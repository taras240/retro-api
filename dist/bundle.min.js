/*! For license information please see bundle.min.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Js:()=>is,$W:()=>ts,ve:()=>ds,ui:()=>ss,VL:()=>ns});const t=Object.freeze({default:{mainColor:"#171A21",secondaryColor:"#202329",accentColor:"#3663D8",fontColor:"#d6d6d6"},white:{mainColor:"#FFFFFF",secondaryColor:"#F0F0F0",accentColor:"#007ACC",fontColor:"#000000"},black:{mainColor:"#050505",secondaryColor:"#202329",accentColor:"#0a7ff5",fontColor:"#ffffff",selectionColor:"rgba(10, 127, 245, 0.1)"},contrastGreen:{mainColor:"#000000",secondaryColor:"#1a1a1a",accentColor:"#FFD700",fontColor:"#00FF00"},blue:{mainColor:"#070F2B",secondaryColor:"#1B1A55",accentColor:"#535C91",fontColor:"#eeeeee"},retro:{mainColor:"#1D2B53",secondaryColor:"#333A73",accentColor:"#387ADF",fontColor:"#cdcdcd"},vintage:{mainColor:"#222831",secondaryColor:"#31363F",accentColor:"#76ABAE",fontColor:"#eeeeee"},lightblue:{mainColor:"#A0E9FF",secondaryColor:"#89CFF3",accentColor:"#00A9FF",fontColor:"#000000"},synthwave:{mainColor:"#5D0E41",secondaryColor:"#A0153E",accentColor:"#FF204E",fontColor:"#dedede"},brown:{mainColor:"#481E14",secondaryColor:"#9B3922",accentColor:"#B35C1E",fontColor:"#eeeeee"}}),s={default:"",Roboto:"https://fonts.googleapis.com/css2?family=Roboto:wght@100..900&display=swap","Pixelify Sans":"https://fonts.googleapis.com/css2?family=Pixelify+Sans&display=swap",Jaro:"https://fonts.googleapis.com/css2?family=Jaro&display=swap",Oxygen:"https://fonts.googleapis.com/css2?family=Oxygen:wght@300;400;700&display=swap",Nunito:"https://fonts.googleapis.com/css2?family=Nunito:wght@200..1000&display=swap"};function i(){return new Promise(((e,t)=>{const s=indexedDB.open("retrocheevosDB",1);s.onupgradeneeded=e=>{e.target.result.createObjectStore("handles")},s.onsuccess=t=>e(t.target.result),s.onerror=e=>t(e.target.error)}))}const n={panel:"./elements/side-panel.elem",status:"./elements/status.elem",note:"./elements/note.elem"};const a={1:"Compilation",2:"Strategy",3:"Casino",4:"Music",5:"Action",6:"Platformer",7:"Puzzle",8:"Quiz",9:"Shooter",10:"Vehicle Simulation",11:"Construction and Management Simulation",12:"Fighting",13:"Sports",14:"Role-Playing",15:"Racing",16:"Beat 'em Up",17:"Adventure",18:"Education",19:"Life Simulation",20:"Board Game",21:"Stealth",22:"Pinball",23:"Flight Simulator",24:"Visual Novel",25:"Horror",26:"Sandbox",27:"Party",28:"MMO"};function o(e,t=!1){if(!isFinite(e))return"";const s=e<0;e=Math.abs(e);let i=Math.floor(e/3600),n=Math.floor(e%3600/60),a=e%60;i=i.toString().padStart(2,"0"),n=n.toString().padStart(2,"0"),a=a.toString().padStart(2,"0");const o=`${s?"-":""}${i>0?i+":":""}${n}:${a}`;return t?0==i?o:`${s?"-":""}${i}<i class="time__blinked-dots">:</i>${n}`:o}function r(e){if(!e)return"--/--";e=+e;let t=Math.floor(e/3600),s=Math.floor(e%3600/60);return t?`${t}h${s}m`:s?`${s}min${s>1?"s":""}`:`${e%60}secs`}function l(e,t){const s={day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1,...t};!/(\+00\:00$)|(z$)/gi.test(e)&&(e+="+00:00");const i=new Date(e);if(isNaN(i.getTime()))return"";return i.toLocaleDateString("uk-UA",s)}function c(e){return new Date(e).toLocaleDateString("uk-UA")}const d={11:"rank x",10:"rank sss",9:"rank ss",8:"rank s",7:"rank a",6:"rank b",5:"rank c",4:"rank d"},h=(Object.fromEntries(Object.entries(d).map((([e,t])=>[e,`mastery: ${t}`]))),Object.freeze({KILLER:"killer",PACIFIST:"pacifist",SCORE:"score",TIMETRIAL:"timetrial",NO_DEATH:"no-death",NO_DAMAGE:"no-damage",COLLECTOR:"collector",BOSSFIGHT:"bossfight"})),u="https://static.retroachievements.org/assets/images/system",m={1:{Name:"Mega Drive",IconURL:`${u}/md.png`},2:{Name:"Nintendo 64",IconURL:`${u}/n64.png`},3:{Name:"SNES",IconURL:`${u}/snes.png`},4:{Name:"Game Boy",IconURL:`${u}/gb.png`},5:{Name:"Game Boy Advance",IconURL:`${u}/gba.png`},6:{Name:"Game Boy Color",IconURL:`${u}/gbc.png`},7:{Name:"NES/Famicom",IconURL:`${u}/nes.png`},8:{Name:"PC Engine",IconURL:`${u}/pce.png`},9:{Name:"Sega CD",IconURL:`${u}/scd.png`},10:{Name:"32X",IconURL:`${u}/32x.png`},11:{Name:"Master System",IconURL:`${u}/sms.png`},12:{Name:"PlayStation",IconURL:`${u}/ps1.png`},13:{Name:"Atari Lynx",IconURL:`${u}/lynx.png`},14:{Name:"Neo Geo Pocket",IconURL:`${u}/ngp.png`},15:{Name:"Game Gear",IconURL:`${u}/gg.png`},16:{Name:"GameCube",IconURL:`${u}/gc.png`},17:{Name:"Atari Jaguar",IconURL:`${u}/jag.png`},18:{Name:"Nintendo DS",IconURL:`${u}/ds.png`},19:{Name:"Wii",IconURL:`${u}/wii.png`},20:{Name:"Wii U",IconURL:`${u}/wiiu.png`},21:{Name:"PlayStation 2",IconURL:`${u}/ps2.png`},22:{Name:"Xbox",IconURL:`${u}/xbox.png`},23:{Name:"Magnavox Odyssey 2",IconURL:`${u}/mo2.png`},24:{Name:"Pokemon Mini",IconURL:`${u}/mini.png`},25:{Name:"Atari 2600",IconURL:`${u}/2600.png`},26:{Name:"DOS",IconURL:`${u}/dos.png`},27:{Name:"Arcade",IconURL:`${u}/arc.png`},28:{Name:"Virtual Boy",IconURL:`${u}/vb.png`},29:{Name:"MSX",IconURL:`${u}/msx.png`},30:{Name:"Commodore 64",IconURL:`${u}/c64.png`},31:{Name:"ZX81",IconURL:`${u}/zx81.png`},32:{Name:"Oric",IconURL:`${u}/oric.png`},33:{Name:"SG-1000",IconURL:`${u}/sg1k.png`},34:{Name:"VIC-20",IconURL:`${u}/vic-20.png`},35:{Name:"Amiga",IconURL:`${u}/amiga.png`},36:{Name:"Atari ST",IconURL:`${u}/ast.png`},37:{Name:"Amstrad CPC",IconURL:`${u}/cpc.png`},38:{Name:"Apple II",IconURL:`${u}/a2.png`},39:{Name:"Saturn",IconURL:`${u}/sat.png`},40:{Name:"Dreamcast",IconURL:`${u}/dc.png`},41:{Name:"PlayStation Portable",IconURL:`${u}/psp.png`},42:{Name:"Philips CD-i",IconURL:`${u}/cd-i.png`},43:{Name:"3DO Interactive Multiplayer",IconURL:`${u}/3do.png`},44:{Name:"ColecoVision",IconURL:`${u}/cv.png`},45:{Name:"Intellivision",IconURL:`${u}/intv.png`},46:{Name:"Vectrex",IconURL:`${u}/vect.png`},47:{Name:"PC-8000/8800",IconURL:`${u}/8088.png`},48:{Name:"PC-9800",IconURL:`${u}/9800.png`},49:{Name:"PC-FX",IconURL:`${u}/pc-fx.png`},50:{Name:"Atari 5200",IconURL:`${u}/5200.png`},51:{Name:"Atari 7800",IconURL:`${u}/7800.png`},52:{Name:"Sharp X68000",IconURL:`${u}/x68k.png`},53:{Name:"WonderSwan",IconURL:`${u}/ws.png`},54:{Name:"Cassette Vision",IconURL:`${u}/ecv.png`},55:{Name:"Super Cassette Vision",IconURL:`${u}/escv.png`},56:{Name:"Neo Geo CD",IconURL:`${u}/ngcd.png`},57:{Name:"Fairchild Channel F",IconURL:`${u}/chf.png`},58:{Name:"FM Towns",IconURL:`${u}/fm-towns.png`},59:{Name:"ZX Spectrum",IconURL:`${u}/zxs.png`},60:{Name:"Game & Watch",IconURL:`${u}/g&w.png`},61:{Name:"Nokia N-Gage",IconURL:`${u}/n-gage.png`},62:{Name:"Nintendo 3DS",IconURL:`${u}/3ds.png`},63:{Name:"Watara Supervision",IconURL:`${u}/wsv.png`},64:{Name:"Sharp X1",IconURL:`${u}/x1.png`},65:{Name:"TIC-80",IconURL:`${u}/tic-80.png`},66:{Name:"Thomson TO8",IconURL:`${u}/to8.png`},67:{Name:"PC-6000",IconURL:`${u}/pc-6000.png`},68:{Name:"Sega Pico",IconURL:`${u}/pico.png`},69:{Name:"Mega Duck",IconURL:`${u}/duck.png`},70:{Name:"Zeebo",IconURL:`${u}/zeebo.png`},71:{Name:"Arduboy",IconURL:`${u}/ard.png`},72:{Name:"WASM-4",IconURL:`${u}/wasm4.png`},73:{Name:"Arcadia 2001",IconURL:`${u}/a2001.png`},74:{Name:"Interton VC 4000",IconURL:`${u}/vc4000.png`},75:{Name:"Elektor TV Games Computer",IconURL:`${u}/elek.png`},76:{Name:"PC Engine CD",IconURL:`${u}/pccd.png`},77:{Name:"Atari Jaguar CD",IconURL:`${u}/jcd.png`},78:{Name:"Nintendo DSi",IconURL:`${u}/dsi.png`},79:{Name:"TI-83",IconURL:`${u}/ti-83.png`},80:{Name:"Uzebox",IconURL:`${u}/uze.png`},81:{Name:"Famicom Disk System",IconURL:`${u}/fds.png`},100:{Name:"Hubs",IconURL:`${u}/hubs.png`},101:{Name:"Events",IconURL:`${u}/events.png`},102:{Name:"Standalone",IconURL:`${u}/exe.png`}},g=({icon:e,label:t="",hint:s=""})=>`<p class="signed-icon" data-title="${s}">${e}${t}</p>`,p={cheevos:e=>g({icon:E.cheevos,label:e,hint:ss.lang.cheevosCount}),points:e=>g({icon:E.points,label:e,hint:ss.lang.points}),retropoints:e=>g({icon:E.retropoints,label:e,hint:ss.lang.retropoints}),rarity:e=>g({icon:E.rarity,label:e,hint:ss.lang.unlockRate}),retroRatio:e=>g({icon:E.retroRatio,label:e,hint:ss.lang.trueRatio}),level:e=>g({icon:E.level,label:e,hint:ss.lang.level}),date:e=>g({icon:E.date,label:e,hint:ss.lang.date}),time:e=>e?g({icon:E.time,label:e,hint:ss.lang.time}):"",rating:e=>g({icon:E.rating,label:e,hint:ss.lang.gameRating}),platform:e=>g({icon:E.platform(e),label:m[e].Name,hint:e}),difficulty:e=>`<p class="description-icon difficult-icon difficult-badge__${e}" data-title="${ss.lang.difficulty} [${e}]"></p>`,award:e=>`<p  class="signed-icon award-type" data-title="${e}">\n    ${E.award(e)}</p>`,empty:e=>g({icon:e}),players:e=>g({icon:E.players,label:e})},v=e=>`<i>${e}</i>`,E={flag:'<i class="description-icon map-icon"></i>',time:v("‚è∞"),level:v("üö©"),points:v("üí∞"),retropoints:v("‚ö°Ô∏è"),cheevos:v("‚≠ê"),trueratio:v("üíé"),players:v("üë•"),date:v("üìÖ"),rating:v("üî•"),rarity:v("üìà"),retroRatio:v("üíé"),masteryAward:v("üèÜ"),progressionAward:v("üéñÔ∏è"),cheevoType:e=>`<i class=" description-icon ${e??"none"}" data-title="[${e??"none"}]"></i> `,chat:'<i class="description-icon link_icon chat-icon"></i>',award:e=>e?`<i class="description-icon award-type__icon ${e}_icon"></i>`:"",favourite:'<i class="description-icon favourite_icon"></i>',apply:'<i class="description-icon link_icon apply-icon"></i>',search:'<i class="description-icon link_icon search-icon google_link"></i>',link:'<i class="description-icon link_icon ra-link_icon"></i>',platform:e=>`<img class="image-icon console-icon" src="${m[e].IconURL}">`,unlock:'<i class="description-icon unlock_icon"></i>'},f={[h.KILLER]:'<i class="cheevo-genre__icon">üíÄ</i>',[h.PACIFIST]:'<i class="cheevo-genre__icon">‚òÆÔ∏è</i>',[h.SCORE]:'<i class="cheevo-genre__icon">üí≤</i>',[h.TIMETRIAL]:'<i class="cheevo-genre__icon">‚è≥</i>',[h.NO_DEATH]:'<i class="cheevo-genre__icon">üëº</i>',[h.NO_DAMAGE]:'<i class="cheevo-genre__icon">‚ù§Ô∏è</i>',[h.COLLECTOR]:'<i class="cheevo-genre__icon">üëë</i>',[h.BOSSFIGHT]:'<i class="cheevo-genre__icon">üòà</i>'};function _(e,t="gameTitle"){return e?.reduce(((e,s)=>{if(!s)return e;if(""==(s=s.toString()).trim())return e;const i=y[t](s);return e.push(i),e}),[]).join(" ")}const y={default:e=>A({text:e}),infoBadge:e=>A({text:e,classes:["badge_transparent"]}),selection:(e,t)=>A({text:e,classes:["badge_selection"],event:`onclick="${t}"`}),black:e=>A({text:e,classes:["badge_black"]}),gold:e=>A({text:e,classes:["badge_gold"]}),gameTitle:e=>A({text:e,classes:[e.toLowerCase().replace(/[\s\'\"\`]/g,"-")]}),gameGenre:e=>A({text:e,classes:["game-title_genre"]}),cheevoLevel:(e,t)=>`<div \n            class="${t?"target-level-badge":""} badge badge_gold" \n            data-title="${ui.lang.level}" >\n            ${E.flag}${e}\n        </div>`,difficultBadge:(e,t="")=>{if(""==e)return"";return`\n            <p class="badge difficult-badge__${e}" >\n                ${t} ${d[e]}\n                    </p >\n            `},hltbBadge:(e,t="")=>y.gold(`HLTB: ${e} `),buttonGenreBadge:(e,t)=>A({text:e,classes:["target-genre-badge","badge-bold","badge_gold","badge-button"],event:`onclick="${t}"`,dataProp:`data-genre="${e}"`})},A=({text:e,classes:t=[],hint:s,event:i,dataProp:n})=>`<i class="${["badge",...t].join(" ")}" ${s?`data-title="${s}"`:""} ${i||""} ${n||""}>${e.trim()}</i>`,T=e=>y.gold(e);function w(e,t=!1){const s=(e,t,s=!0)=>{const i=Array.isArray(t)?[...new Set(t)].join('<span class="popup__value-divider"> | </span>'):t;return s?`\n        <p><span class="popup__prop-title">${e}: </span>${i}</p>\n    `:""},i=e.level?.toString()?.split(".")[1],n=e.zone?i?`${e.zone} [${i}]`:e.zone:e.level?.toString()?.replace(".","-");let a=document.createElement("div");return a.classList.add("cheevo-popup","popup",e.isHardcoreEarned?"hardcore":e.isEarned?"softcore":"f"),a.classList.toggle("fixed",t),a.dataset.id=e.ID,a.innerHTML=`\n        <div class="cheevo-popup__header">\n            <h3 class="cheevo-popup__title">${e.Title}</h3>\n            <div class="cheevo-popup__description"> ${e.Description} </div>\n            ${((e,t)=>{if(!e&&0===t.length)return"";return`\n            <div class="cheevo-popup__icons">${_([e&&`LVL: ${e}`,...t],"selection")}</div>\n        `})(n,e.genres)}\n            <div class="points">\n                ${p.points(e.Points)}\n                ${p.retropoints(e.TrueRatio)}\n                ${p.rarity(e.rateEarnedHardcore)}\n                ${p.retroRatio(e.retroRatio)}\n                ${E.cheevoType(e.Type)}\n                ${y.difficultBadge(e.difficulty)}\n            </div>\n        </div>\n        <div class="cheevo-popup__props">\n            ${s(ui.lang.unlockDate,l(e.DateEarnedHardcore),!!e.DateEarnedHardcore)}\n            ${s(ui.lang.unlockDate+ui.lang.casual_,l(e.DateEarned),!!e.DateEarned&&e.DateEarnedHardcore!=e.DateEarned)}\n            ${s(ui.lang.playersTotal,[e.totalPlayers])}\n            ${s(ui.lang.unlockedBy,[e.NumAwardedHardcore,e.NumAwarded])}\n            ${s(ui.lang.unlockRate,[e.rateEarnedHardcore,e.rateEarned])}\n            ${s(ui.lang.timeToUnlock,[r(e.timeToUnlock),r(e.timeToUnlockSoftcore)])}\n            ${s(ui.lang.created,[c(e.DateCreated),c(e.DateModified)])}\n            ${s(ui.lang.createdBy,e.Author)}\n        </div>\n    `,a}const b=({event:e,onChange:t,id:s,checked:i,label:n,name:a,isRadio:o})=>`\n        <div class="${o?"radio":"checkbox"}-input_container">\n            <input ${[`type="${o?"radio":"checkbox"}"`,s&&`id="${s}"`,`name="${a||s}"`,e,t&&`onchange="${t}"`,i&&"checked"].filter(Boolean).join(" ")}\n            >\n            <label class="checkbox-input" ${s?`for="${s}"`:""}>\n                ${n}\n            </label>\n        </div>\n    `,S=({prefix:e,title:t,id:s,value:i,label:n,onChange:a,isNumber:o,isSearch:r,placeholder:l})=>`\n        <input ${[`type="${o?"number":r?"search":"text"}"`,(t||e)&&`data-title="${t||e}"`,'class="text-input"',s&&`id="${s}"`,void 0!==i&&`value="${i}"`,n&&`placeholder="${n}"`,a&&`onchange="${a}"`].filter(Boolean).join(" ")}\n        />\n    `,I=({id:e,label:t,selectValues:s})=>`\n        <button class="select-button" id="${e}" onclick="this.classList.toggle('extended'); event.stopPropagation();">\n            <div class="select-label">${t}</div>\n            <div class="select-menu">\n                ${s?.map((e=>(({name:e,checked:t,event:s,label:i,id:n,type:a})=>`<li class="context-menu_item">\n                    <input ${[n&&`id="${n}"`,`type="${a||"radio"}"`,e&&`name="${e}"`,t&&"checked",s].filter(Boolean).join(" ")}></input>\n                    <label class="context-menu_${a||"radio"}" for="${n}">\n                        ${i}\n                    </label>\n                </li>\n            `)(e))).join("\n")}\n            </div>\n        </button>\n    `,C=e=>{switch(e.type){case P.TEXT_INPUT:return S(e);case P.SEARCH_INPUT:return t=e,S({...t,isSearch:!0});case P.NUM_INPUT:return(e=>S({...e,isNumber:!0}))(e);case P.BUTTON:return(({event:e,onClick:t,label:s,id:i})=>`\n        <button ${[i&&`id="${i}"`,'class="button-input"',e,t&&`onclick="${t}"`].filter(Boolean).join(" ")}>\n            ${s}\n        </button>\n    `)(e);case P.CHECKBOX:return b(e);case P.STATEBOX:return(({state:e,type:t,value:s,id:i,event:n,label:a,sectionCode:o})=>`\n    <div \n        class="statebox statebox__container checkbox-input" \n        data-state="${e??0}" \n        data-value="${s}" \n        data-event="${n}"\n        id="${i+o}"\n        <p class="statebox__label">${a}</p>\n    </div>\n`)(e);case P.RADIO:return(e=>b({...e,isRadio:!0}))(e);case P.SELECTOR:return I(e);case P.GROUP:return(({label:e})=>`\n       <div class="group-header">${e}</div>\n    `)(e);case P.COLOR:return(({onChange:e,value:t,id:s,label:i})=>{const n=`const container = this.closest('.color-input__container');\n    if (container) container.style.setProperty('--color', this.value);\n     container.querySelector('.text-input').value = this.value;container.querySelector('.color-input').value = this.value;${e}`;return`\n        <div class="color-input__container" style="--color:${t}">\n            <div class="color-input__preview" onclick="this.nextElementSibling.click()"></div>\n            <input \n                type="color" \n                class="color-input" \n                onchange="${n}" \n                value="${t}" \n                id="${s}" \n                data-title="${i}" \n            />\n            ${S({title:i,label:t,value:t,onChange:n})}\n        </div>\n    `})(e);default:return`[${e.type} N/A]`}var t},P=Object.freeze({CHECKBOX:"checkbox",STATEBOX:"statebox",RADIO:"radio",NUM_INPUT:"number",TEXT_INPUT:"text",SEARCH_INPUT:"search",SELECTOR:"selector",BUTTON:"button",GROUP:"group",COLOR:"color"}),D=({menuItems:e,sectionCode:t="",isSubmenu:s=!1})=>{const i=document.createElement("ul");return i.className=s?"context-menu_item-menu context-submenu":"achievement_context-menu context-menu hidden",e.forEach((e=>{const s=e.hasOwnProperty("elements");let n=document.createElement("li");n.className=`context-menu_item ${s&&"expandable"}`,e&&(s?(n.innerHTML+=e.label,n.appendChild(D({menuItems:e.elements,isSubmenu:!0,sectionCode:t}))):n.innerHTML+=$[e.type](e),i.appendChild(n))})),i.addEventListener("contextmenu",(e=>e.stopPropagation())),i.addEventListener("mousedown",(e=>e.stopPropagation())),ss.AUTOCLOSE_CONTEXTMENU||i.addEventListener("click",(e=>e.stopPropagation())),i.querySelectorAll(".context-menu_statebox")?.forEach((e=>e.addEventListener("click",L))),i},$={[P.CHECKBOX]:({type:e,name:t,id:s,checked:i,event:n,label:a,sectionCode:o=""})=>`\n        <input \n            type="${e}" \n            name="context-${t||s}${o}" \n            id="context-${s}${o}" \n            ${n??""}\n            ${i?"checked":""} \n            ></input>\n        <label class="context-menu_${e}" for="context-${s}${o}">${a}</label>`,radio:e=>$.checkbox(e),statebox:({state:e,type:t,value:s,id:i,event:n,label:a,sectionCode:o=""})=>`\n        <div \n            class="context-menu_statebox" \n            data-state="${e??0}" \n            data-value="${s}" \n            data-event="${n}"\n            id="context-${i+o}"\n            <p class="statebox__label">${a}</p>\n        </div>\n    `,[P.NUM_INPUT]:({prefix:e,type:t,id:s,event:i,title:n,value:a,postfix:o,sectionCode:r=""})=>`\n        ${e}\n        <input \n            class="context-menu_${t}" \n            id="context-${s}-${r}" \n            type="number" \n            data-title="${n}" \n            value="${a??""}" \n            ${i||""} \n            onclick="event.stopPropagation()">\n                ${o??""} \n        </input>`,[P.TEXT_INPUT]:({prefix:e,type:t,id:s,event:i,title:n,value:a,postfix:o,sectionCode:r=""})=>`\n        ${e}\n        <input \n            class="context-menu_${t}" \n            id="context-${s}-${r}" \n            type="text" \n            data-title="${n}" \n            value="${a??""}" \n            ${i||""} \n            onclick="event.stopPropagation()">\n                ${o??""} \n        </input>`,range:({prefix:e,event:t,minRange:s,maxRange:i,value:n,id:a,sectionCode:o=""})=>`\n        ${e}\n        <input \n            class="slider" \n            id="context-${a}-${o}"\n            type="range" \n            ${t??""} \n            min="${s}" \n            max="${i}" \n            value="${n}">`,button:({type:e,id:t,sectionCode:s,event:i,label:n=""})=>`\n            <button \n                class="context-menu_${e}" \n                id="context-${t}-${s}" \n                ${i??""} \n                type="button"\n            >\n                ${n??"NOLABEL"}\n            </button>`};function L(e){const t=e.target,s=+t.dataset.state,i=1===s?-1:s+1,n=t.dataset.value;t.dataset.state=i,t.dataset.event&&new Function("event","state","filterName",t.dataset.event)(e,i,n)}const k=Object.freeze({AWARD:"award",CHEEVO:"cheevo",GAME:"game",STATS:"stats"}),R=e=>new Promise((t=>setTimeout(t,e))),N=({BadgeName:e})=>`https://media.retroachievements.org/Badge/${e}.png`,O=e=>`https://media.retroachievements.org${e}`,M=e=>`https://retroachievements.org/game/${e}`,H=({ID:e})=>`https://retroachievements.org/achievement/${e}`,x=Object.freeze({MASTERED:"mastered",COMPLETED:"completed",BEATEN:"beaten",BEATEN_SOFTCORE:"beaten-softcore"});let G=[];function U(e){e.forEach((e=>{G.push(e),1===G.length&&B()}))}async function B(){const{fsAlertDuration:e,fsNewCheevo:t,fsNewAward:s}=ds,{app:i}=ss,n=()=>y.default(ss.lang.casual),a=(e,t)=>{const{ImageIcon:s,Title:a}=e,{MASTERED:o,COMPLETED:r,BEATEN:l,BEATEN_SOFTCORE:c}=x,d={[o]:ss.lang.masteryUnlocked,[r]:`${ss.lang.masteryUnlocked} ${n()}`,[l]:ss.lang.gameBeaten,[c]:`${ss.lang.gameBeaten} ${n()}`};i.querySelectorAll(".fs-alert__container").forEach((e=>e.remove()));const h=document.createElement("div");return h.className="fs-alert__container",h.innerHTML=`\n            <div class="fs-alert__main-content">\n                <div class="fs-alert__border fs-alert__border-top"></div>\n                <div class="fs-alert__header">${d[t]}</div>\n                <div class="fs-alert__sub-border "></div>\n                <div class="fs-alert__image-container">\n                    <div class="fs-alert__light"></div>\n                    <img src="${O(s)}" alt="" class="fs-alert__image">\n                    <div class="fs-alert__blick"></div>\n                </div>\n                <div class="fs-alert__description">${a}</div>\n                <div class="fs-alert__border fs-alert__border-botton"></div>\n            </div>\n        `,h},o=({isHardcoreEarned:e,Title:t,BadgeName:s,Points:a,TrueRatio:o,rateEarned:r,rateEarnedHardcore:l,difficulty:c,Description:d})=>{i.querySelectorAll(".fs-alert__container").forEach((e=>e.remove()));const h=document.createElement("div");h.className="fs-alert__container";const u=e?ss.lang.achievementUnlocked:`${ss.lang.achievementUnlocked} ${n()}`;return h.innerHTML=`\n            <div class="fs-alert__main-content">\n                <div class="fs-alert__border fs-alert__border-top"></div>\n                <div class="fs-alert__header">${u}</div>\n                <div class="fs-alert__sub-border"></div>\n                <div class="fs-alert__image-container">\n                    <div class="fs-alert__light"></div>\n                    <img src="${N({BadgeName:s})}" alt="" class="fs-alert__image">\n                    <div class="fs-alert__blick"></div>\n                </div>\n                <div class="fs-alert__title">\n                    ${t}\n                </div>\n                <div class="fs-alert__border fs-alert__border-botton"></div>\n                <div class="fs-alert__description">\n                    ${d}\n                </div>\n            </div>\n        `,h};for(;G.length>0;){if(alert=G[0],alert.type===k.CHEEVO&&!t||alert.type===k.AWARD&&!s){G.shift();continue}let n;switch(alert.type){case k.AWARD:n=a(alert.value,alert.award);break;case k.CHEEVO:n=o(alert.value)}i.appendChild(n),await R(1e3*e).then((async()=>{n?.classList.add("hide-fs-alert"),await R(1e3)})).then((()=>{n?.remove(),G.shift()}))}}const F=16766720,V=12632256,q="https://taras240.github.io/retro-api/assets/img/overlay_sets/mario_q/q.png";async function W({message:e="",type:t,value:s,award:i,id:n}){const a=ds.targetUser||ts.USER_NAME,r=ds.discordWebhook;if(!r)return;let l={};const c=ns.GAME_DATA;switch(t){case k.GAME:l=(e=>({header:`${a} has launched the game: \n${e.Title}`,description:`\n          Platform: ${e.ConsoleName}\n          Realeased: ${e.Released}\n          Achievements: ${e.NumAwardedToUserHardcore} / ${e.NumAchievements}\n          Points: ${e.unlockData.hardcore.points} / ${e.unlockData.softcore.points} / ${e.totalPoints}\n          Retropoints:  ${e.unlockData.hardcore.retropoints} / ${e.totalRetropoints}\n        `,color:65280,url:M(e.ID),image:O(e.ImageIcon)}))(c);break;case k.AWARD:await R(2e3),l=((e,t)=>({header:`${a} has ${t.toUpperCase()} the game: \n${e.Title}`,description:`\n          Earned in: ${o(e.TimePlayed)}\n          Platform: ${e.ConsoleName}\n          Realeased: ${e.Released}\n          Achievements: ${e?.unlockData?.hardcore.count} / ${e?.unlockData?.softcore.count} / ${e.NumAchievements}\n          Points: ${e.unlockData.hardcore.points} / ${e.unlockData.softcore.points} / ${e.totalPoints}\n          Retropoints: ${e.unlockData.hardcore.retropoints} / ${e.totalRetropoints}\n        `,color:"beaten"==t||"mastered"==t?F:V,url:M(e.ID),image:O(e.ImageIcon)}))(c,i);break;case k.CHEEVO:l=((e,t)=>{const s=`${a} unlocked cheevo${t.isHardcoreEarned?"":" (casual mode)"}: \n${t.Title}`,i=`\n        Game: [${e.Title}](${M(e.ID)})\n        Unlocked in: ${o(e.TimePlayed)}\n        Description: ${t.Description}\n        Points: ${t.Points}\n        Retropoints:  ${t.TrueRatio}\n        `;return{header:s,description:i,color:t.isHardcoreEarned?F:V,url:H(t),image:t.prevSrc}})(c,s)}const d={username:"RETROCHEEVOS",avatar_url:q,embeds:[{thumbnail:{url:l.image},title:l.header,url:l.url,color:l.color,description:l.description.replace(/\n[ \t]*/g,"\n"),footer:{text:"retrocheevos.vercel.app"},timestamp:(new Date).toISOString()}]};fetch(r,{body:JSON.stringify(d),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(e){})).catch((function(e){console.log(e)}))}function j(e,t){const s=new Blob([e],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(s),n=document.createElement("a");n.href=i,n.download=`${t}.csv`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}const z={completion:async function(){const e=await is.completionProgress(),t=e?.Results.map((e=>({Title:e.Title,ID:e.GameID,Platform:m[e.ConsoleID]?.Name??"-",Award:e.HighestAwardKind,AwardDate:e.HighestAwardDate&&new Date(e.HighestAwardDate).toLocaleString(),LastEarnedDate:e.MostRecentAwardedDate&&new Date(e.MostRecentAwardedDate).toLocaleString(),TotalAchievements:e.NumAchievements,EarnedAchievements:e.NumAwardedHardcore,EarnedAchievementsSoftcore:e.NumAwarded,PlayedTime:o(ts.gamesDB[e.GameID]?.TimePlayed),Notes:ts.gamformatTimeesDB[e.GameID]?.notes?.replace(/;|\n/g," ")})));if(!t||0==t.length)return;const s=[...Object.keys(t[0])],i=t.map((e=>[e.Title,e.ID,e.Platform,e.Award,e.AwardDate,e.LastEarnedDate,e.TotalAchievements,e.EarnedAchievements,e.EarnedAchievementsSoftcore,e.PlayedTime,e.Notes]));j([s.join(";"),...i.map((e=>e.join(";")))].join("\n"),"completion")},wantToPlay:async function(){const e=await is.getWantToPlayGamesList({count:500}),t=e?.map((e=>({Title:e.Title,ID:e.ID,ConsoleName:m[e.ConsoleID]?.Name??"-",AchievementsPublished:e.AchievementsPublished}))),s=[...Object.keys(t[0])],i=t.map((e=>[e.Title,e.ID,e.ConsoleName,e.AchievementsPublished]));j([s.join(";"),...i.map((e=>e.join(";")))].join("\n"),"wantToPlay")}};async function K({direction:e}){const t=localStorage.getItem("retroApiConfig"),s=JSON.parse(t);switch(s.apiWorker&&delete s.apiWorker.completionProgress,s.version=ui.VERSION,e){case"file":!function(e,t){const s=new Blob([JSON.stringify(e)],{type:"text/json;charset=utf-8;"}),i=URL.createObjectURL(s),n=document.createElement("a");n.href=i,n.download=`${t}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}(s,`RCSettings_v${s.version}`);break;case"clipboard":await async function(e){if(navigator.clipboard)await navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch(e){console.error("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ (fallback):",e)}document.body.removeChild(t)}}(t);break;case"discord":!function({jsonData:e,fileName:t,message:s}){const i=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=new FormData;n.append("file",i,`${t}.json`),n.append("payload_json",JSON.stringify({username:"RETROCHEEVOS",avatar_url:q})),fetch(ds.discordWebhook,{method:"POST",body:n}).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);console.log("–§–∞–π–ª –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!")})).catch((e=>console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ:",e)))}({jsonData:s,fileName:`RCSettings_v${s.version}`,message:"retrocheevos settings file"})}}function X(e,t){const s=(e,t,s,i=10)=>s+e+i<t?s+i:s-e-i<0?5:s-e-i,i=document.documentElement.clientWidth,n=document.documentElement.clientHeight,a=t.x,o=t.y;e.style.top=s(e.offsetHeight,n,o)+"px",e.style.left=s(e.offsetWidth,i,a)+"px"}function Y({x:e,y:t,stickySection:s}){const{clientHeight:i,clientWidth:n}=s;let a=t,o=e;if(!1===ts.ui.isWindowsSticky)return{newXPos:o,newYPos:a};const r=ss.STICK_TOLERANCE,l=ss.STICK_MARGIN,c=[{check:e=>Math.abs(t+i-e.offsetTop-e.clientHeight)<r,action:e=>a=e.offsetTop+e.clientHeight-i},{check:e=>Math.abs(t-e.offsetTop)<r,action:e=>a=e.offsetTop},{check:e=>Math.abs(t-e.offsetTop-e.clientHeight)<r,action:e=>a=e.offsetTop+e.clientHeight+l},{check:e=>Math.abs(t+i-e.offsetTop)<r,action:e=>a=e.offsetTop-i-l},{check:t=>Math.abs(e+n-t.offsetLeft-t.clientWidth)<r,action:e=>o=e.offsetLeft+e.clientWidth-n},{check:t=>Math.abs(e-t.offsetLeft)<r,action:e=>o=e.offsetLeft},{check:t=>Math.abs(e+n-t.offsetLeft)<r,action:e=>o=e.offsetLeft-n-l},{check:t=>Math.abs(e-t.offsetLeft-t.clientWidth)<r,action:e=>o=e.offsetLeft+e.clientWidth+l}];return document.querySelectorAll(".section").forEach((e=>{s!=e&&c.forEach((({check:t,action:s})=>t(e)&&s(e)))})),o=Math.abs(window.innerWidth-o-n)<r?window.innerWidth-n:o,o=Math.abs(o)<r?0:o,a=Math.abs(window.innerHeight-a-i)<r?window.innerHeight-i:a,a=Math.abs(a)<r?0:a,{newXPos:o,newYPos:a}}function Q(e,t){const s=t=>{!function(e,t,s,i){e.preventDefault();const n=e.clientX-t,a=e.clientY-s,{newXPos:o,newYPos:r}=Y({x:n,y:a,stickySection:i});i.style.left=o+"px",i.style.top=r+"px"}(t,c,d,e)},i=e=>{e.preventDefault(),n(),a()},n=()=>{e.classList.remove("dragable"),o.removeEventListener("mousemove",s),o.removeEventListener("mouseup",i)},a=()=>{ts.setNewPosition({id:e.id,xPos:e.style.left,yPos:e.style.top})},{app:o}=ss,{left:r,top:l}=e.getBoundingClientRect(),c=t.clientX-r,d=t.clientY-l;e.classList.add("dragable"),o.addEventListener("mousemove",s),o.addEventListener("mouseup",i)}const J={top:"N",left:"W",right:"E",bottom:"S",topRight:"NE",topLeft:"NW",bottomRight:"SE",bottomLeft:"SW"};function Z({event:e,section:t,callback:s,resizeDirection:i=J.bottomRight}){const{app:n}=ss,a=parseInt(window.getComputedStyle(t).minWidth??10);let o={startWidth:t.clientWidth,startHeight:t.clientHeight,windowTop:t.offsetTop,windowLeft:t.offsetLeft,startX:e.clientX,startY:e.clientY,minWidth:a};const r=e=>{t.classList.add("resized",`resised-${i}`),function(e,t,s,i=J.bottomRight){let{startWidth:n,startHeight:a,windowLeft:o,windowTop:r,startX:l,startY:c,minWidth:d}=t;const h=o+n,u=r+a;let m=r,g=o,p=i.includes(J.right)?e.clientX-l:l-e.clientX,v=i.includes(J.bottom)?e.clientY-c:c-e.clientY,E=n,f=a;i.includes(J.top)&&(m-=v);i.includes(J.left)&&(g-=p);let{newXPos:_,newYPos:y}=Y({x:g,y:m,stickySection:s});i.includes(J.top)&&(v=u-y-a);i.includes(J.left)&&(p=h-_-n);2===i.length?(E+=p,f+=v):["E","W"].includes(i)?E+=p:f+=v;let{newHeight:A,newWidth:T}=function({width:e,height:t,stickySection:s}){const{offsetTop:i,offsetLeft:n}=s;let a=e,o=t;if(!1===ts.ui.isWindowsSticky)return{newWidth:a,newHeight:o};const{STICK_TOLERANCE:r,STICK_MARGIN:l}=ss,c=[{check:e=>Math.abs(i+t-e.offsetTop-e.clientHeight)<r,action:e=>o=e.offsetTop+e.clientHeight-i},{check:e=>Math.abs(i+t-e.offsetTop)<r,action:e=>o=e.offsetTop-i-l},{check:t=>Math.abs(n+e-t.offsetLeft-t.clientWidth)<r,action:e=>a=e.offsetLeft+e.clientWidth-n},{check:t=>Math.abs(n+e-t.offsetLeft)<r,action:e=>a=e.offsetLeft-n-l}];return document.querySelectorAll(".section").forEach((e=>{s!=e&&c.forEach((({check:t,action:s})=>t(e)&&s(e)))})),a=Math.abs(window.innerWidth-n-a)<r?window.innerWidth-n:a,o=Math.abs(window.innerHeight-i-o)<r?window.innerHeight-i:o,{newWidth:a,newHeight:o}}({width:E,height:f,stickySection:s});if(d>=T)return;s.style.width=`${T}px`,s.style.height=`${A}px`,s.style.left=_+"px",s.style.top=y+"px"}(e,o,t,i)},l=e=>{s&&s(),t.classList.remove("resized",`resised-${[i]}`),c(),d()},c=()=>{n.removeEventListener("mousemove",r),n.removeEventListener("mouseup",l)},d=()=>{ts.setNewPosition({id:t.id,width:t.clientWidth,height:t.clientHeight,xPos:t.style.left,yPos:t.style.top})};n.addEventListener("mousemove",r),n.addEventListener("mouseup",l)}const ee=(e,t)=>{const{left:s,top:i,width:n,height:a}=t.getBoundingClientRect(),o=s,r=i,l=s+n,c=i+a,d=e.clientX-o<=5,h=l-e.clientX<=5,u=e.clientY-r<=5,m=c-e.clientY<=5;let g="";return u?g=J.top:m&&(g=J.bottom),d?g+=J.left:h&&(g+=J.right),g},te=(e,t,s)=>`\n    <button \n        class="${e?"game-props-button":"edit-cheevo-button"} header-button header-icon edit-icon"\n        data-title="${ss.lang.editPropsHint}" \n        ${e?"":`data-cheevo-id="${t}"`} \n        onclick="${s}">\n    </button>\n`,se=(e,t=[])=>`<button class="comments-button header-button header-icon chat-icon ${t.join(" ")}" data-title="${ss.lang.showCommentsHint}" onclick="${e}"></button>`,ie=e=>te(!0),ne=(e,t)=>te(!1,e,t),ae=e=>`<button class="header-button header-icon tweak-button tweak-icon" data-title="${ss.lang.widgetConfigHint}" onclick="${e}"></button>`,oe=()=>`<button class="header-button header-icon  delete-icon delete-from-target" data-title="${ss.lang.removeFromTargetHint}"></button>`,re=e=>`<button class="header-icon header-button close-icon" onclick="${e}" data-title="${ss.lang.close}"></button>`,le=(e,t)=>`<button class="header-button header-icon sort-icon" id="${e}-sort-button" data-title="${ss.lang.sort}"></button>`,ce=(e,t)=>`<button class="header-button header-icon filter-icon" id="${e}-filter-button" data-title="${ss.lang.filter}"></button>`,de=(e,t)=>`<button class="header-button header-icon external-icon" id="${e}-external_window-button" data-title="Open in external window"></button>`,he=e=>`<button class="header-button header-icon update-icon" data-title="${ss.lang.forceReloadHint}" onclick="${e}"></button>`,ue=e=>`\n        <button class="header-button header-icon fullscreen-button fullscreen-icon" data-title="${ss.lang.fullscreen}" onclick="${e}"></button>\n    `,me=(e=[],t="")=>`\n        <div class="${e.join(" ")}">\n            ${t}\n        </div>\n    `,ge=()=>me(["resizer"]);class pe{widgetIcon={imageSource:"../assets/img/gamepad.svg",iconID:"widget-id",iconClass:"gamepad-icon",onChangeEvent:""};uiProps=new Proxy({},{get:(e,t)=>{const s=this.uiDefaultValues[t]??!0;return ts.getUIProperty({sectionID:this.sectionID,property:t})??s},set:(e,t,s)=>{const i=this.uiValuePreprocessors[t];"function"==typeof i&&(s=i(s)),ts.saveUIProperty({sectionID:this.sectionID,property:t,value:s});const n=this.uiSetCallbacks?.[t];return"function"==typeof n?n.call(this,s):this.setElementsValues(),!0}});uiDefaultValues={};uiSetCallbacks={};uiValuePreprocessors={};get VISIBLE(){return!this.section.classList.contains("hidden")&&!!ts.ui[this.section?.id]}set VISIBLE(e){Vt.switchSectionVisibility({section:this.section,visible:e}),this.widgetIcon.element&&(this.widgetIcon.element.checked=e)}constructor(){}addEvents(){this.section.addEventListener("mousedown",(e=>{const t=ee(e,this.section);0===e.button&&(e.target.matches(".close-icon")?this.close():e.target.matches(".tweak-button")?this.contextMenuItems&&ss.settings.openSettings(this.contextMenuItems):e.target.matches(".resizer")||t?(this.section.classList.add("resized"),Z({event:e,section:this.section,resizeDirection:e.target.matches(".resizer")?J.bottomRight:t,callback:this.resizeCallback})):e.target.closest(".header-container")&&Q(this.section,e))})),this.section.addEventListener("mousemove",(e=>{this.section.classList.remove(...Object.values(J).map((e=>"hover-"+e)),"resize-hover","grab-hover");let t=ee(e,this.section);t?this.section.classList.add(`hover-${t}`,"resize-hover"):e.target.closest(".header-container")&&this.section.classList.add("grab-hover")})),this.section.addEventListener("mouseleave",(e=>{this.section.classList.remove(...Object.values(J).map((e=>"hover-"+e)),"resize-hover")})),Array.isArray(this.contextMenuItems)&&this.section.addEventListener("contextmenu",(e=>{ss.showContextmenu({event:e,menuItems:this.contextMenuItems,sectionCode:this.CLONE_NUMBER||""})}))}addWidgetIcon(){const e=!1===ts.ui?.[this.section?.id]?.hidden??!this.VISIBLE,{iconID:t,onChangeEvent:s,description:i,iconClass:n,badgeLabel:a}=this.widgetIcon,o=document.querySelector(".buttons-block__shortcuts"),r=document.createElement("div");r.classList.add("setting-radio-group"),r.innerHTML=`\n            <input type="checkbox" name="${t}" id="${t}" onchange="${s}" ${e?"checked":""}></input>\n            <label class="side-panel_input" data-title="${i}" for="${t}">\n                    <i class="side-panel__icon ${n}"></i>\n            </label>\n            <div class="side-panel__badge">\n                ${a?y.black(a):""}\n            </div>`,o.appendChild(r),this.widgetIcon.element=document.getElementById(t)}generateWidgetElement({classes:e,id:t,title:s,headerElementsHtml:i,contentClasses:n}){const a=document.createElement("section");return a.classList.add(...e),a.id=t,a.innerHTML=`\n            <div class="header-container">\n                <div class="header-icon ${this.widgetIcon.iconClass}"></div>\n                <h2 class="widget-header-text">${s}</h2>\n                ${i??""}\n                ${re()}\n            </div>\n            <div class="${n?n.join(" "):"widget-content__container"}"></div>\n            ${ge()}`,a}open(){}close(){this.VISIBLE=!1}}const ve=Object.freeze({PROGRESSION:"progression",MISSABLE:"missable",WIN:"win_condition"});const Ee={earned:({DateEarnedHardcore:e})=>e,earnedSoftcore:({DateEarned:e,DateEarnedHardcore:t})=>!t&&e,notEarned:({DateEarnedHardcore:e,DateEarned:t})=>!e&&!t,missable:({Type:e})=>e===ve.MISSABLE,progression:({Type:e})=>e===ve.PROGRESSION||e===ve.WIN,typeless:e=>!Ee.progression(e)&&!Ee.missable(e),all:()=>!0,genre:({genres:e,genre:t})=>e?.includes(t),level:({level:e},{targetLevel:t})=>parseInt(e)===parseInt(t),group:({group:e,targetGroup:t})=>e===t,leveless:({level:e})=>!e},fe=Object.freeze({UNLOCKED:"earned",UNLOCKED_SOFT:"earnedSoftcore",MISSABLE:"missable",PROGRESSION:"progression"}),_e="all",ye="genre";async function Ae({container:e,itemClassName:t,sortMethod:s,reverse:i,strictMode:n=!1,animationDuration:a}){const o=[...e.querySelectorAll(t)].sort(((e,t)=>s(e.dataset,t.dataset,i,n)));a?await async function(e,t,s=500){const i=[...e.children],n=new Map;i.forEach((e=>{n.set(e,e.getBoundingClientRect())})),t.forEach((t=>e.appendChild(t))),t.forEach((async(e,t)=>{e.style.zIndex=1e3-t,setTimeout((()=>e.style.removeProperty("z-index")),s+100);const i=n.get(e),a=e.getBoundingClientRect(),o=i.left-a.left,r=i.top-a.top;e.style.transform=`translate(${o}px, ${r}px)`,e.style.transition="transform 0s",e.offsetHeight,e.style.transition=`transform ${s}ms`,e.style.transform=""})),await R(s+100)}(e,o,a):(e.innerHTML="",o.forEach((t=>{e.appendChild(t)})))}function Te(e){return new Date(e)}const we={latestHardcore:(e,t,s=1,i=!1)=>{if(e.DateEarnedHardcore||t.DateEarnedHardcore){const s=e.DateEarnedHardcore?Te(e.DateEarnedHardcore):-1/0;return(t.DateEarnedHardcore?Te(t.DateEarnedHardcore):-1/0)-s}return we.latest(e,t)},latest:(e,t,s=1,i=!1)=>{const n=e.DateEarnedHardcore?Te(e.DateEarnedHardcore):e.DateEarned?Te(e.DateEarned):0,a=t.DateEarnedHardcore?Te(t.DateEarnedHardcore):t.DateEarned?Te(t.DateEarned):0;return i&&n*a==0&&n+a!==0?a?1:-1:(a-n)*s},raLatest:(e,t,s=1,i)=>we.latest(e,t,-1,!0)*s,earnedCount:(e,t,s=1)=>(t.NumAwardedHardcore-e.NumAwardedHardcore)*s,unlockRate:(e,t,s=1)=>we.earnedCount(e,t,s),rarest:(e,t,s=1)=>we.earnedCount(e,t,s),points:(e,t,s=1)=>(e.Points-t.Points)*s,truepoints:(e,t,s=1)=>(e.TrueRatio-t.TrueRatio)*s,trueRatio:(e,t,s=1)=>(e.TrueRatio/e.Points-t.TrueRatio/t.Points)*s,default:(e,t,s=1)=>0!=e.DisplayOrder?(e.DisplayOrder-t.DisplayOrder)*s:we.unlockRate(e,t,s),id:(e,t)=>e.ID-t.ID,disable:(e,t)=>0,level:(e,t,s,i=!1)=>!i||e.level&&t.level||!e.level&&!t.level?e.level||t.level?e.level?t.level?(e.level-t.level)*s:-1*s:1*s:i?0:we.default(e,t,s):t.level?1:-1,timeToUnlock:(e,t,s,i=!1)=>!i||e.timeToUnlock&&t.timeToUnlock||!e.timeToUnlock&&!t.timeToUnlock?e.timeToUnlock||t.timeToUnlock?e.timeToUnlock?t.timeToUnlock?(e.timeToUnlock-t.timeToUnlock)*s:-1*s:1*s:i?0:we.difficulty(e,t,s):t.timeToUnlock?1:-1,difficulty:(e,t,s)=>{let i=e.difficulty-t.difficulty;return 0==i&&(i=t.NumAwardedHardcore-e.NumAwardedHardcore),i*s},rating:(e,t)=>t.Rating-e.Rating,achievementsCount:(e,t)=>parseInt(e.NumAchievements)-parseInt(t.NumAchievements),title:(e,t)=>{let s=e.Title.toUpperCase(),i=t.Title.toUpperCase();return s<i?-1:s>i?1:0},award:(e,t)=>{const s={mastered:5,completed:4,"beaten-hardcore":3,"beaten-softcore":2,started:1},i=s[t.Award]??0,n=s[e.Award]??0,a=new Date(t.MostRecentAwardedDate),o=new Date(e.MostRecentAwardedDate);return i-n!=0?i-n:a-o},date:(e,t)=>(e.Date?Te(e.Date):-1/0)-(t.Date?Te(t.Date):-1/0)},be=Object.freeze({TIME_TO_UNLOCK:"timeToUnlock",UNLOCK_DATE:"latest",UNLOCK_DATE_RA:"raLatest",TRUE_RATIO:"trueRatio",DIFFICULTY:"difficulty",UNLOCK_RATE:"unlockRate",POINTS:"points",TRUE_POINTS:"truepoints",DEFAULT:"default",LEVEL:"level"}),Se="latest",Ie="points",Ce="default",Pe="date";function De({container:e,itemClassName:t,filters:s,isHide:i}){const n=e.querySelectorAll(t),a=s&&Object.values(s)?.filter((e=>1==e?.state)),o=s&&Object.values(s)?.filter((e=>-1==e?.state));n.forEach((e=>e.classList.remove("hidden","removed")));a?.length>0&&n.forEach((e=>e.classList.add("hidden",i?"removed":"f"))),a?.forEach((e=>{n.forEach((t=>{Ee[e.filterName]({...t.dataset,...e})&&t.classList.remove("hidden","removed")}))})),o?.forEach((e=>{n.forEach((t=>{Ee[e.filterName](t.dataset)&&t.classList.add("hidden",i?"removed":"f")}))}))}const $e=Object.freeze({UNLOCK_STATUS:"unlockStatus",TYPE:"type",LEVEL:"level"});async function Le({container:e,element:t,scrollByX:s=!0,scrollByY:i=!0}){if(!e||!t)return;const n=e.getBoundingClientRect(),a=t.getBoundingClientRect(),o=a.top-n.top+e.scrollTop-e.clientHeight/2+t.offsetHeight/2,r=a.left-n.left+e.scrollLeft-e.clientWidth/2+t.offsetWidth/2;e.scrollTo({top:i?o:e.scrollTop,left:s?r:e.scrollLeft,behavior:"smooth"}),await R(600)}const ke="border",Re={DISABLED:"disabled",BLUR:"blur",GRAYSCALE:"grayscale",OPACITY:"opacity"};class Ne extends pe{widgetIcon={description:"cheevos widget",iconClass:"achievements-icon"};filters={};get contextMenuItems(){return[{label:ss.lang.style,elements:[{type:P.CHECKBOX,id:"show-load-anim",label:ss.lang.showLoadAnimation,checked:this.uiProps.showLoadAnimation,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.showLoadAnimation = this.checked"`},{type:P.CHECKBOX,id:"show-mario",label:ss.lang.unlockAnimation,checked:this.uiProps.showMario,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.showMario = this.checked"`},{type:P.CHECKBOX,id:"autoscroll-achieves",label:ss.lang.autoscroll,checked:this.uiProps.autoscroll,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.autoscroll = this.checked;"`},{type:P.CHECKBOX,id:"stretch-achieves",label:ss.lang.stretch,checked:this.uiProps.stretchAchievements,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.stretchAchievements = this.checked;"`},{prefix:ss.lang.minSize,postfix:"px",type:P.NUM_INPUT,id:"menu_min-size",label:ss.lang.minSize,value:this.uiProps.ACHIV_MIN_SIZE,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.ACHIV_MIN_SIZE = this.value;"`,onChange:`ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.ACHIV_MIN_SIZE = this.value;`},{prefix:ss.lang.maxSize,postfix:"px",type:P.NUM_INPUT,id:"menu_max-size",label:ss.lang.maxSize,value:this.uiProps.ACHIV_MAX_SIZE,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.ACHIV_MAX_SIZE = this.value;"`,onChange:`ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.ACHIV_MAX_SIZE = this.value;`}]},{label:ss.lang.elements,elements:[{label:ss.lang.showHeader,type:P.CHECKBOX,id:"hide-achivs-header",checked:this.uiProps.showHeader,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.showHeader = this.checked;"`},{label:ss.lang.showBackground,type:P.CHECKBOX,id:"show-bg",checked:this.uiProps.bgVisibility,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.bgVisibility = this.checked;"`}]},{label:ss.lang.overlay,elements:[{type:P.CHECKBOX,id:"hide-unearned",label:ss.lang.showOverlay,checked:this.uiProps.showPrevOverlay,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.showPrevOverlay = this.checked"`},...Object.values(Re).map((e=>({type:P.RADIO,name:`${this.sectionID}-preview-filter`,id:`${this.sectionID}-preview-filter-${e}`,label:e,checked:this.uiProps.lockedPreviewFilter===e,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.lockedPreviewFilter = '${e}';"`})))]},this.contextSortMenu(),this.contextFilterMenu(),this.contextMultiGameMenu(),{label:ss.lang.groupBy,elements:[{type:P.CHECKBOX,id:"grouping",label:ss.lang.groupElements,checked:this.uiProps.isGrouping,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.isGrouping = this.checked;"`},...Object.values($e).map((e=>({type:P.RADIO,name:`${this.sectionID}-group`,id:`${this.sectionID}-group-${e}`,label:ss.lang[e],value:e,checked:this.uiProps.groupBy===e,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.groupBy = '${e}';"`}))),{type:P.CHECKBOX,id:"grouping-title",label:ss.lang.showCheevosGroupTitle,checked:this.uiProps.showGroupHeader,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.showGroupHeader = this.checked;"`}]}]}contextSortMenu=()=>({label:ss.lang.sort,elements:[...Object.values(be).map((e=>({type:P.RADIO,name:`${this.sectionID}-sort`,id:`${this.sectionID}-sort-${e}`,label:ss.lang[e],checked:this.uiProps.sortName===e,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.sortName = '${e}';"`}))),{type:P.CHECKBOX,id:"reverse-sort",label:ss.lang.reverse,checked:-1==this.uiProps.reverseSort,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.reverseSort = this.checked"`},{type:P.CHECKBOX,id:"strict-sort",label:ss.lang.strictMode,checked:this.uiProps.strictSort,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.strictSort = this.checked"`}]});contextFilterMenu=()=>({label:ss.lang.filter,elements:[...Object.values(fe).map((e=>({type:P.STATEBOX,name:`${this.sectionID}-filter`,id:`${this.sectionID}-filter-${e}`,label:ss.lang[e],value:e,state:`${this.uiProps.filters[e]?.state??0}`,event:`ui.achievementsBlock[${this.CLONE_NUMBER}].setFilter({ state, filterName })`}))),{type:P.CHECKBOX,id:"hide-filtered",label:ss.lang.hideFiltered,checked:this.uiProps.hideFiltered,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.hideFiltered = this.checked;"`}]});contextMultiGameMenu=()=>ns.GAME_DATA?.groups?.length>1?{label:ss.lang.multigame,elements:[{type:P.RADIO,name:`${this.sectionID}-mgame`,id:`${this.sectionID}-mgame-all`,label:ss.lang.all,checked:!this.uiProps.mGameSelection,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.mGameSelection = '';"`},...ns.GAME_DATA.groups.map((e=>({type:P.RADIO,name:`${this.sectionID}-mgame`,id:`${this.sectionID}-mgame-${e}`,label:e,checked:this.uiProps.mGameSelection===e,event:`onchange = "ui.achievementsBlock[${this.CLONE_NUMBER}].uiProps.mGameSelection = '${e}';"`})))]}:"";uiDefaultValues={showHeader:!0,overlayType:ke,ACHIV_MIN_SIZE:60,ACHIV_MAX_SIZE:128,stretchAchievements:!1,isGrouping:!1,groupBy:$e.UNLOCK_STATUS,autoscroll:!0,showPrevOverlay:!0,showMario:!0,showLoadAnimation:!1,showGroupHeader:!0,sortName:Se,reverseSort:1,strictSort:!1,filterBy:_e,hideFiltered:!1,reverseFilter:!1,lockedPreviewFilter:Re.GRAYSCALE,mGameSelection:""};uiSetCallbacks={ACHIV_MIN_SIZE(e){this.fitSizeVertically()},ACHIV_MAX_SIZE(e){this.fitSizeVertically()},isGrouping(e){this.groupCheevos()},groupBy(){this.groupCheevos()},showGroupHeader(e){this.groupCheevos()},autoscroll(e){e?this.startAutoScroll():this.stopAutoScroll()},showPrevOverlay(e){this.container.querySelectorAll(".achiv-block").forEach((t=>t.classList.toggle("overlay",e)))},sortName(e){this.applySorting()},reverseSort(){this.applySorting()},strictSort(){this.applySorting()},filterBy(e){this.applyFiltering()},hideFiltered(e){this.applyFiltering()},lockedPreviewFilter(){this.setElementsValues()},mGameSelection(){this.setMGameSelection()}};uiValuePreprocessors={ACHIV_MIN_SIZE:e=>e<=10?10:e,ACHIV_MAX_SIZE:e=>e<=20?20:e,reverseSort:e=>e?-1:1};get SECTION_NAME(){return 0===this.CLONE_NUMBER?"achievements_section":`achievements_section-${this.CLONE_NUMBER}`}get CLONE_NUMBER(){return this._cloneNumber}set CLONE_NUMBER(e){this._cloneNumber=e?.length?e.length:0,this.widgetIcon={...this.widgetIcon,iconID:`side-panel__cheevos-${this.CLONE_NUMBER}`,onChangeEvent:`ui.achievementsBlock[${this.CLONE_NUMBER}].VISIBLE = this.checked`}}constructor(e=!1){super(),this.CLONE_NUMBER=ss.achievementsBlock,this.isClone=e,this.addWidgetIcon(),this.initializeElements(),this.addEvents(),this.setValues()}initializeElements(){this.section=this.generateNewWidget({}),this.sectionID=this.section.id,document.querySelector(".wrapper").appendChild(this.section),this.container=this.section.querySelector(".achievements-container"),this.resizer=this.section.querySelector(`#achivs-resizer${this.CLONE_NUMBER}`),this.resizeCallback=()=>this.fitSizeVertically(!0)}addEvents(){super.addEvents(),this.section.querySelector(`#${this.SECTION_NAME}-filter-button`).addEventListener("click",(e=>{ss.showContextmenu({event:e,menuItems:this.contextFilterMenu().elements,sectionCode:this.SECTION_NAME})})),this.section.querySelector(`#${this.SECTION_NAME}-sort-button`).addEventListener("click",(e=>{ss.showContextmenu({event:e,menuItems:this.contextSortMenu().elements,sectionCode:this.SECTION_NAME})})),new Sortable(this.container,{group:{name:"cheevos",pull:"clone",push:"false"},animation:100,chosenClass:"dragged",onEnd:()=>ss.addEvents()})}setElementsValues(){this.section.classList.toggle("hide-bg",!this.uiProps.bgVisibility),this.section.classList.toggle("compact",!this.uiProps.showHeader),this.container.style.alignContent=this.uiProps.stretchAchievements?"space-around":"start",this.container.style.justifyContent=this.uiProps.stretchAchievements?"space-around":"center",this.section.dataset.previewFilter=this.uiProps.lockedPreviewFilter}setValues(){Vt.applyPosition({widget:this}),this.setElementsValues(),ts.ui[this.SECTION_NAME]&&(this.section.style.top=ts.ui[this.SECTION_NAME].y??"0px",this.section.style.left=ts.ui[this.SECTION_NAME].x??"0px",this.section.style.height=ts.ui[this.SECTION_NAME].height??"600px",this.section.style.width=ts.ui[this.SECTION_NAME].width??"350px"),this.uiProps.autoscroll&&this.startAutoScroll(),this.filters=ts.getUIProperty({sectionID:this.section.id,property:"filters"})??{}}parseGameAchievements(e){(()=>{this.container.innerHTML=""})(),(e=>{Object.values(e.Achievements).forEach((e=>{const t=this.generateAchievement(e);this.container.appendChild(t)})),this.groupCheevos()})(e),this.fitSizeVertically(),this.setMGameSelection(),this.applyFiltering(),this.applySorting({animation:0}),this.uiProps.showLoadAnimation&&this.doLoadAnimation(),this.startAutoScroll()}generateAchievement(e){const t=document.createElement("li");var s;return s=this,t.classList.add("achiv-block"),t.classList.toggle("start-load-anim",s.uiProps.showLoadAnimation),t.classList.toggle("overlay",s.uiProps.showPrevOverlay),t.classList.toggle("earned",e.isEarned),t.classList.toggle("hardcore",e.isHardcoreEarned),t.classList.toggle("rare",e.difficulty>7),t.dataset.achivId=e.ID,t.dataset.Points=e.Points,t.dataset.TrueRatio=e.TrueRatio,e.TrueRatio>50&&(t.dataset.rarity="normal"),e.TrueRatio>150&&(t.dataset.rarity="rare"),e.TrueRatio>300&&(t.dataset.rarity="mythycal"),t.dataset.DisplayOrder=e.DisplayOrder,t.dataset.Type=e.Type,t.dataset.difficulty=e.difficulty,t.dataset.group=e.group,e.level&&(t.dataset.level=e.level),t.dataset.NumAwardedHardcore=e.NumAwardedHardcore,e.DateEarnedHardcore&&(t.dataset.DateEarnedHardcore=e.DateEarnedHardcore),e.DateEarned&&(t.dataset.DateEarned=e.DateEarned),t.dataset.timeToUnlock=e.timeToUnlock,t.innerHTML=`\n        <div class="preview-container">\n          <img class="achiv-preview" src="${e.prevSrc}"  alt="${e.Title} icon"/>\n          <div class="prev-lock-overlay"></div>\n          <div class="box-inner-shadow"></div>\n        </div>\n        `,t}fitSizeVertically(e=!1){const{section:t,container:s,sectionID:i}=this;let n,a;s.style.flex="1",e||!ts.getUIProperty({sectionID:i,property:"height"})?(n=s.clientHeight,a=s.clientWidth):(n=parseInt(ts.ui[this.SECTION_NAME].height)-t.querySelector(".header-container").clientHeight,a=parseInt(ts.ui[this.SECTION_NAME].width)),s.style.flex="";const o=s.querySelectorAll(".achiv-block:not(.removed)").length;if(0===o)return;let r=Math.floor(Math.sqrt(a*n/o));do{r--,this.section.style.setProperty("--achiv-height",r+"px"),t.offsetHeight}while(s.scrollHeight>s.offsetHeight&&r>this.uiProps.ACHIV_MIN_SIZE);if(r=r<this.uiProps.ACHIV_MIN_SIZE?this.uiProps.ACHIV_MIN_SIZE:r>this.uiProps.ACHIV_MAX_SIZE?this.uiProps.ACHIV_MAX_SIZE:r,s.scrollHeight>s.offsetHeight+2){const e=1,t=~~(s.offsetWidth/(+r+1)),i=s.offsetWidth/t-(t-1)*e;r=i-r<r?~~i:r}this.section.style.setProperty("--achiv-height",r+"px")}autoscrollInterval={};async updateEarnedAchieves({earnedAchievementIDs:e}){await R(100),this.stopAutoScroll();for(let t of e){const e=ns.CHEEVOS[t],s=this.container.querySelector(`.achiv-block[data-achiv-id="${t}"]`),i=null===e.offsetParent;!this.uiProps.showMario||i?(s.classList.add("earned"),s.classList.toggle("hardcore",e.isHardcoreEarned)):(await Le({container:this.container,element:s,scrollByX:!1}),await this.marioAction(s,e)),await R(100),e.DateEarnedHardcore&&(s.dataset.DateEarnedHardcore=e.DateEarnedHardcore),s.dataset.DateEarned=e.DateEarned}this.container.scrollTo({top:0,left:0,behavior:"smooth"}),await R(500),this.applyFiltering(),await this.applySorting(),await R(2e3),this.startAutoScroll()}async marioAction(e,t){const s=t.isHardcoreEarned,i=document.createElement("div");i.classList.add("mario__container","stand"),this.container.appendChild(i);const n=i.getBoundingClientRect().width,a=e?.getBoundingClientRect(),o={xPos:a.left,yPos:a.top+n},r=2*n,l=a.left>window.innerWidth/2,c={xPos:l?window.innerWidth+n:-n,yPos:o.yPos+r},d=70;let h=Math.sqrt(20*r);i.style.top=c.yPos+"px",i.style.left=c.xPos+"px";const u=()=>{const i=document.createElement("div");i.classList.add("coin__container");const n=s?t.TrueRatio+"RP":t.Points+"SP";i.innerHTML=`\n                <div class='coins__points'>+${n}</div>\n                <div class='coins__coin'></div>\n            `,this.section.appendChild(i),this.section.classList.add("focus"),i.style.top=a.top-a.height/2+"px",i.style.left=o.xPos+"px",e?.classList.add("earned","mario-dumb"),e?.classList.toggle("hardcore",s),setTimeout((()=>e?.classList.remove("mario-dumb")),500),setTimeout((()=>{i.remove(),this.section.classList.remove("focus")}),5e3)};await(async()=>{let e=c.xPos;for(i.classList.remove("stand"),i.classList.add("walk"),i.classList.toggle("to-left",l),i.style.setProperty("--frame-duration","70ms");e!==o.xPos;)l?(e-=20,e<o.xPos&&(e=o.xPos)):(e+=20,e>o.xPos&&(e=o.xPos)),i.style.left=e+"px",await R(d);i.classList.remove("walk"),i.classList.add("stand"),await R(500)})(),await(async()=>{i.classList.remove("stand"),i.classList.add("jump");let e=c.yPos;for(;~~h>0;)e-=h,h-=10,e<o.yPos?(e=o.yPos-2,i.style.top=e+"px"):(i.style.top=e+"px",await R(d));for(u(),h=0;e<c.yPos;)e+=h,h+=10,e>c.yPos&&(e=c.yPos),i.style.top=e+"px",await R(d);i.classList.remove("jump"),i.classList.add("stand"),await R(500),i.classList.toggle("to-left",!l),await R(500)})(),await(async()=>{let e=i.getBoundingClientRect().left;for(i.style.setProperty("--frame-duration","52.5ms"),i.className=`mario__container walk ${l?"":"to-left"} `;e!==c.xPos;)l?(e+=20,e>c.xPos&&(e=c.xPos)):(e-=20,e<c.xPos&&(e=c.xPos)),i.style.left=e+"px",await R(52.5)})(),i.remove(),await R(100)}startAutoScroll(e=!0){clearTimeout(this.autoscrollInterval.timeout),clearInterval(this.autoscrollInterval.interval);let t=this.container,s=1;this.uiProps.autoscroll&&(this.autoscrollInterval.interval=setInterval((()=>{t.scrollHeight-t.clientHeight<=10&&this.stopAutoScroll(),e?(t.scrollTop+=s,t.scrollTop+t.clientHeight>=t.scrollHeight&&(clearInterval(this.autoscrollInterval.interval),this.autoscrollInterval.timeout=setTimeout((()=>this.startAutoScroll(!1)),15e3))):(t.scrollTop-=s,0===t.scrollTop&&(clearInterval(this.autoscrollInterval.interval),this.autoscrollInterval.timeout=setTimeout((()=>this.startAutoScroll(!0)),15e3)))}),50),t.addEventListener("mouseenter",(()=>{s=0})),t.addEventListener("mouseleave",(()=>{s=1})))}stopAutoScroll(){clearInterval(this.autoscrollInterval.interval),clearTimeout(this.autoscrollInterval.timeout)}isAllEarnedAchievesVisible(){let e=!0;return this.container.querySelectorAll(".earned").forEach((t=>{!this.isAchieveVisible(t)&&(e=!1)})),e}isAchieveVisible(e){let t=!0;const s=this.container.getBoundingClientRect().top,i=this.container.getBoundingClientRect().height,n=e.getBoundingClientRect().top-s,a=e.getBoundingClientRect().top-s+e.getBoundingClientRect().height;return(n<0||a>i)&&(t=!1),t}highlightCurrentLevel(e){[...this.container.querySelectorAll(".achiv-block")].forEach((t=>{if(t.classList.remove("highlight"),t.dataset.level==e&&t.classList.add("highlight"),!Number.isInteger(e)){const s=parseInt(e);t.dataset.level==s&&t.classList.add("highlight")}}))}async applySorting(e={animation:500}){await Ae({container:this.container,itemClassName:".achiv-block",sortMethod:we[this.uiProps.sortName],reverse:this.uiProps.reverseSort,strictMode:this.uiProps.strictSort,animationDuration:this.uiProps.isGrouping?0:e.animation}),this.groupCheevos()}applyFiltering(){De({container:this.container,itemClassName:".achiv-block",filters:this.filters,isHide:this.uiProps.hideFiltered}),this.groupCheevos()}setFilter({filterName:e,state:t,type:s,event:i}){0===t?delete this.filters[e]:this.filters[e]={filterName:e,state:t},ts.saveUIProperty({sectionID:this.section.id,property:"filters",value:this.filters}),this.applyFiltering()}setMGameSelection(){const e=this.container.querySelectorAll(".achiv-block");if(!this.uiProps.mGameSelection||ns.GAME_DATA.groups?.includes(this.uiProps.mGameSelection)){{const t=e=>this.uiProps.mGameSelection&&this.uiProps.mGameSelection!==e.dataset.group;e.forEach((e=>e.classList.toggle("hidden-group",t(e))))}this.groupCheevos()}else this.uiProps.mGameSelection=""}doLoadAnimation(){const e=this.container,t=e.querySelectorAll(".achiv-block");const s=e=>new Promise((t=>setTimeout(t,e)));setTimeout((()=>function(){const i=e.scrollHeight;e.style.setProperty("--top-position",-i+"px");let n=0;[...t].reverse().forEach((async e=>{const t=100*n+200;!e.classList.contains("removed")&&n++;const i=t+1e3;e.style.setProperty("--load-delay",t+"ms"),e.classList.add("start-load-anim"),await s(50),e.classList.add("show-load-anim"),await s(i+500),e.classList.remove("show-load-anim","start-load-anim")}))}()),0)}generateNewWidget({}){const e=document.createElement("section");return e.id=`${this.SECTION_NAME}`,e.classList.add("achivs","section"),e.style.width=ts.ui.achievements_section?.width??"350px",e.style.height=ts.ui.achievements_section?.height??"650px",e.innerHTML=`\n        <div class="header-container achievements-header_container">\n          <div class="header-icon achievements-icon">\n          </div>\n          <h2 class="widget-header-text achivs-header-text">${ss.lang.cheevosSectionName}${0===this.CLONE_NUMBER?"":" ~"}</h2>\n            ${ce(this.SECTION_NAME)}\n            ${le(this.SECTION_NAME)}\n            ${ae()}\n            ${re()}\n        </div>\n        <ul class="achievements-container content-container"></ul>\n        ${ge()}\n      `,e}groupCheevos(){const e=(e,t,s,...i)=>{const n=[...s].filter((e=>t(e.dataset,...i)));if(0===n.length)return;const a=document.createElement("div");a.classList.add("cheevos__group"),a.classList.toggle("compact",!this.uiProps.showGroupHeader),a.innerHTML=`\n                <div class="cheevos__group-header"><h3 class="cheevos__group-title">${e}</h3></div>\n                <div class="cheevos__group-container"></div>\n                </div>\n            `,this.container.appendChild(a),n.forEach((e=>a.querySelector(".cheevos__group-container").appendChild(e)))},t=e=>{e.forEach((e=>this.container.appendChild(e))),this.fitSizeVertically()},s=this.container.querySelectorAll(".achiv-block");if(this.container.innerHTML="",this.uiProps.isGrouping){switch(this.uiProps.groupBy){case"unlock_status":case $e.UNLOCK_STATUS:e(ss.lang.earned,Ee.earned,s),e(ss.lang.earnedSoftcore,Ee.earnedSoftcore,s),e(ss.lang.locked,Ee.notEarned,s);break;case $e.TYPE:e(ss.lang.progression,Ee.progression,s),e(ss.lang.missable,Ee.missable,s),e(ss.lang.other,Ee.typeless,s);break;case $e.LEVEL:const t=[...s].map((({dataset:e})=>Number(e.level))).filter((e=>!Number.isNaN(e))),i=Math.max(0,...t),n=Math.min(0,...t),{zones:a}=ns.GAME_DATA,o=a?.length>2;for(let t=n;t<=i;t++)e(`Level: ${o?a[t-1]:t}`,Ee.level,s,{targetLevel:t});e(ss.lang.other,Ee.leveless,s)}this.fitSizeVertically()}else t(s)}}class Oe extends pe{widgetIcon={iconClass:"info-icon"};constructor(e){super(),this.generatePopupElement(e),this.initializeElements(),this.addEvents(),this.VISIBLE=!0,Vt.applyPosition({widget:this})}generatePopupElement({id:e,classList:t=[],title:s,content:i}){this.close(e);const n=document.createElement("section");n.classList.add("popup-section","section",...t),n.id=e,n.innerHTML=`\n            <div class="header-container">\n                <div class="header-icon ${this.widgetIcon.iconClass}"></div>\n                <h2 class="widget-header-text">${s}</h2>\n                ${re()}\n            </div>\n            <div class="widget-content__container">\n                ${i}\n            </div>\n            ${ge()}`,this.section=n,ss.app.appendChild(n)}initializeElements(){}addEvents(){super.addEvents(),this.section.addEventListener("click",(e=>{if(e.target.matches(".comment__copy-button")){const t=e.target.parentElement?.innerText;navigator.clipboard.writeText(t||"")}else if(e.target.matches(".comment__note-button")){const t=e.target.parentElement?.innerText,s=ns.GAME_DATA?.ID||"main";let i=ts.gamesDB[s]?.notes??"";i+="\n-----------------\n"+t+"\n-----------------\n",ss.note.saveNoteValue({id:s,value:i.trim()}),ss.note.switchActiveTab(),ss.note.switchActiveTab()}}))}close(e){e?document.querySelector(`#${e}`)?.remove():super.close()}}async function Me(e,t=2){const s=await(is?.getComments({id:e,type:t}))||[];let i="";i=s.length>0?`\n            <ul class="comments-list scrollable">\n                ${s.map((e=>`\n                    <li class="comment">\n                        <div class="comment__header">\n                            <h3 class="comment__user-name">${e.User}</h3>\n                            <div class="comment__date">${xe(e)}</div>\n                        </div>\n                        <div class="comment__comment">\n                          <button data-title="copy to clipboard" class="icon-button description-icon copy-icon comment__copy-button"></button>\n                          <button data-title="copy to note" class="icon-button description-icon note-icon comment__note-button"></button>\n                          ${He(e)}\n                        </div>\n                    </li>\n                `)).join("\n")}\n            </ul>`:'<h2 style="width: 100%;padding: 1rem; font-size: 2rem; text-align:center">No comments yet</h2>';new Oe({title:(1===t?"Game":2===t?"Cheevo":"User")+" comments",content:i,id:`comments_type-${t}`})}const He=({CommentText:e})=>e?.replace(/\bhttp(?:s)*:\/\/[^\s]*\b/g,(e=>`<a href='${e}' target='_blank'>${e}</a>`)),xe=({Submitted:e})=>new Date(e).toLocaleString();function Ge(){const e=e=>[{label:ss.lang.title,elements:[{type:"text",title:ss.lang.cheevoTitleHint,id:"cheevo-props-title",value:e?.Title??""}]},{label:ss.lang.description,elements:[{type:"text",title:ss.lang.cheevoDescrHint,id:"cheevo-props-description",value:e?.Description??""}]},{label:ss.lang.genre,elements:[{type:"text",title:ss.lang.editGenreHint,id:"cheevo-props-genres",value:e?.genres?.join(",")??""}]},{label:ss.lang.levelName,elements:[{type:"text",title:ss.lang.levelNameHint,id:"cheevo-props-zonename",value:e?.zone??""}]},{label:ss.lang.levelNumber,elements:[{type:"number",title:ss.lang.editlevelHint,id:"cheevo-props-level",value:e?.level??""}]},{elements:[{id:"reset-cheevo-props",label:ss.lang.resetData,type:"button"},{id:"save-cheevo-props",label:ss.lang.saveData,type:"button"}]}];let t;const s=(e,t)=>{Object.keys(e).length>0?ts.cheevosDB[t]=e:delete ts.cheevosDB[t],ts.writeConfiguration()},i=(e,i)=>{e.querySelector("#save-cheevo-props")?.addEventListener("click",(()=>((e,t)=>{const i=t.ID,n=is.gameData?.Achievements[i],a=(e=>({Title:e.querySelector("#cheevo-props-title")?.value,Description:e.querySelector("#cheevo-props-description")?.value,zone:e.querySelector("#cheevo-props-zonename")?.value,level:e.querySelector("#cheevo-props-level")?.value,genres:e.querySelector("#cheevo-props-genres").value?.length>1?e.querySelector("#cheevo-props-genres").value.split(","):[]}))(e);Object.keys(a).forEach((e=>{ns.CHEEVOS[i][e]=a[e],a[e]==n[e]&&delete a[e]})),s(a,i),ns.resetCheevo(i)})(e,i))),e.querySelector("#reset-cheevo-props")?.addEventListener("click",(()=>(async(e,i)=>{const a=i.ID,o=is.gameData?.Achievements[a];ns.CHEEVOS[a].Title=o.Title,ns.CHEEVOS[a].Description=o.Description,ns.CHEEVOS[a].zone=o.zone,ns.CHEEVOS[a].level=o.level,ns.CHEEVOS[a].genres=o.genres||[],s({},a),ns.resetCheevo(a),t?.section?.remove(),n(o)})(0,i)))},n=s=>{var n;t=new Oe({title:s?.Title,content:(n=e(s),`\n        <ul class="game-props__list flex-column-list">\n        ${n.map((e=>`\n            <li class="game-props__item">${e.label??""}\n                ${e.elements.map((e=>C(e))).join("\n")}\n            </li>\n        `)).join("\n")}\n        </ul>\n    `),id:"cheevo-data-popup",classList:["game-data__section"]}),i(t.section,s)};return{open:n}}const Ue="gameTimes",Be="completionProgress",Fe="aotw";class Ve extends pe{sectionCode="-target";widgetIcon={description:"target widget",iconID:"side-panel__target",onChangeEvent:"ui.target.VISIBLE = this.checked",iconClass:"target-icon"};filters={};externalWindow;get contextMenuItems(){return[{label:ss.lang.style,elements:[{label:ss.lang.showBackground,type:P.CHECKBOX,id:"hide-target-bg",checked:!this.uiProps.hideBg,event:'onchange="ui.target.uiProps.hideBg = !this.checked;"'},{type:P.CHECKBOX,id:"fixed-count-switcher",label:ss.lang.fixedSize,checked:this.uiProps.isFixedSize,event:'onchange="ui.target.uiProps.isFixedSize = this.checked;"'},{prefix:ss.lang.cheevosCount,postfix:"",type:P.NUM_INPUT,id:"fixed-count",label:ss.lang.cheevosCount,value:this.uiProps.fixedSizeCount,event:'onchange="ui.target.uiProps.fixedSizeCount = this.value;"',onChange:"ui.target.uiProps.fixedSizeCount = this.value;"},{type:P.CHECKBOX,id:"autoscroll-target",label:ss.lang.autoscroll,checked:this.uiProps.autoscroll,event:'onchange="ui.target.uiProps.autoscroll = this.checked;"'},{type:P.CHECKBOX,id:"contrast-highlight-target",label:ss.lang.contrastHighlight,checked:this.uiProps.contrastHighlight,event:'onchange="ui.target.uiProps.contrastHighlight = this.checked;"'}]},{label:ss.lang.overlay,elements:[{type:P.CHECKBOX,id:"show-overlay",label:ss.lang.showOverlay,checked:this.uiProps.showPrevOverlay,event:'onchange="ui.target.uiProps.showPrevOverlay = this.checked"'},...Object.values(Re).map((e=>({type:P.RADIO,name:`${this.sectionID}-preview-filter`,id:`${this.sectionID}-preview-filter-${e}`,label:e,checked:this.uiProps.lockedPreviewFilter===e,event:`onchange="ui.target.uiProps.lockedPreviewFilter = '${e}';"`})))]},{label:ss.lang.elements,elements:[{label:ss.lang.showHeader,type:P.CHECKBOX,id:"hide-target-header",checked:this.uiProps.showHeader,event:'onchange="ui.target.uiProps.showHeader = this.checked;"'},{type:P.CHECKBOX,id:"show-genre-badge",label:ss.lang.showGenreBadges,checked:this.uiProps.showGenre,event:'onchange="ui.target.uiProps.showGenre = this.checked;"'},{type:P.CHECKBOX,id:"show-level",label:ss.lang.showLevel,checked:this.uiProps.showLevel,event:'onchange="ui.target.uiProps.showLevel = this.checked"'},{type:P.CHECKBOX,id:"show-events-checkbox",label:ss.lang.showEvents,checked:this.uiProps.showEvents,event:'onchange="ui.target.uiProps.showEvents = this.checked"'},{type:P.CHECKBOX,id:"progression-bar",label:ss.lang.showCheevoUnlockRateBar,checked:this.uiProps.showCheevoUnlockRateBar,event:'onchange="ui.target.uiProps.showCheevoUnlockRateBar = this.checked;"'}]},this.contextSortMenu(),this.contextFilterMenu(),this.contextMultiGameMenu(),{label:ss.lang.level_test,elements:[{type:P.CHECKBOX,id:"hide-passed-levels",label:ss.lang.hidePassedLevels,checked:this.uiProps.hidePassedLevels,event:'onchange="ui.target.uiProps.hidePassedLevels = this.checked;"'},{type:P.CHECKBOX,id:"highlight-passed",label:ss.lang.highLightPassedLevels,checked:this.uiProps.highlightPassedLevels,event:'onchange="ui.target.uiProps.highlightPassedLevels = this.checked;"'}]},{label:ss.lang.data,elements:[{type:P.BUTTON,id:"fill",label:ss.lang.fillAll,event:'onclick="ui.target.fillItems()"'},{type:P.CHECKBOX,id:"autofill",label:ss.lang.autofill,checked:this.uiProps.autoFillTarget,event:'onchange="ui.target.uiProps.autoFillTarget = this.checked;"'},{type:P.BUTTON,id:"clear-all",label:ss.lang.clearAll,event:'onclick="ui.target.clearAllAchivements();"'},{type:P.CHECKBOX,id:"autoclear",label:ss.lang.autoclearEarned,checked:this.uiProps.autoClearTarget,event:'onchange="ui.target.uiProps.autoClearTarget = this.checked;"'},{prefix:ss.lang.clearDelay,postfix:"sec",type:P.NUM_INPUT,id:"autoclear-delay",label:ss.lang.clearDelay,value:this.uiProps.autoClearTargetTime,event:'onchange="ui.target.uiProps.autoClearTargetTime = this.value;"',onChange:"ui.target.uiProps.autoClearTargetTime = this.value;"}]}]}contextSortMenu=()=>({label:ss.lang.sort,elements:[...Object.values(be).map((e=>({type:P.RADIO,name:`${this.sectionID}-sort`,id:`${this.sectionID}-sort-${e}`,label:ss.lang[e],checked:this.uiProps.sortName===e,event:`onchange="ui.target.uiProps.sortName = '${e}';"`}))),{type:P.CHECKBOX,id:"reverse-sort",label:ss.lang.reverse,checked:-1==this.uiProps.reverseSort,event:'onchange="ui.target.uiProps.reverseSort = this.checked"'},{type:P.CHECKBOX,id:"strict-sort",label:ss.lang.strictMode,checked:this.uiProps.strictSort,event:'onchange="ui.target.uiProps.strictSort = this.checked"'}]});contextFilterMenu=()=>({label:ss.lang.filter,elements:[...Object.values(fe).map((e=>({type:P.STATEBOX,name:`${this.sectionID}-filter`,id:`${this.sectionID}-filter-${e}`,label:ss.lang[e],value:e,state:`${this.uiProps.filters[e]?.state??0}`,event:"ui.target.uiProps.filters = ({ state, filterName })"}))),{type:P.CHECKBOX,id:"hide-filtered",label:ss.lang.hideFiltered,checked:this.uiProps.hideFiltered,event:'onchange="ui.target.uiProps.hideFiltered = this.checked;"'}]});contextMultiGameMenu=()=>ns.GAME_DATA?.groups?.length>1?{label:ss.lang.multigame,elements:[{type:P.RADIO,name:`${this.sectionID}-mgame`,id:`${this.sectionID}-mgame-all`,label:ss.lang.all,checked:!this.uiProps.mGameSelection,event:"onchange=\"ui.target.uiProps.mGameSelection = '';\""},...ns?.GAME_DATA?.groups?.map((e=>({type:P.RADIO,name:`${this.sectionID}-mgame`,id:`${this.sectionID}-mgame-${e}`,label:e,checked:this.uiProps.mGameSelection===e,event:`onchange = "ui.target.uiProps.mGameSelection = '${e}';"`})))??[]]}:"";uiDefaultValues={isFixedSize:!1,fixedSizeCount:2,showHeader:!0,hideBg:!1,showCheevoUnlockRateBar:!1,autoClearTarget:!1,autoFillTarget:!0,autoClearTargetTime:5,autoscroll:!1,showDifficult:!0,showLevel:!0,showGenre:!0,hidePassedLevels:!1,highlightPassedLevels:!0,showEvents:!1,reverseSort:1,strictSort:!1,sortName:Ce,filters:{},hideFiltered:!1,lockedPreviewFilter:Re.OPACITY,showPrevOverlay:!0,contrastHighlight:!1,mGameSelection:""};uiSetCallbacks={autoscroll(e){e?this.startAutoScroll():this.stopAutoScroll()},showLevel(e){this.container.querySelectorAll(".target-achiv").forEach((t=>t.classList.toggle("show-level",e)))},showGenre(e){this.container.querySelectorAll(".target-achiv").forEach((t=>t.classList.toggle("show-genre",e)))},reverseSort(e){this.applySort()},sortName(){this.applySort()},strictSort(){this.applySort()},filters(){this.applyFilter()},hideFiltered(){this.filterByGenre(this.genreFilter,!0)},lockedPreviewFilter(){this.setElementsValues()},showPrevOverlay(){this.setElementsValues()},contrastHighlight(){this.setElementsValues()},mGameSelection(){this.setMGameSelection()}};uiValuePreprocessors={newAchivDuration:e=>e<=5||e>60?5:e,fixedSizeCount:e=>e<1?1:~~e,autoClearTargetTime:e=>e<0?0:+e,reverseSort:e=>e?-1:1,filters({filterName:e,state:t}){const s=ss.target.uiProps.filters;return 0===t?delete s[e]:s[e]={filterName:e,state:t},s}};constructor(){super(),this.generateWidget(),this.addWidgetIcon(),this.initializeElements(),this.addEvents(),this.setValues(),this.showAotwEvent()}initializeElements(){this.section=document.querySelector("#target_section"),this.sectionID=this.section.id,this.header=document.querySelector(".target-header_container"),this.container=document.querySelector(".target-container"),this.searchInput=this.section.querySelector("#target__searchbar")}generateWidget(){const e="target_section",t=`\n            ${ce(e)}\n            ${le(e)}\n            ${ae()}\n            <input type="search" name="" id="target__searchbar" class="text-input target__search-bar" placeholder="${ss.lang.search}">\n            ${de(e)}\n        `,s={classes:["target_section","section","compact-header"],id:e,title:ss.lang.targetSectionName,headerElementsHtml:t,contentClasses:["target-container","content-container","flex-main-list"]},i=this.generateWidgetElement(s);ss.app.appendChild(i)}toggleExternalWindow(){const e=(e,t=250)=>{this.externalUpdateTimer&&clearTimeout(this.externalUpdateTimer),this.externalUpdateTimer=setTimeout((()=>e.apply(this)),t)},t=()=>{const t=new MutationObserver((t=>{e((()=>this.updateExternalWindow()))}));return t.observe(this.container,{childList:!0,characterData:!0,subtree:!0,attributes:!0}),t};if(this.externalWindow)this.externalWindow.close(),delete this.externalWindow,this.containerObserver?.disconnect(),this.externalUpdateTimer&&clearTimeout(externalUpdateTimer);else{this.externalUpdateTimer,this.externalWindow=window.open("","Target",`width=${this.section.offsetWidth},\n                height=${this.section.offsetHeight}`),this.externalWindow.document.write("\n            <html>\n              <head>\n                <title>Target Window</title>\n              </head>\n              <body></body>\n            </html>\n            "),this.externalWindow.document.close(),[...document.querySelectorAll('link[rel="stylesheet"], style')].forEach((e=>{this.externalWindow.document.head.appendChild(e.cloneNode(!0))}));const e=this.externalWindow.document.body,s=getComputedStyle(document.body);for(let t=0;t<s.length;t++){const i=s[t];if(i.startsWith("--")){const t=s.getPropertyValue(i);e.style.setProperty(i,t)}}e.innerHTML=`\n                <section style='height: 100%; display: flex'>\n                    ${this.container.outerHTML}\n                </section>`,this.containerObserver=t()}}updateExternalWindow(){if(!this.externalWindow)return;this.externalWindow.document.body.innerHTML=`\n                <section style='height: 100%; display: flex'>\n                    ${this.container.outerHTML}\n                </section>`}addEvents(){super.addEvents(),this.section.querySelector(`#${this.sectionID}-filter-button`)?.addEventListener("click",(e=>{ss.showContextmenu({event:e,menuItems:this.contextFilterMenu().elements,sectionCode:this.SECTION_NAME})})),this.section.querySelector(`#${this.sectionID}-sort-button`)?.addEventListener("click",(e=>{ss.showContextmenu({event:e,menuItems:this.contextSortMenu().elements,sectionCode:this.SECTION_NAME})})),this.section.querySelector(`#${this.sectionID}-external_window-button`).addEventListener("click",(e=>{ss.target.toggleExternalWindow()})),this.container.addEventListener("click",(e=>{if(e.target.closest(".comments-button")){const t=e.target.closest(".target-achiv")?.dataset.achivId;t&&Me(t,2)}else if(e.target.matches(".edit-cheevo-button")){const t=e.target.dataset.cheevoId,s=ns.CHEEVOS[t];s&&Ge().open(s)}else if(e.target.matches(".delete-from-target")){const t=e.target.closest(".target-achiv");ss.target.deleteFromTarget(t)}}));var e,t;e=this.container,t=e=>{ss.target.pushCheevo(e),this.section.querySelector(".achiv-block")?.remove()},new Sortable(e,{group:{name:"cheevos",pull:!1},animation:100,chosenClass:"dragged",onAdd:function(e){const s=e.item.dataset.achivId;t&&t(s)},onEnd:()=>ss.addEvents()}),this.searchInput?.addEventListener("input",this.searchInputEvent)}searchInputEvent(e){e.stopPropagation();[...ss.target.container.querySelectorAll(".target-achiv")].forEach((e=>{const t=e.dataset.achivId,s=e.querySelector(".list-item__text"),i=e.querySelector(".target__cheevo-header a");s&&(s.innerText=ns.CHEEVOS[t]?.Description),i&&(i.innerText=ns.CHEEVOS[t]?.Title)})),ss.target.applySort();const t=e.target.value;if(t&&(t.length>2||/\d+/.test(t))){(e=>{const t=new RegExp(`(${e})`,"gi");[...ss.target.container.querySelectorAll(".target-achiv")].reverse().forEach((e=>{const s=e.querySelector(".list-item__text"),i=e.querySelector(".target__cheevo-header a");i.innerText.match(t)&&(ss.target.moveToTop(s.closest(".target-achiv")),i.innerHTML=i.innerHTML.replace(t,(e=>`<span class="badge highlight-badge">${e}</span>`))),s.innerText.match(t)&&(ss.target.moveToTop(s.closest(".target-achiv")),s.innerHTML=s.innerHTML.replace(t,(e=>`<span class="badge highlight-badge">${e}</span>`)))}))})(t);const e=document.querySelector(".badge.highlight-badge");e&&e.scrollIntoView({behavior:ss.isCEF?"auto":"smooth",block:"center"})}}setElementsValues(){this.section.classList.toggle("show-events",this.uiProps.showEvents),this.section.classList.toggle("compact-header",!this.uiProps.showHeader),this.section.classList.toggle("hide-bg",this.uiProps.hideBg),this.section.classList.toggle("hide-passed",this.uiProps.hidePassedLevels),this.section.classList.toggle("highlight-passed",this.uiProps.highlightPassedLevels),this.section.classList.toggle("fixed-size",this.uiProps.isFixedSize),this.section.classList.toggle("show-progression-bar",this.uiProps.showCheevoUnlockRateBar),this.section.classList.toggle("show-overlay",this.uiProps.showPrevOverlay),this.container.style.setProperty("--max-count",this.uiProps.fixedSizeCount),this.section.dataset.previewFilter=this.uiProps.lockedPreviewFilter,this.section.classList.toggle("contrast-highlight",this.uiProps.contrastHighlight)}setValues(){Vt.applyPosition({widget:this}),this.setElementsValues(),this.startAutoScroll()}gameChangeEvent(e){this.genreFilter="",this.uiProps.autoClearTarget&&this.clearEarned(),this.uiProps.autoFillTarget&&this.fillItems()}async updateEarnedAchieves({earnedAchievementIDs:e}){const t=()=>{const e=document.createElement("div");return e.classList.add("target-unlock-anim"),e.innerHTML='\n                <div class="lines"></div>\n                <div class="lock"></div>\n            ',e},s=this.container.scrollTop;for(let s of e){const e=ns.CHEEVOS[s],i=this.container.querySelector(`.target-achiv[data-achiv-id='${s}']`);if(i){const s=t();await Le({container:this.container,element:i,scrollByX:!1}),await R(600),i.classList.add("earned","show-hard-anim"),i.classList.toggle("hardcore",e?.isHardcoreEarned),e.isHardcoreEarned&&(i.dataset.DateEarnedHardcore=e.DateEarnedHardcore),i.dataset.DateEarned=e.DateEarned,i.appendChild(s),setTimeout((()=>{i.classList.remove("show-hard-anim"),s?.remove()}),2e3),await R(2100)}}this.container.scrollTo({top:s,behavior:"smooth"}),this.applyFilter(),this.applySort(),this.genreFilter&&this.filterByGenre(this.genreFilter,!0)}autoscrollInterval;startAutoScroll(e=!0){this.stopAutoScroll();let t=this.container,s=1;this.uiProps.autoscroll&&(this.autoscrollInterval=setInterval((()=>{t.scrollHeight-t.clientHeight<=10&&this.stopAutoScroll(),e?(t.scrollTop+=s,t.scrollTop+t.clientHeight>=t.scrollHeight&&(this.stopAutoScroll(),setTimeout((()=>this.startAutoScroll(!1)),2e3))):(t.scrollTop-=s,0===t.scrollTop&&(this.stopAutoScroll(),setTimeout((()=>this.startAutoScroll(!0)),2e3)))}),50),t.addEventListener("mouseenter",(()=>{s=0})),t.addEventListener("mouseleave",(()=>{s=1})))}stopAutoScroll(){clearInterval(this.autoscrollInterval)}isAchievementInTargetSection({ID:e,targetContainer:t=this.container}){return[...t.querySelectorAll(".target-achiv")].filter((t=>t.dataset.achivId==e)).length>0}pushCheevo(e){if(this.isAchievementInTargetSection({ID:e}))return;const t=ns.CHEEVOS[e],s=document.createElement("li");(()=>{s.classList.add("target-achiv","main-column-item","right-bg-icon"),s.classList.add("border"),s.classList.add("overlay"),s.classList.add("show-difficult"),s.classList.toggle("show-level",this.uiProps.showLevel),s.classList.toggle("show-genre",this.uiProps.showGenre),s.classList.toggle("earned",t.isEarned),s.classList.toggle("hardcore",t.isHardcoreEarned),s.classList.toggle("rare",t.difficulty>7)})(),s.dataset.Type=t.Type,s.dataset.Points=t.Points,s.dataset.TrueRatio=t.TrueRatio,s.dataset.difficulty=t.difficulty,s.dataset.DisplayOrder=t.DisplayOrder,s.dataset.genres=t.genres?.join(","),s.dataset.group=t.group,t.DateEarnedHardcore&&(s.dataset.DateEarnedHardcore=t.DateEarnedHardcore),t.DateEarned&&(s.dataset.DateEarned=t.DateEarned),s.dataset.NumAwardedHardcore=t.NumAwardedHardcore,s.dataset.achivId=e,t.level&&(s.dataset.level=t.level),s.style.setProperty("--progression",100*t.NumAwardedHardcore/t.totalPlayers+"%"),s.dataset.timeToUnlock=t.timeToUnlock,(()=>{const e=t.level?.toString()?.split(".")[1],i=t.zone?e?`${t.zone} [${e}]`:t.zone:t.level?.toString()?.replace(".","-");s.innerHTML=`\n            <div class="target__cheevo-bg"></div>\n            <div class="target__buttons-container">\n                ${ne(t.ID)}\n                ${se()}\n                ${oe()}\n            </div>\n            <div class="prev">\n                <div class="prev-bg"></div>\n                <img\n                    class="prev-img"\n                    src="${t.prevSrc}"\n                    alt="${t.Title}"\n                />\n                <div class="prev-lock-overlay"></div>\n                <div class="box-inner-shadow"></div>\n                <div class="target__cheevo-progression-container">\n                    <div class="target__cheevo-progression">\n                </div>\n            </div>\n            </div>\n            <div class="target__cheevo-details">\n                <h3 class="target__cheevo-header">\n                    ${i?y.cheevoLevel(i,!0):""}\n                    ${t.genres.length>0?t.genres?.map((e=>y.buttonGenreBadge(e,`ui.target.filterByGenre('${e}')`))).join(""):""}<a target="_blanc" data-title="${ss.lang.goToRAHint}" href="${H(t)}">\n                        ${t.Title} ${t.genres?.map((e=>f[e])).join("")}\n                    </a>\n                </h3>\n                <p class="list-item__text">${t.Description}</p>\n                <div class="icons-row-list">\n                    ${E.cheevoType(t.Type)}\n                    ${p.points(t.Points)}\n                    ${p.retropoints(t.TrueRatio)}\n                    ${p.time(r(t.timeToUnlock))}\n                    ${p.rarity(t.rateEarnedHardcore)}\n                    ${p.retroRatio(t.retroRatio)}\n                    ${y.difficultBadge(t.difficulty)}\n                </div>\n            </div>\n            `})(),this.container.appendChild(s),this.isDynamicAdding||(this.applyFilter(),this.applySort()),this.delayedRemove()}refreshCheevo(e){this.container.querySelector(`.target-achiv[data-achiv-id="${e}"]`)?.remove(),this.pushCheevo(e)}moveToTop(e){1==this.uiProps.reverseSort?this.container.prepend(e):this.container.append(e),this.applyFilter()}applyFilter(){De({container:this.container,itemClassName:".target-achiv",filters:this.uiProps.filters,isHide:this.uiProps.hideFiltered})}filterByGenre(e,t=!1){(()=>{this.container.querySelectorAll(".hidden").forEach((e=>e.classList.remove("hidden")))})(),!t&&this.genreFilter===e||!e?(this.genreFilter="",this.applyFilter()):(this.genreFilter=e,De({container:this.container,itemClassName:".target-achiv",filters:{...this.uiProps.filters,genre:{filterName:ye,state:1,genre:e}},isHide:this.uiProps.hideFiltered}))}setMGameSelection(){const e=this.container.querySelectorAll(".target-achiv");if(!this.uiProps.mGameSelection||ns.GAME_DATA.groups?.includes(this.uiProps.mGameSelection)){const t=e=>this.uiProps.mGameSelection&&this.uiProps.mGameSelection!==e.dataset.group;e.forEach((e=>e.classList.toggle("hidden-group",t(e))))}else this.uiProps.mGameSelection=""}applySort(e={animation:500}){Ae({container:this.container,itemClassName:".target-achiv",sortMethod:we[this.uiProps.sortName],reverse:this.uiProps.reverseSort,strictMode:this.uiProps.strictSort,animationDuration:this.IS_GROUPING?0:e.animation})}highlightCurrentLevel(e){[...this.container.querySelectorAll(".target-achiv")].forEach((t=>{t.classList.remove("highlight"),t.classList.remove("passed");const s=t.dataset.level;if(s==e&&t.classList.add("highlight"),!Number.isInteger(e)){const s=parseInt(e);t.dataset.level==s&&t.classList.add("highlight")}Number.isInteger(+s)?s<parseInt(e)&&t.classList.add("passed"):s<e&&t.classList.add("passed")}))}deleteFromTarget(e){const t=e.closest(".target-achiv");t?.classList.add("removing"),setTimeout((()=>t?.remove()),0)}clearEarned(){this.container.querySelectorAll(".target-achiv").forEach((e=>{e.classList.contains("hardcore")&&e.remove()}))}clearAllAchivements(){this.container.innerHTML=""}delayedRemove(){this.uiProps.autoClearTarget&&this.container.querySelectorAll(".earned").forEach((e=>{setTimeout((()=>e.remove()),1e3*this.uiProps.autoClearTargetTime)}))}fillItems(){this.isDynamicAdding=!0,this.clearAllAchivements(),Object.keys(ns.CHEEVOS).forEach((e=>{this.pushCheevo(e)})),this.applyFilter(),this.applySort(),this.setMGameSelection(),this.isDynamicAdding=!1}async showAotwEvent(){const e=await is.aotw();if(!e||e.wasShown)return;const t=100*e.UnlocksHardcoreCount/e.TotalPlayers;this.section.querySelector(".target__aotw-container")?.remove(),this.container.querySelector(`.target-achiv[data-achiv-id='${e.ID}']`)?.classList.add("target__aotw");const s=document.createElement("div");s.classList.add("target__aotw-container","target__aotw","show-difficult","show-level"),s.innerHTML=`\n        <button class="description-icon target__hide-aotw" \n          onclick="ui.target.hideAotw()"></button>\n        <div class="prev">\n          <img class="prev-img" src="${O(e.BadgeURL)}" alt=" ">\n        </div>\n        <div class="target__cheevo-details">\n          <h3 class="target__cheevo-header">\n            <a target="_blanc" href="${H(e)}">\n              ${e.Title}\n            </a>\n            in\n            <a target="_blanc" href="${M(e.GameID)}">\n              ${e.GameTitle}\n            </a>\n          </h3>\n          <div class="list-item__text">\n          ${y.black("AotW Event")}\n            ${e.Description}\n          </div>\n          <div class="icons-row-list">\n            ${E.cheevoType(e?.Type)}\n            ${p.points(e.Points)}\n            ${p.retropoints(e.TrueRatio)}\n            ${p.rarity(t.toFixed(2)+"%")}\n            ${p.retroRatio((e.TrueRatio/Math.max(1,e.Points)).toFixed(2))}\n          </div>\n        </div>\n      `,this.section.querySelector(".target__aotw-container")?.remove(),this.section.insertBefore(s,this.container)}async hideAotw(){this.section.querySelector(".target__aotw-container")?.remove();const e=await is.aotw();is.cache.push({dataType:Fe,data:{...e,wasShown:!0}})}}function qe(){const e=e=>[{label:ui.lang.title,elements:[{type:"text",title:ui.lang.gameTitleHint,id:"game-props-title",value:e?.Title??""}]},{label:ui.lang.platform,elements:[{type:"text",title:ui.lang.platform,id:"game-props-platform",value:e?.ConsoleName??""}]},{label:ui.lang.genre,elements:[{type:"text",title:ui.lang.genre,id:"game-props-genre",value:e?.Genre??""}]},{label:ui.lang.timePlayed,elements:[{type:"number",title:ui.lang.timePlayed,id:"game-props-time",value:e?.TimePlayed??0}]},{elements:[{id:"reset-game-props",label:ui.lang.resetData,type:"button"},{id:"save-game-props",label:ui.lang.saveData,type:"button"}]}];let t;const s=(e,t)=>{ts.gamesDB[t]=e,ts.writeConfiguration()},i=(e,t)=>{const i=is.gameData,n=(e=>({Title:e.querySelector("#game-props-title")?.value,ConsoleName:e.querySelector("#game-props-platform")?.value,Genre:e.querySelector("#game-props-genre")?.value,TimePlayed:Number(e.querySelector("#game-props-time")?.value??0)}))(e);Object.getOwnPropertyNames(n).forEach((e=>{ns.GAME_DATA[e]=n[e],n[e]==i[e]&&delete n[e]})),s(n,t.ID),ns.reset()},n=(e,n)=>{e.querySelector("#save-game-props")?.addEventListener("click",(()=>i(e,n))),e.querySelector("#reset-game-props")?.addEventListener("click",(()=>(async(e,i)=>{const n=is.gameData;ns.GAME_DATA.Title=n.Title,ns.GAME_DATA.ConsoleName=n.ConsoleName,ns.GAME_DATA.Genre=n.Genre,s({TimePlayed:ns.GAME_DATA.TimePlayed},i.ID),ns.reset(),t?.section?.remove(),a(n)})(0,n)))},a=s=>{var i;t=new Oe({title:s?.Title,content:(i=e(s),`\n    <ul class="game-props__list flex-column-list">\n      ${i.map((e=>`\n          <li class="game-props__item">${e.label??""}\n              ${e.elements.map((e=>C(e))).join("\n")}\n          </li>\n      `)).join("\n")}\n    </ul>`),id:"game-data-popup",classList:["game-data__section"]}),n(t.section,s)};return{open:a}}function We({container:e,textGenerator:t}){const s=e=>{const t=document.createElement("p");return t.className="infinite-line",t.innerHTML=e,t},i=()=>{const i=document.createDocumentFragment();for(;e.scrollWidth/e.offsetWidth<3||e.querySelectorAll("p").length<3;)i.appendChild(s(t())),e.appendChild(i)};let n=null;const a=()=>{n&&clearInterval(n),e.innerHTML=""};return{startScrolling:()=>{a(),i(),n=setInterval((()=>(async()=>{e.scrollBy({left:1,behavior:"auto"});const n=e.querySelector(".infinite-line");if(n&&n.offsetWidth-e.scrollLeft<=0){n.remove();const i=s(t());e.appendChild(i),e.scrollLeft=0}(e.querySelectorAll("p").length<3||e.scrollWidth/e.offsetWidth<3)&&i()})()),40)},stopScrolling:a}}function je(){const e={...ns.GAME_DATA?.unlockData,user:ds.targetUser||ts.USER_NAME,...Object.fromEntries(Object.entries(ns.GAME_DATA).filter((([e,t])=>null===t||"object"!=typeof t)))},t="&nbsp;&nbsp;&middot;&nbsp;&nbsp;\n    ",s=`retrocheevos.vercel.app${t}`,i=`\n        ${e.user} is playing ${e.Title}${t}`,n=ns.GAME_DATA?[e.ConsoleName&&`Console: ${e.ConsoleName},`,e.Released&&`Released: ${e.Released},`,e.Developer&&`Developer: ${e.Developer},`,e.Publisher&&`Publisher: ${e.Publisher},`,e.Genre&&`Genre: ${e.Genre},`,e.NumDistinctPlayersCasual&&`Total RA Players: ${e.NumDistinctPlayersCasual},`,e.beatenRate&&`Beaten Rate: ${e.beatenRate}% (${e.beatenRateSoftcore}%),`,e.masteryRate&&`Mastery Rate: ${e.masteryRate}% (${e.completedRate}%),`,e.retroRatio&&`Retro Ratio: ${e.retroRatio},`,e.timeToBeat&&`Time to beat: ${r(e.timeToBeat)}`,e.timeToMaster&&`Time to master: ${r(e.timeToMaster)}`,e.gameDifficulty&&`Game Difficulty: ${d[e.gameDifficulty]} (${d[e.masteryDifficulty]})`,t].join("&nbsp;"):"Game ERROR",a=["Completion Progress: ",`${e.hardcore.count>0?e.hardcore.count+"/":""}${e.softcore.count>e.hardcore.count?e.softcore.count-e.hardcore.count+"/":""}${e.NumAchievements} achievements, `,`${e.hardcore.points>0?e.hardcore.points+"/":""}${e.softcore.points>e.hardcore.points?e.softcore.points-e.hardcore.points+"/":""}${e.totalPoints} points, `,`${e.hardcore.retropoints?e.hardcore.retropoints+"/":""}${e.totalRetropoints} retropoints${t}`].join(" "),o=!!ss.statusPanel?.deltaStats?.deltaPoints,l=!!ss.statusPanel?.deltaStats,c=o?`${ss.statusPanel.deltaStats.deltaPoints} hardpoints and ${ss.statusPanel.deltaStats.deltaRetroPoints} retropoints`:`and ${ss.statusPanel?.deltaStats?.deltaSoftPoints} softpoints`,h=l?`Session statistics: +${ss.statusPanel.initialStats.cheevosCount} achievements, ${c}${t}`:"",u=ss.statusPanel?.currentStats||ss.statusPanel?.initialStats;return i+n+a+h+(u?`User statistics: position ${u?.rank} in RA rank system (TOP${u?.percentile.toFixed(2)}%), \n        ${u?.points} total hardpoints, \n        ${u?.retroPoints} total retropoints and\n        ${u?.softPoints} total softpoints\n        ${t}`:"")+s}class ze extends pe{widgetIcon={description:"status widget",iconID:"side-panel__status",onChangeEvent:"ui.statusPanel.VISIBLE = this.checked",badgeLabel:"legacy",iconClass:"status-icon"};get contextMenuItems(){return[{label:ss.lang.gameTime,elements:[{type:P.CHECKBOX,id:"show-time",label:ss.lang.showTimeBar,checked:this.uiProps.showTimeBar,event:'onchange="ui.statusPanel.uiProps.showTimeBar = this.checked;"'},{type:P.RADIO,name:"game-time",id:"show-playTime",label:ss.lang.gameTime,checked:"playTime"==this.uiProps.time,event:"onclick=\"ui.statusPanel.uiProps.time = 'playTime';\""},{type:P.RADIO,name:"game-time",id:"show-sessionTime",label:ss.lang.sessionGameTime,checked:"sessionTime"==this.uiProps.time,event:"onclick=\"ui.statusPanel.uiProps.time = 'sessionTime';\""},{type:P.RADIO,name:"game-time",id:"show-full-time",label:ss.lang.totalTime,checked:"totalSessionTime"==this.uiProps.time,event:"onclick=\"ui.statusPanel.uiProps.time = 'totalSessionTime';\""},{type:P.RADIO,name:"game-time",id:"show-timer",label:ss.lang.timer,checked:"timer"==this.uiProps.time,event:"onclick=\"ui.statusPanel.uiProps.time = 'timer';\""},{prefix:ss.lang.timer,postfix:ss.lang.min,type:P.NUM_INPUT,id:"context-menu_stats-timer-duration",label:ss.lang.timer,value:~~(this.uiProps.timerTime/60*100)/100,event:'onchange="ui.statusPanel.uiProps.timerTime = this.value;"',onChange:"ui.statusPanel.uiProps.timerTime = this.value;"}]},{label:ss.lang.elements,elements:[{type:P.CHECKBOX,id:"show-target-preview",label:ss.lang.focusCheevoPreview,checked:this.uiProps.showTargetPreview,event:'onchange="ui.statusPanel.uiProps.showTargetPreview = this.checked;"'},{type:P.RADIO,name:"description-variant-radio",id:"show-progression-description",label:ss.lang.progression,checked:"progression"===this.uiProps.statusDescriptionVariant,event:"onchange=\"ui.statusPanel.uiProps.statusDescriptionVariant = 'progression';\""},{type:P.RADIO,name:"description-variant-radio",id:"show-game-info-description",label:ss.lang.richPresence,checked:"gameInfo"===this.uiProps.statusDescriptionVariant,event:"onchange=\"ui.statusPanel.uiProps.statusDescriptionVariant = 'gameInfo';\""},{type:P.CHECKBOX,id:"show-mastery-rate",label:ss.lang.showMasteryRate,checked:this.uiProps.showMasteryRate,event:'onclick="ui.statusPanel.uiProps.showMasteryRate = this.checked;"'}]},{label:ss.lang.progressionStyleTypes,elements:[{type:P.RADIO,name:"progression-variant",id:"progression-variant-dots",label:ss.lang.dots,checked:"dots"===this.uiProps.progressionVariant,event:"onchange=\"ui.statusPanel.uiProps.progressionVariant = 'dots';\""},{type:P.RADIO,name:"progression-variant",id:"progression-variant-rects",label:ss.lang.rects,checked:"rects"===this.uiProps.progressionVariant,event:"onchange=\"ui.statusPanel.uiProps.progressionVariant = 'rects';\""}]},{label:ss.lang.alerts,elements:[{type:P.CHECKBOX,id:"show-new-cheevos",label:ss.lang.showAlerts,checked:this.uiProps.showNewAchiv,event:'onchange="ui.statusPanel.uiProps.showNewAchiv = this.checked;"'},{prefix:ss.lang.duration,postfix:ss.lang.sec,type:P.NUM_INPUT,id:"context-menu_stats-earned-duration",label:ss.lang.duration,value:this.uiProps.newAchivDuration,event:'onchange="ui.statusPanel.uiProps.newAchivDuration = this.value;"',onChange:"ui.statusPanel.uiProps.newAchivDuration = this.value;"},{type:P.CHECKBOX,id:"show-stats-alert",label:ss.lang.statsAlerts,checked:this.uiProps.showStatisticsAlert,event:'onchange="ui.statusPanel.uiProps.showStatisticsAlert = this.checked;"'}]},{type:P.CHECKBOX,id:"show-update-blink",label:ss.lang.showUpdateBlink,checked:this.uiProps.showUpdateBlink,event:'onchange="ui.statusPanel.uiProps.showUpdateBlink = this.checked;"'},{type:P.CHECKBOX,id:"hard-mode",label:ss.lang.hardcoreMode,checked:this.uiProps.hardMode,event:'onchange="ui.statusPanel.uiProps.hardMode = this.checked; ui.statusPanel.generateProgressionBlock()"'},{type:P.CHECKBOX,id:"game-bg",label:ss.lang.gameBg,checked:this.uiProps.showGameBg,event:'onchange="ui.statusPanel.uiProps.showGameBg = this.checked;"'}]}uiProps=new Proxy({},{get:(e,t)=>{const s=this.uiDefaultValues[t]??!0;return ts.getUIProperty({sectionID:this.sectionID,property:t})??s},set:(e,t,s)=>{const i=this.uiValuePreprocessors[t];"function"==typeof i&&(s=i(s)),ts.saveUIProperty({sectionID:this.sectionID,property:t,value:s});const n=this.uiSetCallbacks?.[t];return"function"==typeof n?n.call(this,s):this.setElementsValues(),!0}});uiDefaultValues={newAchivDuration:15,time:"playTime",timerTime:30,showTargetPreview:!1,progressionVariant:"dots",showMasteryRate:!0,showGameBg:!0,showTimeBar:!0,statusDescriptionVariant:"progression",hardMode:!0,showNewAchiv:!0,showUpdateBlink:!0};uiSetCallbacks={showStatisticsAlert(){},showNewAchiv(){},time(){this.startStatsAnimation()},timerTime(){this.startStatsAnimation()},statusDescriptionVariant(e){const t={gameInfo:"show-game-info",progression:"show-game-progress"};Object.values(t).forEach((e=>this.section.classList.remove(e))),this.section.classList.add(t[e])},showTargetPreview(){this.generateProgressionBlock()},progressionVariant(){this.generateProgressionBlock()},showGameBg(){this.container.classList.toggle("game-bg",this.SHOW_GAME_BG)}};uiValuePreprocessors={newAchivDuration:e=>e<=5||e>60?5:e,timerTime:e=>e<=5||e>1e6?5:60*e};stats={userName:ds.targetUser,gameTitle:ns.GAME_DATA?.Title??"Title",gamePlatform:ns.GAME_DATA?.ConsoleName??"Platform",richPresence:"Waiting...",imageSrc:O(ns.GAME_DATA?.ImageIcon),totalPoints:ns.GAME_DATA?.totalPoints??0,totalAchievesCount:ns.GAME_DATA?.NumAchievements??0,totalSoftpoints:0,earnedPoints:0,earnedAchievesCount:0,totalRetropoints:ns.GAME_DATA?.totalRetropoints,earnedRetropoints:0,earnedSoftpoints:0,showStatisticsAlert:!0};awards={award:"",progressionAward:""};gameTimeInterval;getActiveTime=()=>{let e=0;switch(this.uiProps.time){case"playTime":e=ns.playTime.totalGameTime;break;case"sessionTime":e=ns.playTime.gameTime;break;case"totalSessionTime":e=ns.playTime.sessionTime,e=e<0?0:e;break;case"timer":e=this.uiProps.timerTime-ns.playTime.gameTime}return o(e,!0)};get statusTextValues(){const e={};return this.uiProps.time&&(e.gameTime=this.getActiveTime()),e}constructor(){super(),this.addWidgetIcon(),!ts.ui.update_section&&(ts.ui.update_section={}),this.initializeElements(),this.addEvents(),Vt.applyPosition({widget:this}),this.infiniteLine=We({container:this.section.querySelector("#magic-line"),textGenerator:je}),setTimeout((()=>{this.fitFontSize()}),1e3)}initializeElements(){this.section=document.querySelector("#update-section"),this.sectionID=this.section.id,this.container=this.section.querySelector(".status__container"),this.guideLink=this.section.querySelector("#status-game-guide"),this.progresBar=this.section.querySelector("#status-progress-bar"),this.progresBarDelta=this.section.querySelector("#status_progress-bar-delta"),this.progressStatusText=this.section.querySelector("#status-progress-text"),this.resizer=this.section.querySelector("#status-resizer"),this.frontSide={container:this.section.querySelector(".status__front-side"),gamePreview:this.section.querySelector("#game-preview"),retroRatioElement:this.section.querySelector(".status__retro-ratio"),gameTitle:this.section.querySelector("#game-title"),gamePlatform:this.section.querySelector("#game-platform"),richPresence:this.section.querySelector("#rich-presence"),watchButton:this.section.querySelector("#watching-button"),sideBlock:this.section.querySelector(".status__sideblock-container"),iconsContainer:this.section.querySelector("#status__sideblock-icons")},this.backSide={container:this.section.querySelector(".status__back-side"),imgElement:this.section.querySelector("#update_achiv-preview"),titleElement:this.section.querySelector("#update_achiv-title"),descriptionElement:this.section.querySelector("#update_achiv-description"),badgesElement:this.section.querySelector("#update_achiv-earned-points")}}setElementsValues(){this.uiProps.statusDescriptionVariant=this.uiProps.statusDescriptionVariant,this.progressStatusText.innerText="";const e=ns.GAME_DATA.ImageIngame;this.container.style.setProperty("--bg-image",`url(${O(e)})`),(()=>{this.container.classList.toggle("show-game-ratio",this.uiProps.showMasteryRate),this.container.classList.toggle("game-bg",this.uiProps.showGameBg),this.container.classList.toggle("show-time-bar",this.uiProps.showTimeBar)})(),(()=>{const e=ns.GAME_DATA.masteryRate;this.frontSide.retroRatioElement.innerText=e,this.frontSide.retroRatioElement.className="status__retro-ratio badge badge-gold"})(),(()=>{const{ImageIcon:e,Title:t,ConsoleName:s,ConsoleID:i,badges:n,ID:a,GuideURL:o}=ns.GAME_DATA,{gamePreview:r,gameTitle:l,gamePlatform:c,richPresence:d}=this.frontSide;r.setAttribute("src",O(e)),l.innerHTML=`\n                <a target="_blank" class="status__game-title" href="${M(a)}">${t}</a>\n                ${_(n)} \n                ${_([m[i||1].Name])}\n\n            `,setTimeout((()=>{this.startAutoScrollElement(l,!0,6e4),this.startAutoScrollElement(d,!0,6e4)}),1e4),this.guideLink.setAttribute("href",o),this.guideLink.classList.toggle("hidden",!o),c.innerText=s||"",this.generateProgressionBlock()})(),this.fillSidebarIcons(),this.startStatsAnimation()}addEvents(){this.section.addEventListener("mousemove",(e=>{this.section.classList.remove(...Object.values(J).map((e=>"hover-"+e)),"resize-hover");const t=ee(e,this.section);t&&this.section.classList.add(`hover-${t}`,"resize-hover")})),this.section.addEventListener("mousedown",(e=>{const t=ee(e,this.section);e.target.matches(".resizer")||t?(e.stopPropagation(),this.section.classList.add("resized"),Z({event:e,section:this.section,callback:()=>this.fitFontSize(!0),resizeDirection:e.target.matches(".resizer")?J.bottomRight:t})):e.target.matches(".status__watch-button")?(e.stopPropagation(),ns.isActive?ns.stop():ns.start()):e.target.matches(".comments-button")?(e.stopPropagation(),Me(ns.GAME_DATA?.ID,1)):e.target.matches(".game-props-button")?(e.stopPropagation(),qe().open(ns.GAME_DATA)):e.target.matches(".close-icon")?(e.stopPropagation(),this.close()):0===e.button&&Q(this.section,e)})),this.section.addEventListener("contextmenu",(e=>{ss.showContextmenu({event:e,menuItems:this.contextMenuItems})}))}fillSidebarIcons(){const e=this.uiProps.hardMode?{...ns.GAME_DATA.unlockData.hardcore}:{...ns.GAME_DATA.unlockData.softcore};this.frontSide.iconsContainer.innerHTML=`\n            <p class="signed-icon auto-font-size" data-title="${ss.lang.cheevosCount}">\n                ${E.cheevos}\n                ${e.count}/${ns.GAME_DATA.NumAchievements}\n            </p>\n\n            <p class="signed-icon auto-font-size" data-title="${ss.lang.points}">\n                ${E.points}\n                ${e.points}/${ns.GAME_DATA.totalPoints}\n            </p>\n            <p class="signed-icon auto-font-size" data-title="${ss.lang.trueRatio}">\n                ${E.trueratio}\n                ${ns.GAME_DATA.retroRatio}\n            </p>\n            <p class="signed-icon auto-font-size" data-title="${ss.lang.retropoints}">\n                ${E.retropoints}\n                ${e.retropoints}/${ns.GAME_DATA.totalRetropoints}\n            </p>\n        `}updateGameData(e=!1){this.stats={userName:ds.targetUser,gameTitle:ns.GAME_DATA?.Title??"Title",gamePlatform:ns.GAME_DATA?.ConsoleName??"Platform",richPresence:"Waiting...",imageSrc:O(ns.GAME_DATA?.ImageIcon),totalPoints:ns.GAME_DATA?.totalPoints??0,totalSoftPoints:ns.GAME_DATA.totalPoints-ns.GAME_DATA.unlockData.softcore.points,totalAchievesCount:ns.GAME_DATA?.NumAchievements??0,totalProgressionCount:ns.GAME_DATA?.progressionSteps,earnedPoints:ns.GAME_DATA.unlockData.hardcore.points,earnedAchievesCount:ns.GAME_DATA.unlockData.hardcore.count,earnedProgressionCount:ns.GAME_DATA.unlockData.softcore.progressionCount,totalRetropoints:ns.GAME_DATA?.totalRetropoints,earnedRetropoints:ns.GAME_DATA.unlockData.hardcore.retropoints,earnedSoftpoints:ns.GAME_DATA.unlockData.softcore.points-ns.GAME_DATA.unlockData.hardcore.points},e&&(this.awards.award=ns.GAME_DATA.award,this.awards.progressionAward=ns.GAME_DATA.progressionAward)}gameChangeEvent(e=!1){e&&ns.IS_WATCHING&&this.addAlertsToQuery([{type:k.GAME,value:ns.GAME_DATA}]),this.updateGameData(!0),this.setElementsValues()}timeWatcher(){this.frontSide.watchButton.classList.toggle("active",ns.isActive),this.section.classList.toggle("watching",ns.IS_ONLINE&&ns.isActive);return{start:()=>{ss.statusPanel.timeWatcher().stop(),this.gameTimeInterval=setInterval((()=>{"timer"===this.uiProps.time&&ns.playTime.timer<0&&this.section.classList.add("timer-timeout");const e=this.getActiveTime(),t=this.section.querySelector(".status__game-time");t&&t.innerHTML!==e&&(t.innerHTML=e)}),1e3)},stop:()=>{this.gameTimeInterval&&clearInterval(this.gameTimeInterval)}}}generateProgressionBlock(){if("dots"!==this.uiProps.progressionVariant)return void(this.uiProps.progressionVariant="dots");const e=this.section.querySelector(".status__progression-container"),t=this.section.querySelector(".status__description-text"),s=e=>this.uiProps.hardMode?e.isHardcoreEarned?"earned":"":e.isEarned?"earned":"",i={dots:()=>{const e=Object.values(ns.CHEEVOS).filter((e=>e.Type==ve.PROGRESSION)).sort(((e,t)=>we.default(e,t))),t=Object.values(ns.CHEEVOS).filter((e=>e.Type==ve.WIN));return e.reduce(((e,t)=>e+=`\n                            <div class="progression-point progression-point__dot  ${s(t)}" data-achiv-id=${t.ID}></div>\n                        `),"")+(t?.length>0?`\n                        <div class="win-points win-points__dots">\n                            ${t.reduce(((e,t)=>e+=`\n                                <div class="progression-point progression-point__dot-win ${s(t)}" data-achiv-id=${t.ID}></div>\n                            `),"")}\n                         </div>\n                        `:"")},rects:()=>{const e=Object.values(ns.CHEEVOS).filter((e=>e.Type==ve.PROGRESSION)).sort(((e,t)=>we.default(e,t))),t=Object.values(ns.CHEEVOS).filter((e=>e.Type==ve.WIN));return e.reduce(((e,t)=>e+=`\n                        <div class="rp__progression-point ${s(t)}" data-achiv-id=${t.ID}></div>\n                    `),"")+(t?.length>0?`\n                    <div class="rp__win-points">\n                        ${t.reduce(((e,t)=>e+=`\n                                <div class="rp__progression-point win ${s(t)}" data-achiv-id=${t.ID}></div>\n                            `),"")}\n                     </div>\n                    `:"")}},n=Object.values(ns.CHEEVOS).filter((e=>Ee.progression(e))).sort(((e,t)=>we.default(e,t))).find((e=>!s(e)));e.classList.remove("progression-points__dots","progression-points__rects"),e.classList.add(`progression-points__${this.uiProps.progressionVariant}`),e.innerHTML=i[this.uiProps.progressionVariant](),t.innerHTML=n?n.Description:ns.GAME_DATA?.progressionAward?ss.lang.gameBeatenMsg:ss.lang.noProgressionMsg;const a=e.querySelector(`[data-achiv-id="${n?.ID}"`);a?.scrollIntoView({behavior:"smooth",block:"end",inline:"center"}),a?.classList.add("focus"),this.frontSide.gamePreview.src=this.uiProps.showTargetPreview&&n?N(n):O(ns.GAME_DATA.ImageIcon)}updateProgress({earnedAchievementIDs:e}){e.length>0&&(this.uiProps.hardMode=!!ns.CHEEVOS[e[0]].isHardcoreEarned),this.updateGameData(),this.generateProgressionBlock(),this.fillSidebarIcons(),this.progresBarDelta?.classList.remove("hidden"),setTimeout((()=>this.progresBarDelta?.classList.add("hidden")),50),this.initialStats&&(this.initialStats.cheevosCount+=e.length)}initialStats;currentStats;deltaStats;updateStatistics({userSummary:e}){function t(e){return 0==e?"":(e>0?"+":"")+e}if(this.initialStats){this.currentStats={points:e.TotalPoints,retroPoints:e.TotalTruePoints,softPoints:e.TotalSoftcorePoints,rank:e.Rank,totalRanked:e.TotalRanked,percentile:100*e.Rank/e.TotalRanked};const s=this.currentStats.rank-this.initialStats.rank,i=(this.currentStats.percentile-this.initialStats.percentile).toFixed(3),n={deltaPoints:t(this.currentStats.points-this.initialStats.points),deltaRetroPoints:t(this.currentStats.retroPoints-this.initialStats.retroPoints),deltaSoftPoints:t(this.currentStats.softPoints-this.initialStats.softPoints),deltaRank:t(s),deltaPercentile:t(i)};this.deltaStats=n;const a={type:k.STATS,value:{...this.currentStats,...n,cheevosCount:this.initialStats.cheevosCount}};!this.alertsQuery.find((e=>e.type===k.STATS))&&this.addAlertsToQuery([a]),ss.status.addAlertsToQuery([a])}else this.initialStats={points:e.TotalPoints,retroPoints:e.TotalTruePoints,softPoints:e.TotalSoftcorePoints,rank:e.Rank,totalRanked:e.TotalRanked,percentile:100*e.Rank/e.TotalRanked,cheevosCount:0},this.currentStats=this.initialStats}alertsQuery=[];addAlertsToQuery(e){this.uiProps.showNewAchiv&&(this.alertsQuery.length>0?this.alertsQuery=[...this.alertsQuery,...e]:(this.alertsQuery=[...e],this.startAlerts()))}async startAlerts(){const e=()=>{this.container.classList.remove("new-game-info","new-achiv","new-award","stats","beaten","mastered"),this.backSide.container.classList.remove("hardcore","beaten","mastered","beaten-softcore","completed")},t=()=>{const e=this.section.querySelector(".status_glass-effect");e.classList.remove("update"),setTimeout((()=>e.classList.add("update")),20)},s=e=>{const{Title:t,badges:s,ImageIcon:i,totalPoints:n,ConsoleName:a,totalRetropoints:o,NumAchievements:r,masteryRate:l,beatenRate:c}=e;this.backSide.imgElement.src=O(i),this.backSide.titleElement.innerHTML=`${t} ${_(s)}\n            <i class="badge">${a}</i>\n            `;let d=`\n                ${T(E.cheevos+r)}\n                ${T(E.points+n)}\n                ${T(E.retropoints+o)}\n                ${T(l+"% MASTERED")}\n                ${c?T(c+"% BEATEN"):""}\n            `;this.backSide.descriptionElement.innerText="",this.backSide.badgesElement.innerHTML=d,this.container.classList.add("new-game-info")},i=e=>{const{isHardcoreEarned:t,Title:s,prevSrc:i,Points:n,TrueRatio:a,rateEarned:o,rateEarnedHardcore:r,difficulty:l}=e;this.backSide.imgElement.src=i,this.backSide.titleElement.innerHTML=s,this.backSide.descriptionElement.innerText=e.Description;let c=t?`\n                    ${T(E.points+" +"+n)}\n                    ${T(E.retropoints+" +"+a)}\n                    ${T("TOP"+r)}\n                    ${y.difficultBadge(l)}\n                `:`\n                    ${T(E.points+" +"+n)}\n                    ${T("TOP"+o)}\n                    ${y.difficultBadge(l)}\n                `,d=e.genres?.map((e=>T(e))).join("\n")??"";this.backSide.badgesElement.innerHTML=d+c,this.backSide.container.classList.toggle("hardcore",e.isHardcoreEarned),setTimeout((()=>this.container.classList.add("new-achiv")),2e3)},n=(e,t)=>{const{Title:s,badges:i,ImageIcon:n,totalPoints:a,unlockData:o,totalRetropoints:r,masteryRate:l,beatenRate:c,completedRate:d,beatenRateSoftcore:h,ID:u,NumAchievements:m,TimePlayed:g}=e,p="mastered"==t?l:"beaten"==t?c:"completed"==t?d:h,v=(e=>{const t=~~(e/3600),s=~~((e-3600*t)/60);return`\n          ${t>0?1==t?"1 hour ":t+" hours ":""}\n          ${t>0&&s>0?"and ":""}\n          ${s>0?1==s?"1 minute":s+" minutes":""}\n            `})(g);this.backSide.imgElement.src=O(n),this.backSide.titleElement.innerHTML=`${s} ${_(i)}\n                ${T("GAINED AWARD")}\n            `;let f=`\n                ${T(`${t} IN ${v}`)}\n                ${T(`TOP${p}%`)}\n                ${T(`${E.cheevos}${o.hardcore.count}/${m}`)}\n                ${T(`${E.points}${o.hardcore.points}/${a}`)}\n                ${T(`${E.retropoints}${o.hardcore.retropoints}/${r}`)}\n            `;this.backSide.badgesElement.innerHTML=f,this.backSide.descriptionElement.innerText="",this.backSide.container.classList.add(t),setTimeout((()=>this.container.classList.add("new-award")),1e3)},a=e=>{this.backSide.imgElement.src=ts.userImageSrc,this.backSide.titleElement.innerHTML=`\n                ${ts.USER_NAME.toUpperCase()} statistics:\n            `;let t=`\n                ${e.rank?T(`Rank: ${e.rank} ${e.deltaRank}`):""}\n                ${e.percentile?T(`TOP ${e.percentile.toFixed(2)}% ${e.deltaPercentile}`):""}\n                ${T(`${E.cheevos} +${e.cheevosCount}`)}\n                ${T(`${E.points}${e.points} ${e.deltaPoints}`)}\n                ${T(`${E.retropoints}${e.retroPoints} ${e.deltaRetroPoints}`)}\n                ${T(`${E.points}${e.softPoints}SP ${e.deltaSoftPoints}`)}\n            `;this.backSide.badgesElement.innerHTML=t,this.backSide.descriptionElement.innerText="",this.container.classList.add("stats")},o=t=>{switch(e(),t.type){case k.GAME:s(t.value);break;case k.CHEEVO:i(t.value);break;case k.AWARD:n(t.value,t.award);break;case k.STATS:a(t.value)}};for(;this.alertsQuery.length>0;){const e=this.alertsQuery[0];if(!e.value)return void this.alertsQuery.shift();const s=()=>{o(e),this.container.classList.add("show-back"),t(),setTimeout((()=>{this.startAutoScrollElement(this.backSide.titleElement),this.startAutoScrollElement(this.backSide.badgesElement)}),2e3)},i=()=>{this.container.classList.remove("show-back"),this.alertsQuery.shift(),this.stopAutoScrollElement(this.backSide.badgesElement,!0),this.stopAutoScrollElement(this.backSide.titleElement,!0)};await R(1e3),s(),await R(1e3*this.uiProps.newAchivDuration),i()}}statsAnimationInterval;startStatsAnimation(){this.stopStatsAnimation(),this.section.classList.remove("timer-timeout");const e=this.getActiveTime(),t=this.section.querySelector(".status__game-time");t&&t.innerHTML!==e&&(t.innerHTML=e,this.frontSide.sideBlock.classList.toggle("long-time",e.length>6))}stopStatsAnimation(){clearInterval(this.statsAnimationInterval),this.currentStatusTextIndex=0}changeStatsElementValues({className:e,text:t}){this.progressStatusText.innerText=t,this.progressStatusText.className=`status__big-text ${e}`}autoscrollAlertInterval={};startAutoScrollElement(e,t=!0,s=1e3){const i=e.className;this.autoscrollAlertInterval[i]?this.stopAutoScrollElement(e):this.autoscrollAlertInterval[i]={};this.autoscrollAlertInterval[i].interval=setInterval((()=>{e.clientWidth==e.scrollWidth?(this.stopAutoScrollElement(e,!0),this.autoscrollAlertInterval[i].timeout=setTimeout((()=>this.startAutoScrollElement(e,!0,s)),1e4)):t?(e.scrollLeft++,e.scrollWidth-e.scrollLeft<=e.clientWidth&&(this.stopAutoScrollElement(e),this.autoscrollAlertInterval[i].timeout=setTimeout((()=>this.startAutoScrollElement(e,!1,s)),5e3))):(e.scrollLeft--,e.scrollLeft<=0&&(this.stopAutoScrollElement(e),this.autoscrollAlertInterval[i].timeout=setTimeout((()=>this.startAutoScrollElement(e,!0,s)),s)))}),50)}stopAutoScrollElement(e,t=!1){t&&(e.scrollLeft=0),clearInterval(this.autoscrollAlertInterval[e.className].interval),clearTimeout(this.autoscrollAlertInterval[e.className].timeout)}convertToPercentage(e){const t=e.split("/");return(parseInt(t[0],10)/parseInt(t[1],10)*100).toFixed(2)+"%"}fitFontSize(e=!1){const t=this.section.querySelector(".status__container");let s=ts.ui["update-section"]?.height??this.section.getBoundingClientRect().height;e&&(s=this.section.getBoundingClientRect().height);const i=(parseInt(s)-10)/5.5+"px";t.style.fontSize=i}blinkUpdate(){this.section.classList.remove("offline","blink"),this.uiProps.showUpdateBlink&&ns.IS_ONLINE?(this.section.classList.add("blink"),setTimeout((()=>this.section.classList.remove("blink","offline")),1e3)):ns.IS_ONLINE||this.section.classList.add("offline")}}class Ke{get VISIBLE(){return!this.section.classList.contains("hidden")}constructor(){this.initializeElements(),this.addEvents(),this.setValues()}initializeElements(){this.section=document.querySelector("#side_panel"),this.header=this.section.querySelector("#buttons-header_container"),this.settings=this.section.querySelector("#open-settings-button"),this.achievements=this.section.querySelector("#open-achivs-button"),this.gameCard=this.section.querySelector("#open-game-card-button"),this.target=this.section.querySelector("#open-target-button"),this.status=this.section.querySelector("#open-status-button"),this.awards=this.section.querySelector("#open-awards-button"),this.games=this.section.querySelector("#open-games-button"),this.progression=this.section.querySelector("#open-progression-button"),this.userImage=this.section.querySelector("#side-panel-user-image"),this.note=this.section.querySelector("#open-note-button"),this.notifications=this.section.querySelector("#open-notifications-button"),this.user=this.section.querySelector("#open-user-button"),this.stats=this.section.querySelector("#open-stats-button")}addEvents(){this.sidePanel=document.querySelector("#side_panel"),setTimeout((()=>ss.buttons.section.classList.remove("expanded")),2e3),document.addEventListener("touchstart",(e=>this.touchVisibilityHandler(e))),this.settings.addEventListener("click",(e=>{const t=document.querySelector("#settings_section");t?t.remove():ss.settings.openSettings()}))}setValues(){this.userImage.src=ts.userImageSrc}show(){this.section.classList.add("expanded"),this.autoHideTimeout=setTimeout((()=>this.section.classList.remove("expanded")),500),this.section.addEventListener("mousemove",(()=>{this.autoHideTimeout&&clearTimeout(this.autoHideTimeout)})),this.section.addEventListener("mouseleave",(()=>{setTimeout((()=>this.section.classList.remove("expanded")),200)}))}touchVisibilityHandler(e){e.touches[0].clientX<50&&(this.section.classList.add("expanded"),this.section.addEventListener("blur",(e=>{setTimeout((()=>ss.buttons.section.classList.remove("expanded")),0)})))}generatePanel(){const e=document.createElement("section");e.id="side_panel",e.classList.add("buttons-block","expanded")}}const Xe=e=>{const t=e.target,s=+t.dataset.state,i=1===s?-1:s+1,n=t.dataset.value;t.dataset.state=i,t.dataset.event&&new Function("event","state","filterName",t.dataset.event)(e,i,n)},Ye=Object.freeze({en:"en",ua:"ua",br:"br"}),Qe=(e=Ye.en)=>{const t=Object.keys(Ye).includes(e)?e:Ye.en;return`./json/lang/${Ye[t]}.json`},Je=Object.freeze({PARTICLES_MOVE_RANDOM:"partsToRandom",PARTICLES_MOVE_RIGHT:"partsToRight",PARTICLES_MOVE_TOP:"partsToBottom",RANDOM_IMAGE:"randomImage"});class Ze extends pe{widgetIcon={iconClass:"settings-icon"};get settingsItems(){return[{label:ss.lang.style,elements:[{type:P.SELECTOR,label:ss.lang.selectColors,id:"settings_colors-selector",selectValues:[...Object.keys(t).map((e=>({type:P.RADIO,name:"settings_color-scheme",id:`settings_color-scheme-${e}`,label:e,checked:ds.preset===e,event:`onchange="configData.preset = '${e}'"`}))),{type:P.RADIO,name:"settings_color-scheme",id:"settings_color-scheme-custom",label:"custom",checked:"custom"===ds.preset,event:"onchange=\"configData.preset = 'custom'\""}]},{type:P.CHECKBOX,label:ss.lang.showBgAnimation,id:"settings_show-bg",onChange:"configData.bgVisibility = this.checked;",checked:ds.bgVisibility},{type:P.SELECTOR,label:ss.lang.animType,id:"settings_anims-variant",selectValues:[...Object.values(Je).map((e=>({type:P.RADIO,name:"settings_anim-variant",id:`settings_anim-variant-${e}`,label:e,checked:ds.bgAnimType===e,event:`onchange="configData.bgAnimType = '${e}'"`})))]},{type:P.CHECKBOX,label:ss.lang.stickyWindows,id:"settings_sticky-windows",onChange:"ui.settings.IS_WINDOWS_STICKY = this.checked;",checked:this.IS_WINDOWS_STICKY},{type:P.CHECKBOX,label:ss.lang.cheevoOnHover,id:"settings_cheevo-on-hover",onChange:"configData.showCheevoOnHover = this.checked;",checked:ds.showCheevoOnHover}]},{label:ss.lang.customColors,elements:[{type:P.COLOR,id:"main-color-input",label:"main color",value:ds.customColors.mainColor,onChange:"configData.customColors = {colorProperty: 'mainColor', color: this.value};"},{type:P.COLOR,id:"secondary-color-input",label:"secondary color",value:ds.customColors.secondaryColor,onChange:"configData.customColors  = {colorProperty: 'secondaryColor', color: this.value};"},{type:P.COLOR,id:"accent-color-input",label:"accent color",value:ds.customColors.accentColor,onChange:"configData.customColors = {colorProperty: 'accentColor', color: this.value};"},{type:P.COLOR,id:"selection-color-input",label:"selection color",value:ds.customColors.selectionColor,onChange:"configData.customColors = {colorProperty: 'selectionColor', color: this.value};"},{type:P.COLOR,id:"font-color-input",label:"font color",value:ds.customColors.fontColor,onChange:"configData.customColors  = {colorProperty: 'fontColor', color: this.value};"}]},{label:ss.lang.fontFamily,elements:[{type:P.SELECTOR,label:ss.lang.selectFont,id:"settings_font-family",selectValues:[...Object.keys(s).map((e=>({type:P.RADIO,name:"settings_font-family",id:`settings_font-family-${e}`,label:e,checked:ds.fontFamilyName===e,event:`onchange="configData.fontFamilyName = '${e}';"`})))]},{type:P.BUTTON,label:"-",id:"settings_font-size-decrease",onClick:"configData.fontSize = parseFloat(configData.fontSize) - 0.5;"},{type:P.BUTTON,label:"+",id:"settings_font-size-increase",onClick:"configData.fontSize = parseFloat(configData.fontSize) + 0.5;"}]},{label:ss.lang.raApi,elements:[{type:P.SEARCH_INPUT,label:ds.targetUser||ts.USER_NAME,id:"settings_target-user-input",value:ds.targetUser,onChange:"configData.targetUser = this.value",title:ss.lang.targetUserInputHint},{type:P.BUTTON,label:ss.lang.checkGameID,id:"settings_check-game-id",onClick:"watcher.updateGameData(document.getElementById('settings_game-id-input').value)"},{type:P.BUTTON,label:ss.lang.getLastID,id:"settings_get-last-id",onClick:"ui.settings.getLastGameID()"},{type:P.NUM_INPUT,label:ss.lang.gameID,id:"settings_game-id-input",value:ds.gameID,onChange:"configData.gameID = this.value;"},{type:P.CHECKBOX,label:ss.lang.loadLastSubset,id:"settings_load-last-subset",onChange:"configData.loadLastSubset = this.checked;",checked:ds.loadLastSubset}]},{label:ss.lang.autoupdate,elements:[{type:P.CHECKBOX,label:ss.lang.startOnLoad,id:"settings_start-on-load",onChange:"configData.startOnLoad = this.checked;",checked:ds.startOnLoad},{type:P.CHECKBOX,label:ss.lang.pauseIfOffline,id:"settings_autopause",onChange:"configData.pauseIfOnline = this.checked;",checked:ds.pauseIfOnline},{type:P.NUM_INPUT,label:"sec",id:"settings_update-delay-input",value:ds.updateDelaySec,onChange:"configData.updateDelaySec = this.value",title:ss.lang.autoupdateInputHint}]},{label:ss.lang.logParser,elements:[{type:P.CHECKBOX,label:ss.lang.enableLogParser,id:"settings_enable-log-parser",onChange:"configData.parseLog = this.checked;",checked:ds.parseLog},{label:ss.lang.selectRarchLog,type:P.BUTTON,id:"context_open-log-selector",onClick:"config.selectLogFile('rarch')"}]},{label:ss.lang.fsAlerts,elements:[{type:P.CHECKBOX,label:ss.lang.earnCheevoAlert,id:"settings_fsalert-cheevo",onChange:"configData.fsNewCheevo = this.checked;",checked:ds.fsNewCheevo},{type:P.CHECKBOX,label:ss.lang.earnAwardAlert,id:"settings_fsalert-award",onChange:"configData.fsNewAward = this.checked;",checked:ds.fsNewAward},{type:P.NUM_INPUT,label:ss.lang.duration,id:"settings_fsakert-duration-input",value:ds.fsAlertDuration,onChange:"configData.fsAlertDuration = this.value",title:ss.lang.fsAlertDurationInputHint}]},{label:ss.lang.dsAlerts,elements:[{type:P.TEXT_INPUT,label:ss.lang.pasteWebhook,id:"settings_discord-hook-input",value:ds.discordWebhook??"",onChange:"configData.discordWebhook = value;"},{type:P.CHECKBOX,label:ss.lang.startGameAlert,id:"settings_discord-start-game",onChange:"configData.discordNewGame = this.checked;",checked:ds.discordNewGame},{type:P.CHECKBOX,label:ss.lang.startSession,id:"settings_discord-start-session",onChange:"configData.discordStartSession = this.checked;",checked:ds.discordStartSession},{type:P.CHECKBOX,label:ss.lang.earnCheevoAlert,id:"settings_discord-new-cheevo",onChange:"configData.discordNewCheevo = this.checked;",checked:ds.discordNewCheevo},{type:P.NUM_INPUT,label:ss.lang.points,id:"settings_min-points-alert",title:ss.lang.DSAlertMinPointsInputHint,value:ds.minPointsDiscordAlert,onChange:"configData.minPointsDiscordAlert = this.value;"},{type:P.NUM_INPUT,label:ss.lang.retropoints,title:ss.lang.DSAlertMinTruePointsInputHint,id:"settings_min-retropoints-alert",value:ds.minRetroPointsDiscordAlert,onChange:"configData.minRetroPointsDiscordAlert = this.value;"},{type:P.CHECKBOX,label:"Hardcore Only",id:"settings_discord-hard-award",onChange:"configData.hardOnlyDiscordAlert = this.checked;",checked:ds.hardOnlyDiscordAlert},{type:P.CHECKBOX,label:ss.lang.earnAwardAlert,id:"settings_discord-new-award",onChange:"configData.discordNewAward = this.checked;",checked:ds.discordNewAward}]},{label:"Language",elements:[{name:"settings-language",type:P.RADIO,label:"English",id:"settings_lang-en",onChange:`ui.settings.LANG = '${Ye.en}';`,checked:this.LANG===Ye.en},{name:"settings-language",type:P.RADIO,label:"Portugu√™s (Brasil)",id:"settings_lang-br",onChange:`ui.settings.LANG = '${Ye.br}';`,checked:this.LANG===Ye.br},{name:"settings-language",type:P.RADIO,label:"–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞",id:"settings_lang-ua",onChange:`ui.settings.LANG = '${Ye.ua}';`,checked:this.LANG===Ye.ua}]},{label:ss.lang.data,elements:[{label:ss.lang.exportCompletion,type:P.BUTTON,id:"context_export-completion",onClick:"ui.exportCompletionDataToXlsx()"},{label:ss.lang.exportWantToPlay,type:P.BUTTON,id:"context_export-wtp-list",onClick:"ui.exportWantToPlayToCSV()"},{label:ss.lang.exportSettings,type:P.BUTTON,id:"context_export-settings",onClick:"ui.exportSettingsToJson()"},{label:ss.lang.importSettings,type:P.BUTTON,id:"context_import-settings",onClick:"ui.importSettingsFromJson()"},{label:ss.lang.clearCache,type:P.BUTTON,id:"context_clear-cache",onClick:"apiWorker.cache.clear()"}]}]}get LANG(){return ts.ui?.local??Ye.en}set LANG(e){ts.ui.local=e,ts.writeConfiguration(),setTimeout((()=>location.reload()),1e3)}get IS_WINDOWS_STICKY(){return ts.ui.isWindowsSticky??!0}set IS_WINDOWS_STICKY(e){ts.ui.isWindowsSticky=e,ts.writeConfiguration()}get VISIBLE(){return!this.section.classList.contains("hidden")}get contextMenuItems(){return[{label:ss.lang.selectColors,elements:[...Object.keys(t).map((e=>({type:P.RADIO,name:"context_color-scheme",id:`context_color- scheme - ${e}`,label:e,checked:ds.preset===e,event:`onchange ="configData.preset = '${e}'"`}))),{type:P.RADIO,name:"context_color-scheme",id:"settings_color-scheme-custom",label:"custom",checked:"custom"===ds.preset,event:"onchange=\"configData.preset = 'custom'\""}]},{label:ss.lang.animType,elements:[{label:ss.lang.showBgAnimation,type:P.CHECKBOX,id:"context_show-bg-animation",checked:ds.bgVisibility,event:'onchange="configData.bgVisibility = this.checked;"'},...Object.values(Je).map((e=>({type:P.RADIO,name:"context_anim-variant",id:`context_anim-variant-${e}`,label:e,checked:ds.bgAnimType===e,event:`onchange="configData.bgAnimType = '${e}'"`})))]},{label:ss.lang.startOnLoad,type:P.CHECKBOX,id:"context_show-start-on-load",checked:ds.startOnLoad,event:'onchange="configData.startOnLoad = this.checked;"'}]}constructor(){super(),this.setValues()}setValues(){ds.fontSize=ds.fontSize,ds.fontFamilyName=ds.fontFamilyName}addEvents(){super.addEvents(),this.section.addEventListener("click",(e=>{this.section.querySelectorAll(".extended").forEach((e=>e.classList.remove("extended")))}))}generateWidget(e){const t={classes:["prefs_section","section"],id:"settings_section",title:ss.lang.settingsSectionName,contentClasses:["settings_container","content-container"]},s=this.generateWidgetElement(t);ss.app.appendChild(s),this.section=s,this.section.querySelector(".resizer")?.remove(),(e=>{const t=this.section.querySelector(".content-container");t.innerHTML="",e.forEach((e=>{if(e.elements){const s=document.createElement("li");s.classList.add("settings_setting-line"),s.innerHTML=`\n                    <h3 class="settings_setting-header">\n                        ${e?.label}\n                    </h3>`,e.elements.forEach((e=>{s.innerHTML+=C(e)})),t.appendChild(s)}else t.innerHTML+=C(e)}))})(e),this.section.querySelectorAll(".statebox").forEach((e=>e.addEventListener("click",Xe)))}openSettings(e=this.settingsItems){this.close(),this.generateWidget(e),this.addEvents(),ts.ui.settings_section&&(ts.ui.settings_section.x&&(this.section.style.left=ts.ui.settings_section.x),ts.ui.settings_section.y&&(this.section.style.top=ts.ui.settings_section.y)),ss.buttons.settings.checked=!0}close(){ss.buttons.settings.checked=!1,this.section&&this.section.remove()}getLastGameID(){apiWorker.getProfileInfo({}).then((e=>{document.getElementById("settings_game-id-input").value=e.LastGameID,ds.gameID=e.LastGameID,watcher.updateGameData()}))}}class et extends pe{widgetIcon={description:"notes widget",iconID:"side-panel__note",onChangeEvent:"ui.note.VISIBLE = this.checked",iconClass:"note-icon"};AUTOSAVE_INTERVAL_MILISECS=2e3;get notesTabs(){return[{type:"radio",name:"note__tabs",id:"notes__main-tab",label:ss.lang.mainNote,checked:"main"===this.CURRENT_TAB,onChange:"ui.note.CURRENT_TAB = 'main'"},{type:"radio",name:"note__tabs",id:"notes__game-tab",label:ss.lang.gameNote,checked:"game"===this.CURRENT_TAB,onChange:"ui.note.CURRENT_TAB = 'game'"}]}get NOTES_VALUE(){return ts._cfg.ui?.note_section?.notes??""}set NOTES_VALUE(e){ts._cfg.ui.note_section.notes=e,ts.writeConfiguration()}get GAME_NOTES_VALUE(){const e=ns.GAME_DATA?.ID??0;return ts.gamesDB[e]?.notes??""}set GAME_NOTES_VALUE(e){const t=ns.GAME_DATA?.ID??0;ts.gamesDB[t].notes=e,ts.writeConfiguration()}get CURRENT_TAB(){return ts._cfg.ui?.note_section?.currentTab??"main"}set CURRENT_TAB(e){ts._cfg.ui.note_section.currentTab=e,ts.writeConfiguration(),this.switchActiveTab()}constructor(){super(),this.addWidgetIcon(),ts._cfg.ui.note_section||(ts._cfg.ui.note_section={}),this.initializeElements(),this.generateTabs(),this.addEvents(),this.setValues(),Vt.applyPosition({widget:this})}initializeElements(){this.section=document.querySelector("#note_section"),this.header=this.section.querySelector(".header-container"),this.resizer=this.section.querySelector("#note-resizer"),this.textarea=this.section.querySelector(".note-textaria")}generateTabs(){const e=this.notesTabs.reduce(((e,t)=>e+=`\n          <div class="checkbox-input_container" onmousedown="event.stopPropagation()">\n            <input  onchange="${t.onChange}" type="radio" id="${t.id}" ${t.checked?"checked":""} name="${t.name}">\n            <label class="radio-tab" for="${t.id}">${t.label}</label>\n          </div>\n        `),"");document.querySelector(".note__tabs-container").innerHTML=e}addEvents(){super.addEvents(),this.delayedSave={},this.textarea.addEventListener("input",this.textInputHandler)}textInputHandler(e){const t=ns.GAME_DATA?.ID??0,s="main"==ss.note.CURRENT_TAB?"main":t,i=ss.note.textarea.value;clearTimeout(ss.note.delayedSave[s]),ss.note.delayedSave[s]=setTimeout((()=>{ss.note.saveNoteValue({id:s,value:i})}),ss.note.AUTOSAVE_INTERVAL_MILISECS)}saveNoteValue({id:e,value:t}){if("main"===e)this.NOTES_VALUE=t;else this.GAME_NOTES_VALUE=t}setValues(){this.switchActiveTab()}switchActiveTab(){switch(this.CURRENT_TAB){case"main":this.textarea.value=this.NOTES_VALUE;break;case"game":this.textarea.value=this.GAME_NOTES_VALUE}}updateGame(){"game"===this.CURRENT_TAB&&(this.textarea.value=this.GAME_NOTES_VALUE)}async copyNoteText(){const e=this.textarea.value.substring(this.textarea.selectionStart,this.textarea.selectionEnd),t=e||this.textarea.value;try{await navigator.clipboard.writeText(t),this.textInputHandler()}catch(e){console.error(e)}}async pasteTextToNote(){try{const e=await navigator.clipboard.readText();this.textarea.value+=e,this.textInputHandler()}catch(e){console.error(e)}}clearTextNote(){this.textarea.value="",this.textInputHandler()}}class tt extends pe{widgetIcon={description:"awards widget",iconID:"side-panel__awards",onChangeEvent:"ui.awards.VISIBLE = this.checked",iconClass:"awards-icon"};constructor(){super(),this.generateWidget(),this.addWidgetIcon(),this.initializeElements(),this.addEvents(),Vt.applyPosition({widget:this})}generateWidget(){const e=`\n            ${he("ui.awards.updateAwards()")}\n        `,t={classes:["awards_section","section"],id:"awards_section",title:ss.lang.awardsSectionName,headerElementsHtml:e,contentClasses:["awards-content_container","content-container"]},s=this.generateWidgetElement(t);ss.app.appendChild(s)}initializeElements(){this.section=document.querySelector(".awards_section"),this.container=this.section.querySelector(".awards-content_container")}addEvents(){super.addEvents()}async updateAwards(){const e=await is.getUserAwards({});this.parseAwards(e)}parseAwards(e){if(!e?.TotalAwardsCount)return;this.container.innerHTML="";const{dataset:t}=this.container;t.total=e.TotalAwardsCount,t.beatenSoftcore=e.BeatenSoftcoreAwardsCount,t.beatenHard=e.BeatenHardcoreAwardsCount,t.completion=e.CompletionAwardsCount,t.mastery=e.MasteryAwardsCount;let s=[...e.VisibleUserAwards]?.sort(((e,t)=>t.awardedDate-e.awardedDate));const i=this.generateAwardsGroupsArray(s);this.generateConsolesAwards(i)}generateAwardsGroupsArray(e){return e.reduce(((e,t)=>(e.hasOwnProperty(t.ConsoleName)||(e[t.ConsoleName]=[]),e[t.ConsoleName].push(t),e.Total.push(t),e)),{Total:[]})}generateConsolesAwards(e){Object.keys(e).forEach((t=>{let s=document.createElement("li");s.classList.add("console-awards"),"Total"!==t&&s.classList.add("collapsed"),s.dataset.consoleName=t;let i=e[t].length;s.innerHTML=`\n                <h3 class="awards-console_header" onclick="ui.awards.expandAwards(this)">${t}</h3>\n                <ul class="console-awards-values">\n                    <li class="awarded-games total" data-title="${ss.lang.totalAwardsHint}" onclick="ui.awards.filterAwards('all')">\n                        ${i}\n                    </li>\n                    ${Object.values(x).map((s=>{return`\n                        <li class="awarded-games ${s}" data-title="${ss.lang[s]??s}" onclick="ui.awards.filterAwards('${s}')">\n                            ${i=s,e[t]?.filter((e=>e.award===i)).length}\n                        </li>\n                        `;var i})).join("")}\n                </ul>\n                <button class="expand-awards_button" onclick="ui.awards.expandAwards(this)"> </button>\n                <ul class="flex-main-list awarded-games_list ${"Total"!==t?"hidden":""} total">\n                </ul>\n                `,this.container.appendChild(s);let n=s.querySelector(".flex-main-list");e[t].forEach((e=>{n.appendChild(this.generateAwardElement(e))}))}))}generateAwardElement(e){let t=document.createElement("li");return t.classList.add("awarded-game","awards__game-item","main-column-item","right-bg-icon",e.award),t.dataset.title=`${ss.lang.awardTypeHint}: ${e.award}`,t.innerHTML=`\n            <img class="awards__game-preview" src="${O(e.ImageIcon)}" alt=" ">\n            <h3 class="game-title">${e.Title}</h3>\n            <p class="awards__game-description">${e.ConsoleName}</p>\n            <p class="awards__game-description">${e.timeString}</p>\n        `,t}expandAwards(e){const t=e.parentNode,s=t.querySelector(".awarded-games_list");s.classList.contains("hidden")?(t.classList.remove("collapsed"),s.classList.remove("hidden")):(t.classList.add("collapsed"),s.classList.add("hidden"))}filterAwards(e){this.container.querySelectorAll(".awarded-game").forEach((t=>{t.classList.remove("hidden"),t.classList.contains(e)||"all"===e||t.classList.add("hidden")}))}}class st extends pe{widgetIcon={description:"game info widget",iconID:"side-panel__gamecard",onChangeEvent:"ui.gameCard.VISIBLE = this.checked",iconClass:"game-info-icon"};previewTypes={boxart:"0",ingame:"1",titleScreen:"2"};uiDefaultValues={showHeader:!1,showBadges:!0,previewType:this.previewTypes.boxart};uiSetCallbacks={};uiValuePreprocessors={};get contextMenuItems(){return[{label:ss.lang.previewType,elements:[...Object.keys(this.previewTypes).map((e=>({type:P.RADIO,name:"game-card_preview-type",id:`game-card_preview-${e}`,label:ss.lang[e],checked:this.uiProps.previewType===this.previewTypes[e],event:`onchange="ui.gameCard.uiProps.previewType = '${this.previewTypes[e]}';"`})))]},{label:ss.lang.showHeader,type:P.CHECKBOX,id:"game-card_show-header",event:'onchange="ui.gameCard.uiProps.showHeader = this.checked"',checked:this.uiProps.showHeader},{label:ss.lang.showTitleBadges,type:P.CHECKBOX,id:"game-card_show-badges",event:'onchange="ui.gameCard.uiProps.showBadges = this.checked"',checked:this.uiProps.showBadges}]}constructor(){super(),this.generateWidget(),this.addWidgetIcon(),this.initializeElements(),this.addEvents(),Vt.applyPosition({widget:this})}generateWidget(){const e=`\n            ${se()}\n            ${ie()}\n            ${ae()}\n        `,t={classes:["game-card_section","section"],id:"game_section",title:ss.lang.gameCard,headerElementsHtml:e,contentClasses:["game-card_container","content-container"]},s=this.generateWidgetElement(t);s.querySelector(".content-container").innerHTML='\n            <div class="game-card_image-container">\n                <div class="game-card__icons-container"></div>\n                <img id="game-card-image" class="game-card_image" src="" onerror="this.src=\'./assets/img/missable.svg\';" alt=" " />\n            </div>\n            <div class="hor-line-decorate"></div>\n            <div class="game-card__description">\n                <h2 class="game-card__title-container">\n                    <span class="game-card__progression-award"></span>\n                    <span class="game-card__award"></span>\n                    <a id="game-card-header" href="#" target="_blank"> </a>\n                </h2>\n                <div class="game-card__info game-card__genres-container"></div>\n            </div>\n        ',ss.app.appendChild(s)}initializeElements(){this.section=document.querySelector(".game-card_section"),this.sectionID=this.section.id,this.header=document.querySelector("#game-card-header"),this.descriptions=document.querySelector(".game-card__description"),this.preview=document.querySelector("#game-card-image"),this.iconsContainer=this.section.querySelector(".game-card__icons-container"),this.badgesContainer=this.section.querySelector(".game-card__genres-container")}setElementsValues(){const{award:e,progressionAward:t,ConsoleID:s}=ns.GAME_DATA;switch(this.badgesContainer.classList.toggle("hidden",!this.uiProps.showBadges),this.section.dataset.award=e,this.section.dataset.progressionAward=t,this.section.classList.toggle("left-margin-preview",(e=>[4,5,6,18,78].includes(e))(s)),this.section.classList.toggle("compact-header",!this.uiProps.showHeader),this.uiProps.previewType){case this.previewTypes.ingame:this.preview.src=O(ns?.GAME_DATA?.ImageIngame);break;case this.previewTypes.titleScreen:this.preview.src=O(ns?.GAME_DATA?.ImageTitle);break;default:this.preview.src=O(ns?.GAME_DATA?.ImageBoxArt)}}addEvents(){super.addEvents(),this.section.querySelector(".comments-button").addEventListener("click",(e=>{const t=ns.GAME_DATA?.ID;t&&Me(t,1)})),this.section.querySelector(".game-props-button").addEventListener("click",(e=>{e.stopPropagation(),qe().open(ns.GAME_DATA)})),this.section.addEventListener("mousedown",(e=>{0!==e.button||e.target.closest(".resizer, button")||this.section.classList.contains("resized")||Q(this.section,e)}))}async gameChangeEvent(e){const{Title:t,ID:s,ImageBoxArt:i,Genre:n,totalRetropoints:a,NumAchievements:o,totalPoints:l,badges:h,retroRatio:u,ConsoleName:m,ConsoleID:g,Developer:v,Publisher:E,Released:f,gameDifficulty:A,masteryDifficulty:T,timeToBeat:w,timeToMaster:b}=ns.GAME_DATA;(async()=>{const e=(()=>{const e=[];return v&&e.push(`dev: ${v}`),E&&e.push(`Pub: ${E}`),f&&e.push(`${c(f)}`),e})();this.setElementsValues(),this.header.innerHTML=`${t.replaceAll(/\,\s*the$/gi,"")}`,this.header.href=M(s),this.preview.alt=`${t} boxart`;const i=`HLTB: \n                    ${w?r(w)+" | ":""} \n                    ${b?r(b):"-"}`,a=[m,...h,...n?n.split(","):[],...e,d[A],i];this.badgesContainer.innerHTML=_(a,"selection")})(),(()=>{this.iconsContainer.innerHTML=`\n                ${y.black(p.cheevos(o))}\n                ${y.black(p.points(l))}\n                ${y.black(p.retropoints(a))}\n                ${y.black(p.retroRatio(u))}\n            `})()}}class it extends pe{widgetIcon={description:"progression widget",iconID:"side-panel__progression",onChangeEvent:"ui.progression.VISIBLE = this.checked",iconClass:"progression"};get contextMenuItems(){return[{label:ss.lang.elements,elements:[{label:ss.lang.showHeader,type:P.CHECKBOX,id:"show-header",checked:this.uiProps.showHeader,event:'onchange="ui.progression.uiProps.showHeader = this.checked;"'},{label:ss.lang.showBackground,type:P.CHECKBOX,id:"show-bg",checked:this.uiProps.showBG,event:'onchange="ui.progression.uiProps.showBG = this.checked;"'}]},{label:ss.lang.style,elements:[{label:ss.lang.showSubLevels,type:P.CHECKBOX,id:"show-sublevels",checked:this.uiProps.showSublevels,event:'onchange="ui.progression.uiProps.showSublevels = this.checked;"'},{label:ss.lang.showAllDesc,type:P.CHECKBOX,id:"show-all-descr",checked:this.uiProps.showAllDescriptions,event:'onchange="ui.progression.uiProps.showAllDescriptions = this.checked;"'}]}]}uiDefaultValues={showBG:!0,showHeader:!1,hardMode:!0,showSublevels:!0,showAllDescriptions:!1};uiSetCallbacks={};uiValuePreprocessors={};constructor(){super(),this.generateWidget(),this.addWidgetIcon(),this.initializeElements(),this.setElementsValues(),this.addEvents(),Vt.applyPosition({widget:this}),this.generateProgression()}initializeElements(){this.section=document.querySelector("#progression_section"),this.sectionID=this.section.id,this.header=this.section.querySelector(".header-container"),this.resizer=this.section.querySelector("#progression-resizer")}setElementsValues(){this.section.classList.toggle("compact-header",!this.uiProps.showHeader),this.section.classList.toggle("hide-bg",!this.uiProps.showBG),this.section.classList.toggle("show-all-descriptions",this.uiProps.showAllDescriptions),this.section.classList.toggle("show-sublevels",this.uiProps.showSublevels)}addEvents(){super.addEvents()}update({earnedAchievementIDs:e}){e[0]&&(this.uiProps.hardMode=ns.CHEEVOS[e[0]].isHardcoreEarned),this.generateProgression()}generateWidget(){const e={classes:["progression_section","section","compact-header"],id:"progression_section",title:ss.lang.progressionSectionName,contentClasses:["progression__list","content-container"]},t=this.generateWidgetElement(e);ss.app.appendChild(t)}generateProgression(){const e=this.section.querySelector(".progression__list");const t=Object.values(ns.CHEEVOS)?.filter((e=>e.Type==ve.PROGRESSION||e.Type==ve.WIN)).sort(((e,t)=>0===e.DisplayOrder?e.ID-t.ID:e.DisplayOrder-t.DisplayOrder)),s=t.find((e=>this.uiProps.hardMode?!e.isHardcoreEarned:!e.isEarned))?.ID;e.innerHTML=t?.reduce(((e,i)=>(e+=function(e,t){const i=e.level,n=t?.find((e=>e.level>i))?.level??i+1,a=null!=i?Object.values(ns.CHEEVOS).filter((e=>e.level&&![ve.PROGRESSION,ve.WIN].includes(e.Type)&&e.level>=i&&e.level<n)):[],o=`\n                <li class="progression__item ${s===e.ID?"focus":""} ${e.Type}-cheevo">\n                    <p class="cheevo-date">${l(e.DateEarnedHardcore||e.DateEarned,{year:"2-digit"})}</p>\n                    <div class="mark ${e.isEarned?"earned":""} ${e.isHardcoreEarned?"hardcore":""}"></div>\n                    <div class="cheevo-container">\n                        <h3 class="cheevo-title" data-achiv-id="${e.ID}">${e.Title}</h3>\n                        <p class="cheevo-description">\n                            ${e.Description}</p>\n                        <div class="subcheevos-container">\n                            ${a?.reduce(((e,t)=>e+`<h3 class="progression__subcheevo ${t.isEarned?"earned":""} ${t.isHardcoreEarned?"hardcore":""}" data-achiv-id="${t.ID}">${t.Title}</h3>`),"")}\n                        </div>\n                    </div>\n                </li>\n            `;return o}(i,t),e)),"")??"",this.scrollToFocus()}scrollToFocus(){const e=this.section?.querySelector(".focus")||this.section?.querySelector(".win_condition-cheevo");e?.scrollIntoView({behavior:"auto",block:"center"})}}class nt extends pe{widgetIcon={description:"user statistics widget",iconID:"side-panel__stats",onChangeEvent:"ui.stats.VISIBLE = this.checked",iconClass:"stats-icon"};get contextMenuItems(){return[{label:ss.lang.showStats,elements:[{type:P.CHECKBOX,name:"show-points",id:"show-points",label:ss.lang.points,checked:this.uiProps.showHP,event:'onchange="ui.stats.uiProps.showHP = this.checked;"'},{type:P.CHECKBOX,name:"show-retropoints",id:"show-retropoints",label:ss.lang.retropoints,checked:this.uiProps.showRP,event:'onchange="ui.stats.uiProps.showRP = this.checked;"'},{type:P.CHECKBOX,name:"show-softpoints",id:"show-softpoints",label:ss.lang.softpoints,checked:this.uiProps.showSP,event:'onchange="ui.stats.uiProps.showSP = this.checked;"'},{type:P.CHECKBOX,name:"show-rank",id:"show-rank",label:ss.lang.rank,checked:this.uiProps.showRank,event:'onchange="ui.stats.uiProps.showRank = this.checked;"'},{type:P.CHECKBOX,name:"show-percentile",id:"show-percentile",label:ss.lang.percentile,checked:this.uiProps.showPercentile,event:'onchange="ui.stats.uiProps.showPercentile = this.checked;"'},{type:P.CHECKBOX,name:"show-true-ratio",id:"show-true-ratio",label:ss.lang.trueRatio,checked:this.uiProps.showTrueRatio,event:'onchange="ui.stats.uiProps.showTrueRatio = this.checked;"'},{type:P.CHECKBOX,name:"show-completion-chart",id:"show-completion-chart",label:ss.lang.completionChart,checked:this.uiProps.completionChart,event:'onchange="ui.stats.uiProps.completionChart = this.checked;"'}]},{label:ss.lang.style,elements:[{type:P.CHECKBOX,name:"show-header",id:"show-header",label:ss.lang.showHeader,checked:this.uiProps.showHeader,event:'onchange="ui.stats.uiProps.showHeader = this.checked;"'},{type:P.CHECKBOX,name:"show-bg",id:"show-bg",label:ss.lang.showBackground,checked:this.uiProps.showBG,event:'onchange="ui.stats.uiProps.showBG = this.checked;"'},{type:P.RADIO,name:"list-type",id:"list-type-list",label:"List",checked:this.uiProps.listMode,event:'onchange="ui.stats.uiProps.listMode = true;"'},{type:P.RADIO,name:"list-type",id:"list-type-grid",label:"Grid",checked:!this.uiProps.listMode,event:'onchange="ui.stats.uiProps.listMode = false;"'}]},{type:P.CHECKBOX,name:"show-session-progress",id:"show-session-progress",label:ss.lang.showSessionProgress,checked:this.uiProps.showSessionProgress,event:'onchange="ui.stats.uiProps.showSessionProgress = this.checked;"'}]}uiDefaultValues={listMode:!1,completionChart:!1,showSessionProgress:!0,showTrueRatio:!0,showPercentile:!0,showRank:!0,showSP:!1,showRP:!0,showHP:!0,showHeader:!1,showBG:!0};uiSetCallbacks={completionChart(){this.setElementsValues(),this.updateChart()}};saveProppertySetting(e,t){ts.ui.stats_section||(ts.ui.stats_section={}),ts.ui.stats_section[e]=t,ts.writeConfiguration()}initialUserSummary;userSummary;constructor(){super(),this.generateWidget(),this.addWidgetIcon(),this.initializeElements(),this.setElementsValues(),this.addEvents(),Vt.applyPosition({widget:this})}generateWidget(){const e=`\n            ${ae()}\n            <button class=" header-button header-icon update-icon" id="" title="${ss.lang.forceReloadHint}"\n            onclick="ui.stats.updateStats({})"></button>\n        `,t={classes:["section","stats_section","compact-header"],id:"stats_section",title:ss.lang.statisticsSectionName,headerElementsHtml:e,contentClasses:["stats-container","content-container"]},s=this.generateWidgetElement(t);ss.app.appendChild(s)}initializeElements(){this.section=document.querySelector("#stats_section"),this.sectionID=this.section.id,this.header=this.section.querySelector(".header-container"),this.container=this.section.querySelector(".stats-container"),this.generateStatsElements(),this.rankRateElement=this.section.querySelector("#stats_rank-rate"),this.rankElement=this.section.querySelector("#stats_rank"),this.pointsElement=this.section.querySelector("#stats_points"),this.retropointsElement=this.section.querySelector("#stats_retropoints"),this.softpointsElement=this.section.querySelector("#stats_softpoints"),this.trueRatioElement=this.section.querySelector("#stats_true-ratio"),this.completionElement=this.section.querySelector(".stats__chart-container"),this.masteredCountElement=this.section.querySelector("#stats_mastered-count"),this.beatenCountElement=this.section.querySelector("#stats_beaten-count"),this.playedCountElement=this.section.querySelector("#stats_played-count"),this.resizer=this.section.querySelector(".resizer")}setElementsValues(){this.pointsElement.closest("li").classList.toggle("hidden",!this.uiProps.showHP),this.retropointsElement.closest("li").classList.toggle("hidden",!this.uiProps.showRP),this.softpointsElement.closest("li").classList.toggle("hidden",!this.uiProps.showSP),this.rankElement.closest("li").classList.toggle("hidden",!this.uiProps.showRank),this.rankRateElement.closest("li").classList.toggle("hidden",!this.uiProps.showPercentile),this.trueRatioElement.closest("li").classList.toggle("hidden",!this.uiProps.showTrueRatio),this.completionElement.classList.toggle("hidden",!this.uiProps.completionChart),this.section.classList.toggle("compact-header",!this.uiProps.showHeader),this.section.classList.toggle("hide-bg",!this.uiProps.showBG),this.container.classList.toggle("show-session-progress",this.uiProps.showSessionProgress),this.container.classList.toggle("list-mode",this.uiProps.listMode)}addEvents(){super.addEvents()}initialSetStats({userSummary:e,completionProgress:t}){this.initialData={Rank:e.Rank,rankRate:+(100*e.Rank/e.TotalRanked).toFixed(2),TotalPoints:e.TotalPoints,TotalSoftcorePoints:e.TotalSoftcorePoints,TotalTruePoints:e.TotalTruePoints,trueRatio:+(e.TotalTruePoints/e.TotalPoints).toFixed(2)},e&&(this.userSummary=e,this.initialUserSummary=e,this.rankElement.innerText=e.Rank,this.rankRateElement.innerText=(100*e.Rank/e.TotalRanked).toFixed(2)+"%",this.pointsElement.innerText=e.TotalPoints,this.softpointsElement.innerText=e.TotalSoftcorePoints,this.retropointsElement.innerText=e.TotalTruePoints,this.trueRatioElement.innerText=(e.TotalTruePoints/e.TotalPoints).toFixed(2)),setTimeout((()=>this.updateChart()),1e3)}async updateStats({currentUserSummary:e}){e||(e=await is.getUserSummary({gamesCount:"0",achievesCount:0}));const t=(t,s)=>{let i=0,n=0,a=0,o=0;switch(s){case"rankRate":a=(100*e.Rank/e.TotalRanked).toFixed(2),o=(100*this.userSummary.Rank/this.userSummary.TotalRanked).toFixed(2),i=+(a-o).toFixed(2),n=-(a-this.initialData.rankRate).toFixed(2),a+="%";break;case"trueRatio":a=(e.TotalTruePoints/e.TotalPoints).toFixed(2),o=(this.userSummary.TotalTruePoints/this.userSummary.TotalPoints).toFixed(2),i=+(a-o).toFixed(2),n=+(a-this.initialData.trueRatio).toFixed(2);break;case"Rank":i=e[s]-this.userSummary[s],n=this.initialData[s]-e[s],a=e[s];break;default:i=e[s]-this.userSummary[s],n=e[s]-this.initialData[s],a=e[s]}if(0==i)return;const r=i<0,l=n<0;t.classList.add("delta"),t.classList.toggle("negative",r),t.dataset.delta=`${r||0==i?"":"+"}${i}`;setTimeout((()=>{const e=0==n?"":l?"‚ñæ"+-1*n:`‚ñ¥${n}`;t.innerHTML=a+` <span class="session-progress ${l?"negative":""}">${e}</span>`,t.classList.remove("delta")}),0)};t(this.rankRateElement,"rankRate"),t(this.rankElement,"Rank"),t(this.pointsElement,"TotalPoints"),t(this.softpointsElement,"TotalSoftcorePoints"),t(this.retropointsElement,"TotalTruePoints"),t(this.trueRatioElement,"trueRatio"),this.userSummary=e}async updateChart(){if(!this.uiProps.completionChart)return;const e=this.section.querySelector(".stats__chart-container"),t=await is.completionProgress(),s=t?.Results??[],i=s.length,n=s.filter((e=>"mastered"===e.HighestAwardKind)).length/i*100,a=s.filter((e=>"completed"===e.HighestAwardKind)).length/i*100,o=s.filter((e=>"beaten-hardcore"===e.HighestAwardKind)).length/i*100,r=s.filter((e=>"beaten-softcore"===e.HighestAwardKind)).length/i*100;e.style.setProperty("--m",n+"%"),e.style.setProperty("--c",a+"%"),e.style.setProperty("--b",o+"%"),e.style.setProperty("--b-s",r+"%"),this.section.querySelector(".legend__value-mastered").innerText=n.toFixed(2)+"%",this.section.querySelector(".legend__value-completed").innerText=a.toFixed(2)+"%",this.section.querySelector(".legend__value-beaten").innerText=o.toFixed(2)+"%",this.section.querySelector(".legend__value-beaten-soft").innerText=r.toFixed(2)+"%",this.section.querySelector(".legend__value-progress").innerText=(100-n-a-o-r).toFixed(2)+"%"}statusProperties={percentile:{label:ss.lang.percentile,id:"stats_rank-rate",class:"stats__rank-value"},rank:{label:ss.lang.rank,id:"stats_rank",class:"stats__rank-value"},points:{label:ss.lang.points,id:"stats_points"},retropoints:{label:ss.lang.retropoints,id:"stats_retropoints"},trueRatio:{label:ss.lang.trueRatio,id:"stats_true-ratio"},softpoints:{label:ss.lang.softpoints,id:"stats_softpoints"}};generateStatsElements(){const e=Object.values(this.statusProperties).reduce(((e,t)=>e+=`\n          <li class="stats__stat-container">\n              <h2 class="stats__title">${t.label}</h2>\n              <p id="${t.id}" class="stats__value ${t.class}"></p>\n          </li>\n          `),"");this.container.innerHTML=e+'\n            <li class="stats__stat-container stats__chart-container">\n            \n            <div class="round-stat__container ">\n                <div class="circle">\n                <div class="round-stat__total" id="sector"></div>\n                </div>\n                <div class="round-stat__legend">\n                    <div class="legend__award legend__mastered">mastered: <span class="legend__value-mastered">0%</span></div>\n                    <div class="legend__award legend__completed">completed: <span class="legend__value-completed">0%</div>\n                    <div class="legend__award legend__beaten">beaten: <span class="legend__value-beaten">0%</div>\n                    <div class="legend__award legend__beaten-soft">beaten soft: <span class="legend__value-beaten-soft">0%</div>\n                    <div class="legend__award legend__started">in progress: <span class="legend__value-progress">0%</div>\n                </div>\n            </div>\n            </li>\n        '}}const at=({imageUrl:e,title:t,titleUrl:s,meta:i,icons:n=[],badge:a="",alertType:o})=>{const r={[k.CHEEVO]:{title:"unlocked",color:"gold"},[k.GAME]:{title:"launched",color:"lime"},[x.BEATEN]:{title:"beaten",color:"orange"},[x.BEATEN_SOFTCORE]:{title:"beaten*",color:"darkorange"},[x.MASTERED]:{title:"mastered",color:"violet"},[x.COMPLETED]:{title:"completed",color:"yellow"}};return`\n            <div class="media-item">\n                <div class="media-item__award" style="--alert-color:${r[o].color}">\n                    <p class="media-item__award-name" >\n                            ${r[o]?.title??""}\n                    </p>\n                </div>\n                <div class="media-item__preview">\n                    <img\n                    class="media-item__image"\n                    src="${e}"\n                    alt=""\n                    >\n                </div>\n\n                <div class="media-item__content">\n                    <h3 class="media-item__title">\n                        ${a||""} \n                    <a\n                        class="media-item__link"\n                        target="_blank"\n                        href="${s}"\n                    >\n                        ${t}\n                    </a>\n                    </h3>\n\n                    <p class="media-item__meta">\n                        ${i}\n                    </p>\n                    <div class="media-item__stats icons-row-list">\n                        ${n.map((e=>p[e.type]?.(e.value))).join("")}\n                    </div>\n                </div>\n            </div>\n        `};class ot extends pe{widgetIcon={description:"notifications widget",iconID:"side-panel__notifications",onChangeEvent:"ui.notifications.VISIBLE = this.checked",iconClass:"notification-icon"};get contextMenuItems(){return[{label:ss.lang.showHeader,type:P.CHECKBOX,id:"hide-notification-header",checked:this.uiProps.showHeader,event:'onchange="ui.notifications.uiProps.showHeader = this.checked;"'},{label:ss.lang.transparentBg,type:P.CHECKBOX,id:"hide-notification-bg",checked:this.uiProps.hideBg,event:'onchange="ui.notifications.uiProps.hideBg = this.checked;"'},{label:ss.lang.showTimestamps,type:P.CHECKBOX,id:"show-notification-time",checked:this.uiProps.showTimestamp,event:'onchange="ui.notifications.uiProps.showTimestamp = this.checked;"'}]}uiDefaultValues={showTimestamp:!0,showHeader:!1,hideBg:!1};uiSetCallbacks={};uiValuePreprocessors={};alertsCacheName="raApiAlertsCache";get NOTIFICATIONS(){return this._notifications??{time:"",notifications:[]}}constructor(){super(),this.generateWidget(),this.addWidgetIcon(),this.initializeElements(),this.addEvents(),this.setElementsValues(),Vt.applyPosition({widget:this}),this.updateInterval=setInterval((()=>{this.container.querySelectorAll(".notification_timestamp").forEach((e=>{e.innerText=this.getDeltaTime(e.dataset.time)}))}),6e4),this.showSavedAlert()}initializeElements(){this.section=document.querySelector("#notification_section"),this.sectionID=this.section.id,this.container=this.section.querySelector(".notification-container"),this.resizer=this.section.querySelector(".resizer")}generateWidget(){const e={classes:["notification_section","bg-visible","section","compact-header"],id:"notification_section",title:ss.lang.alertsSectionName,contentClasses:["notification-container","content-container"]},t=this.generateWidgetElement(e);ss.app.appendChild(t)}addEvents(){super.addEvents()}setElementsValues(){this.section.classList.toggle("compact-timestamp",!this.uiProps.showTimestamp),this.section.classList.toggle("compact-header",!this.uiProps.showHeader),this.section.classList.toggle("hide-bg",this.uiProps.hideBg)}gameChangeEvent(e){if(!e)return;const t=[{type:k.GAME,value:ns.GAME_DATA}];this.addAlertsToQuery(t)}saveAlerts(e){const t=(new Date).toISOString(),s=e.map((e=>{if([k.GAME,k.AWARD].includes(e.type)){const{Title:t,ImageIcon:s,totalPoints:i,NumDistinctPlayers:n,retroRatio:a,NumAchievements:o,ConsoleName:r,ID:l}=e.value,c={Title:t,ImageIcon:s,totalPoints:i,NumDistinctPlayers:n,retroRatio:a,NumAchievements:o,ConsoleName:r,ID:l};return{...e,value:c}}if(e.type===k.CHEEVO){const{Title:t,BadgeName:s,Points:i,Description:n,TrueRatio:a,retroRatio:o,rateEarnedHardcore:r,ID:l}=e.value,c={Title:t,BadgeName:s,Points:i,Description:n,TrueRatio:a,retroRatio:o,rateEarnedHardcore:r,ID:l};return{...e,value:c}}console.log("notification type doesn't exist")})),i=this.getSavedAlerts();i.length>=20&&i.shift(),i.push({timeStamp:t,alerts:s}),localStorage.setItem(this.alertsCacheName,JSON.stringify(i))}getSavedAlerts(){return JSON.parse(localStorage.getItem(this.alertsCacheName))??[]}showSavedAlert(){this.getSavedAlerts().forEach((({timeStamp:e,alerts:t})=>{this.showAlerts(t,new Date(e).toLocaleString())}))}addAlertsToQuery(e=[]){this.alertsQueryArray?.length>0?this.alertsQueryArray=[...this.alertsQueryArray,...e]:(this.alertsQueryArray=[...e],setTimeout((()=>{this.saveAlerts(this.alertsQueryArray),this.showAlerts(this.alertsQueryArray)}),2e3))}showAlerts(e,t){if(!e)return;const s=(e,t)=>{const s=this.generatePopupTime(t),i=document.createElement("ul");return i.classList.add("notification_timeblock-list"),i.appendChild(s),e.forEach((e=>{i.appendChild(e)})),i};let i=[];for(;e.length>0;){const t=e.shift();if(t)switch(t.type){case k.GAME:i.push(this.gameAlertElement(t.value));break;case k.CHEEVO:i.push(this.cheevoAlertElement(t.value));break;case k.AWARD:i.push(this.awardAlertElement(t));break;default:console.log("notification type doesn't exist")}}if(i.length>0){const e=s(i,t);this.container.prepend(e);const n=e.getBoundingClientRect().height;this.container.style.setProperty("--offset-height",`${n}px`),e.classList.add("notification_popup")}}generatePopupTime(e){!e&&(e=(new Date).toLocaleString());const t=document.createElement("li"),s=(e?(e=>{const[t,s]=e.split(", "),[i,n,a]=t.split(".").map(Number),[o,r]=s.split(":").map(Number);return new Date(a,n-1,i,o,r)})(e):new Date).getTime();return t.dataset.time=s,t.classList.add("notification_timestamp"),t.innerHTML=`\n            ${this.getDeltaTime(s)}\n        `,t}gameAlertElement(e){const t=document.createElement("li");t.classList.add("notification-game","new-game");const s=at({alertType:k.GAME,imageUrl:O(e.ImageIcon),title:e.Title,titleUrl:M(e.ID??e.GameID),meta:`${e.ConsoleName}`,icons:[{type:"players",value:e.NumDistinctPlayers},{type:"cheevos",value:e.NumAchievements},{type:"points",value:e.totalPoints},{type:"retroRatio",value:e.retroRatio}]});return t.innerHTML=s,t}cheevoAlertElement(e){const t=document.createElement("li");t.classList.add("notification-achiv","new-achiv");const s=at({alertType:k.CHEEVO,imageUrl:N(e),title:e.Title,badge:E.progressionAward,titleUrl:H(e),meta:e.Description,icons:[{type:"points",value:e.Points},{type:"retropoints",value:e.TrueRatio},{type:"retroRatio",value:e.retroRatio},{type:"rarity",value:e.rateEarnedHardcore}]});return t.innerHTML=s,t}awardAlertElement({award:e,value:t}){const s=document.createElement("li");s.classList.add("notification-game","new-game");const i=at({alertType:e,imageUrl:O(t.ImageIcon),badge:E.masteryAward,title:t.Title,titleUrl:M(t.ID??t.GameID),meta:`${t.ConsoleName}`,icons:[{type:"players",value:t.NumDistinctPlayers},{type:"cheevos",value:t.NumAchievements},{type:"points",value:t.totalPoints},{type:"retroRatio",value:t.retroRatio}]});return s.innerHTML=i,s}getDeltaTime(e){let t=+e,s=~~(((new Date).getTime()-t)/1e3);return s<120?"moment ago":s<600?"few minutes ago":s<3600?~~(s/60)+" minutes ago":s<43200?new Date(t).toLocaleTimeString().replace(/:[^:]*$/gi,""):new Date(t).toLocaleString().replace(/:[^:]*$/gi,"")}}const rt={SEGA:{"SG-1000":"33","Master System":"11","Genesis/Mega Drive":"1","Game Gear":"15","Sega CD":"9","32X":"10",Saturn:"39",Dreamcast:"40"},Nintendo:{"NES/Famicom":"7","Game Boy":"4","SNES/Super Famicom":"3","Game Boy Color":"6","Nintendo 64":"2","Game Cube":"16","Game Boy Advance":"5","Virtual Boy":"28","Nintendo DS":"18","Nintendo DSi":"78","Pokemon Mini":"24"},NEC:{"PC Engine/TurboGrafx-16":"8","PC Engine CD/TurboGrafx-CD":"76","PC-8000/8800":"47","PC-FX":"49"},SONY:{PlayStation:"12","PlayStation 2":"21","PlayStation Portable":"41"},SNK:{"Neo Geo Pocket":"14","Neo Geo CD":"56"},Atari:{"Atari 2600":"25","Atari 7800":"51","Atari Lynx":"13","Atari Jaguar":"17","Atari Jaguar CD":"77"},Other:{"Magnavox Odyssey 2":"23",Arcade:"27","Apple II":"38","Amstrad CPC":"37",MSX:"29","3DO Interactive Multiplayer":"43",ColecoVision:"44",Intellivision:"45",Vectrex:"46",WonderSwan:"53","Fairchild Channel F":"57","Watara Supervision":"63","Mega Duck":"69",Arduboy:"71","WASM-4":"72","Arcadia 2001":"73","Interton VC 4000":"74","Elektor TV Games Computer":"75",Uzebox:"80"},Special:{Events:"101",Standalone:"102"}},lt=Object.freeze({RETAIL:"Retail",HACK:"Hack",UNLICENSED:"Unlicensed",DEMO:"Demo",HOMEBREW:"Homebrew",PROTOTYPE:"Prototype"}),ct={t:"Title",b:"badges",i:"ID",c:"ConsoleID",j:"ImageIcon",a:"NumAchievements",p:"Points",d:"Date",e:"Coop",r:"Rating",g:"Genres",h:"HLTB"};function dt(e){return e.map((e=>a[e]))}const ht=async()=>{const e=await fetch("./json/games/all_ext_min.json"),t=(e=>e.map((e=>{let t={};if(Object.keys(e).forEach((s=>{t={...t,[ct[s]]:e[s]}})),t.HLTB){const e=Math.min(...Object.values(t.HLTB)),s=`${e>=60?`${~~(e/60)}hr${e>119?"s":""}`:""} ${e%60>0?e%60+"mins":""}`;t.timeToBeat=s}return t.ImageIcon=`/Images/${t.ImageIcon}.png`,!t.badges&&(t.badges=[]),!t.Genres&&(t.Genres=[]),t})))(await e.json());return t};class ut extends pe{widgetIcon={description:"games widget",iconID:"side-panel__games",onChangeEvent:"ui.games.VISIBLE = this.checked",iconClass:"games-icon"};contextMenuItems(e){return[{type:P.BUTTON,id:"update-game",label:"**Update game**",event:`onclick="watcher.updateGameData(${e})"`},{type:P.CHECKBOX,id:"add-to-favourites",label:"fav",checked:ss.games.FAVOURITES.includes(+e),event:`onclick="ui.games.addToFavourite(event,${e})"`}]}get headerControls(){return[{type:P.SELECTOR,label:ss.lang.sort,id:"games__sort-selector",selectValues:[{type:P.RADIO,name:"games__sort-type",id:`games__sort-type-${Pe}`,label:ss.lang.releaseDate,checked:this.SORT_NAME===Pe,event:`onchange="ui.games.SORT_NAME = '${Pe}'"`},{type:P.RADIO,name:"games__sort-type",id:`games__sort-type-${Ie}`,label:ss.lang.points,checked:this.SORT_NAME===Ie,event:`onchange="ui.games.SORT_NAME = '${Ie}'"`},{type:P.CHECKBOX,name:"games__sort-type-order",id:"games__sort-type-order",label:ss.lang.reverse,checked:this.REVERSE_SORT,event:'onchange="ui.games.REVERSE_SORT = this.checked"'}]},{type:P.CHECKBOX,label:ss.lang.filter,id:"games__filter-list-checkbox",onChange:"ui.games.showFilters(this.checked)",checked:!1},{type:P.SEARCH_INPUT,label:ss.lang.search,id:"games__search-text-input",value:"",onChange:"ui.games.searchInputEvent(event)",title:ss.lang.searchGameInputHint}]}get platformFilterItems(){return Object.keys(rt).reduce(((e,t)=>{const s={label:t,type:P.GROUP},i=Object.keys(rt[t]).reduce(((e,s)=>{const i={label:s,type:P.CHECKBOX,name:"filter-by-platform",checked:this.PLATFORMS_FILTER.includes(rt[t][s]),onChange:`ui.games.platformCheckboxChangeEvent(this,${rt[t][s]})`,id:`filter-by-platform-${rt[t][s]}`};return e.push(i),e}),[]);return e=[...e,s,...i]}),[])}get awardsFilterItems(){return Object.keys(this.awardTypes).reduce(((e,t)=>{const s={type:P.CHECKBOX,label:this.awardTypes[t],name:"filter-by-award",value:"award",checked:this.AWARD_FILTER.includes(t),onChange:`ui.games.awardCheckboxChangeEvent(this,'${t}')`,id:`filter-by-award-${t}`};return e.push(s),e}),[])}get releaseVersionFilterItems(){return Object.keys(lt).reduce(((e,t)=>{const s={type:P.CHECKBOX,label:lt[t],name:"filter-by-release",value:"release",checked:this.RELEASE_FILTER.includes(lt[t]),onChange:`ui.games.releaseCheckboxChangeEvent(this,'${lt[t]}')`,id:`filter-by-release-${t}`};return e.push(s),e}),[])}get genresFilterItems(){return Object.keys(a).reduce(((e,t)=>{const s={type:P.CHECKBOX,label:a[t],name:"filter-by-genre",checked:this.GENRE_FILTER.includes(t),onChange:`ui.games.genreCheckboxChangeEvent(this,'${t}')`,id:`filter-by-genre-${t}`};return e.push(s),e}),[])}get sortItems(){return[{type:P.RADIO,label:ss.lang.released,name:"games__sort-by",checked:this.SORT_NAME===Pe,onChange:`ui.games.SORT_NAME = '${Pe}'`,id:"games__sort-by-date"},{type:P.RADIO,label:ss.lang.points,name:"games__sort-by",checked:this.SORT_NAME===Ie,onChange:`ui.games.SORT_NAME = '${Ie}'`,id:"games__sort-by-points"}]}set FAVOURITES(e){this._favs=e,ts.ui.favouritesGames=e,ts.writeConfiguration()}get FAVOURITES(){return this._favs??[]}set COOP_FILTER(e){this.coopOnly=e,this.updateGamesList()}get COOP_FILTER(){return this.coopOnly??!1}awardCheckboxChangeEvent(e,t){let s=this.AWARD_FILTER;e.checked?s.push(t):s=s.filter((e=>e!=t)),this.AWARD_FILTER=s}releaseCheckboxChangeEvent(e,t){let s=this.RELEASE_FILTER;e.checked?s.push(t):s=s.filter((e=>e!=t)),this.RELEASE_FILTER=s}platformCheckboxChangeEvent(e,t){let s=this.PLATFORMS_FILTER;e.checked?s.push(t+""):s=s.filter((e=>e!=t)),this.PLATFORMS_FILTER=s}genreCheckboxChangeEvent(e,t){let s=this.GENRE_FILTER;e.checked?s.push(t):s=s.filter((e=>e!=t)),this.GENRE_FILTER=s}set YEARS_FILTER(e){this.yearsFilter=e,this.updateGamesList()}get YEARS_FILTER(){return this.yearsFilter??{from:-1/0,to:1/0}}set CHEEVOS_COUNT_FILTER(e){this.cheevosCountFilter=e,this.updateGamesList()}get CHEEVOS_COUNT_FILTER(){return this.cheevosCountFilter??{from:-1/0,to:1/0}}set POINTS_PER_CHEEVO_FILTER(e){this.ppcFilter=e,this.updateGamesList()}get POINTS_PER_CHEEVO_FILTER(){return this.ppcFilter??{from:-1/0,to:1/0}}set HLTB_FILTER(e){this.hltbFilter=e,this.updateGamesList()}get HLTB_FILTER(){return this.hltbFilter??{from:0,to:1/0}}set PLATFORMS_FILTER(e){let t=e.filter((e=>Object.keys(m).includes(e)));this.platformsFilter=t,this.updateGamesList()}get PLATFORMS_FILTER(){return this.platformsFilter??[]}set GENRE_FILTER(e){let t=e.filter((e=>Object.keys(a).includes(e)));this.genreFilter=t,this.updateGamesList()}get GENRE_FILTER(){return this.genreFilter??[]}set AWARD_FILTER(e){this.awardFilter=e,this.updateGamesList()}get AWARD_FILTER(){return this.awardFilter??[]}set RELEASE_FILTER(e){this.releaseFilter=e,this.updateGamesList()}get RELEASE_FILTER(){return this.releaseFilter??[lt.RETAIL]}set FAVOURITES_FILTER(e){this.favouritesFilter=e,this.updateGamesList()}get FAVOURITES_FILTER(){return this.favouritesFilter}get TYPES_FILTER(){return ts.ui?.games_section?.typesFilter??["original"]}set TYPES_FILTER(e){const t=e.dataset.type??"",s=this.TYPES_FILTER;if(e.checked)s.push(t);else{const e=s.indexOf(t);-1!==e&&s.splice(e,1)}ts.ui.games_section.typesFilter=s,ts.writeConfiguration(),this.applyFilter()}set REVERSE_SORT(e){ts._cfg.ui.games_section.reverse_sort=e?-1:1,ts.writeConfiguration(),this.updateGamesList()}get REVERSE_SORT(){return ts._cfg.ui?.games_section?.reverse_sort??-1}get SORT_METHOD(){return we[this.SORT_NAME]}get SORT_NAME(){return ts._cfg.ui?.games_section?.sort_name??Pe}set SORT_NAME(e){e===this.SORT_NAME&&(ts._cfg.ui.games_section.reverse_sort=-1*this.REVERSE_SORT),ts._cfg.ui.games_section.sort_name=e,ts.writeConfiguration(),this.updateGamesList()}titleFilter="";applyFilter(){const e=this.titleFilter.split(/\s/).map((e=>`(?=.*${e})`)).join(""),t=new RegExp(e,"gi");this.games=this.titleFilter?this.GAMES.filter((e=>`${e.Title} ${e.badges?.join(" ")} ${m[e.ConsoleID]?.Name??"-"}`.match(t))):this.GAMES,this.COOP_FILTER&&(this.games=this.games?.filter((e=>"true"==e.Coop))),this.PLATFORMS_FILTER.length>0&&(this.games=this.games?.filter((e=>{let t=!1;for(let s of this.PLATFORMS_FILTER)s==e.ConsoleID&&(t=!0);return t}))),this.GENRE_FILTER.length>0&&(this.games=this.games?.filter((e=>{let t=!1;for(let s of this.GENRE_FILTER)e?.Genres?.includes(+s)&&(t=!0);return t}))),this.FAVOURITES_FILTER&&(this.games=this.games.filter((e=>this.FAVOURITES.includes(e.ID)))),this.AWARD_FILTER.length>0&&(this.games=this.games.filter((e=>{let t=!1;for(let s of this.AWARD_FILTER)s==e.Award&&(t=!0);return t}))),this.RELEASE_FILTER.length>0&&(this.games=this.games.filter((e=>{for(let t of this.RELEASE_FILTER)return t===lt.RETAIL?0===e.badges?.length:e.badges?.includes(t)}))),this.games=this.games.filter((e=>{const t=e.Points/e.NumAchievements;return t<=this.POINTS_PER_CHEEVO_FILTER.to&&t>=this.POINTS_PER_CHEEVO_FILTER.from})),this.games=this.games.filter((e=>{const t=Object.values(e.HLTB||{}),s=Math.min(...t.length?t:[0]);return s<=this.HLTB_FILTER.to&&s>=this.HLTB_FILTER.from})),this.games=this.games.filter((e=>{const t=parseInt(e.NumAchievements)??0;return t<=this.CHEEVOS_COUNT_FILTER.to&&t>=this.CHEEVOS_COUNT_FILTER.from})),this.games=this.games.filter((e=>{const t=+(e.Date?.split("-")?.[0]??0);return t<=this.YEARS_FILTER.to&&t>=this.YEARS_FILTER.from}))}applySort(){this.games=this.games.sort(((e,t)=>this.REVERSE_SORT*this.SORT_METHOD(e,t)))}platformCodes={};awardTypes={mastered:"mastered","beaten-hardcore":"beaten",completed:"completed","beaten-softcore":"beaten softcore",started:"started"};games={};gamesInfo={};constructor(){super(),this.generateWidget(),this.addWidgetIcon(),this._favs=ts.ui.favouritesGames??[],this.initializeElements(),this.container.appendChild(this.sideMenuElement()),this.setValues(),this.addEvents(),this.gamesList.innerHTML='\n      <button class="games__load-button" onclick="ui.games.loadGames()"></button>\n      ',Vt.applyPosition({widget:this}),this.section.querySelector(".games__main-controls").innerHTML=this.headerControls.map((e=>C(e))).join("\n")}generateWidget(){const e=document.createElement("div");e.classList.add("games__main-controls");const t={classes:["games_setion","section"],id:"games_section",title:"RA Games Library",headerElementsHtml:`\n            ${he("ui.games.loadGames()")}\n            ${ue("ui.games.toggleFullscreen()")}\n        `,contentClasses:["games_container","content-container"]},s=this.generateWidgetElement(t),i=s.querySelector(".games_container");i.innerHTML='\n            <ul class="platform-list" id="games-list" data--console-id="all" data-current-games-array-position="0"></ul>\n        ',s.insertBefore(e,i),ss.app.appendChild(s)}initializeElements(){this.section=document.querySelector("#games_section"),this.header=this.section.querySelector(".header-container"),this.container=this.section.querySelector(".games_container"),this.searchbar=this.section.querySelector("#games__searchbar"),this.platformFiltersList=this.section.querySelector("#games_filter-platform-list"),this.gamesList=this.section.querySelector("#games-list")}setValues(){this.header.classList.add("fixed")}searchInputEvent(e){const t=e.target.value;this.titleFilter=t,e.target.classList.toggle("empty",""==t),this.updateGamesList()}addEvents(){super.addEvents(),this.section.addEventListener("contextmenu",(e=>{const t=e.target.closest(".games__game-item");if(t){e.preventDefault(),e.stopPropagation();const s=t.dataset.id;ss.showContextmenu({event:e,menuItems:this.contextMenuItems(s)})}})),this.section.querySelectorAll(".side-menu__subitem").forEach((e=>{const t=e.querySelector(".side-menu__item-header"),s=e.querySelector(".side-menu__header"),i=e.querySelector(".side-menu__subitem-content"),n=e.querySelector(".side-menu__submenu");t&&i&&t.addEventListener("click",(e=>{e.stopPropagation(),i.classList.add("active")})),s&&n&&s.addEventListener("click",(e=>{e.stopPropagation(),n.classList.remove("active")}))})),this.section.querySelectorAll(".statebox").forEach((e=>e.addEventListener("click",Xe)))}async loadWantToPlay(){const e=await is.getWantToPlayGames({});this._favs=Array.from(new Set([...e]))}updateGamesList(){this.applyFilter(),this.applySort(),this.gamesList.innerHTML="",function({list:e,items:t,callback:s}){const i=document.createElement("div");i.classList.add("lazy-load_trigger"),e.appendChild(i);let n=0;const a=20,o=i=>{for(let a=0;a<i&&n<t.length;a++)e.appendChild(s(t[n++]))};o(a);const r=(s,r)=>{s.forEach((s=>{s.isIntersecting&&(o(a),r.unobserve(i),e.appendChild(i),n<t.length&&r.observe(i))}))};new IntersectionObserver(r,{root:null,rootMargin:"0px",threshold:1}).observe(i)}({list:this.gamesList,items:this.games,callback:this.gameElement})}loadGames(){this.loadWantToPlay().then(this.getAllGames().then((()=>{this.updateGamesList()}))),this.loadGameInfo()}async loadGameInfo(){const e=await fetch("./json/games/all_info.json");this.gamesInfo=await e.json()}async getAllGames(){this.GAMES={};try{const e=await ht(),t=await is.completionProgress();for(let s of t.Results){let t=e.find((e=>s.ID===e.ID));t?(s.NumAwardedHardcore&&(t.NumAwardedHardcore=s.NumAwardedHardcore),s.HighestAwardKind?t.Award=s.HighestAwardKind:t.Award="started",s.MostRecentAwardedDate&&(t.MostRecentAwardedDate=s.MostRecentAwardedDate)):(t=s,t.ImageIcon=t.ImageIcon.match(/\d+/gi)[0],s.NumAwardedHardcore&&(t.NumAwardedHardcore=s.NumAwardedHardcore),s.HighestAwardKind?t.Award=s.HighestAwardKind:t.Award="started",t.Points="",e.push(t))}this.GAMES=e}catch(e){return[]}}gameElement(e){const t=document.createElement("li");var s;return t.classList.add("platform_game-item","games__game-item"),t.dataset.id=e.ID,t.innerHTML=`\n            <img class="game-preview_image" src="${O(e.ImageIcon)}" alt="game preview">\n            <h3 class="game-description_title">\n            <button data-title="${ss.lang.showGameInfoHint}" class="game-description_button"\n                    onclick="ui.games.showGameInfoPopup(${e.ID})">\n                    ${e.Title} \n                    ${e.Award?y.infoBadge(e.Award):""}\n                    ${e.badges?.length?_(e.badges,"infoBadge"):""} \n                    ${s=e.Coop,"true"===s?y.infoBadge("coop"):""} \n                    ${e.Genres?_(dt(e.Genres),"infoBadge"):""}\n            </button>\n            </h3>\n            <div class="game-description__info icons-row-list"> \n                ${p.platform(e.ConsoleID)}\n                ${p.date(e.Date||"n/a")}\n                ${p.rating(e.Rating||"n/a")}\n                ${p.cheevos((e.NumAwardedHardcore?e.NumAwardedHardcore+"/":"")+e.NumAchievements)}\n                ${p.points(e.Points)}\n                ${p.time(e.timeToBeat)}\n            </div>\n        `,t}addToFavourite(e,t){const s=this.FAVOURITES.includes(t);this.FAVOURITES=s?this.FAVOURITES.filter((e=>e!=t)):[t,...this.FAVOURITES]}showFilters(e=!0){this.section.querySelector(".section__side-menu")?.classList.toggle("active",e)}toggleFilterList(e,t){const s=()=>{this.section.querySelector(".games__filters-list")?.remove(),this.section.querySelectorAll(".games__filter-header .extended").forEach((e=>e.classList.remove("extended")))},i=e.target.closest("button");if(i.classList.contains("extended"))s();else{let e;switch(s(),i.classList.add("extended"),t){case"platform":e=this.generateCheckboxList(this.platformFilterItems);break;case"award":e=this.generateCheckboxList(this.awardsFilterItems);break;case"genre":e=this.generateCheckboxList(this.genresFilterItems)}this.section.append(e),this.section.querySelector(".games__filter-container").appendChild(e)}}toggleSortList(e){const t=()=>{this.section.querySelector(".games__filters-list")?.remove(),this.section.querySelectorAll(".games__filter-header .extended").forEach((e=>e.classList.remove("extended")))};if(e.target.classList.contains("extended"))t();else{e.target.classList.toggle("extended");const t=this.generateCheckboxList(this.sortItems);this.section.append(t),this.section.querySelector(".games__filter-container").appendChild(t)}}generateCheckboxList(e){const t=Object.values(e).reduce(((e,t)=>{if("group"==t.type){const s=document.createElement("li");s.classList.add("filter-list__platform-header"),s.innerText=t.label+": ",e.appendChild(s)}else{const s=document.createElement("li");s.classList.add("checkbox-input_container"),s.innerHTML=C(t),e.appendChild(s)}return e}),document.createElement("ul"));return t.classList.add("games__filters-list"),t}async showGameInfoPopup(e=1){const t=({label:e,value:t})=>`\n            <div class="game-description__property">\n                ${e}: <span>${t}</span>\n            </div>\n        `,s=e=>`<img src="${O(e)}" alt="game preview" class="game__image">`;document.querySelectorAll(".game-popup__section").forEach((e=>e.remove()));const i=document.createElement("div"),n=await is.getGameInfoAndProgress({gameID:e});i.innerHTML=`\n            <section class="section game-popup__section">\n                <div class="game-popup__header-container header-container">\n                    <h2 class="widget-header-text"><a href="${M(n.ID)}" target="_blank">${n.Title} ${_(n.badges)}</a></h2>\n                    ${re("this.closest('section').remove();")}\n                </div>\n                <div class="game-info__container">\n                    <div class="game-info__images-container scrollable">\n                        ${s(n.ImageBoxArt)}\n                        ${s(n.ImageIngame)}\n                        ${s(n.ImageTitle)}\n                    </div>\n                    <div class="game-info__descriptions-container">\n                        ${t({label:ss.lang.platform,value:n?.ConsoleName})}\n                        ${t({label:ss.lang.developer,value:n?.Developer})}\n                        ${t({label:ss.lang.genre,value:n?.Genre})}\n                        ${t({label:ss.lang.publisher,value:n?.Publisher})}\n                        ${t({label:ss.lang.released,value:n?.Released})}\n                        ${t({label:ss.lang.cheevosCount,value:`${n?.NumAwardedToUserHardcore} / ${n?.NumAwardedToUser} / ${n?.NumAchievements}`})}\n                        ${t({label:ss.lang.retropoints,value:`${n?.unlockData.hardcore.retropoints} / ${n?.totalRetropoints}`})}\n                        ${t({label:ss.lang.points,value:`${n?.unlockData.hardcore.points} / ${n?.unlockData.softcore.points} / ${n?.totalPoints}`})}\n                        ${t({label:ss.lang.retroRatio,value:n?.retroRatio})}\n                        ${t({label:ss.lang.players,value:`${n?.masteredCount} / ${n?.beatenCount} / ${n?.players_total}`})}\n                        ${t({label:ss.lang.completion,value:`${n?.masteryRate}% / ${n?.beatenRate}%`})}\n                    </div>\n                    <div class="game-info__cheevos-container"></div>\n                </div>\n            </section>\n        `,ss.app.appendChild(i)}toggleFullscreen(){this.section.classList.toggle("fullscreen")}sideMenuElement(e,t){e?t=`<-- ${t}`:(t=`${ss.lang.filters}`,e=[{title:`${ss.lang.platform}`,type:"submenu",submenu:[{elements:this.platformFilterItems}]},{title:`${ss.lang.genre}`,type:"submenu",submenu:[{elements:this.genresFilterItems}]},{title:`${ss.lang.releaseYear}:`,elements:[{type:P.NUM_INPUT,id:"side-list-released-from",label:`${ss.lang.from}`,onChange:"ui.games.YEARS_FILTER =  {...ui.games.YEARS_FILTER, from: Number(this.value) || 0}"},{type:P.NUM_INPUT,id:"side-list-released-to",label:`${ss.lang.to}`,onChange:"ui.games.YEARS_FILTER =  {...ui.games.YEARS_FILTER, to: Number(this.value) || Infinity}"}]},{title:`${ss.lang.cheevosCount}:`,elements:[{type:P.NUM_INPUT,id:"side-list-cheevos-from",label:`${ss.lang.from}`,onChange:"ui.games.CHEEVOS_COUNT_FILTER =  {...ui.games.CHEEVOS_COUNT_FILTER, from: Number(this.value) || 0}"},{type:P.NUM_INPUT,id:"side-list-cheevos-to",label:`${ss.lang.to}`,onChange:"ui.games.CHEEVOS_COUNT_FILTER =  {...ui.games.CHEEVOS_COUNT_FILTER, to: Number(this.value) || Infinity}"}]},{title:`${ss.lang.pointsPerCheevo}:`,elements:[{type:P.NUM_INPUT,id:"side-list-ppc-from",label:`${ss.lang.from}`,onChange:"ui.games.POINTS_PER_CHEEVO_FILTER = {...ui.games.POINTS_PER_CHEEVO_FILTER, from: Number(this.value) || 0}"},{type:P.NUM_INPUT,id:"side-list-ppc-to",label:`${ss.lang.to}`,onChange:"ui.games.POINTS_PER_CHEEVO_FILTER = {...ui.games.POINTS_PER_CHEEVO_FILTER, to: Number(this.value) || Infinity}"}]},{title:`${ss.lang.hltb}:`,elements:[{type:P.NUM_INPUT,id:"side-list-hltb-from",label:`${ss.lang.from}`,onChange:"ui.games.HLTB_FILTER =  {...ui.games.HLTB_FILTER, from: Number(this.value) || 0}"},{type:P.NUM_INPUT,id:"side-list-released-to",label:`${ss.lang.to}`,onChange:"ui.games.HLTB_FILTER =  {...ui.games.HLTB_FILTER, to: Number(this.value) || Infinity}"}]},{title:`${ss.lang.highestAward}:`,elements:this.awardsFilterItems},{title:`${ss.lang.releaseVersion}:`,elements:this.releaseVersionFilterItems},{title:`${ss.lang.other}:`,elements:[{type:P.CHECKBOX,label:"WTPlay",checked:this.FAVOURITES_FILTER,onChange:"ui.games.FAVOURITES_FILTER = this.checked",id:"filter-by-wtp"},{type:P.CHECKBOX,label:"Coop",checked:this.COOP_FILTER,onChange:"ui.games.COOP_FILTER = this.checked",id:"filter-by-coop"}]}]);const s=({title:e,elements:t,type:s,submenu:i})=>{const n=e=>`<h3 class="side-menu__item-header">\n                        ${e}\n                    </h3>`,a=(e,t)=>`\n                <div class="side-menu__item-container side-menu__subitem" >\n                    ${t?n(t):"<br>"}\n                    <div class="side-menu__subitem-content side-menu__submenu">\n                        ${this.sideMenuElement(e,t).outerHTML}\n                    </div>\n                </div>\n            `;return"submenu"===s?a(i,e):`\n                <div class="side-menu__item-container">\n                    ${e?n(e):"<br>"}\n                    <div class="side-menu__item-inputs">\n                        ${t.map((e=>"object"==typeof e?C(e):e)).join("\n")}\n                    </div>\n                </div>\n            `},i=document.createElement("div");return i.classList.add("section__side-menu"),i.innerHTML=`\n            <h2 class="side-menu__header">${t}</h2>\n            <div class="side-menu__content scrollable">\n                ${e.map((e=>s(e))).join("")}\n            </div>\n        `,i}}const mt="rp__progression",gt=e=>`\n        <div class="${mt}-container">\n            <h3 class="${mt}-target"></h3>\n            <div class="${mt}-points"></div>\n        </div>\n    `,pt=Object.freeze({cheevos:"cheevos",points:"points",retropoints:"retropoints"}),vt=Object.freeze({default:"default",thick:"thick"}),Et=(e,t)=>e.replace(/\{\{(\w+)\}\}/g,((e,s)=>{const i=t[s];return"function"==typeof i?i():i??""})),ft="rp__progressbar",_t=(e=vt.default)=>`\n        <div class="${ft}-container">\n            <div class="${ft}-header">\n                <div class="${ft}-title"></div>\n                <ul class="rp__last-cheevos"></ul>\n            </div>\n            <div class="${ft}">\n                <div class="${ft}-bg"></div>\n                <div class="${ft}-value"></div>\n                <div class="${ft}-sessions"></div>\n            </div>\n        </div>\n    `,yt=(e,t,s,i=pt.cheevos)=>{if(!e)return;const n=e.querySelector(`.${ft}-title`),a=e.querySelector(".rp__last-cheevos"),o=e.querySelector(`.${ft}`),r=e.querySelector(`.${ft}-sessions`),{unlocked:l,total:c,unlockedRate:d}=((e,t,s)=>{let i,n,a;switch(s){case pt.points:i=((e,t)=>t?e?.unlockData?.hardcore?.points??0:e?.unlockData?.soft?.points??0)(e,t),n=e?.totalPoints||1,a=Math.round(100*i/n)+"%";break;case pt.retropoints:i=(e=>e?.unlockData?.hardcore?.retropoints??0)(e),n=e?.totalRetropoints||1,a=Math.round(100*i/n)+"%";break;default:i=((e,t)=>t?e?.unlockData?.hardcore?.count??0:e?.unlockData?.softcore?.count??0)(e,t),n=e?.NumAchievements||1,a=Math.round(100*i/n)+"%"}return{unlocked:i,total:n,unlockedRate:a}})(t,s,i),h=Object.values(t?.Achievements??{}).filter((e=>Ee.earned(e))).sort(((e,t)=>we.latest(e,t,1,!0))).slice(0,6).reverse();n.innerHTML=((e,t,s,i,n,a)=>{const{gameMasteredMsg:o,gameCompletedMsg:r,unlockProgressMsg:l}=ss.lang,c=ss.lang?.[`${n}Progress`]??n;return e.award===x.MASTERED?o:a||e.award!==x.COMPLETED?`${y.gold(`${t}/${s}`)} ${Et(l,{rate:i,progressTypeName:c})}`:r})(t,l,c,d,i,s),a.innerHTML=h.map((e=>(e=>`\n    <li class="last-cheevo" data-achiv-id="${e?.ID??0}">\n        <img class="last-cheevo__img" src="${N(e)}" alt="">\n    </li>`)(e))).join(""),o.style.setProperty("--unlockRate",100*l/c+"%"),r.innerHTML=((e,t,s)=>{let i,n=0,a="";return e.sessions.map((o=>{const{cheevosCount:r,cheevosCountHardcore:l,startDate:c}=o;switch(s){case pt.cheevos:n=t?l:r,i=e.NumAchievements,a=Et(ss.lang.progressUnlockCheevosHint,{count:n,type:`${1===n?ss.lang.cheevo:ss.lang.cheevos}`,date:c});break;case pt.points:n=o.cheevos.reduce(((s,i)=>{const n=e.Achievements[i];return(t&&n.DateEarnedHardcore||!t&&n.DateEarned)&&(s+=n.Points),s}),0),i=e.totalPoints,a=Et(ss.lang.progressEarnedPointsHint,{count:n,type:`${1===n?ss.lang.point:ss.lang.points}`,date:c});break;case pt.retropoints:n=o.cheevos.reduce(((s,i)=>{const n=e.Achievements[i];return t&&n.DateEarnedHardcore&&(s+=n.TrueRatio),s}),0),i=e.totalRetropoints,a=Et(ss.lang.progressEarnedPointsHint,{count:n,type:`${1===n?ss.lang.retropoint:ss.lang.retropoints}`,date:c})}return 0===n?"":`\n            <div \n                class="${ft}-session"\n                data-title="${a}" \n                style="--percentage:${100*n/i}%"\n            ></div>\n        `.trim()})).join("")})(t,s,i),r.classList.toggle("completed",l===c)},At=Object.freeze({DEFAULT:"default",THICK:"thick"}),Tt=({imageUrl:e,title:t,description:s,badgesHtml:i})=>`\n        <div class="rp__alert-preview-container">\n            <img class="rp__alert-preview" src="${e}" alt="">\n        </div>\n        <div class="rp__alert-info-grid">\n            <h3 class="rp__alert-title">\n                ${t??""}\n            </h3>\n            <div class="rp__alert-description">${s??""}</div>\n            <div class="rp__alert-badges">${i??""}</div>\n        </div>\n    `,wt=(e,t)=>{switch(e.type){case k.GAME:break;case k.CHEEVO:t.innerHTML=((e,t=!1)=>{const s=document.createElement("li");s.classList.add("cheevo-column-item"),s.classList.toggle("earned",e.isEarned),s.classList.toggle("hardcore",e.isHardcoreEarned),s.dataset.achivId=e.ID;const i=e.level?.toString()?.split(".")[1],n=e.zone?i?`${e.zone} [${i}]`:e.zone:e.level?.toString()?.replace(".","-"),a=(e.NumAwardedHardcore,e.totalPlayers,`\n        <div class="target__buttons-container">\n                <button class="header-button header-icon  target__comments-button edit-cheevo-button edit-icon" data-title="edit props" data-cheevo-id="${e.ID}"></button>\n                <button class="header-button header-icon  target__comments-button comments-button chat-icon" data-title="${ui.lang.showCommentsHint}"></button>\n                <button class="header-button header-icon  delete-icon delete-from-target" data-title="remove"></button>\n        </div>\n    `);return s.innerHTML=`\n            ${t?a:""}\n            <div class="prev">\n                <img\n                class="prev-img"\n                src="${e.prevSrc}"\n                alt="${e.Title}"\n                />\n            </div>\n            <div class="target__cheevo-details">\n                <h3 class="target__cheevo-header">\n                    ${n?y.cheevoLevel(n,!0):""}\n                    \x3c!--${e.genres.length>0?e.genres?.map((e=>T(e))).join(""):""}--\x3e\n                    <a target="_blanc" data-title="go to RA cheevo-page" href="https://retroachievements.org/achievement/${e.ID}">\n                        ${e.Title}\n                    </a>\n                </h3>\n                <p class="list-item__text">${e.Description}</p>\n                <div class="icons-row-list">\n                    ${E.cheevoType(e.Type)}\n                    ${p.points(e.Points)}\n                    ${p.retropoints(e.TrueRatio)}\n                    ${p.rarity(e.rateEarnedHardcore)}\n                    ${p.retroRatio(e.retroRatio)}\n                    ${y.difficultBadge(e.difficulty)}\n                </div>\n            </div>\n            `,s})(e.value).innerHTML,t.className="rp__alert-container cheevo-alert show-alert";break;case k.AWARD:t.innerHTML=((e,t)=>{const{Title:s,badges:i,ImageIcon:n,totalPoints:a,unlockData:o,totalRetropoints:r,masteryRate:l,beatenRate:c,completedRate:d,beatenRateSoftcore:h,ID:u,NumAchievements:m,TimePlayed:g}=e,p="mastered"==t?l:"beaten"==t?c:"completed"==t?d:h,v=(e=>{const t=~~(e/3600),s=~~((e-3600*t)/60);return`\n          ${t>0?1==t?"1 hour ":t+" hours ":""}\n          ${t>0&&s>0?"and ":""}\n          ${s>0?1==s?"1 minute":s+" minutes":""}\n            `})(g);let f=`\n                ${T(`${t} IN ${v}`)}\n                ${T(`TOP${p}%`)}\n                ${T(`${E.cheevos}${o.hardcore.count}/${m}`)}\n                ${T(`${E.points}${o.hardcore.points}/${a}`)}\n                ${T(`${E.retropoints}${o.hardcore.retropoints}/${r}`)}\n            `;const y=`${s} ${_(i)} ${T("GAINED AWARD")}`;return Tt({imageUrl:O(n),title:y,badgesHtml:f})})(e.value,e.award),t.className="rp__alert-container award-alert show-alert";break;case k.STATS:t.innerHTML=(e=>{let t=`\n                ${e.rank?T(`Rank: ${e.rank} ${e.deltaRank}`):""}\n                ${e.percentile?T(`TOP ${e.percentile.toFixed(2)}% ${e.deltaPercentile}`):""}\n                ${T(`${E.cheevos} +${e.cheevosCount}`)}\n                ${T(`${E.points}${e.points} ${e.deltaPoints}`)}\n                ${T(`${E.retropoints}${e.retroPoints} ${e.deltaRetroPoints}`)}\n                ${T(`${E.points}${e.softPoints}SP ${e.deltaSoftPoints}`)}\n            `;return Tt({imageUrl:ts.userImageSrc,title:`${ts.USER_NAME.toUpperCase()} statistics:`,badgesHtml:t})})(e.value),t.className="rp__alert-container stats-alert show-alert"}},bt=(e,t)=>me(["rp__game-container"],`\n        <div class="rp__preview-container">\n            <img class="rp__game-image" src="" alt="" srcset="">\n            <button class="status__watch-button" id="rp__watch-button"></button>\n        </div>\n        <div class="rp__game-info">\n            <a class="rp__game-title" target="_blank"></a>\n            <div class="rp__game-info-grid">\n                \n                    \n                  <div class="rp__game-info-content">\n                  ${_t()}\n                    \x3c!--\n        <p class="rp__game-platform"></p>\n        <div class="icons-row-list rp__game-icons"></div>\n    --\x3e\n                    </div>\n                <div class="rp__game-time"></div>\n            </div>\n        </div>\n    `),St=Object.freeze({normal:"normal",background:"background"}),It={icons:"icons",progression:"progression",progressbar:"progressbar"};class Ct extends pe{ACHIV_DURATION=15e3;IS_HARD_MODE=!0;widgetIcon={description:"status widget",iconID:"side-panel__status1",onChangeEvent:"ui.status.VISIBLE = this.checked",iconClass:"status-icon"};get contextMenuItems(){return[{label:ss.lang.subsets,elements:Object.keys(ns.GAME_DATA?.subsets).map((e=>({type:P.RADIO,name:"subset-select",id:`subset-select-${e}`,label:e,checked:ns.GAME_DATA?.ID===ns.GAME_DATA?.subsets[e],event:`onclick="watcher.setSubset('${e}')"`})))},{label:ss.lang.elements,elements:[{type:P.CHECKBOX,id:"show-rp",label:ss.lang.richPresence,checked:this.uiProps.showRichPresence,event:'onchange="ui.status.uiProps.showRichPresence = this.checked"'},{type:P.CHECKBOX,id:"show-ticker",label:ss.lang.ticker,checked:this.uiProps.showTicker,event:'onchange="ui.status.uiProps.showTicker = this.checked"'},{type:P.CHECKBOX,id:"show-progression",label:ss.lang.progression,checked:this.uiProps.showProgression,event:'onchange="ui.status.uiProps.showProgression = this.checked"'},{type:P.CHECKBOX,id:"context-show-progressbar",label:ss.lang.progressbar,checked:this.uiProps.showProgressbar,event:'onchange="ui.status.uiProps.showProgressbar = this.checked"'}]},{label:ss.lang.infoPanel,elements:Object.values(It).map((e=>({type:P.RADIO,name:"info-type",id:`info-type-${e}`,label:ss.lang?.[e]??e,checked:this.uiProps.gameInfoType==e,event:`onclick="ui.status.uiProps.gameInfoType = '${e}';"`})))},{label:ss.lang.style,elements:Object.values(At).map((e=>({type:P.RADIO,name:"status-theme",id:`status-theme-${e}`,label:ss.lang?.[e]??e,checked:this.uiProps.statusTheme==e,event:`onclick="ui.status.uiProps.statusTheme = '${e}';"`})))},{label:ss.lang.progressbar,elements:Object.values(pt).map((e=>({type:P.RADIO,name:"progressbar-type",id:`progressbar-type-${e}`,label:ss.lang?.[e]??e,checked:this.uiProps.progressType==e,event:`onclick="ui.status.uiProps.progressType = '${e}';"`})))},{label:ss.lang.time,elements:[{type:P.RADIO,name:"context_game-time",id:"show-playTime",label:ss.lang.gameTime,checked:"playTime"==this.uiProps.time,event:"onclick=\"ui.status.uiProps.time = 'playTime';\""},{type:P.RADIO,name:"context_game-time",id:"show-sessionTime",label:ss.lang.sessionGameTime,checked:"sessionTime"==this.uiProps.time,event:"onclick=\"ui.status.uiProps.time = 'sessionTime';\""},{type:P.RADIO,name:"context_game-time",id:"show-totalTime",label:ss.lang.totalTime,checked:"totalSessionTime"==this.uiProps.time,event:"onclick=\"ui.status.uiProps.time = 'totalSessionTime';\""},{type:P.RADIO,name:"context_game-time",id:"show-timer",label:ss.lang.timer,checked:"timer"==this.uiProps.time,event:"onclick=\"ui.status.uiProps.time = 'timer';\""},{prefix:ss.lang.timer,postfix:ss.lang.min,type:P.NUM_INPUT,id:"stats-timer-duration",label:ss.lang.timer,value:~~(this.uiProps.timerTime/60*100)/100,event:'onchange="ui.status.uiProps.timerTime = this.value;"',onChange:"ui.status.uiProps.timerTime = this.value;"},...Object.keys(St).map((e=>({type:P.RADIO,name:"time-pos",id:`time-pos-${e}`,label:ss.lang?.[e]??e,checked:this.uiProps.timePosition==e,event:`onclick="ui.status.uiProps.timePosition = '${e}';"`})))]}]}uiDefaultValues={time:"playTime",timerTime:30,showRichPresence:!0,showTicker:!0,showProgressbar:!0,showProgression:!0,progressType:pt.cheevos,statusTheme:At.DEFAULT,timePosition:St.normal,gameInfoType:It.icons};uiSetCallbacks={time(){this.gameElements.time.innerText=ns.getActiveTime(this.uiProps.time,this.uiProps.timerTime)},showTicker(e){e?this.ticker.startScrolling():this.ticker.stopScrolling(),this.setElementsValues()},progressType(){this.updateProgressBar()},gameInfoType(){this.updateGameInfo()}};uiValuePreprocessors={timerTime:e=>(e<=0&&(e=1),e>1440&&(e=1440),60*e)};constructor(){super(),this.generateWidget(),this.addWidgetIcon(),this.initializeElements(),Vt.applyPosition({widget:this}),this.setElementsValues(),this.addEvents()}initializeElements(){this.section=document.querySelector(".rp__section"),this.sectionID=this.section.id,this.watchButton=this.section.querySelector("#rp__watch-button"),this.indicatorElement=this.section.querySelector(".rp__indicator"),this.gameElements={icon:this.section.querySelector(".rp__game-image"),title:this.section.querySelector(".rp__game-title"),platform:this.section.querySelector(".rp__game-platform"),gameIcons:this.section.querySelector(".rp__game-icons"),time:this.section.querySelector(".rp__game-time")},this.alertElements={container:this.section.querySelector(".rp__alert-container"),preview:this.section.querySelector(".rp__alert-preview"),title:this.section.querySelector(".rp__alert-title"),description:this.section.querySelector(".rp__alert-description"),badges:this.section.querySelector(".rp__alert-badges")},this.richPresenceElement=this.section.querySelector(".rp__rich-presence"),this.progressionContainer=this.section.querySelector(".rp__progression-container"),this.progressbarElements={container:this.section.querySelector(".rp__progressbar-container"),title:this.section.querySelector(".rp__progressbar-title"),lastCheevos:this.section.querySelector(".rp__last-cheevos")},this.tickerElement=this.section.querySelector(".rp__ticker"),this.ticker=We({container:this.tickerElement,textGenerator:je})}generateWidget(){const e={classes:["rp__section","section"],id:"rp__section",headerElementsHtml:"\n        "},t=this.generateWidgetElement(e);ss.app.appendChild(t)}generateWidgetElement({classes:e,id:t,headerElementsHtml:s}){const i=document.createElement("section");i.classList.add(...e),i.id=t;ts.ui?.[t]?.statusTheme??At.DEFAULT;return i.innerHTML=`\n            <div class="hidden-header-buttons">\n                ${s??""}\n                ${re()}\n            </div>\n            ${me(["rp__indicator"])}\n            ${me(["rp__alert-container"])}\n            <div class="rp-content__container">\n                ${bt()}\n                ${me(["rp__rich-presence"],"Rich Presence")}\n                ${gt()}\n                ${_t()}\n            </div>\n            ${me(["rp__ticker"])}\n            ${ge()}`,i}addEvents(){this.section.addEventListener("mousemove",(e=>{this.section.classList.remove(...Object.values(J).map((e=>"hover-"+e)),"resize-hover");const t=ee(e,this.section);t&&this.section.classList.add(`hover-${t}`,"resize-hover")})),this.section.addEventListener("mousedown",(e=>{const t=ee(e,this.section);e.target.matches(".resizer")||t?(this.section.classList.add("resized"),Z({event:e,section:this.section,resizeDirection:e.target.matches(".resizer")?J.bottomRight:t})):e.target.matches(".comments-button")?(e.stopPropagation(),Me(ns.GAME_DATA?.ID,1)):e.target.matches(".game-props-button")?(e.stopPropagation(),qe().open(ns.GAME_DATA)):e.target.matches(".close-icon")?(e.stopPropagation(),this.close()):0===e.button&&Q(this.section,e)})),this.section.addEventListener("contextmenu",(e=>{ss.showContextmenu({event:e,menuItems:this.contextMenuItems})})),this.watchButton.addEventListener("click",(e=>{e.stopPropagation(),ns.isActive?ns.stop():ns.start()}))}setElementsValues(){this.section.classList.toggle("show-ticker",this.uiProps.showTicker),this.section.classList.toggle("show-progression",this.uiProps.showProgression),this.section.classList.toggle("show-progressbar",this.uiProps.showProgressbar),this.richPresenceElement.classList.toggle("hidden",!this.uiProps.showRichPresence),this.gameElements.time&&(this.gameElements.time.dataset.position=this.uiProps.timePosition),this.uiProps.showTicker&&ns.GAME_DATA&&this.ticker.startScrolling(),this.section.dataset.theme=this.uiProps.statusTheme??At.DEFAULT}doUpdateAnimation(){(e=>{const t=document.createElement("div");t.classList.add("sweep-effect-element"),e.appendChild(t),setTimeout((()=>t?.remove()),1e3)})(this.section)}gameChangeEvent(e=!1){e&&ns.IS_WATCHING&&this.addAlertsToQuery([{type:k.GAME,value:ns.GAME_DATA}]),this.fillGameData(),this.uiProps.showTicker&&this.ticker.startScrolling(),this.doUpdateAnimation()}updateProgressionBar(){this.section.querySelectorAll(".rp__progression-container")?.forEach((e=>{((e,t,s=!0)=>{const i=e=>e.isHardcoreEarned||e.isEarned&&!s;if(!t)return"n/a";const n=Object.values(t.Achievements).filter((e=>Ee.progression(e))).sort(((e,t)=>we.default(e,t))),a=n.find((e=>!i(e))),o=n.findIndex((e=>!i(e)));e.innerHTML=`\n        <h3 class="${mt}-target">\n            ${((e,s,i)=>{let n;return n=s>=0?`${y.gold(`${s+1}/${i.length}`)} ${e.Description}`:t?.progressionAward?ss.lang.gameBeatenMsg:ss.lang.noProgressionMsg,n})(a,o,n)}\n        </h3>\n        <div class="${mt}-points">\n            ${((e,t)=>t.map((t=>`<div class="${["rp__progression-point",t.Type===ve.WIN&&"win",i(t)&&"earned",e?.ID===t.ID&&"focus"].filter(Boolean).join(" ")}" data-achiv-id="${t.ID}"></div>`)).join(""))(a,n)}\n        </div>\n    `})(e,ns?.GAME_DATA,this.IS_HARD_MODE),Le({container:e,element:e.querySelector(".rp__progression-points .focus"),scrollByX:!0,scrollByY:!1})}))}updateProgressBar(){this.section.querySelectorAll(".rp__progressbar-container")?.forEach((e=>yt(e,ns?.GAME_DATA,this.IS_HARD_MODE,this.uiProps.progressType)))}updateGameInfo(){const e=this.section.querySelector(".rp__game-info-content"),t=()=>{const{ConsoleID:e,NumAchievements:t,totalPoints:s,retroRatio:i}=ns.GAME_DATA;this.section.querySelector(".rp__game-platform")?.setHTMLUnsafe(p.platform(e)),this.section.querySelector(".rp__game-icons")?.setHTMLUnsafe(`\n                    ${p.cheevos(t)}\n                    ${p.points(s)}\n                    ${p.retroRatio(i)}\n                `)};switch(this.uiProps.gameInfoType){case It.progressbar:e.innerHTML=_t(),this.updateProgressBar();break;case It.progression:e.innerHTML=gt(),this.updateProgressionBar();break;case It.icons:e.innerHTML='\n        <p class="rp__game-platform"></p>\n        <div class="icons-row-list rp__game-icons"></div>\n    ',t();break;default:e.innerHTML=gt(),this.updateProgressionBar()}}fillGameData(){this.richPresenceElement.innerText=ss.lang.richPresence,(()=>{const{ImageIcon:e,Title:t,badges:s,ConsoleName:i,ConsoleID:n,ID:a,NumAchievements:o,totalPoints:r,retroRatio:l}=ns.GAME_DATA;this.gameElements.icon.src=O(e),this.gameElements.title.innerHTML=`\n                ${t||""}\n                ${_(s)}\n            `,this.gameElements.title.href=M(a),setTimeout((()=>this.startAutoScrollElement(this.gameElements.title,!0,1e4)),1e4);const c=ns.getActiveTime(this.uiProps.time,this.uiProps.timerTime);this.gameElements.time.innerHTML=c})(),this.updateGameInfo(),this.updateProgressionBar(),this.updateProgressBar(),this.startAutoScrollElement(this.richPresenceElement,!0,1e4)}updateProgress({earnedAchievementIDs:e}){e?.length>0&&(this.IS_HARD_MODE=!!ns.CHEEVOS[e[0]].isHardcoreEarned),this.updateProgressionBar(),this.updateProgressBar(),this.doUpdateAnimation()}alertsQuery=[];addAlertsToQuery(e){this.alertsQuery.length>0?this.alertsQuery=[...this.alertsQuery,...e]:(this.alertsQuery=[...e],this.startAlerts())}async startAlerts(){for(;this.alertsQuery.length>0;){const e=this.alertsQuery[0];if(!e.value)return void this.alertsQuery.shift();const t=()=>{wt(e,this.alertElements.container),setTimeout((()=>{}),2e3)},s=()=>{this.alertElements.container.classList.add("hide-alert"),this.alertsQuery.shift()};await R(1e3),t(),await R(this.ACHIV_DURATION),s()}}timeWatcher(){this.watchButton.classList.toggle("active",ns.isActive),this.section.classList.toggle("watching",ns.IS_ONLINE&&ns.isActive);return{start:()=>{this.timeWatcher().stop(),this.indicatorElement.classList.add("online"),this.gameTimeInterval=setInterval((()=>{"timer"===this.uiProps.time&&ns.playTime.timer<0&&this.section.classList.add("timer-timeout");const e=ns.getActiveTime(this.uiProps.time,this.uiProps.timerTime);e&&e!==this.gameElements.time.innerHTML&&(this.gameElements.time.innerHTML=e)}),1e3)},stop:()=>{this.gameTimeInterval&&clearInterval(this.gameTimeInterval),this.indicatorElement.classList.remove("offline","online","error","blink")}}}BLINK_ON_UPDATE=!0;blinkUpdate(){this.indicatorElement.classList.remove("offline","blink"),this.section.classList.toggle("offline",!ns.IS_ONLINE),this.indicatorElement.classList.toggle("online",ns.IS_ONLINE),this.indicatorElement.classList.toggle("realtime",ns.IS_ONLINE&&ns.isLogOK),this.BLINK_ON_UPDATE&&ns.IS_ONLINE||ns.IS_ONLINE}autoscrollAlertInterval={};startAutoScrollElement(e,t=!0,s=1e3){const i=e.id||e.className;this.autoscrollAlertInterval[i]?this.stopAutoScrollElement(e):this.autoscrollAlertInterval[i]={};const n=e;this.autoscrollAlertInterval[i].interval=setInterval((()=>{n.clientWidth==n.scrollWidth?(this.stopAutoScrollElement(e),this.autoscrollAlertInterval[i].timeout=setTimeout((()=>this.startAutoScrollElement(e,!0,s)),1e4)):t?(n.scrollLeft++,n.scrollLeft+n.clientWidth>=n.scrollWidth&&(this.stopAutoScrollElement(e),this.autoscrollAlertInterval[i].timeout=setTimeout((()=>this.startAutoScrollElement(e,!1,s)),s))):(n.scrollLeft=Math.max(0,n.scrollLeft-1),0==n.scrollLeft&&(this.stopAutoScrollElement(e),this.autoscrollAlertInterval[i].timeout=setTimeout((()=>this.startAutoScrollElement(e,!0,s)),s)))}),50)}stopAutoScrollElement(e,t=!1){t&&(e.scrollLeft=0);const s=e.id||e.className;this.autoscrollAlertInterval[s]&&(clearInterval(this.autoscrollAlertInterval[s].interval),clearTimeout(this.autoscrollAlertInterval[s].timeout))}}class Pt{}class Dt extends pe{widgetIcon={description:"game series",iconID:"side-panel__game-list",onChangeEvent:"ui.gameList.VISIBLE = this.checked",iconClass:"playlist-icon"};set VISIBLE(e){super.VISIBLE=e,ns.GAME_DATA?.ID!==this.gameSetID&&this.generateGamesSet()}get VISIBLE(){return super.VISIBLE}constructor(){super(),this.generateWidget(),this.initializeElements(),this.addWidgetIcon(),this.setElementsVisibility(),this.addEvents(),Vt.applyPosition({widget:this})}initializeElements(){this.section=document.getElementById("game-list"),this.content=this.section.querySelector(".widget-content__container")}gameChangeEvent(){this.VISIBLE&&this.generateGamesSet()}setElementsVisibility(){}addEvents(){super.addEvents(),this.section.querySelector(".update-icon")?.addEventListener("click",(()=>this.generateGamesSet()))}generateWidget(){const e=`\n            <div class="header-button header-icon update-icon" title="${ss.lang.forceReloadHint}"></div>\n        `,t={classes:["game-list__section","section"],id:"game-list",title:ss.lang.gameSeriesSectionName,headerElementsHtml:e},s=this.generateWidgetElement(t);ss.app.appendChild(s)}generateWidgetContent(){this.content.innerHTML=""}async generateGamesSet(){const e=this.gameSetID=ns.GAME_DATA?.ID,t=await $t(e),s=(await is.completionProgress())?.Results,i=this.section.querySelector(".widget-header-text"),n=this.section.querySelector(".widget-content__container");t.value=(await Promise.all(t?.value?.map((async e=>{const t=await Lt(e.ID);return e.Date=t?.Date,e.Award=s.find((t=>e.ID===t.GameID))?.HighestAwardKind??"",e}))))?.sort(((e,t)=>we.date(e,t)));const a=t?.value.reduce(((t,s)=>{var i;return t+=`\n                <li class="game-info__set-item main-column-item right-bg-icon award-type ${s.Award} ${e==s.ID?"focus":""}">\n                    <img class="awards__game-preview" src="${i=s.ImageIcon,`https://media.retroachievements.org/Images/${i}.png`}" alt=" ">\n                    <h3 class="game-title">\n                        <a target="_blank" data-title="${ss.lang.goToRAHint}" href="${M(s.ID)}">\n                    ${s.Title} ${_(s?.badges)}</a></h3>\n                    <p class="awards__game-description">${s.Console}</p>\n                    <p class="awards__game-description">${s.Date??"Date unavailable"}</p>\n                </li>\n            `}),"");i.innerHTML=`${t.name} Series`,n.innerHTML=`<ul class="flex-main-list">${a}<ul>`,n.querySelector(".focus")?.scrollIntoView()}}const $t=async(e=1)=>{if(!ns.gamesSets){const e=await fetch("./json/games/gamesSets.json");ns.gamesSets=await e.json()}const t=Object.keys(ns.gamesSets);for(let s=0;s<t.length;s++){const i=t[s];if(ns.gamesSets[i].find((t=>t.ID===e)))return{name:i,value:ns.gamesSets[i]}}},Lt=async e=>{if(!ss.gamesExtInfo){const e=await fetch("./json/games/all_ext.json");ss.gamesExtInfo=await e.json()}return e?ss.gamesExtInfo.find((t=>t.ID==e)):void 0};class kt extends pe{widgetIcon={description:"links widget",iconID:"side-panel__links",onChangeEvent:"ui.links.VISIBLE = this.checked",iconClass:"link-icon"};links=[{name:"RetroAchievements",url:"https://retroachievements.org"},{name:"RA API docs",url:"https://api-docs.retroachievements.org"},{name:"ROM Patcher",url:"https://www.marcrobledo.com/RomPatcher.js/"},{name:"WoWRoMs",url:"https://wowroms.com/en/"},{name:"Emu-Land",url:"https://www.emu-land.net/en/"},{name:"GitHub [Project]",url:"https://github.com/taras240/retro-api"},{name:"Discord [Project]",url:"https://discord.gg/apzc6kCAbH"}];constructor(){super(),this.generateWidget(),this.initializeElements(),this.addWidgetIcon(),this.addEvents(),this.generateWidgetContent(),Vt.applyPosition({widget:this})}generateWidget(){const e={classes:["links_section","section"],id:"links_section",title:ss.lang.linksSectionName,contentClasses:["links-container","content-container","flex-main-list"]},t=this.generateWidgetElement(e);ss.app.appendChild(t)}initializeElements(){this.section=document.querySelector("#links_section")}addEvents(){super.addEvents()}generateWidgetContent(){const e=this.section.querySelector(".links-container"),t=this.links.map((({name:e,url:t,iconUrl:s})=>`<li class="links__link-item">\n                <a class="signed-icon links__link-container" href="${t}" target="_blank">\n                    ${s?`<img class="links__link-image" src="${s}" alt="${e}">`:" "}\n                    <span class="links__link-title">${e}</span>\n                </a>\n            </li> `)).join("");e.innerHTML=`<ul class="flex-main-list links-list">${t}</ul>`}}const Rt=["Level","Levels","Stage\\b","Stages","Area","World","Mission","Chapter","Section","Zone","Phase","Realm","Domain","Episode","Act","Acts","Tier","Floor","Floors","Dimension","Region","Scene","Screen","Round\\b","Course","Board"],Nt=[...Rt,...Rt.map((e=>e.toLowerCase())),"üö©","\\bin\\b"],Ot=["Zone","Stage","Area","Mission","Chapter","Section","World","Scene"],Mt={one:"1",first:"1",two:"2",second:"2",three:"3",third:"3",four:"4",fourth:"4",five:"5",fifth:"5",six:"6",sixth:"6",seven:"7",seventh:"7",eight:"8",eighth:"8",nine:"9",ninth:"9",ten:"10",tenth:"10",eleven:"11",eleventh:"11",twelve:"12",twelfth:"12",thirteen:"13",thirteenth:"13",fourteen:"14",fourteenth:"14",fifteen:"15",fifteenth:"15",sixteen:"16",sixteenth:"16",seventeen:"17",seventeenth:"17",eighteen:"18",eighteenth:"18",nineteen:"19",nineteenth:"19",twenty:"20",twentieth:"20"};function Ht(e){e=e.replaceAll(/(\d)(st|nd|rd|th)/gi,((e,t)=>t));const t=new RegExp(Object.keys(Mt).map((e=>`\\b${e}\\b`)).join("|"),"gi");return e=e.replace(t,(e=>Mt[e.toLowerCase().trim()]))}const xt=({title:e="Message!",message:t="",elements:s=[]})=>{const i=document.createElement("div");return i.addEventListener("mousedown",(e=>e.stopPropagation())),i.classList.add("dialog-window","section"),i.innerHTML=`\n        <h2 class="dialog__header">${e}</h2>\n        <button class="dialog-close-icon header-icon header-button close-icon" onclick="this.closest('.section').remove();"></button>\n        <p>${t}</p>\n        <div class="dialog__inputs-row">${s.map((e=>C(e))).join("")}</div>\n    `,i},Gt=Object.freeze({RANDOM:"random",TO_RIGHT:"right",TO_TOP:"top"});function Ut(e,t){switch(t){case Je.RANDOM_IMAGE:return function(e){let t,s=window.innerWidth,i=window.innerHeight,n=5*(new Date).getDate();const a=()=>{t?.remove()},o=()=>{const o=()=>{e.innerHTML="",t=document.createElement("img"),t.id="background-image",e.appendChild(t)};a(),o(),t.src=`https://picsum.photos/seed/${n}/${s}/${i}`};return{start:o,stop:a}}(e);case Je.PARTICLES_MOVE_RANDOM:return Bt(e,Gt.RANDOM);case Je.PARTICLES_MOVE_RIGHT:return Bt(e,Gt.TO_RIGHT);case Je.PARTICLES_MOVE_TOP:return Bt(e,Gt.TO_TOP);default:return Bt(e,Gt.TO_RIGHT)}}function Bt(e,t){let s,i,n=window.innerWidth,a=window.innerHeight,o=Math.floor(n*a/3e4),r=!1,l=[];const c=e=>e?~~(80*Math.random())-40+e:100+~~(155*Math.random());class d{constructor(e,t,s,i,n,a){this.x=e,this.y=t,this.size=s,this.speedX=i,this.speedY=n,this.color=a}update(){switch(this.x+=this.speedX,this.y+=this.speedY,t){case Gt.TO_RIGHT:this.x-this.size>n&&(this.x=0-this.size,this.y=Math.random()*a);break;case Gt.TO_TOP:this.y-this.size>a&&(this.y=0-this.size,this.x=Math.random()*n);break;default:(this.x-this.size<=0||this.x+this.size>=n)&&(this.speedX*=-1),(this.y-this.size<=0||this.y+this.size>=a)&&(this.speedY*=-1)}}draw(){i.beginPath(),i.rect(this.x-this.size,this.y-this.size,2*this.size,2*this.size),i.fillStyle=this.color,i.fill()}}const h=()=>{if(i.clearRect(0,0,s.width,s.height),r){for(let e of l)e.update(),e.draw();requestAnimationFrame(h)}},u=()=>{r=!1,l=[]};return{start:()=>{u(),r=!0,window.addEventListener("resize",(()=>{n=window.innerWidth,a=window.innerHeight,s.width=n,s.height=a})),(t=>{e.innerHTML="",s=document.createElement("canvas"),e.appendChild(s),i=s.getContext("2d"),s.width=n,s.height=a;for(let e=0;e<o;e++){const e=1+~~(5*Math.random()),s=Math.random()*n,i=Math.random()*a;let o,r;switch(t){case Gt.TO_RIGHT:o=e/15,r=0;break;case Gt.TO_TOP:r=e/15,o=0;break;default:o=1*(Math.random()-.5),r=1*(Math.random()-.5)}const h=c(),u=`rgb(${h},${c(h)},${c(h)})`;l.push(new d(s,i,e,o,r,u))}})(t),h()},stop:u}}class Ft{widgetIcon={description:"2025 review",iconID:"side-panel__recap",onChangeEvent:"ui.recap.open()",iconClass:"side-panel_text-icon"};constructor(){this.addWidgetIcon()}addWidgetIcon(){const{iconID:e,onChangeEvent:t,description:s,iconClass:i}=this.widgetIcon,n=document.querySelector(".buttons-block__shortcuts"),a=document.createElement("div");a.classList.add("setting-radio-group"),a.innerHTML=`\n                <button id="${e}" class="${i}" data-title="${s}" onclick="${t}"}>25</button>\n                `,n.appendChild(a),this.widgetIcon.element=document.getElementById(e)}addEvents(){const e=document.querySelector("#recap_2025");e.addEventListener("mousedown",(t=>{if(t.stopPropagation(),t.target.matches(".recap__page-control")){const s=t.target.matches(".recap__page-control_left"),i=[...e.querySelectorAll(".recap__content-container")],n=[...e.querySelectorAll(".recap__indicator")];let a=i.findIndex((e=>e.classList.contains("focus")));i.forEach((e=>e.classList.remove("focus"))),n.forEach((e=>e.classList.remove("active"))),a=s?(a-1+i.length)%i.length:(a+1)%i.length,i[a].classList.add("focus"),n[a].classList.add("active")}else t.target.matches(".close-icon")?this.close():Q(e,t)}))}setValues(){const e=document.querySelector("#recap_2025"),t=e.getBoundingClientRect(),s={x:(window.innerWidth-t.width)/2+"px",y:(window.innerHeight-t.height)/2+"px"},i=ts.ui[e.id]||s;e.style.left=i.x,e.style.top=i.y,e.querySelector(".recap__content-container")?.classList.add("focus")}cardHtml({title:e,value:t}){return`\n                <div class="recap__card">\n                    <div class="recap__card-header">${e}</div>\n                    <div class="recap__card-content">${t}</div>\n                </div>\n        `}cheevosListHtml({title:e,cheevosArray:t}){return`\n            <div class="recap__card recap__card_wide">\n                    <div class="recap__card-header">${e}</div>\n                    <div class="recap__card-content">\n                        <ul class="recap__cheevos-list">\n                            ${t.map((e=>`\n                                    <li class="recap__cheevo-container" data-title="${e.Description}">\n                                        <div class="recap__cheevo-preview">\n                                            <img src="${N(e)}" alt=""\n                                                class="cheevo-icon">\n                                        </div>\n                                        <div class="recap__cheevo-content">\n                                            <h2 class="recap__cheevo-title">${e.Title}</h2>\n                                            <p class="recap__cheevo-text">${e.GameTitle}</p>\n                                            <p class="recap__cheevo-text">Unlocked ${new Date(e.Date).toLocaleDateString()}</p>\n                                            <div class="recap__cheevo-ratio">${(e.TrueRatio/e.Points).toFixed(2)}</div>\n                                        </div>\n                                    </li>\n                                `)).join("")}\n                        </ul>\n                    </div>\n                </div>\n        `}async getData(e=!1){function t(e){return e.reduce(((e,t)=>{const s=(i=t.Date,new Date(i).toLocaleString("en-US",{month:"long"}));var i;return e[s]??={month:s,count:0,points:0,retroPoints:0,softPoints:0},e[s].count++,t.HardcoreMode?(e[s].points+=t.Points,e[s].retroPoints+=t.TrueRatio):e[s].softPoints+=t.Points,e}),{})}function s(e){const s=t(e),i=Object.keys(s).reduce(((e,t)=>((!e.month||e.count<s[t].count)&&(e.month=t,e.count=s[t].count),e)),{month:null,count:0});return s[i.month]}function i(e){return e.reduce(((e,t)=>{const s=(i=t.Date,new Date(i).toLocaleString("en-US",{month:"long",day:"numeric"}));var i;return e[s]??={day:s,count:0,points:0,retroPoints:0,softPoints:0},e[s].count++,t.HardcoreMode?(e[s].points+=t.Points,e[s].retroPoints+=t.TrueRatio):e[s].softPoints+=t.Points,e}),{})}function n(e){const t=i(e),s=Object.keys(t).reduce(((e,s)=>((!e.day||e.count<t[s].count)&&(e.day=s,e.count=t[s].count),e)),{day:null,count:0});return t[s.day]}if(ts._cfg.recap2025&&!e)return ts._cfg.recap2025;{const e=await async function(){let e=[];const t=e=>`https://retroachievements.org/API/API_GetAchievementsEarnedBetween.php?y=${ts.API_KEY}&u=${ds.targetUser||ts.USER_NAME}&f=${(e=>~~(new Date(e??"2025-01-01").getTime()/1e3))(e)}&t=${Math.floor(Date.now()/1e3)}`;let s=[],i=null;do{s=await(n=i,fetch(t(n)).then((e=>e.json()))),e=e.concat(s),i=s[s.length-1]?.Date,await R(200)}while(500===s.length);var n;return Array.from(new Map(e.map((e=>[JSON.stringify(e),e]))).values())}(),t=await async function(){const e=await is.getUserAwards({});return e.VisibleUserAwards?.filter((e=>2025===new Date(e.AwardedAt).getFullYear()))||[]}(),i=await async function(){const e=new Date("2025-01-01T00:00:00"),t=new Date("2025-12-31T23:59:59");let s=0,i=[],n=null;for(;;){const t=await is.getUserCompelitionProgress({count:500,offset:s}),a=t?.Results??[];if(!a||0===a.length)break;i.push(...a);const o=a.at(-1).ID;if(o===n)break;if(n=o,new Date(a.at(-1).MostRecentAwardedDate)<e)break;s+=500,await R(200)}return i.filter((s=>{const i=new Date(s.MostRecentAwardedDate);return i>=e&&i<=t}))}(),o=await ht(),r={cheevosCount:(a=e,a.filter((e=>1===e.HardcoreMode)).length),cheevosCountSoft:function(e){return e.filter((e=>0===e.HardcoreMode)).length}(e),points:function(e){return e.reduce(((e,t)=>e+(1===t.HardcoreMode?t.Points:0)),0)}(e),softPoints:function(e){return e.reduce(((e,t)=>e+(0===t.HardcoreMode?t.Points:0)),0)}(e),retropoints:function(e){return e.reduce(((e,t)=>e+(1===t.HardcoreMode?t.TrueRatio:0)),0)}(e),gamesPlayed:function(e){return new Set(e.map((e=>e.GameID))).size}(i),masteredCount:function(e){return e.filter((e=>"Mastery/Completion"===e.AwardType&&1===e.AwardDataExtra)).length}(t),beatenCount:function(e){return e.filter((e=>"Game Beaten"===e.AwardType&&1===e.AwardDataExtra)).length}(t),beatenSoftCount:function(e){return e.filter((e=>"Game Beaten"===e.AwardType&&0===e.AwardDataExtra)).length}(t),completedCount:function(e){return e.filter((e=>"Mastery/Completion"===e.AwardType&&0===e.AwardDataExtra)).length}(t),gamingStreak:function(e){const t=[...new Set(e.map((e=>e.Date.split(" ")[0])))].sort().map((e=>new Date(e)));let s=1,i=1;for(let e=1;e<t.length;e++){const n=(t[e]-t[e-1])/864e5;1===n?s++:n>1&&(s=1),i=Math.max(i,s)}return i}(e),beatenStreak:function(e){const t=e.filter((({AwardType:e,AwardDataExtra:t})=>"Game Beaten"===e&&1==t)).map((({AwardedAt:e})=>e)).map((e=>new Date(e))).sort(((e,t)=>e-t));let s=1,i=1;for(let e=1;e<t.length;e++){const n=t[e-1],a=t[e]-n,o=Math.floor(a/864e5);a<=864e5||1===o?s++:s=1,i=Math.max(i,s)}return i}(t),masteredStreak:function(e){const t=e.filter((({AwardType:e,AwardDataExtra:t})=>"Mastery/Completion"===e&&1==t)).map((({AwardedAt:e})=>e)).map((e=>new Date(e))).sort(((e,t)=>e-t));let s=1,i=1;for(let e=1;e<t.length;e++){const n=t[e-1],a=t[e]-n,o=Math.floor(a/864e5);a<=864e5||1===o?s++:s=1,i=Math.max(i,s)}return i}(t),topPlatform:function(e){const t=function(e){return e.reduce(((e,t)=>{const{ConsoleID:s}=t;return e[s]||(e[s]=0),e[s]++,e}),{})}(e),s=Object.keys(t).reduce(((e,s)=>((!e.platform||e.gamesCount<t[s])&&(e.platform=s,e.gamesCount=t[s]),e)),{platform:null,gamesCount:0}).platform;return m[s]?.Name}(i),platformCount:function(e){return new Set(e.map((e=>e.ConsoleID))).size}(i),topMonth:s(e).month,monthCheevos:s(e).count,monthPoints:s(e).points,topDay:n(e).day,dayCheevos:n(e).count,dayPoints:n(e).points,rareCheevos:function(e,t){const s=e.filter((e=>e.Points>0)).sort(((e,t)=>t.TrueRatio/t.Points-e.TrueRatio/e.Points));return s?.slice(0,t)??[]}(e,8),topGenre:function(e,t){const s=function(e,t){return e.reduce(((e,s)=>{const{ID:i}=s,n=t.find((e=>e.ID==i));return n&&n.Genres.length>0&&dt(n.Genres).forEach((t=>{e[t]||(e[t]=0),e[t]++})),e}),{})}(e,t);return Object.keys(s).reduce(((e,t)=>((!e.genre||e.gamesCount<s[t])&&(e.genre=t,e.gamesCount=s[t]),e)),{genre:null,gamesCount:0}).genre}(i,o)};return ts._cfg.recap2025=r,ts.writeConfiguration(),r}var a}async genContent(e=!1){const t=document.createElement("section");t.className="recap__container",t.id="recap_2025";const s=await this.getData(e),i=(e=>{const t=(e,t,s)=>({title:e,value:t});return[[t("Games played",e.gamesPlayed),t("Games beaten",e.beatenCount,e.beatenSoftCount),t("Games mastered",e.masteredCount,e.completedCount),t("Achievements unlocked",e.cheevosCount,e.cheevosCountSoft),t("Points earned",e.points,e.softPoints),t("Retropoints earned",e.retropoints),t("Gaming streak, days",e.gamingStreak),t("Completion streak",e.beatenStreak),t("Mastery streak",e.masteredStreak)],[t("Platforms played",e.platformCount),t("Preffered platform",e.topPlatform?.split("/")[0]),t("Preffered genre",e.topGenre),t("Retromonth",e.topMonth),t("Achievements",e.monthCheevos),t("Points",e.monthPoints),t("Retroday",e.topDay),t("Achievements",e.dayCheevos),t("Points",e.dayPoints)]]})(s),n=i.map((e=>`\n                <div class="recap__content-container">\n                    ${e.map(((e,t)=>this.cardHtml(e,t))).join("\n")}\n                </div>\n            `)).join("");t.innerHTML=`\n        <div class="recap__header">\n            <div class="recap__header-content">\n                <div class="recap-controls">\n                            ${he("ui.recap.forceUpdate()")}\n                            ${re()}\n                        </div>\n                <div class="recap__user-name">\n                    <img class="recap__header-icon" style="padding: 0.2rem;"\n                        src="https://static.retroachievements.org/assets/images/ra-icon.webp" alt="">\n                    <img class="recap__header-icon" src="https://media.retroachievements.org/UserPic/${ds.targetUser||ts.USER_NAME}.png"\n                        alt="">\n                    ${ds.targetUser||ts.USER_NAME}\n                </div>\n                <p class="recap__header-text">\n                    2025 highlights\n                </p>\n\n            </div>\n        </div>\n        <div class="recap__main-content">\n            ${n}\n            <div class="recap__content-container">\n                ${this.cheevosListHtml({title:"Rarest achievements",cheevosArray:s.rareCheevos})}\n            </div>\n            <div class="recap__indicator-container">\n                <div class="recap__indicator active"></div>\n                <div class="recap__indicator"></div>\n                <div class="recap__indicator"></div>\n            </div>\n            <div class="recap__page-control recap__page-control_left">< </div>\n            <div class="recap__page-control recap__page-control_right"> </div>\n\n        </div>\n\n        <div class="recap__footer">\n            retrocheevos.vercel.app\n        </div>\n        `,document.querySelector(".recap__container")?.remove(),ss.app.appendChild(t),this.addEvents(),this.setValues()}open(e){document.querySelector("#recap_2025")?this.close():this.genContent()}close(){document.querySelector(".recap__container").remove()}forceUpdate(){this.genContent(!0)}}class Vt{VERSION="0.81";isCEF=!("Notification"in window);CURRENT_LEVEL;AUTOCLOSE_CONTEXTMENU=!1;STICK_MARGIN=1;STICK_TOLERANCE=7;hltb={};twitchClient=new Pt;gamePopup=()=>qe();constructor(){this.initUI()}async loadLang(){const e=await fetch(Qe(Ye.en)),t=await e.json(),s=ts.ui?.local??Ye.en;if(s===Ye.en)this.lang=t;else{const e=await fetch(Qe(s)),i=await e.json();this.lang={...t,...i}}await R(25)}async initUI(){await this.loadLang(),await async function(){if("/test.html"===window.location.pathname)try{for(const e in n){const t=n[e],s=await fetch(t);if(!s.ok)throw new Error(`Failed to fetch section: ${t}`);const i=await s.text(),a=document.createElement("div");a.innerHTML=i,document.querySelector(".wrapper").appendChild(a)}}catch(e){console.error("Error loading sections:",e)}}(),this.initializeElements(),this.addEvents(),Vt.updateColors(),ds.bgVisibility=ds.bgVisibility,ts.identConfirmed&&(ds.startOnLoad?ns.start():ns.updateGameData(),setTimeout((()=>{is.getUserSummary({}).then((e=>{this.userInfo?.update({userSummary:e}),this.stats?.initialSetStats({userSummary:e}),this.statusPanel?.updateStatistics({userSummary:e})}))}),3e3)),setTimeout((()=>document.querySelector(".loading-section").classList.add("hidden")),500)}initializeElements(){this.app=document.querySelector(".wrapper"),this.recap=new Ft,this.statusPanel=new ze,this.status=new Ct,this.achievementsBlock=[new Ne],this.createAchievementsTemplate(),this.target=new Ve,this.gameCard=new st,this.stats=new nt,this.gameList=new Dt,this.progression=new it,this.note=new et,this.awards=new tt,this.notifications=new ot,this.games=new ut,this.settings=new Ze,this.links=new kt,this.buttons=new Ke}static applyPosition({widget:e}){if(!e)return;const t=e.section.id,s=()=>{e.section.classList.add("hidden","disposed")};if(ts.ui[t]){const{x:i,y:n,width:a,height:o,hidden:r}=ts.ui[t],{clientWidth:l,clientHeight:c}=ss.app,d=parseInt(i),h=parseInt(n);i&&(e.section.style.left=d<0?0:d>l-10?l-100+"px":i),n&&(e.section.style.top=h<0?0:h>c-10?c-100+"px":n),a&&(e.section.style.width=a),o&&(e.section.style.height=o);(r??!0)&&s()}else!e.VISIBLE&&s();e.widgetIcon?.element&&(e.widgetIcon.element.checked=!1===ts.ui?.[e.section?.id]?.hidden??!e.VISIBLE)}addEvents(){const e=async e=>{e.stopPropagation();const t=e.target.closest("[data-title]")?.dataset.title,s=e.target.closest("[data-achiv-id]")?.dataset?.achivId,i=ns.CHEEVOS[s],n=document.querySelectorAll(".popup:not(.fixed)");if(t&&t===n[0]?.innerText)return;if(!t&&n[0]?.dataset.id&&n[0]?.dataset.id==s)return;(async e=>{e.forEach((e=>e.remove()))})(n);if(!t&&i&&!ds.showCheevoOnHover)return;const a=t?function(e){let t=document.createElement("div");return t.classList.add("popup","hint","hint-popup"),t.innerHTML=`\n      <p>${e}</p>\n      `,t}(t):i?w(i):void 0;a&&(this.app.appendChild(a),X(a,e),setTimeout((()=>a.classList.add("visible")),50)),(e=>{e.clientX<20&&this.buttons.show()})(e)};this.app.addEventListener("mousemove",e),this.app.addEventListener("mouseleave",(()=>{document.querySelectorAll(".popup:not(.fixed)").forEach((e=>e.remove())),this.buttons.section.classList.remove("expanded")})),this.app.addEventListener("click",(e=>{if(document.querySelectorAll(".context-menu").forEach((e=>e.remove())),e.target.closest("button, a, .badge-button"))return;const t=e.target.closest("[data-achiv-id]")?.dataset?.achivId;t&&(t=>{const s=ns.CHEEVOS[t],i=s?w(s,!0):void 0;this.app.appendChild(i),X(i,e),setTimeout((()=>i.classList.add("visible")),0)})(t)})),this.app.addEventListener("contextmenu",(e=>{this.showContextmenu({event:e,menuItems:this.settings.contextMenuItems})})),this.app.addEventListener("mousedown",(t=>{this.app.removeEventListener("mousemove",e),document.querySelectorAll(".popup, .dialog-window")?.forEach((e=>e.remove()))})),this.app.addEventListener("mouseup",(t=>{this.app.addEventListener("mousemove",e)}))}toggleBgAnimation(e){this.bgAnimation&&this.bgAnimation.stop(),this.animContainer||(this.animContainer=document.createElement("div"),this.animContainer.id="background-animation",document.body.appendChild(this.animContainer)),e&&(this.bgAnimation=Ut(this.animContainer,ds.bgAnimType),this.bgAnimation.start())}gameChangeEvent(e){this.achievementsBlock.forEach((e=>e?.parseGameAchievements(ns.GAME_DATA))),["statusPanel","status","target","gameList","gameCard"].forEach((t=>this[t]?.gameChangeEvent(e))),this.note?.updateGame(),this.progression?.generateProgression()}updateWidgets({earnedAchievementsIDs:e=[],isLog:t=!1}){this.achievementsBlock.forEach((t=>t.updateEarnedAchieves({earnedAchievementIDs:e}))),this.target.updateEarnedAchieves({earnedAchievementIDs:e}),this.target.delayedRemove(),this.awards.VISIBLE&&this.awards.updateAwards(),this.statusPanel.updateProgress({earnedAchievementIDs:e}),this.status.updateProgress({earnedAchievementIDs:e}),this.progression.update({earnedAchievementIDs:e}),this.userInfoTimeout&&clearTimeout(this.userInfoTimeout);const s=16e3*e.length;this.userInfoTimeout=setTimeout((async()=>{const e=await is.getUserSummary({gamesCount:0,achievesCount:0});ss.stats?.updateStats({currentUserSummary:e}),ss.statusPanel?.updateStatistics({userSummary:e})}),t&&s<3e4?3e4:s);const i=e.map((e=>({type:k.CHEEVO,value:ns.CHEEVOS[e]})));this.notifications.addAlertsToQuery(i)}showGameChangeAlerts(e){this.notifications.gameChangeEvent(!0),(ds.discordNewGame||e&&ds.discordStartSession)&&W({type:k.GAME})}showAwardsAlerts(e=[]){U(e),e.forEach((e=>{ds.discordNewAward&&W(e)})),this.statusPanel.addAlertsToQuery(e),this.status.addAlertsToQuery(e),this.notifications.addAlertsToQuery(e),this.gameCard.section.dataset.award=ns.GAME_DATA?.award??"-",this.gameCard.section.dataset.progressionAward=ns.GAME_DATA?.progressionAward??"-",e.length&&setTimeout((()=>ss.stats.updateChart()),4e3)}showCheevoAlerts(e=[]){let t=e.map((e=>({type:k.CHEEVO,value:ns.CHEEVOS[e]})));t.forEach((e=>{const t=e.value,{minPointsDiscordAlert:s,minRetroPointsDiscordAlert:i,hardOnlyDiscordAlert:n,discordNewCheevo:a}=ds,o=t.Points>=s||t.TrueRatio>=i,r=!n||t.isHardcoreEarned;a&&o&&r&&W(e)})),U(t),this.statusPanel.addAlertsToQuery(t),this.status.addAlertsToQuery(t)}updateWidgetsRichPresence(e="Rich presence"){this.statusPanel.frontSide.richPresence.innerText=e,this.status.richPresenceElement.innerText=e;const t=(e=>{const t=Nt.join("|"),s=((e,s)=>{const i=new RegExp(`(${t})(\\s|-\\s*|:\\s*)((\\d+-\\d+)|(\\d+))`,"gi"),n=new RegExp(`\\b${s?.join("\\b|\\b")}\\b`,"gi"),a=e.match(n),o=a?ns.GAME_DATA.zones?.indexOf(a[0]):void 0,r=e.matchAll(i);let l;for(const e of r)l=e[3]?.replace("-",".");return o>=0&&(l=`${o+1}${l?.includes(".")?"."+l:""}`),Number(l)})(Ht(e),ns.GAME_DATA.zones);return!!Number.isFinite(s)&&s})(e);this.CURRENT_LEVEL=t,t&&(this.target.highlightCurrentLevel(t),this.achievementsBlock.forEach((e=>e.highlightCurrentLevel(t))))}showContextmenu({event:e,menuItems:t,sectionCode:s=""}){e.preventDefault(),e.stopPropagation(),document.querySelector(".context-menu")?.remove(),this.contextMenu=D({menuItems:t,sectionCode:s}),this.app.appendChild(this.contextMenu),(()=>{this.contextMenu.style.left=e.x+"px",this.contextMenu.style.top=e.y+"px",window.innerWidth-e.x<3*this.contextMenu.offsetWidth&&this.contextMenu.classList.add("to-left"),window.innerHeight-e.y<2*this.contextMenu.offsetHeight&&this.contextMenu.classList.add("to-top")})(),this.contextMenu.classList.remove("hidden")}createAchievementsTemplate(){2===this.achievementsBlock.length?Vt.switchSectionVisibility(this.achievementsBlock[1]):(this.achievementsBlock.push(new Ne(!0)),ns.GAME_DATA&&this.achievementsBlock.at(-1).parseGameAchievements(ns.GAME_DATA))}stopWatching(){ss.IS_WATCHING=!1,this.statusPanel.frontSide.watchButton.classList.remove("active"),clearInterval(ss.apiTrackerInterval)}static updateColors(e){const{style:s}=document.body,{mainColor:i,secondaryColor:n,accentColor:a,fontColor:o,selectionColor:r}=(e=>{let s;return s="custom"===e?ds.customColors:t[e]||t.default,s.selectionColor||(s.selectionColor=function(e,t=1){3===(e=e.replace(/^#/,"")).length&&(e=e.split("").map((e=>e+e)).join(""));const s=parseInt(e,16);return`rgba(${s>>16&255}, ${s>>8&255}, ${255&s}, ${t})`}(s.accentColor,.1)),s})(ds.preset);s.setProperty("--main-color",i),s.setProperty("--secondary-color",n),s.setProperty("--accent-color",a),s.setProperty("--font-color",o),s.setProperty("--selection-color",r)}static addDraggingEventForElements(e,t){}static switchSectionVisibility({section:e,visible:t=!1}){e.classList.contains("hidden")||t?(e.classList.remove("disposed"),setTimeout((()=>e.classList.remove("hidden")),100),ts.setNewPosition({id:e.id,hidden:!1})):(e.classList.add("hidden"),setTimeout((()=>e.classList.add("disposed")),300),ts.setNewPosition({id:e.id,hidden:!0}))}exportCompletionDataToXlsx=()=>z.completion();exportWantToPlayToCSV=()=>z.wantToPlay();exportSettingsToJson=e=>{if(e)K(e);else{const e=xt({title:ss.lang.exportSettings,message:ss.lang.exportSettingsMessage,elements:[{type:P.BUTTON,id:"dialog-download",label:ss.lang.download,event:"onclick=\"ui.exportSettingsToJson({direction:'file'});\""},{type:P.BUTTON,id:"dialog-copy",label:ss.lang.copyToClipboard,event:"onclick=\"ui.exportSettingsToJson({direction:'clipboard'});\""},{type:P.BUTTON,id:"dialog-discord",label:ss.lang.sendToDS,event:"onclick=\"ui.exportSettingsToJson({direction:'discord'});\""}]});ss.app.appendChild(e)}};importSettingsFromJson(){const e=document.createElement("input");e.type="file",e.accept=".json",e.addEventListener("change",(function(e){const t=e.target.files[0];if(t){const e=new FileReader;e.onload=function(e){try{const t=JSON.parse(e.target.result);console.log("Imported Settings:",t),ss.applySettings(t)}catch(e){console.error("Error parsing JSON:",e)}},e.onerror=function(){console.error("Error reading file:",e.error)},e.readAsText(t)}else console.log("No file selected")})),e.click()}applySettings(e){e.version>=.65?(ts._cfg=e,ts.writeConfiguration(),setTimeout((()=>location.reload()),1e3)):console.log("Unsupported file")}}const qt="retroApiConfig";class Wt{get version(){return this._cfg.version??"0"}set version(e){this._cfg.version=e,this.writeConfiguration()}get API_KEY(){return this._cfg.identification.RAApi_key}set API_KEY(e){this._cfg.identification.RAApi_key=e,this.writeConfiguration()}get USER_NAME(){return this._cfg.identification.RAApi_login}set USER_NAME(e){this._cfg.identification.RAApi_login=e,this.writeConfiguration()}get identConfirmed(){return this._cfg.identification.identConfirmed??!1}set identConfirmed(e){this._cfg.identification.identConfirmed=e,this.writeConfiguration()}get userImageSrc(){return this._cfg.identification.userImageSrc||""}set userImageSrc(e){this._cfg.identification.userImageSrc=e,this.ui.buttons&&(ss.buttons.userImage.src=e),this.writeConfiguration()}configData=new Proxy({},{get:(e,t)=>{const s=this.configDefaultValues[t]??!0;return this.getSettingProperty(t)??s},set:(e,t,s)=>{const i=this.configValuePreprocessors[t];"function"==typeof i&&(s=i(s)),this.saveSettingProperty(t,s);const n=this.configSetCallbacks?.[t];return"function"==typeof n&&n.call(this,s),!0}});configDefaultValues={bgVisibility:!1,bgAnimType:"",startOnLoad:!1,targetUser:"",gameID:1,updateDelaySec:5,customColors:t.default,preset:"default",fsAlertDuration:15,fsNewCheevo:!1,fsNewAward:!0,minPointsDiscordAlert:0,minRetroPointsDiscordAlert:0,hardOnlyDiscordAlert:!1,fontSize:14,fontFamilyName:"default",pauseIfOnline:!1,discordNewGame:!0,discordNewCheevo:!0,discordNewAward:!0,discordStartSession:!0,discordWebhook:"",parseLog:!1,showCheevoOnHover:!1,loadLastSubset:!0};configValuePreprocessors={updateDelaySec:e=>parseInt(e)<5?5:parseInt(e),customColors:({colorProperty:e,color:t})=>({...configData.customColors,[e]:t}),fsAlertDuration:e=>e<5?5:e>60?60:e,minPointsDiscordAlert:e=>parseInt(e)>=0?e:0,minRetroPointsDiscordAlert:e=>parseInt(e)>=0?e:0};configSetCallbacks={targetUser(){this.identConfirmed&&(ss.settings.getLastGameID(),ss.awards.updateAwards())},bgVisibility(e){ss.toggleBgAnimation(e)},bgAnimType(e){ss.toggleBgAnimation(!1),ss.toggleBgAnimation(!0)},customColors(){this.configData.preset="custom"},preset(e){Vt.updateColors()},fontSize(e){document.documentElement.style.setProperty("font-size",`${e}px`)},fontFamilyName(e){if(Object.keys(s).includes(e)){const t=document.createElement("link");t.rel="stylesheet",t.href=s[e],document.head.appendChild(t),document.documentElement.style.setProperty("--font-family",`"${e}", system-ui, sans-serif`)}else document.documentElement.style.setProperty("--font-family","system-ui, sans-serif")}};get ui(){return this._cfg.ui}get gamesDB(){return this._cfg.gamesDB||(this._cfg.gamesDB={}),this._cfg.gamesDB}get cheevosDB(){return this._cfg.cheevosDB||(this._cfg.cheevosDB={}),this._cfg.cheevosDB}async getFileHandle(e="log"){return await async function(e="log"){const t=await i();return new Promise(((s,i)=>{const n=t.transaction("handles","readonly").objectStore("handles").get(e);n.onsuccess=e=>s(e.target.result),n.onerror=e=>i(e.target.error)}))}(e)}constructor(){this.readConfiguration(),this.fixConfig()}fixConfig=()=>{if(3.12!==this.version)try{delete this._cfg.apiWorker,delete this._cfg.aotw,this.version=3.12,this.writeConfiguration()}catch(e){console.error(e)}};setNewPosition({id:e,xPos:t,yPos:s,width:i,height:n,hidden:a}){this._cfg.ui.hasOwnProperty(e)||(this._cfg.ui[e]={id:e,x:t,y:s,width:i,height:n,hidden:a}),t&&(this._cfg.ui[e].x=t),s&&(this._cfg.ui[e].y=s),i&&(this._cfg.ui[e].width=i+"px"),n&&(this._cfg.ui[e].height=n+"px"),void 0!==a&&(this._cfg.ui[e].hidden=a),this.writeConfiguration()}readConfiguration(){let e=JSON.parse(localStorage.getItem(qt));e||(e={identification:{RAApi_key:"",RAApi_login:""},settings:{updateDelaySec:5},ui:{}}),this._cfg=e,localStorage.setItem(qt,JSON.stringify(this._cfg)),this.writeConfiguration()}saveUIProperty({sectionID:e,property:t,value:s}){e&&t&&(this.ui[e]||(this.ui[e]={}),this.ui[e][t]=s,this.writeConfiguration())}saveSettingProperty(e,t){e&&(this._cfg.settings[e]=t,this.writeConfiguration())}getUIProperty({sectionID:e,property:t}){if(e&&t)return this.ui[e]?this.ui[e][t]:void 0}getSettingProperty(e){if(e)return this._cfg.settings[e]}delayedWrite;writeConfiguration(){clearTimeout(this.delayedWrite),this.delayedWrite=setTimeout((()=>{localStorage.setItem(qt,JSON.stringify(this._cfg))}),500)}async selectLogFile(e){let[t]=await window.showOpenFilePicker({types:[{description:"Log files",accept:{"text/plain":[".log"]}}]});await async function(e,t="log"){const s=(await i()).transaction("handles","readwrite");s.objectStore("handles").put(e,t),s.oncomplete=()=>console.log("Handle saved in IndexedDB"),s.onerror=e=>console.error("Error:",e)}(t,e),await async function(e){"granted"!==await e.queryPermission({mode:"read"})?console.warn("–î–æ—Å—Ç—É–ø –Ω–µ –Ω–∞–¥–∞–Ω–æ"):console.log("–î–æ—Å—Ç—É–ø –Ω–∞–¥–∞–Ω–æ")}(t)}}const jt=Object.freeze({userProfile:"API_GetUserProfile.php",gameInfoAndProgress:"API_GetGameInfoAndUserProgress.php",gameTimesInfo:"API_GetGameProgression.php",recentAchieves:"API_GetUserRecentAchievements.php",gameInfo:"API_GetGame.php",extendedGameInfo:"API_GetGameExtended.php",recentlyPlayedGames:"API_GetUserRecentlyPlayedGames.php",userAwards:"API_GetUserAwards.php",userGameRankAndScore:"API_GetUserGameRankAndScore.php",completionProgress:"API_GetUserCompletionProgress.php",gameList:"API_GetGameList.php",userSummary:"API_GetUserSummary.php",achievementOfTheWeek:"API_GetAchievementOfTheWeek.php",comments:"API_GetComments.php",wantToPlay:"API_GetUserWantToPlayList.php"});const zt=(e,t,s)=>e<=.2&&t>1e3&&s<100?11:e<=1&&t>300||t>=500?10:e<=1.5&&t>300||t>=500?9:e<=3&&t>100||t>=300?8:e<8&&t>24?7:e<13&&t>10?6:e<20&&t>5||t>10?5:4;function Kt(e){let t=[];Object.values(e.Achievements).forEach((e=>{e.genres=[],(e=>{const t="\\b"+["Level","Stage","Area","World","Mission","Chapter","Section","Zone","Phase","Realm","Domain","Episode","Act","Tier","Floor","Scene","Screen","Round"].join("\\b|\\b")+"\\b",s="\\b"+["first","second","third","fourth","fifth","sixth","seventh","eighth"].join("\\b|\\b")+"\\b",i="\\b"+["(D|d)efeat(ing)*","(K|k)ill(ing)*","(B|b)eat"].join("\\b|\\b")+"\\b",n="\\b"+["(?:T|t)he\\b","\\ba\\b","(?:M|m)rs{0,1}\\b[.]*","(?:D|d)r\\b[.]*","his\\b"].join("|\\b"),a="\\b"+["All","((Hi)*(-)*(S|s)core)","((T|t)he\\s)*(G|g)ame","(P|p)ro"].join("\\b|\\b")+"\\b";return new RegExp(`((${i})\\s*(${n})*\\s*(${s})*\\s*(?!(${a}|${t}))(?:(['"]*[A-Z]\\w*\\b)|((all)*[\\s\\w]*boss(es)*)))`,"g").exec(e.Description)})(e)&&e.genres.push(h.BOSSFIGHT),(e=>{const t="\\b"+["(?:C|c)ollect","(A|a)ccumulate","by collecting","(?:O|o)btain","(?:S|s)till","(?:P|p)ick\\sup"].join("\\b|\\b")+"\\b",s=["(?:P|p)oints","(G|g)old","(?:S|s)core","(?:O|o)ver"].join("|");return new RegExp(`(?:${t})(?![^.]*(?:${s}))[^.]+(?:.|w$)`,"g").exec(e.Description)})(e)&&e.genres.push(h.COLLECTOR),(e=>new RegExp("(((W|w)ithout|no)\\b[\\s\\w]*((D|d)amage|(H|h)armed|(G|g)ettings(H|h)it\b)|(\\b(with)|at)\\b\\sfull\\s(\\b(health)|(life)))","gi").exec(e.Description))(e)&&e.genres.push(h.NO_DAMAGE),(e=>{const t="("+["without\\s([\\w\\s]*or\\s)*dying","(without|\\bno(t)*)\\s[\\w\\s]*losing\\s(a)*\\slife","\\bno(t)*\\s(dying|death(s)*)"].join(")|(")+")";return new RegExp(`${t}`,"gi").exec(e.Description)})(e)&&e.genres.push(h.NO_DEATH),(e=>{const t=["\\b(?:M|m)inute","\\b(?:S|s)econds","\\b(?:H|h)our"].join("|");return new RegExp(`((?:\\bin\\b|\\bless|\\bunder|\\bfor|\\bwith(in)*)[\\s\\w\\d:]*(?:${t}))|(.*\\d{0,2}:\\d{2})|(.*\\d+['m]\\d{2}["s])`,"g").exec(e.Description)})(e)&&e.genres.push(h.TIMETRIAL),(e=>{const t="\\b"+["score(d|s)*","point(s)*","PTS|pts|Pts","earn","dollars"].join("\\b|\\b")+"\\b",s="\\d+[.,']{0,1}(\\d{3,}[.,']{0,1})*";return new RegExp(`((${t})[^.]+)${s}|(?:${s}[^.]+(?:${t}))|\\bbeat\\s(the\\s)*((Hi)*(\\-)*score\\b)`,"gi").exec([e.Title,e.Description].join(". "))})(e)&&e.genres.push(h.SCORE),(e=>/(without|no)\b[\s\w]*(hitting|harming|killing)/gi.exec(e.Description))(e)&&e.genres.push(h.PACIFIST),(e=>/(beat|kill|defeat|finish)(ing)*\s(\d+|(your\s)*first)\s*enem(y|ies)/gi.exec(e.Description))(e)&&e.genres.push(h.KILLER),t.push(...e.genres)})),e.cheevoGenres=[...new Set(t)]}function Xt(e){const t=Object.values(e.Achievements).sort(((e,t)=>0!=e.DisplayOrder?e.DisplayOrder-t.DisplayOrder:e.ID-t.ID)),s=t.reduce(((e,t)=>{const s=(e=>{const t=["Beat","Reach","Select","Bonus","No","Any","Mario","The"],s=["Win","Clear","Complete","Finish","Start","Enter","In"],i=function(e){const i="\\b"+[...Ot,...Ot.map((e=>e.toLowerCase()))].join("\\b|\\b")+"\\b",n="\\b"+[...s,...s.map((e=>e.toLowerCase()))].join("\\b|\\b")+"\\b",a="\\b"+t.join("\\b|\\b")+"\\b",o="[A-Z]\\w+\\s*(?:\\bof\\s)*",r=new RegExp([`(?:(?:${n})\\s+)((${o}\\s*){1,2})(?:${i}(?!\\s*\\d))`,`|(?!${n}|${a}\\s+)((${o}\\s*){1,2})(?:${i}(?!\\s*\\d))`,`|(?:(?:${n})\\s*["]((${o}\\s*){1,2})(?:["]))`,`|(?:${n}\\s*?!${i}\\s*((${o}\\s*){1,2}))`].join(""),"gm").exec(e),l=r&&(r[1]||r[3]||r[5]||r[7]);return l?.trim()}(Ht(` ${e.Description}.${e.Title}.`));return i})(t);s&&(e.zoneCount++,!e.zoneNames.includes(s)&&e.zoneNames.push(s));const i=(e=>{const t=function(e){const t=[...Rt,...Rt.map((e=>e.toLowerCase()))].join("|"),s="(?!\\d{4,}|\\d+%)(\\d{1,3}(?:-\\d{1,3}\\b){0,1})",i=new RegExp(`(?:(${t})\\s(?<level1>${s}))|(?<level2>${s})\\s(?:(${t}))|(?<level3>\\b\\d{1,3}-\\d{1,2}\\b)`,"gi").exec(e);if(i){const e=i.groups.level1||i.groups.level2||i.groups.level3;return e?.replace("-",".")}return null}(Ht(e.Description));return t})(t);return i&&(e.levelCount++,e.levelNums.add(i)),e.data.push({ID:t.ID,zone:s,level:i}),e}),{zoneCount:0,levelCount:0,levelNums:new Set,data:[],zoneNames:[]});s?.zoneNames?.forEach(((t,i)=>{Object.values(e.Achievements).forEach((e=>{const i=s.data.find((t=>t.ID===e.ID)),n=new RegExp(`\\b${t}\\b`,"gi");(n.test(e.Description)||n.test(e.Title)&&!i.zone)&&(s.zoneCount++,s.data.push({ID:e.ID,zone:t,level:i?.level}))}))})),s.zoneNames.length>=3&&s.zoneCount>4&&s.zoneNames.length>=s.levelNums.size?(s.zoneNames=((e,t)=>e.reduce(((e,s)=>(t.forEach((t=>{const i=new RegExp(`\\b${t}\\b`,"g");!e.includes(t)&&(i.test(s.Title)||i.test(s.Description))&&e.push(t)})),e)),[]))(t,s.zoneNames),e.zones=s.zoneNames,s.data.forEach((t=>{t.zone&&(e.Achievements[t.ID].zone=t.zone,e.Achievements[t.ID].level=+`${e.zones.indexOf(t.zone)+1}${t.level?"."+t.level:""}`)}))):s.levelCount>3&&s.levelNums.size>3?s.data.forEach((t=>{const s=t.ID,i=t.level,n=e.Achievements[s];n.level=i,delete n.zone})):s.data.forEach((t=>{delete e.Achievements[t.ID].zone,delete e.Achievements[t.ID].level}))}const Yt=(e,t={})=>{Kt(e),Xt(e),(e=>{const t=Object.values(e.Achievements),s=/\[(.+)\]/i,i=t.reduce(((e,t)=>{const i=s.exec(t.Description)?.[1];return t.group=i,i&&e.add(i),e}),new Set);e.groups=[...i]})(e),function(e){const t=Object.values(e.Achievements);if(0===t.length||0!==t[0].DisplayOrder)return;t.sort(((e,t)=>we.unlockRate(e,t))).forEach(((e,t)=>{e.DisplayOrder=[ve.PROGRESSION,ve.WIN].includes(e.Type)?t:1e3*++t}))}(e),Object.values(e.Achievements).map((s=>((e,t,s)=>{const{BadgeName:i,DateEarned:n,DateEarnedHardcore:a,NumAwardedHardcore:o,NumAwarded:r,TrueRatio:l,ID:c,Points:d}=e,{NumDistinctPlayers:h}=t,u=100*o/h,m=100*o/h,g=m<10?`${m.toFixed(1)}%`:`${m.toFixed(0)}%`,p=~~(100*r/h)+"%",v=(l/Math.max(1,d)).toFixed(2);t.Achievements[c]={...e,totalPlayers:h,isEarned:!!n,isHardcoreEarned:!!a,prevSrc:N(e),rateEarned:p,rateEarnedHardcore:g,trend:u,retroRatio:v,difficulty:zt(u,l,o),...s[c]}})(s,e,t)))};function Qt(e){let t=e.Title;const s=[/\[SUBSET[^\[]*\]/gi,/~[^~]*~/g,".HACK//"].reduce(((s,i)=>{const n=new RegExp(i,"gi"),a=e.Title.match(n);return a&&a.forEach((e=>{t=t.replace(e,"");let i=e;s.push(i.replace(/[~\.\[\]]|subset -|\/\//gi,""))})),s}),[]);e.badges=s,e.Title=t.trim()}let Jt=[];const Zt=(e,t={},s={})=>{e&&(Yt(e,s),Jt=Object.values(e?.Achievements??[]),e.ParentGameID??=e.ID,Qt(e),(e=>{const t=Jt.reduce(((e,t)=>{e.totalRetropoints+=t.TrueRatio,e.totalPoints+=t.Points;const s=e=>{e.count++,e.points+=t.Points,e.retropoints+=t.TrueRatio,[ve.PROGRESSION,ve.WIN].includes(t.Type)&&e.progressionCount++};return t.DateEarnedHardcore&&s(e.unlockData.hardcore),t.DateEarned&&s(e.unlockData.softcore),e}),{totalRetropoints:0,totalPoints:0,unlockData:{hardcore:{count:0,points:0,retropoints:0,progressionCount:0},softcore:{count:0,points:0,retropoints:0,progressionCount:0}}}),s=~~(t.totalRetropoints/t.totalPoints*100)/100;Object.assign(e,t,{retroRatio:s})})(e),(e=>{const t=Jt.filter((e=>e.Type===ve.PROGRESSION)),s=t.length>0,i=!!Jt.find((e=>e.Type===ve.WIN)),n=i?Jt.filter((e=>e.Type===ve.WIN)):[],a=Math.max(...Jt.map((e=>e.NumAwarded))),o=Jt.filter((e=>!e.DateEarnedHardcore&&0===e.Points)).length>0,r=t.length+(i&&1),l=Math.max(...Jt.map((e=>e.difficulty))),c=i?Math.min(...n.map((e=>e.difficulty))):Math.max(...t.map((e=>e.difficulty)));Object.assign(e,{totalRealPlayers:a,hasZeroPoints:o,masteryDifficulty:l,gameDifficulty:c,progressionSteps:r},(()=>{let e=null;if(!s&&!i)return{progressionAward:e};const a=(e=!1)=>{const s=e?"DateEarned":"DateEarnedHardcore",i=0===t.filter((e=>!e[s])).length,a=0===n.length||n.filter((e=>e[s])).length>0;return i&&a};return e=a(!1)?x.BEATEN:a(!0)?x.BEATEN_SOFTCORE:null,{progressionAward:e}})(),(()=>{const e=Jt.length>0&&0===Jt.filter((e=>!e.DateEarnedHardcore)).length,t=Jt.length>0&&0===Jt.filter((e=>!e.DateEarned)).length;return{award:e?x.MASTERED:t?x.COMPLETED:null}})(),(()=>{const e=Math.min(...Jt.map((e=>e.NumAwardedHardcore))),t=Math.min(...Jt.map((e=>e.NumAwarded)));return{masteredCount:e,completedCount:t,masteryRate:~~(1e4*e/a)/100,completedRate:~~(1e4*t/a)/100}})(),(()=>{let e,s;return i?(e=Math.max(...n.map((e=>e.NumAwardedHardcore))),s=Math.max(...n.map((e=>e.NumAwarded)))):(e=Math.min(...t.map((e=>e.NumAwardedHardcore))),s=Math.min(...t.map((e=>e.NumAwarded)))),{beatenCount:e,beatenCountSoftcore:s,beatenRateSoftcore:~~(1e4*s/a)/100,beatenRate:~~(1e4*e/a)/100}})())})(e),(e=>{const t=Jt.filter((e=>e.DateEarned)).sort(((e,t)=>we.latest(e,t,-1))).reduce(((e,t)=>{const s=new Date(t.DateEarnedHardcore||t.DateEarned);let i=((e,t)=>t.find((t=>e-t.date<432e5)))(s,e);return i?(i.date=s,i.cheevos.push(t)):(i={date:s,cheevos:[t],startDate:s},e.push(i)),e}),[]).map((({startDate:e,cheevos:t,date:s})=>({startDate:e.toLocaleDateString(),endDate:s.toLocaleDateString(),cheevos:t.map((({ID:e})=>e)),cheevosCount:t.length,cheevosCountHardcore:t.filter((e=>e.DateEarnedHardcore)).length})));Object.assign(e,{sessions:t})})(e),((e,t={})=>{Object.assign(e,{TimePlayed:0},t)})(e,t[e.ID]))};class es{cache=function(e){let t={gameTimes:{}};const s=()=>{let s=JSON.parse(localStorage.getItem(e))||{[Ue]:{}};t=s};return s(),{initialize:s,clear:()=>{t={[Ue]:{}},localStorage.setItem(e,JSON.stringify(t))},getData:({dataType:e,ID:s})=>e===Ue?t[e]?.[s]:t[e],push:({dataType:s,data:i})=>{s===Ue?(t[s]??={},t[s][i.ID]=i):t[s]=i,localStorage.setItem(e,JSON.stringify(t))}}}("raApiCache");baseUrl="https://retroachievements.org/API/";_subsetsList;async getSubsets(e){this._subsetsList||(this._subsetsList=await fetch("./json/games/all-subsets.json").then((e=>e.json())));return this._subsetsList[e]??{Main:e}}getUrl({endpoint:e,targetUser:t,gameID:s,minutes:i,apiKey:n,userName:a,achievesCount:o,count:r,offset:l,type:c,sort:d}){ss.isTest&&(this.baseUrl=`${window.location.origin}/json/apiTemplates/`);let h=new URL(e,this.baseUrl),u={y:n||ts.API_KEY,z:a||ts.USER_NAME,u:t||ds.targetUser||ts.USER_NAME,g:s??ds.gameID,m:i||2e3,i:s||ds.gameID,f:1,h:1,a:o||5,c:r||20,o:l||0,t:c,sort:d};return e===jt.userProfile&&delete u.i,h.search=new URLSearchParams(u),h}async completionProgress(){let e=this.cache.getData({dataType:Be});if(e?.Total&&(ds.targetUser||ts.USER_NAME)===e.UserName){return new Date-e.Date<6e4?e:this.updateCompletionProgress({batchSize:10,savedArray:e.Results}).then((async()=>await this.cache.getData({dataType:Be})))}return await this.updateCompletionProgress({batchSize:500}),e=await this.cache.getData({dataType:Be}),e}getAotW(){let e=this.getUrl({endpoint:jt.achievementOfTheWeek});return fetch(e).then((e=>e.json())).then((e=>(({AotwData:e,userName:t})=>{console.log(e);const s=e.Unlocks.find((e=>e.User.toLowerCase()===t?.toLowerCase()?.trim()));return{...e.Achievement,ConsoleName:e.Console.Title,ForumTopic:e.ForumTopic.ID,GameID:e.Game.ID,GameTitle:e.Game.Title,StartAt:e.StartAt,TotalPlayers:e.TotalPlayers,UnlocksHardcoreCount:e.UnlocksHardcoreCount,isEarned:!!s,isEarnedHardcore:!!s&&!!s.HardcoreMode}})({AotwData:e,userName:ds.targetUser})))}async aotw(){let e=this.cache.getData({dataType:Fe});return e&&function(e){const t=new Date,s=new Date;return s.setDate(t.getDate()-7),new Date(e)>s}(e.StartAt)||(e=await this.getAotW(),this.cache.push({dataType:Fe,data:e})),e}getUserGameRank({targetUser:e,gameID:t}){let s=this.getUrl({endpoint:jt.userRankAndScore});return fetch(s).then((e=>e.json()))}getProfileInfo({targetUser:e}){let t=this.getUrl({targetUser:e,endpoint:jt.userProfile});return fetch(t).then((e=>e.json()))}getUserCompelitionProgress({targetUser:e,count:t,offset:s}){let i=this.getUrl({targetUser:e||ds.targetUser,count:t||100,offset:s||0,endpoint:jt.completionProgress});return fetch(i).then((e=>e.json())).then((e=>(e.Results=e.Results.map((e=>(e.ID=e.GameID,e.NumAchievements=e.MaxPossible,delete e.MaxPossible,delete e.NumLeaderboards,e))),e)))}getUserAwards({targetUser:e}){let t=this.getUrl({targetUser:e||ds.targetUser,endpoint:jt.userAwards});return fetch(t).then((e=>e.json())).then((e=>(e.VisibleUserAwards=e.VisibleUserAwards.map((e=>({...e,DateEarnedHardcore:e.AwardedAt,timeString:l(e.AwardedAt),awardedDate:new Date(e.AwardedAt),award:"Events"==e.ConsoleName?"event":"Game Beaten"==e.AwardType?"1"==e.AwardDataExtra?x.BEATEN:x.BEATEN_SOFTCORE:"1"==e.AwardDataExtra?x.MASTERED:x.COMPLETED}))),e)))}async getGameInfoAndProgress({targetUser:e,gameID:t,withTimesData:s=!1}){const i=ts.gamesDB?.[t]?.lastSetID??t;t=ds.loadLastSubset?i:t;let n=this.getUrl({endpoint:jt.gameInfoAndProgress,targetUser:e||ds.targetUser,gameID:t});const a=await fetch(n);let o=await a.json();if(this.gameData=JSON.parse(JSON.stringify(o)),s)try{await R(200);o=((e,t)=>t?((e,t)=>t&&t.ID?(e={...e,timeToBeat:t.MedianTimeToBeatHardcore,timeToMaster:t.MedianTimeToMaster},Object.values(e.Achievements).map((s=>((e,t,s)=>{s&&(e.Achievements[t.ID]={...t,timeToUnlock:s.MedianTimeToUnlockHardcore,timeToUnlockSoftcore:s.MedianTimeToUnlock})})(e,s,t?.Achievements[s.ID]))),e):e)(e,t):e)(o,await this.getGameTimesInfo({gameID:t,targetUser:e}))}catch(e){console.log(e)}return Zt(o,ts.gamesDB,ts.cheevosDB),o.subsets=await this.getSubsets(o.ParentGameID),o}async getGameTimesInfo({gameID:e,targetUser:t}){const s=this.getUrl({endpoint:jt.gameTimesInfo,targetUser:t||ds.targetUser,gameID:e||ds.gameID});let i=this.cache.getData({dataType:Ue,ID:e});if(!i){i=(e=>{const t=e.Achievements?.reduce(((e,{ID:t,MedianTimeToUnlock:s,MedianTimeToUnlockHardcore:i})=>(e[t]={ID:t,MedianTimeToUnlock:s,MedianTimeToUnlockHardcore:i},e)),{}),{ID:s,MedianTimeToBeat:i,MedianTimeToBeatHardcore:n,MedianTimeToMaster:a,MedianTimeToComplete:o}=e;return{ID:s,MedianTimeToBeat:i,MedianTimeToBeatHardcore:n,MedianTimeToMaster:a,MedianTimeToComplete:o,Achievements:t}})(await fetch(s).then((e=>e.json()))),this.cache.push({dataType:Ue,data:i})}return i}async getGameInfoWithTimes({gameID:e,targetUser:t}){const s=await this.getGameInfoAndProgress({gameID:e});let i;await R(250);try{i=await apiWorker.getGameTimesInfo({gameID:e})}catch(e){console.log(e)}this.GAME_DATA=mergeGameData(s,i)}getRecentAchieves({targetUser:e,minutes:t}){let s=this.getUrl({endpoint:jt.recentAchieves,targetUser:e,minutes:t});return fetch(s).then((e=>e.json())).then((e=>e.map((e=>(e.localDate=l(e.Date),e)))))}getGameInfo({gameID:e,extended:t}){let s=this.getUrl({endpoint:this.endpoints[t?"extendedGameInfo":"gameInfo"],gameID:e});return fetch(s).then((e=>e.json()))}getWantToPlayGamesList({targetUser:e,count:t,offset:s}){let i=this.getUrl({endpoint:jt.wantToPlay,targetUser:e,count:t||50,offset:s||0});return fetch(i).then((e=>e.json())).then((e=>e.Results||[]))}getWantToPlayGames({targetUser:e,count:t,offset:s}){let i=this.getUrl({endpoint:jt.wantToPlay,targetUser:e,count:t||50,offset:s||0});return fetch(i).then((e=>e.json())).then((e=>(e.Results||[]).map((e=>e.ID))))}getRecentlyPlayedGames({targetUser:e,count:t}){let s=this.getUrl({endpoint:jt.recentlyPlayedGames,targetUser:e,count:t||50});return fetch(s).then((e=>e.json())).then((e=>e.map(((e,t)=>({...e,...Qt(e),ID:e.GameID,Points:e.ScoreAchievedHardcore+"/"+e.PossibleScore,NumAchievements:e.NumAchievedHardcore+"/"+e.AchievementsTotal,DateEarnedHardcore:e.LastPlayed})))))}getUserProfile({userName:e}){let t=this.getUrl({targetUser:e,userName:e,endpoint:jt.userProfile});return fetch(t).then((e=>e.json()))}getUserSummary({targetUser:e,gamesCount:t,achievesCount:s}){let i=this.getUrl({targetUser:e,gameID:t??3,achievesCount:s,endpoint:jt.userSummary});return fetch(i).then((e=>e.json())).then((e=>(e.RecentlyPlayed=e.RecentlyPlayed.map((t=>(t.LastPlayed=l(t.LastPlayed),e.Awarded[t.GameID]&&(t={...t,...e.Awarded[t.GameID]}),t))),e.RecentAchievements=Object.values(e.RecentAchievements).flatMap((e=>Object.values(e))).map((e=>(e.DateAwarded=l(e.DateAwarded),e))),e.RecentlyPlayed.length&&(e.isInGame=new Date-new Date(e.RecentlyPlayed[0].LastPlayed)<3e5),e)))}getComments({targetUser:e,id:t,offset:s=0,count:i=200,type:n=2,sort:a="-submitted"}){let o=this.getUrl({targetUser:e,gameID:t,type:n,offset:s,count:i,sort:a,endpoint:jt.comments});return fetch(o).then((e=>e.json())).then((e=>e.Results?.filter((e=>"Server"!==e.User))||[]))}verifyUserIdent({userName:e,apiKey:t}){let s=this.getUrl({targetUser:e,userName:e,apiKey:t,endpoint:jt.userProfile});return fetch(s).then((e=>e.json()))}getGameList({userName:e,apiKey:t,systemID:s}){let i=this.getUrl({userName:e,apiKey:t,gameID:s,endpoint:jt.gameList});return fetch(i).then((e=>e.json()))}doTestEndpoint({endpoint:e}){let t=this.getUrl({endpoint:e});return fetch(t).then((e=>e.json())).then((e=>console.log(e)))}async updateCompletionProgress({savedArray:e=[],completionProgress:t=[],batchSize:s=500}){let i=await this.getUserCompelitionProgress({count:s,offset:t.length}),n=(t=[...t,...i.Results]).at(-1);if(e.findIndex((e=>e.hasOwnProperty("GameID")&&e.GameID===n.GameID&&e.MostRecentAwardedDate===n.MostRecentAwardedDate))>=0||t.length===i.Total){const s=t.map((e=>e.GameID));e=e.filter((e=>!s.includes(e.GameID))),e=[...t,...e],this.cache.push({dataType:Be,data:{Date:new Date,Total:e.length,Results:e,UserName:ds.targetUser||ts.USER_NAME}})}else setTimeout((()=>this.updateCompletionProgress({savedArray:e,completionProgress:t,batchSize:s})),100)}}let ts,ss,is,ns,as=0,os=!0;async function rs(e){const t=await e.getFile();if(t.size<as&&(as=0),t.size>as){const e=t.slice(as,t.size),s=await e.text();as=t.size;const i=function(e){let t,s=[];return e.split("\n").forEach((e=>{if(e.includes("Awarding achievement")){const t=e.match(/(?:Awarding\sachievement\s)(\d+)/);if(t){const e=t[1];s.push(e)}}else if(e.includes("loaded")){const s=e.match(/(?:Game\s)(\d+)(?:\sloaded,\shardcore\s)(enabled|disabled)/);if(s){const e=s[1];os="enabled"===s[2],t={gameID:e,isHardmode:os}}}})),{unlockedCheevos:[...new Set(s)].map((e=>({AchievementID:+e,HardcoreMode:os?1:0,Date:new Date}))),currentGame:t}}(s);return i}return{}}class ls{RP_DATA={text:"",lastChange:""};IS_ONLINE=!0;IS_HARD_MODE=!0;IS_WATCHING=!1;RECENT_ACHIVES_RANGE_MINUTES=10;CHECK_FOR_ONLINE_DELAY_MS=6e4;CHECK_FOR_ONLINE_AFTER_SILENCE_MS=18e4;watcherInterval;playTime={totalGameTime:0,gameTime:0,sessionTime:0,timer:60};points={hardcore:0,softcore:0};zeroCheckTime=new Date;get CHEEVOS(){return this.GAME_DATA?.Achievements??{}}get GAME_DATA(){return this._gameData}set GAME_DATA(e){this.savePlayTime();const t=this.GAME_DATA&&e.ID!=this.GAME_DATA?.ID;this._gameData=e,this.initPlayTime(),ss.gameChangeEvent(t)}constructor(){this.isActive=!1}initPlayTime=()=>{const e=this.GAME_DATA?.ID??0,t=this.GAME_DATA?.TimePlayed;this.playTime={...this.playTime,gameID:e,totalGameTime:t,gameTime:0,timer:60}};gameChangeEvent(){}async checkForOnline(){const e=()=>{this.RP_DATA.lastChange=new Date,this.zeroCheckTime=new Date,!this.IS_ONLINE&&(this.IS_ONLINE=!0,this.checkApiUpdates()),this.IS_ONLINE=!0};if(!ds.pauseIfOnline)return void e();console.log("Checking for online...");const t=(e=>{!/(\+00\:00$)|(z$)/gi.test(e)&&(e+="+00:00");return new Date(e)})((await is.getRecentlyPlayedGames({count:1}))[0].LastPlayed);if(new Date-t<3e5)e();else{if(this.IS_ONLINE=!1,!this.IS_WATCHING)return;setTimeout((()=>this.checkForOnline()),this.CHECK_FOR_ONLINE_DELAY_MS)}}apiTrackerInterval;async checkApiUpdates(e=!1){const t=e=>{this.points.hardcore=e.TotalPoints,this.points.softcore=e.TotalSoftcorePoints};if(!e&&!this.IS_ONLINE)return;const s=await is.getProfileInfo({});(s.LastGameID!=this.GAME_DATA?.ParentGameID||e)&&(ds.gameID=s.LastGameID,e&&t(s),await this.updateGameData(s.LastGameID),ss.showGameChangeAlerts(e)),(e=>e.TotalPoints!=this.points.hardcore||e.TotalSoftcorePoints!=this.points.softcore)(s)?(t(s),this.updateCheevos(),this.RP_DATA.lastChange=new Date,this.zeroCheckTime=new Date):this.GAME_DATA.hasZeroPoints&&new Date-this.zeroCheckTime>6e4&&(this.updateCheevos(),this.zeroCheckTime=new Date);const i=s.RichPresenceMsg;ss.updateWidgetsRichPresence(i),i===this.RP_DATA.text&&ds.pauseIfOnline?!e&&this.RP_DATA.lastChange&&new Date-this.RP_DATA.lastChange>this.CHECK_FOR_ONLINE_AFTER_SILENCE_MS&&await this.checkForOnline():(this.RP_DATA.lastChange=new Date,this.RP_DATA.text=s.RichPresenceMsg,this.IS_ONLINE=!0)}isLogOK=!1;async checkLogUpdates(){const e=e=>{ss.app.appendChild(xt({title:"Info",message:e})),clearInterval(this.logWatcherInterval),this.isLogOK=!1},t=await ts.getFileHandle("rarch");if(!t)return void e("Select log file");let s={};try{s=await rs(t),this.isLogOK=!0}catch{console.warn("log file error"),this.isLogOK=!1}const{unlockedCheevos:i,currentGame:n}=s;i?.length>0&&this.updateCheevos(!0,i)}async updateGameData(e){e||(e=await(async()=>{const e=Object.values(await is.getRecentlyPlayedGames({count:1}))[0]?.ID;return ds.gameID=e,e})());try{const t=await is.getGameInfoAndProgress({gameID:e,withTimesData:!0});this.GAME_DATA=t}catch(e){this.stop,console.error(e)}}async updateCheevos(e=!1,t){const s=e=>{let t=[];e?.forEach((e=>{const s=this.CHEEVOS[e.AchievementID];if(s){const i=1===e.HardcoreMode&&!s?.isHardcoreEarned;(!s.isEarned||i)&&t.push(e)}})),(e=>{e?.forEach((e=>{const{HardcoreMode:t,Date:s}=e,i=this.CHEEVOS[e.AchievementID],n=1==t;this.IS_HARD_MODE=n,n&&(i.isHardcoreEarned=!0,i.DateEarnedHardcore=s,this.GAME_DATA.unlockData.hardcore.count++,this.GAME_DATA.unlockData.hardcore.points+=i.Points,this.GAME_DATA.unlockData.hardcore.retropoints+=i.TrueRatio,i.Type!=ve.PROGRESSION&&i.Type!=ve.WIN||this.GAME_DATA.unlockData.hardcore.progressionCount++),this.GAME_DATA.unlockData.softcore.count++,this.GAME_DATA.unlockData.softcore.points+=i.Points,i.Type!=ve.PROGRESSION&&i.Type!=ve.WIN||this.GAME_DATA.unlockData.softcore.progressionCount++,i.isEarned=!0,i.DateEarned=i.DateEarned??s,this.CHEEVOS[e.AchievementID]=i}))})(t);const s=t?.map((e=>e.AchievementID));return s},i=()=>{let e=[];return"mastered"!==this.GAME_DATA.award&&this.GAME_DATA.unlockData.hardcore.count===this.GAME_DATA.NumAchievements?(this.GAME_DATA.award="mastered",e.push({type:k.AWARD,award:"mastered",value:this.GAME_DATA})):this.GAME_DATA.award||this.GAME_DATA.unlockData.softcore.count!==this.GAME_DATA.NumAchievements||(this.GAME_DATA.award="completed",e.push({type:k.AWARD,award:"completed",value:this.GAME_DATA})),this.GAME_DATA.progressionSteps>0&&"beaten"!==this.GAME_DATA.progressionAward&&this.GAME_DATA.unlockData.hardcore.progressionCount>=this.GAME_DATA.progressionSteps?(this.GAME_DATA.progressionAward="beaten",e.push({type:k.AWARD,award:"beaten",value:this.GAME_DATA})):this.GAME_DATA.progressionSteps>0&&!this.GAME_DATA.progressionAward&&this.GAME_DATA.unlockData.softcore.progressionCount>=this.GAME_DATA.progressionSteps&&(this.GAME_DATA.progressionAward="beaten-softcore",e.push({type:k.AWARD,award:"beaten-softcore",value:this.GAME_DATA})),e},n=()=>{this.GAME_DATA.hasZeroPoints=Object.values(this.CHEEVOS).filter((({Points:e,isHardcoreEarned:t})=>0===e&&!t))?.length>0};try{e||(t=await is.getRecentAchieves({minutes:this.RECENT_ACHIVES_RANGE_MINUTES}));const a=s(t),o=i();if(this.GAME_DATA.hasZeroPoints&&n(),a&&a.length>0){try{ss.showCheevoAlerts(a),ss.showAwardsAlerts(o)}catch(e){}ss.updateWidgets({earnedAchievementsIDs:a,isLog:e})}}catch(e){console.error(e)}}setSubset(e){const t=this.GAME_DATA.subsets?.[e];ts.gamesDB[this.GAME_DATA.ParentGameID]||(ts.gamesDB[this.GAME_DATA.ParentGameID]={}),t&&(ts.gamesDB[this.GAME_DATA.ParentGameID].lastSetID=t,ts.writeConfiguration(),this.updateGameData(t))}start(){const e=()=>{this.IS_ONLINE&&(this.playTime.totalGameTime++,this.playTime.gameTime++,this.playTime.sessionTime++,this.playTime.timer--)},t=()=>{ss.statusPanel.blinkUpdate(),ss.status.blinkUpdate()};this.stop(),(()=>{this.checkApiUpdates(!0),this.IS_WATCHING=!0,ds.parseLog&&(this.logWatcherInterval=setInterval((()=>{this.checkLogUpdates()}),1e3)),this.apiTrackerInterval=setInterval((()=>{t(),this.checkApiUpdates()}),1e3*ds.updateDelaySec)})(),(()=>{this.isActive=!0,this.initPlayTime()})(),ss.statusPanel.timeWatcher().start(),ss.status.timeWatcher().start(),this.watcherInterval=setInterval((()=>{e(),this.playTime.gameTime%60==0&&this.savePlayTime()}),1e3)}stop(){clearInterval(this.apiTrackerInterval),clearInterval(this.logWatcherInterval),this.IS_WATCHING=!1,this.isActive=!1,this.playTime.totalGameTime&&this.savePlayTime(),this.watcherInterval&&clearInterval(this.watcherInterval),this.playTime.sessionTime=0,ss.statusPanel.timeWatcher().stop(),ss.status.timeWatcher().stop()}reset(){this._gameData={...this._gameData,...ts.gamesDB[this._gameData.ID]},this.initPlayTime(),(()=>{const e=!1;ss.statusPanel.gameChangeEvent(e),ss.status?.gameChangeEvent(e),ss.gameList?.gameChangeEvent(),ss.gameCard?.gameChangeEvent(e)})()}resetCheevo(e){ss.target?.refreshCheevo(e)}savePlayTime(){const e=this.playTime.totalGameTime;e>5&&(this.GAME_DATA.TimePlayed=e,ts.gamesDB[this.GAME_DATA.ID]||(ts.gamesDB[this.GAME_DATA.ID]={}),ts.gamesDB[this.GAME_DATA.ID].TimePlayed=e,ts.writeConfiguration())}getActiveTime=(e,t=0)=>{let s=0;const{sessionTime:i,totalGameTime:n,gameTime:a}=this.playTime;switch(e){case"totalSessionTime":s=i;break;case"playTime":s=n;break;case"sessionTime":s=a;break;case"timer":s=t-a}return o(s,!0)}}const cs=navigator.userAgent||navigator.vendor||window.opera;/android/i.test(cs)||/iPhone/.test(cs)&&!window.MSStream?window.location.href="./mobile/index.html":(ts=new Wt,ss=new Vt,is=new es,ns=new ls,window.ui=ss,window.config=ts,window.configData=ts.configData,window.apiWorker=is,window.watcher=ns),ts.identConfirmed||(console.log("redirect to login"),window.location.href="./login");const{configData:ds}=ts})();