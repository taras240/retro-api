/*! For license information please see bundle.min.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Js:()=>C,$W:()=>w,ui:()=>b,VL:()=>R});const t="retroApiConfig";class Config{get version(){return this._cfg.version??"0"}set version(e){this._cfg.version=e,this.writeConfiguration()}get API_KEY(){return this._cfg.identification.RAApi_key}set API_KEY(e){this._cfg.identification.RAApi_key=e,this.writeConfiguration()}get USER_NAME(){return this._cfg.identification.RAApi_login}set USER_NAME(e){this._cfg.identification.RAApi_login=e,this.writeConfiguration()}get identConfirmed(){return this._cfg.identification.identConfirmed??!1}set identConfirmed(e){this._cfg.identification.identConfirmed=e,this.writeConfiguration()}get DISCORD_WEBHOOK(){return this._cfg.discordWebhook}set DISCORD_WEBHOOK(e){this._cfg.discordWebhook=e,this.writeConfiguration()}get userImageSrc(){return this._cfg.identification.userImageSrc||""}set userImageSrc(e){this._cfg.identification.userImageSrc=e,this.ui.buttons&&(ui.buttons.userImage.src=e),this.writeConfiguration()}get startOnLoad(){return this._cfg.settings.startOnLoad}set startOnLoad(e){this._cfg.settings.startOnLoad=e,this.writeConfiguration()}get targetUser(){return this._cfg.settings.targetUser||this.USER_NAME}set targetUser(e){this._cfg.settings.targetUser=e,this.writeConfiguration(),this.identConfirmed&&(ui.settings.getLastGameID(),ui.awards.updateAwards())}get gameID(){return this._cfg.settings.gameID}set gameID(e){this._cfg.settings.gameID=e,this.writeConfiguration()}get updateDelay(){const e=this._cfg.settings.updateDelay;return e<5?5:e}get updateDelayInMiliSecs(){return 1e3*this._cfg.settings.updateDelay}set updateDelay(e){let t=parseInt(e)>0?e:10;this._cfg.settings.updateDelay=t,this.writeConfiguration()}get bgVisibility(){return this._cfg.settings.bgVisibility??!0}set bgVisibility(e){this._cfg.settings.bgVisibility=e,this.writeConfiguration()}get targetMoveToTop(){return this._cfg.settings.targetMoveToTop}set targetMoveToTop(e){this._cfg.settings.targetMoveToTop=e,this.writeConfiguration()}get aotw(){const e=this._cfg.aotw;return!!(e&&function(e){const t=new Date,s=new Date;return s.setDate(t.getDate()-7),new Date(e)>s}(e.StartAt))&&this._cfg.aotw}set aotw(e){this._cfg.aotw=e,this.writeConfiguration()}get ui(){return this._cfg.ui}get mainColor(){return this._cfg.settings.mainColor??s.default.mainColor}get secondaryColor(){return this._cfg.settings.secondaryColor??s.default.secondaryColor}get accentColor(){return this._cfg.settings.accentColor??s.default.accentColor}get fontColor(){return this._cfg.settings.fontColor??s.default.fontColor}get selectionColor(){return this._cfg.settings.selectionColor??s.default.selectionColor}set mainColor(e){this._cfg.settings.mainColor=e,this.writeConfiguration()}set secondaryColor(e){this._cfg.settings.secondaryColor=e,this.writeConfiguration()}set accentColor(e){this._cfg.settings.accentColor=e,this.writeConfiguration()}set fontColor(e){this._cfg.settings.fontColor=e,this.writeConfiguration()}set selectionColor(e){this._cfg.settings.selectionColor=e,this.writeConfiguration()}get colorsPreset(){return this._cfg.settings.preset||"default"}set colorsPreset(e){this._cfg.settings.preset=e,this.writeConfiguration()}constructor(){this.readConfiguration()}getColors(e){return this.colorsPreset=e,"custom"===e?{mainColor:this.mainColor,secondaryColor:this.secondaryColor,accentColor:this.accentColor,fontColor:this.fontColor,selectionColor:this.selectionColor}:s[e]||s.default}setNewPosition({id:e,xPos:t,yPos:s,width:i,height:n,hidden:a}){this._cfg.ui.hasOwnProperty(e)||(this._cfg.ui[e]={id:e,x:t,y:s,width:i,height:n,hidden:a}),t&&(this._cfg.ui[e].x=t),s&&(this._cfg.ui[e].y=s),i&&(this._cfg.ui[e].width=i+"px"),n&&(this._cfg.ui[e].height=n+"px"),void 0!==a&&(this._cfg.ui[e].hidden=a),this.writeConfiguration()}readConfiguration(){let e=JSON.parse(localStorage.getItem(t));e||(e={identification:{RAApi_key:"",RAApi_login:""},settings:{updateDelay:5,sort:"default",gameID:1,ACHIV_MAX_SIZE:150,ACHIV_MIN_SIZE:30},ui:{}}),this._cfg=e,localStorage.setItem(t,JSON.stringify(this._cfg)),this.writeConfiguration()}saveUIProperty({sectionID:e,property:t,value:s}){e&&t&&(this.ui[e][t]=s,this.writeConfiguration())}getUIProperty({sectionID:e,property:t}){if(e&&t)return this.ui[e]?this.ui[e][t]:void 0}delayedWrite;writeConfiguration(){clearTimeout(this.delayedWrite),this.delayedWrite=setTimeout((()=>{localStorage.setItem(t,JSON.stringify(this._cfg))}),1e3)}}const s={default:{mainColor:"#171A21",secondaryColor:"#202329",accentColor:"#3663D8",fontColor:"#d6d6d6",selectionColor:"#2c303d"},blue:{mainColor:"#070F2B",secondaryColor:"#1B1A55",accentColor:"#535C91",fontColor:"#eeeeee",selectionColor:"#9290C3"},retro:{mainColor:"#1D2B53",secondaryColor:"#333A73",accentColor:"#387ADF",fontColor:"#cdcdcd",selectionColor:"#FBA834"},vintage:{mainColor:"#222831",secondaryColor:"#31363F",accentColor:"#76ABAE",fontColor:"#eeeeee",selectionColor:"#EEEEEE"},pastel:{mainColor:"#51829B",secondaryColor:"#9BB0C1",accentColor:"#F6995C",fontColor:"#000",selectionColor:"#EADFB4"},lightgreen:{mainColor:"#C5EBAA",secondaryColor:"#A5DD9B",accentColor:"#F2C18D",fontColor:"#000000",selectionColor:"#F6F193"},lightblue:{mainColor:"#A0E9FF",secondaryColor:"#89CFF3",accentColor:"#00A9FF",fontColor:"#000000",selectionColor:"#CDF5FD"},synthwave:{mainColor:"#5D0E41",secondaryColor:"#A0153E",accentColor:"#FF204E",fontColor:"#dedede",selectionColor:"#00224D"},brown:{mainColor:"#481E14",secondaryColor:"#9B3922",accentColor:"#0C0C0C",fontColor:"#eeeeee",selectionColor:"#F2613F"},neon:{mainColor:"#7E2553",secondaryColor:"#FF004D",accentColor:"#FAEF5D",fontColor:"#000000",selectionColor:"#50C4ED"},gray:{mainColor:"#808080",secondaryColor:"#757575",accentColor:"#cfcfcf",fontColor:"#000000",selectionColor:"#2ab754"},black:{mainColor:"#050505",secondaryColor:"#202329",accentColor:"#0a7ff5",fontColor:"#ffffff",selectionColor:"#083b82"}},i={gameCard:"./elements/gameCard.elem",panel:"./elements/side-panel.elem",status:"./elements/status.elem",games:"./elements/games.elem",note:"./elements/note.elem",notification:"./elements/notification.elem",stats:"./elements/stats.elem",statusV2:"./elements/statusV2.elem"};class Widget{widgetIcon={imageSource:"../assets/img/gamepad.svg",iconID:"widget-id",iconClass:"gamepad-icon",onChangeEvent:""};get VISIBLE(){return!this.section.classList.contains("hidden")&&!!w.ui[this.section?.id]}set VISIBLE(e){ui_UI.switchSectionVisibility({section:this.section,visible:e}),this.widgetIcon.element&&(this.widgetIcon.element.checked=e)}constructor(){}addEvents(){this.section.addEventListener("mousedown",(e=>{e.stopPropagation(),e.target.matches(".resizer")?(this.section.classList.add("resized"),ui_UI.resizeEvent({event:e,section:this.section})):e.target.matches(".close-icon")?this.close():e.target.matches(".tweak-button")?this.contextMenuItems&&b.settings.openSettings(this.contextMenuItems):e.target.closest(".header-container")&&ui_UI.moveEvent(this.section,e)}))}addWidgetIcon(){const e=!1===w.ui?.[this.section?.id]?.hidden??!this.VISIBLE,{iconID:t,onChangeEvent:s,description:i,iconClass:n,badgeLabel:a}=this.widgetIcon,o=document.querySelector(".buttons-block__shortcuts"),r=document.createElement("div");r.classList.add("setting-radio-group"),r.innerHTML=`\n            <input type="checkbox" name="${t}" id="${t}" onchange="${s}" ${e?"checked":""}></input>\n            <label class="side-panel_input" data-title="${i}" for="${t}">\n                    <i class="side-panel__icon ${n}"></i>\n            </label>\n            <div class="side-panel__badge">\n                ${a?A.black(a):""}\n            </div>`,o.appendChild(r),this.widgetIcon.element=document.getElementById(t)}generateWidgetElement({classes:e,id:t,title:s,headerElementsHtml:i,contentClasses:n}){const a=document.createElement("section");return a.classList.add(...e),a.id=t,a.innerHTML=`\n            <div class="header-container">\n                <div class="header-icon ${this.widgetIcon.iconClass}"></div>\n                <h2 class="widget-header-text">${s}</h2>\n                ${i??""}\n                <button class="header-icon header-button close-icon"></button>\n            </div>\n            <div class="${n?n.join(" "):"widget-content__container"}"></div>\n            <div class="resizer"></div>`,a}open(){}close(){this.VISIBLE=!1}}class AchievementsBlock extends Widget{widgetIcon={description:"cheevos widget",iconClass:"achievements-icon"};get contextMenuItems(){return[{label:b.lang.style,elements:[{type:"checkbox",name:"context-show-load-anim",id:"context-show-load-anim",label:b.lang.showLoadAnimation,checked:this.SHOW_LOAD_ANIMATION,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].SHOW_LOAD_ANIMATION = this.checked"`},{type:"checkbox",name:"context-show-mario",id:"context-show-mario",label:b.lang.showMario,checked:this.SHOW_MARIO,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].SHOW_MARIO = this.checked"`},{type:"checkbox",name:"context_autoscroll-achieves",id:"context_autoscroll-achieves",label:b.lang.autoscroll,checked:this.AUTOSCROLL,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].AUTOSCROLL = this.checked;"`},{type:"checkbox",name:"context_stretch-achieves",id:"context_stretch-achieves",label:b.lang.stretch,checked:this.ACHIV_STRETCH,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].ACHIV_STRETCH = this.checked;"`},{prefix:b.lang.minSize,postfix:"px",type:"input-number",id:"context-menu_min-size",label:b.lang.minSize,value:this.ACHIV_MIN_SIZE,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].ACHIV_MIN_SIZE = this.value;"`,onChange:`ui.achievementsBlock[${this.CLONE_NUMBER}].ACHIV_MIN_SIZE = this.value;`},{prefix:b.lang.maxSize,postfix:"px",type:"input-number",id:"context-menu_max-size",label:b.lang.maxSize,value:this.ACHIV_MAX_SIZE,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].ACHIV_MAX_SIZE = this.value;"`,onChange:`ui.achievementsBlock[${this.CLONE_NUMBER}].ACHIV_MAX_SIZE = this.value;`}]},{label:b.lang.elements,elements:[{label:b.lang.showHeader,type:"checkbox",name:"context_hide-achivs-header",id:"context_hide-achivs-header",checked:this.SHOW_HEADER,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].SHOW_HEADER = this.checked;"`},{label:b.lang.showBackground,type:"checkbox",name:"context_show-bg",id:"context_show-bg",checked:this.BG_VISIBILITY,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].BG_VISIBILITY = this.checked;"`}]},{label:b.lang.overlaySet,elements:[{type:"checkbox",name:"context-hide-unearned",id:"context-hide-unearned",label:b.lang.showOverlay,checked:this.SHOW_PREV_OVERLAY,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].SHOW_PREV_OVERLAY = this.checked"`},...Object.keys(this.overlayTypes).reduce(((e,t)=>{const s={type:"radio",name:"context-achieves-overlay",id:`context-achieves-overlay-${t}`,label:`${this.overlayTypes[t].name}`,checked:this.OVERLAY_TYPE==t,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].OVERLAY_TYPE = '${t}'"`};return e.push(s),e}),[])]},{label:b.lang.sort,elements:[{type:"radio",name:"context-sort",id:"context-sort_latest",label:b.lang.latest,checked:this.SORT_NAME===ui_UI.sortMethods.latest,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].SORT_NAME = 'latest';"`},{type:"radio",name:"context-sort",id:"context-sort_rarest",label:b.lang.rarest,checked:this.SORT_NAME===ui_UI.sortMethods.earnedCount,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].SORT_NAME = 'earnedCount';"`},{type:"radio",name:"context-sort",id:"context-sort_points",label:b.lang.points,checked:this.SORT_NAME===ui_UI.sortMethods.points,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].SORT_NAME = 'points';"`},{type:"radio",name:"context-sort",id:"context-sort_retropoints",label:b.lang.retropoints,checked:this.SORT_NAME===ui_UI.sortMethods.truepoints,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].SORT_NAME = 'truepoints';"`},{type:"radio",name:"context-sort",id:"context-sort_default",label:b.lang.default,checked:this.SORT_NAME===ui_UI.sortMethods.default,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].SORT_NAME = 'default';"`},{type:"radio",name:"context-sort",id:"context-sort_level",label:b.lang.level,checked:this.SORT_NAME===ui_UI.sortMethods.level,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].SORT_NAME = 'level';"`},{type:"radio",name:"context-sort",id:"context-sort_disable",label:b.lang.disable,checked:this.SORT_NAME===ui_UI.sortMethods.disable,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].SORT_NAME = 'disable';"`},{type:"checkbox",name:"context-reverse-sort",id:"context-reverse-sort",label:b.lang.reverse,checked:-1==this.REVERSE_SORT,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].REVERSE_SORT = this.checked"`}]},{label:b.lang.filter,elements:[{type:"radio",name:"context-filter",id:"context_filter-progression",label:b.lang.progression,checked:this.FILTER_NAME===ui_UI.filterMethods.progression,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].FILTER_NAME = 'progression';"`},{type:"radio",name:"context-filter",id:"context_filter-missable",label:b.lang.missable,checked:this.FILTER_NAME===ui_UI.filterMethods.missable,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].FILTER_NAME = 'missable';"`},{type:"radio",name:"context-filter",id:"context_filter-earned",label:b.lang.earned,checked:this.FILTER_NAME===ui_UI.filterMethods.earned,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].FILTER_NAME = 'earned';"`},{type:"radio",name:"context-filter",id:"context_filter-all",label:b.lang.all,checked:this.FILTER_NAME===ui_UI.filterMethods.all,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].FILTER_NAME = 'all';"`},{type:"checkbox",name:"context-reverse-filter",id:"context-reverse-filter",label:b.lang.reverse,checked:this.REVERSE_FILTER,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].REVERSE_FILTER = this.checked;"`},{type:"checkbox",name:"context-hide-filtered",id:"context-hide-filtered",label:b.lang.hideFiltered,checked:this.HIDE_FILTERED,event:`onchange="ui.achievementsBlock[${this.CLONE_NUMBER}].HIDE_FILTERED = this.checked;"`}]}]}get OVERLAY_TYPE(){return w?.ui[this.SECTION_NAME]?.overlayType??"border"}set OVERLAY_TYPE(e){w.ui[this.SECTION_NAME].overlayType=e,w.writeConfiguration(),this.updateOverlay()}overlayTypes={border:{name:"Border",link:"../assets/img/border/overlay_sets/",closedLink:"../assets/img/overlay_sets/border/closed-1.png",earnedSoftcoreLink:"../assets/img/overlay_sets/border/earned_soft.png",earnedHardcoreLink:"../assets/img/overlay_sets/border/earned.png"},digger:{name:"Digger"},mario_q:{name:"Mario '?'",link:"../assets/img/mario_q/overlay_sets/",closedLink:"../assets/img/overlay_sets/mario_q/closed.webp",earnedSoftcoreLink:"../assets/img/overlay_sets/mario_q/earned_soft.webp",earnedHardcoreLink:"../assets/img/overlay_sets/mario_q/earned.webp"},cd_box:{name:"C&D Box",link:"../assets/img/cd_box/",closedLink:"../assets/img/overlay_sets/cd_box/closed.png",earnedSoftcoreLink:"../assets/img/overlay_sets/cd_box/earned_soft.png",earnedHardcoreLink:"../assets/img/overlay_sets/cd_box/earned.png"},kirby:{name:"Kirby",link:"../assets/img/kirby/",closedLink:"../assets/img/overlay_sets/kirby/closed.png",earnedSoftcoreLink:"../assets/img/overlay_sets/kirby/earned_soft.png",earnedHardcoreLink:"../assets/img/overlay_sets/kirby/earned.png"},megaman:{name:"Megaman",link:"../assets/img/megaman/",closedLink:"../assets/img/overlay_sets/megaman/closed.png",earnedSoftcoreLink:"../assets/img/overlay_sets/megaman/earned_soft.png",earnedHardcoreLink:"../assets/img/overlay_sets/megaman/earned.png"},sonic:{name:"Sonic",link:"../assets/img/sonic/",closedLink:"../assets/img/overlay_sets/sonic/closed.png",earnedSoftcoreLink:"../assets/img/overlay_sets/sonic/earned_soft.png",earnedHardcoreLink:"../assets/img/overlay_sets/sonic/earned.png"}};set SORT_NAME(e){w._cfg.ui[this.SECTION_NAME].sortAchievementsBy=e,w.writeConfiguration(),this.applySorting()}get SORT_NAME(){return w?.ui[this.SECTION_NAME]?.sortAchievementsBy||ui_UI.sortMethods.default}get SORT_METHOD(){return ui_UI.sortBy[this.SORT_NAME]}set FILTER_NAME(e){w.ui[this.SECTION_NAME].filterBy=e,w.writeConfiguration(),this.applyFilter()}get FILTER_NAME(){return w?.ui[this.SECTION_NAME]?.filterBy||ui_UI.filterMethods.all}get FILTER_METHOD(){return ui_UI.filterBy[this.FILTER_NAME]}get HIDE_FILTERED(){return w?.ui[this.SECTION_NAME]?.hideFiltered??!1}set HIDE_FILTERED(e){w.ui[this.SECTION_NAME].hideFiltered=e,w.writeConfiguration(),this.applyFilter()}get REVERSE_SORT(){return w?.ui[this.SECTION_NAME]?.reverseSort||1}set REVERSE_SORT(e){w.ui[this.SECTION_NAME].reverseSort=e?-1:1,w.writeConfiguration(),this.applySorting()}get REVERSE_FILTER(){return w?.ui[this.SECTION_NAME]?.reverseFilter??!1}set REVERSE_FILTER(e){w.ui[this.SECTION_NAME].reverseFilter=e,w.writeConfiguration(),this.applyFilter()}get ACHIV_MIN_SIZE(){return w?.ui[this.SECTION_NAME]?.ACHIV_MIN_SIZE??30}set ACHIV_MIN_SIZE(e){+e>10&&(w.ui[this.SECTION_NAME].ACHIV_MIN_SIZE=e,w.writeConfiguration(),this.fitSizeVertically())}get ACHIV_MAX_SIZE(){return w?.ui[this.SECTION_NAME]?.ACHIV_MAX_SIZE??150}set ACHIV_MAX_SIZE(e){+e>+this.ACHIV_MIN_SIZE&&(w.ui[this.SECTION_NAME].ACHIV_MAX_SIZE=e,w.writeConfiguration(),this.fitSizeVertically())}get ACHIV_STRETCH(){return w?.ui[this.SECTION_NAME]?.stretchAchievements??!1}set ACHIV_STRETCH(e){w.ui[this.SECTION_NAME].stretchAchievements=e,w.writeConfiguration(),this.container.style.height=this.ACHIV_STRETCH?"100%":"auto"}get BG_VISIBILITY(){return w?.ui[this.SECTION_NAME]?.bgVisibility??!0}set BG_VISIBILITY(e){w.ui[this.SECTION_NAME].bgVisibility=e,w.writeConfiguration(),this.section.classList.toggle("hide-bg",!this.BG_VISIBILITY)}get SHOW_HEADER(){return w?.ui[this.SECTION_NAME]?.showHeader??!0}set SHOW_HEADER(e){w.ui[this.SECTION_NAME].showHeader=e,w.writeConfiguration(),this.section.classList.toggle("compact",!this.SHOW_HEADER)}get AUTOSCROLL(){return w?.ui[this.SECTION_NAME]?.autoscroll??!0}set AUTOSCROLL(e){w.ui[this.SECTION_NAME].autoscroll=e,e?this.startAutoScroll():this.stopAutoScroll()}get SMART_AUTOSCROLL(){return!1}set SMART_AUTOSCROLL(e){w.ui[this.SECTION_NAME].smartAutoscroll=e,this.stopAutoScroll(),this.startAutoScroll()}get SHOW_PREV_OVERLAY(){return w.ui[this.SECTION_NAME]?.showPrevOverlay??!0}set SHOW_PREV_OVERLAY(e){w.ui[this.SECTION_NAME].showPrevOverlay=e,w.writeConfiguration(),this.container.querySelectorAll(".achiv-block").forEach((t=>t.classList.toggle("overlay",e)))}get SHOW_MARIO(){return w.ui[this.SECTION_NAME]?.showMario??!0}set SHOW_MARIO(e){w.ui[this.SECTION_NAME].showMario=e,w.writeConfiguration()}get SHOW_LOAD_ANIMATION(){return w.ui[this.SECTION_NAME]?.showLoadAnimation??!0}set SHOW_LOAD_ANIMATION(e){w.ui[this.SECTION_NAME].showLoadAnimation=e,w.writeConfiguration()}get SECTION_NAME(){return 0===this.CLONE_NUMBER?"achievements_section":`achievements_section-${this.CLONE_NUMBER}`}get CLONE_NUMBER(){return this._cloneNumber}set CLONE_NUMBER(e){this._cloneNumber=e?.length?e.length:0,this.widgetIcon={...this.widgetIcon,iconID:`side-panel__cheevos-${this.CLONE_NUMBER}`,onChangeEvent:`ui.achievementsBlock[${this.CLONE_NUMBER}].VISIBLE = this.checked`}}constructor(e=!1){super(),this.CLONE_NUMBER=b.achievementsBlock,this.isClone=e,this.addWidgetIcon(),this.initializeElements(),this.addEvents(),this.setValues()}initializeElements(){this.section=this.generateNewWidget({}),document.querySelector(".wrapper").appendChild(this.section),this.container=this.section.querySelector(".achievements-container"),this.resizer=this.section.querySelector(`#achivs-resizer${this.CLONE_NUMBER}`)}addEvents(){this.section.querySelector(".header-container").addEventListener("mousedown",(e=>{e.target.matches(".close-icon")?this.close():ui_UI.moveEvent(this.section,e)})),this.section.addEventListener("contextmenu",(e=>{b.showContextmenu({event:e,menuItems:this.contextMenuItems,sectionCode:this.CLONE_NUMBER})})),this.resizer.addEventListener("mousedown",(e=>{e.stopPropagation(),this.section.classList.add("resized"),this.stopAutoScroll(),ui_UI.resizeEvent({event:e,section:this.section,callback:()=>{this.fitSizeVertically(!0)}})})),this.resizer.addEventListener("mouseup",(()=>{this.startAutoScroll()})),new Sortable(this.container,{group:{name:"cheevos",pull:"clone",push:"false"},animation:100,chosenClass:"dragged"})}setValues(){ui_UI.applyPosition({widget:this}),this.section.classList.toggle("hide-bg",!this.BG_VISIBILITY),this.section.classList.toggle("compact",!this.SHOW_HEADER),w.ui[this.SECTION_NAME]&&(this.section.style.top=w.ui[this.SECTION_NAME].y??"0px",this.section.style.left=w.ui[this.SECTION_NAME].x??"0px",this.section.style.height=w.ui[this.SECTION_NAME].height??"600px",this.section.style.width=w.ui[this.SECTION_NAME].width??"350px"),this.container.style.height=this.ACHIV_STRETCH?"100%":"auto",this.AUTOSCROLL&&this.startAutoScroll(),this.updateOverlay()}updateOverlay(){this.section.dataset.overlay=this.OVERLAY_TYPE}parseGameAchievements(e){(()=>{this.container.innerHTML=""})(),(e=>{Object.values(e.Achievements).forEach((e=>{const t=this.generateAchievement(e);this.container.appendChild(t)}))})(e),this.fitSizeVertically(),this.applyFilter(),this.applySorting(),this.SHOW_LOAD_ANIMATION&&this.doLoadAnimation(),this.startAutoScroll()}generateAchievement(e){const t=document.createElement("li");var s;return s=this,t.classList.add("achiv-block"),t.classList.toggle("start-load-anim",s.SHOW_LOAD_ANIMATION),t.classList.toggle("overlay",s.SHOW_PREV_OVERLAY),t.classList.toggle("earned",e.isEarned),t.classList.toggle("hardcore",e.isHardcoreEarned),t.classList.toggle("rare",e.TrueRatio>100),t.dataset.achivId=e.ID,t.dataset.Points=e.Points,t.dataset.TrueRatio=e.TrueRatio,e.TrueRatio>50&&(t.dataset.rarity="normal"),e.TrueRatio>150&&(t.dataset.rarity="rare"),e.TrueRatio>300&&(t.dataset.rarity="mythycal"),t.dataset.DisplayOrder=e.DisplayOrder,t.dataset.type=e.type,e.level&&(t.dataset.level=e.level),t.dataset.NumAwardedHardcore=e.NumAwardedHardcore,e.DateEarnedHardcore&&(t.dataset.DateEarnedHardcore=e.DateEarnedHardcore),e.DateEarned&&(t.dataset.DateEarned=e.DateEarned),t.innerHTML=`\n        <div class="preview-container">\n          <img class="achiv-preview" src="${e.prevSrc}"  alt="${e.Title} icon"/>\n        </div>\n        `,t}async moveToTop(e){if(this.container.offsetHeight<this.container.scrollHeight)return void this.applySorting();const t=-1===this.REVERSE_SORT;this.container.style.setProperty("--duration","1000ms");const s=e,i=this.container.querySelector(".achiv-block"),n=this.container.querySelector(".achiv-block:last-of-type"),a=document.createElement("li"),o=document.createElement("li");a.classList.add("shrink-element"),o.classList.add("grow-element");const r=t?n.offsetLeft:i.offsetLeft,c=t?n.offsetTop:i.offsetTop,l=s.offsetLeft,d=s.offsetTop;s.style.left=l+"px",s.style.top=d+"px",s.classList.add("move"),t?this.container.append(o):this.container.prepend(o),this.container.insertBefore(a,s),await h(50),s.style.left=r+"px",s.style.top=c+"px",await h(1100),o.remove(),a.remove(),s.classList.remove("move"),s.style.left="auto",s.style.top="auto",t?this.container.append(s):this.container.prepend(s),this.applyFilter()}fitSizeVertically(e=!1){const{section:t,container:s}=this;let i,n;s.style.flex="1",e||!w.ui[this.SECTION_NAME]?.height?(i=s.clientHeight,n=s.clientWidth):(i=parseInt(w.ui[this.SECTION_NAME].height)-t.querySelector(".header-container").clientHeight,n=parseInt(w.ui[this.SECTION_NAME].width)),s.style.flex="";const a=s.querySelectorAll(".achiv-block:not(.removed)").length;if(0===a)return;let o,r,c=Math.floor(Math.sqrt(n*i/a));do{c--,o=Math.floor(i/(c+2)),r=Math.floor(n/(c+2))}while(o*r<a&&c>this.ACHIV_MIN_SIZE);c=c<this.ACHIV_MIN_SIZE?this.ACHIV_MIN_SIZE:c>this.ACHIV_MAX_SIZE?this.ACHIV_MAX_SIZE:c,this.section.style.setProperty("--achiv-height",c+"px")}autoscrollInterval={};async updateEarnedAchieves({earnedAchievementIDs:e}){await h(500),this.stopAutoScroll();for(let t of e){const e=this.container.querySelector(`.achiv-block[data-achiv-id="${t}"]`);this.SHOW_MARIO&&this.isAchieveVisible(e)&&R.CHEEVOS[t].isHardcoreEarned?await this.marioAction(e):e.classList.add("earned",R.CHEEVOS[t].isHardcoreEarned?"hardcore":"f"),this.SORT_NAME==ui_UI.sortMethods.latest&&await this.moveToTop(e),R.CHEEVOS[t].DateEarnedHardcore&&(e.dataset.DateEarnedHardcore=R.CHEEVOS[t].DateEarnedHardcore)}this.applyFilter(),this.startAutoScroll()}async marioAction(e){const t=document.createElement("div");t.classList.add("mario__container","stand"),this.container.appendChild(t);const s=t.getBoundingClientRect().width,i=e?.getBoundingClientRect(),n={xPos:i.left,yPos:i.top+s},a=2*s,o=i.left>window.innerWidth/2,r={xPos:o?window.innerWidth+s:-s,yPos:n.yPos+a},c=70;let l=Math.sqrt(20*a);t.style.top=r.yPos+"px",t.style.left=r.xPos+"px";const d=()=>{const t=document.createElement("div");t.classList.add("coin__container"),t.innerHTML=`\n        <div class='coins__points'>+${e.dataset.TrueRatio}RP</div>\n        <div class='coins__coin'></div>\n        `,this.container.appendChild(t),t.style.top=i.top-i.height/2+"px",t.style.left=n.xPos+"px",e?.classList.add("earned","hardcore","mario-dumb"),setTimeout((()=>e?.classList.remove("mario-dumb")),500),setTimeout((()=>t.remove()),5e3)};await(async()=>{let e=r.xPos;for(t.classList.remove("stand"),t.classList.add("walk"),t.classList.toggle("to-left",o),t.style.setProperty("--frame-duration","70ms");e!==n.xPos;)o?(e-=20,e<n.xPos&&(e=n.xPos)):(e+=20,e>n.xPos&&(e=n.xPos)),t.style.left=e+"px",await h(c);t.classList.remove("walk"),t.classList.add("stand"),await h(500)})(),await(async()=>{t.classList.remove("stand"),t.classList.add("jump");let e=r.yPos;for(;~~l>0;)e-=l,l-=10,e<n.yPos?(e=n.yPos-2,t.style.top=e+"px"):(t.style.top=e+"px",await h(c));for(d(),l=0;e<r.yPos;)e+=l,l+=10,e>r.yPos&&(e=r.yPos),t.style.top=e+"px",await h(c);t.classList.remove("jump"),t.classList.add("stand"),await h(500),t.classList.toggle("to-left",!o),await h(500)})(),await(async()=>{let e=t.getBoundingClientRect().left;for(t.style.setProperty("--frame-duration","52.5ms"),t.className=`mario__container walk ${o?"":"to-left"} `;e!==r.xPos;)o?(e+=20,e>r.xPos&&(e=r.xPos)):(e-=20,e<r.xPos&&(e=r.xPos)),t.style.left=e+"px",await h(52.5)})(),t.remove(),await h(100)}startAutoScroll(e=!0){if(clearTimeout(this.autoscrollInterval.timeout),clearInterval(this.autoscrollInterval.interval),this.SMART_AUTOSCROLL&&this.isAllEarnedAchievesVisible())return void(this.autoscrollInterval.timeout=setTimeout((()=>this.startAutoScroll(e)),3e4));let t=this.container,s=1;this.AUTOSCROLL&&(this.autoscrollInterval.interval=setInterval((()=>{t.scrollHeight-t.clientHeight<=10&&this.stopAutoScroll(),e?(t.scrollTop+=s,t.scrollTop+t.clientHeight>=t.scrollHeight&&(clearInterval(this.autoscrollInterval.interval),this.autoscrollInterval.timeout=setTimeout((()=>this.startAutoScroll(!1)),5e3))):(t.scrollTop-=s,0===t.scrollTop&&(clearInterval(this.autoscrollInterval.interval),this.autoscrollInterval.timeout=setTimeout((()=>this.startAutoScroll(!0)),5e3)))}),50),t.addEventListener("mouseenter",(()=>{s=0})),t.addEventListener("mouseleave",(()=>{s=1})))}stopAutoScroll(){clearInterval(this.autoscrollInterval.interval),clearTimeout(this.autoscrollInterval.timeout)}isAllEarnedAchievesVisible(){let e=!0;return this.container.querySelectorAll(".earned").forEach((t=>{!this.isAchieveVisible(t)&&(e=!1)})),e}isAchieveVisible(e){let t=!0;const s=this.container.getBoundingClientRect().top,i=this.container.getBoundingClientRect().height,n=e.getBoundingClientRect().top-s,a=e.getBoundingClientRect().top-s+e.getBoundingClientRect().height;return(n<0||a>i)&&(t=!1),t}highlightCurrentLevel(e){[...this.container.querySelectorAll(".achiv-block")].forEach((t=>{if(t.classList.remove("highlight"),t.dataset.level==e&&t.classList.add("highlight"),!Number.isInteger(e)){const s=parseInt(e);t.dataset.level==s&&t.classList.add("highlight")}}))}applySorting(){ui_UI.applySort({container:this.container,itemClassName:".achiv-block",sortMethod:this.SORT_METHOD,reverse:this.REVERSE_SORT})}applyFilter(){ui_UI.applyFilter({container:this.container,itemClassName:".achiv-block",filterMethod:this.FILTER_METHOD,reverse:this.REVERSE_FILTER,isHide:this.HIDE_FILTERED}),this.fitSizeVertically()}doLoadAnimation(){const e=this.container,t=e.querySelectorAll(".achiv-block");const s=e=>new Promise((t=>setTimeout(t,e)));setTimeout((()=>function(){const i=e.scrollHeight;e.style.setProperty("--top-position",-i+"px");let n=0;[...t].reverse().forEach((async e=>{const t=100*n+200;!e.classList.contains("removed")&&n++;const i=t+1e3;e.style.setProperty("--load-delay",t+"ms"),e.classList.add("start-load-anim"),await s(50),e.classList.add("show-load-anim"),await s(i+500),e.classList.remove("show-load-anim","start-load-anim")}))}()),0)}generateNewWidget({}){const e=document.createElement("section");return e.id=`${this.SECTION_NAME}`,e.classList.add("achivs","section"),e.style.width=w.ui.achievements_section?.width??"350px",e.style.height=w.ui.achievements_section?.height??"650px",e.innerHTML=`\n        <div class="header-container achievements-header_container">\n          <div class="header-icon achievements-icon">\n          </div>\n          <h2 class="widget-header-text achivs-header-text">Cheevos${0===this.CLONE_NUMBER?"":" ~"}</h2>\n        <button class="header-button header-icon tweak-icon tweak-button" onclick="ui.settings.openSettings(ui.achievementsBlock[${this.CLONE_NUMBER}].contextMenuItems)">\n               \n        </button>\n          <button class="header-button header-icon close-icon">\n          </button>\n        </div>\n        <ul class="achievements-container content-container"></ul>\n        <div class="resizer" id="achivs-resizer${this.CLONE_NUMBER}"></div>\n      `,e}}class PopupWindow extends Widget{widgetIcon={iconClass:"info-icon"};constructor(e){super(),this.generatePopupElement(e),this.initializeElements(),this.addEvents(),this.VISIBLE=!0,ui_UI.applyPosition({widget:this})}generatePopupElement({id:e,title:t,content:s}){this.close(e);const i=document.createElement("section");i.classList.add("popup-section","section"),i.id=e,i.innerHTML=`\n            <div class="header-container">\n                <div class="header-icon ${this.widgetIcon.iconClass}"></div>\n                <h2 class="widget-header-text">${t}</h2>\n                <button class="header-icon header-button close-icon"></button>\n            </div>\n            <div class="widget-content__container">\n                ${s}\n            </div>\n            <div class="resizer"></div>`,this.section=i,b.app.appendChild(i)}initializeElements(){}addEvents(){super.addEvents(),this.section.addEventListener("click",(e=>{if(e.target.matches(".comment__copy-button")){const t=e.target.parentElement?.innerText;navigator.clipboard.writeText(t||"")}else if(e.target.matches(".comment__note-button")){const t=e.target.parentElement?.innerText,s=R.GAME_DATA?.ID||"main";let i=w.getUIProperty({sectionID:"note_section",property:"game_notes"})[s]||"";i+="\n-----------------\n"+t+"\n-----------------\n",b.note.saveNoteValue({id:s,value:i.trim()}),b.note.switchActiveTab(),b.note.switchActiveTab()}}))}close(e){e?document.querySelector(`#${e}`)?.remove():super.close()}}class Target extends Widget{sectionCode="-target";widgetIcon={description:"target widget",iconID:"side-panel__target",onChangeEvent:"ui.target.VISIBLE = this.checked",iconClass:"target-icon"};get contextMenuItems(){return[{label:b.lang.style,elements:[{label:b.lang.showBackground,type:"checkbox",name:"context_hide-target-bg",id:"context_hide-target-bg",checked:!this.HIDE_BG,event:'onchange="ui.target.HIDE_BG = !this.checked;"'},{type:"checkbox",name:"context_fixed-count-switcher",id:"context_fixed-count-switcher",label:"**Fixed size**",checked:this.IS_FIXED_SIZE,event:'onchange="ui.target.IS_FIXED_SIZE = this.checked;"'},{prefix:"**Count: ",postfix:"",type:"input-number",name:"context-fixed-count",id:"context-fixed-count",label:"**Count of cheevos**",value:this.FIXED_COUNT,event:'onchange="ui.target.FIXED_COUNT = this.value;"',onChange:"ui.target.FIXED_COUNT = this.value;"},{type:"checkbox",name:"context_autoscroll-target",id:"context_autoscroll-target",label:b.lang.autoscroll,checked:this.AUTOSCROLL,event:'onchange="ui.target.AUTOSCROLL = this.checked;"'}]},{label:b.lang.elements,elements:[{label:b.lang.showHeader,type:"checkbox",name:"context_hide-target-header",id:"context_hide-target-header",checked:this.SHOW_HEADER,event:'onchange="ui.target.SHOW_HEADER = this.checked;"'},{type:"checkbox",name:"context-show-genre-badge",id:"context-show-genre-badge",label:b.lang.showGenreBadges,checked:this.SHOW_GENRE,event:'onchange="ui.target.SHOW_GENRE = this.checked;"'},{type:"checkbox",name:"context-show-level",id:"context-show-level",label:b.lang.showLevel,checked:this.SHOW_LEVEL,event:'onchange="ui.target.SHOW_LEVEL = this.checked"'},{type:"checkbox",name:"context-show-events-checkbox",id:"context-show-events-checkbox",label:b.lang.showEvents,checked:this.SHOW_EVENTS,event:'onchange="ui.target.SHOW_EVENTS = this.checked"'},{type:"checkbox",name:"context-show-difficult",id:"context-show-difficult",label:b.lang.showDifficult,checked:this.SHOW_DIFFICULT,event:'onchange="ui.target.SHOW_DIFFICULT = this.checked"'}]},{label:b.lang.sort,elements:[{type:"radio",name:"context-sort",id:"context-sort_latest",label:b.lang.latest,checked:this.SORT_NAME===ui_UI.sortMethods.latest,event:"onchange=\"ui.target.SORT_NAME = 'latest';\""},{type:"radio",name:"context-sort",id:"context-sort_rarest",label:b.lang.rarest,checked:this.SORT_NAME===ui_UI.sortMethods.earnedCount,event:"onchange=\"ui.target.SORT_NAME = 'earnedCount';\""},{type:"radio",name:"context-sort",id:"context-sort_points",label:b.lang.points,checked:this.SORT_NAME===ui_UI.sortMethods.points,event:"onchange=\"ui.target.SORT_NAME = 'points';\""},{type:"radio",name:"context-sort",id:"context-sort_retropoints",label:b.lang.retropoints,checked:this.SORT_NAME===ui_UI.sortMethods.truepoints,event:"onchange=\"ui.target.SORT_NAME = 'truepoints';\""},{type:"radio",name:"context-sort",id:"context-sort_default",label:b.lang.default,checked:this.SORT_NAME===ui_UI.sortMethods.default,event:"onchange=\"ui.target.SORT_NAME = 'default';\""},{type:"radio",name:"context-sort",id:"context-sort_level",label:b.lang.level_test,checked:this.SORT_NAME===ui_UI.sortMethods.level,event:"onchange=\"ui.target.SORT_NAME = 'level';\""},{type:"radio",name:"context-sort",id:"context-sort_dont-sort",label:b.lang.disable,checked:this.SORT_NAME===ui_UI.sortMethods.disable,event:"onchange=\"ui.target.SORT_NAME = 'disable';\""},{type:"checkbox",name:"context-reverse-sort",id:"context-reverse-sort",label:b.lang.reverse,checked:-1==this.REVERSE_SORT,event:'onchange="ui.target.REVERSE_SORT = this.checked"'}]},{label:b.lang.filter,elements:[{type:"radio",name:"context-filter",id:"context_filter-progression",label:b.lang.progression,checked:this.FILTER_NAME===ui_UI.filterMethods.progression,event:"onchange=\"ui.target.FILTER_NAME = 'progression';\""},{type:"radio",name:"context-filter",id:"context_filter-missable",label:b.lang.missable,checked:this.FILTER_NAME===ui_UI.filterMethods.missable,event:"onchange=\"ui.target.FILTER_NAME = 'missable';\""},{type:"radio",name:"context-filter",id:"context_filter-earned",label:b.lang.earned,checked:this.FILTER_NAME===ui_UI.filterMethods.earned,event:"onchange=\"ui.target.FILTER_NAME = 'earned';\""},{type:"radio",name:"context-filter",id:"context_filter-all",label:b.lang.all,checked:this.FILTER_NAME===ui_UI.filterMethods.all,event:"onchange=\"ui.target.FILTER_NAME = 'all';\""},{type:"checkbox",name:"context-reverse-filter",id:"context-reverse-filter",label:b.lang.reverse,checked:this.REVERSE_FILTER,event:'onchange="ui.target.REVERSE_FILTER = this.checked;"'},{type:"checkbox",name:"context-hide-filtered",id:"context-hide-filtered",label:b.lang.hideFiltered,checked:this.HIDE_FILTERED,event:'onchange="ui.target.HIDE_FILTERED = this.checked;"'}]},{label:b.lang.level_test,elements:[{type:"checkbox",name:"context-hide-passed-levels",id:"context-hide-passed-levels",label:b.lang.hidePassedLevels,checked:this.HIDE_PASSED_LEVELS,event:'onchange="ui.target.HIDE_PASSED_LEVELS = this.checked;"'},{type:"checkbox",name:"context-highlight-passed",id:"context-highlight-passed",label:b.lang.highLightPassedLevels,checked:this.HIGHLIGHT_PASSED_LEVELS,event:'onchange="ui.target.HIGHLIGHT_PASSED_LEVELS = this.checked;"'}]},{label:b.lang.data,elements:[{type:"button",name:"context-fill",id:"context-fill",label:b.lang.fillAll,event:'onclick="ui.target.fillItems()"'},{type:"checkbox",name:"context-autofill",id:"context-autofill",label:b.lang.autofill,checked:this.AUTOFILL,event:'onchange="ui.target.AUTOFILL = this.checked;"'},{type:"button",name:"context-clear-all",id:"context-clear-all",label:b.lang.clearAll,event:'onclick="ui.target.clearAllAchivements();"'},{type:"checkbox",name:"context-autoclear",id:"context-autoclear",label:b.lang.autoclearEarned,checked:this.AUTOCLEAR,event:'onchange="ui.target.AUTOCLEAR = this.checked;"'},{prefix:b.lang.clearDelay,postfix:"sec",type:"input-number",name:"context-autoclear-delay",id:"context-autoclear-delay",label:b.lang.clearDelay,value:this.AUTOCLEAR_DELAY,event:'onchange="ui.target.AUTOCLEAR_DELAY = this.value;"',onChange:"ui.target.AUTOCLEAR_DELAY = this.value;"}]}]}get IS_FIXED_SIZE(){return w.getUIProperty({sectionID:this.section.id,property:"isFixedSize"})??!1}set IS_FIXED_SIZE(e){w.saveUIProperty({sectionID:this.section.id,property:"isFixedSize",value:e}),this.section.classList.toggle("fixed-size",this.IS_FIXED_SIZE)}get FIXED_COUNT(){const e=~~w.getUIProperty({sectionID:this.section.id,property:"fixedSizeCount"});return e>0?e:2}set FIXED_COUNT(e){e=e>0?~~e:3,w.saveUIProperty({sectionID:this.section.id,property:"fixedSizeCount",value:e}),this.container.style.setProperty("--max-count",this.FIXED_COUNT)}get SHOW_HEADER(){return w.getUIProperty({sectionID:this.section.id,property:"showHeader"})??!0}set SHOW_HEADER(e){w.saveUIProperty({sectionID:this.section.id,property:"showHeader",value:e}),this.section.classList.toggle("compact",!this.SHOW_HEADER)}get HIDE_BG(){return w.getUIProperty({sectionID:this.section.id,property:"hideBg"})??!1}set HIDE_BG(e){w.saveUIProperty({sectionID:this.section.id,property:"hideBg",value:e}),this.section.classList.toggle("hide-bg",this.HIDE_BG)}set SORT_NAME(e){w._cfg.settings.sortTargetBy=e,w.writeConfiguration(),this.applySort()}get SORT_NAME(){return w._cfg.settings.sortTargetBy||ui_UI.sortMethods.default}get SORT_METHOD(){return ui_UI.sortBy[this.SORT_NAME]}get REVERSE_SORT(){return w._cfg.settings.reverseSortTarget||1}set REVERSE_SORT(e){w._cfg.settings.reverseSortTarget=e?-1:1,w.writeConfiguration(),this.applySort()}get FILTER_NAME(){return w._cfg.settings.filterTargetBy||ui_UI.filterMethods.all}set FILTER_NAME(e){w._cfg.settings.filterTargetBy=e,w.writeConfiguration(),this.applyFilter()}get FILTER_METHOD(){return ui_UI.filterBy[this.FILTER_NAME]}get REVERSE_FILTER(){return w._cfg.settings.reverseFilterTarget??!1}set REVERSE_FILTER(e){w._cfg.settings.reverseFilterTarget=e,w.writeConfiguration(),this.applyFilter()}get HIDE_FILTERED(){return w._cfg.settings.hideFilteredTarget??!1}set HIDE_FILTERED(e){w._cfg.settings.hideFilteredTarget=e,w.writeConfiguration(),this.filterByGenre(this.genreFilter,!0)}get AUTOCLEAR(){return w._cfg.settings.autoClearTarget??!1}set AUTOCLEAR(e){w._cfg.settings.autoClearTarget=e,w.writeConfiguration()}get AUTOFILL(){return w._cfg.settings.autoFillTarget??!0}set AUTOFILL(e){w._cfg.settings.autoFillTarget=e,w.writeConfiguration()}get AUTOCLEAR_DELAY(){return Number(w._cfg.settings.autoClearTargetTime??5)}set AUTOCLEAR_DELAY(e){w._cfg.settings.autoClearTargetTime=e>=0?e:0,w.writeConfiguration()}get AUTOSCROLL(){return w?.ui?.target_section?.autoscroll??!1}set AUTOSCROLL(e){w.saveUIProperty({sectionID:this.section.id,property:"autoscroll",value:e}),e?this.startAutoScroll():this.stopAutoScroll()}get SHOW_PREV_BORDER(){return!0}set SHOW_PREV_BORDER(e){w.saveUIProperty({sectionID:this.section.id,property:"showPrevBorder",value:e})}get SHOW_PREV_OVERLAY(){return!0}set SHOW_PREV_OVERLAY(e){w.saveUIProperty({sectionID:this.section.id,property:"showPrevOverlay",value:e})}get SHOW_DIFFICULT(){return w.getUIProperty({sectionID:this.section.id,property:"showDifficult"})??!0}set SHOW_DIFFICULT(e){w.saveUIProperty({sectionID:this.section.id,property:"showDifficult",value:e}),this.container.querySelectorAll(".target-achiv").forEach((t=>t.classList.toggle("show-difficult",e)))}get SHOW_LEVEL(){return w.getUIProperty({sectionID:this.section.id,property:"showLevel"})??!0}set SHOW_LEVEL(e){w.saveUIProperty({sectionID:this.section.id,property:"showLevel",value:e}),this.container.querySelectorAll(".target-achiv").forEach((t=>t.classList.toggle("show-level",e)))}get SHOW_GENRE(){return w.getUIProperty({sectionID:this.section.id,property:"showGenre"})??!0}set SHOW_GENRE(e){w.saveUIProperty({sectionID:this.section.id,property:"showGenre",value:e}),this.container.querySelectorAll(".target-achiv").forEach((t=>t.classList.toggle("show-genre",e)))}get HIDE_PASSED_LEVELS(){return w.getUIProperty({sectionID:this.section.id,property:"hidePassedLevels"})??!0}set HIDE_PASSED_LEVELS(e){w.saveUIProperty({sectionID:this.section.id,property:"hidePassedLevels",value:e}),this.section.classList.toggle("hide-passed",e)}get HIGHLIGHT_PASSED_LEVELS(){return w.getUIProperty({sectionID:this.section.id,property:"highlightPassedLevels"})??!0}set HIGHLIGHT_PASSED_LEVELS(e){w.saveUIProperty({sectionID:this.section.id,property:"highlightPassedLevels",value:e}),this.section.classList.toggle("highlight-passed",e)}get SHOW_EVENTS(){return w.getUIProperty({sectionID:this.section.id,property:"showEvents"})??!0}set SHOW_EVENTS(e){w.saveUIProperty({sectionID:this.section.id,property:"showEvents",value:e}),this.section.classList.toggle("show-events",e)}constructor(){super(),this.generateWidget(),this.addWidgetIcon(),this.initializeElements(),this.addEvents(),this.setValues(),this.showAotwEvent({cheevo:w.aotw})}initializeElements(){this.section=document.querySelector("#target_section"),this.header=document.querySelector(".target-header_container"),this.container=document.querySelector(".target-container"),this.searchInput=this.section.querySelector("#target__searchbar")}generateWidget(){const e={classes:["target_section","section"],id:"target_section",title:"Target",headerElementsHtml:'\n            <button class="header-button header-icon tweak-button tweak-icon"></button>\n            <input type="search" name="" id="target__searchbar" class="text-input target__search-bar" placeholder="Search...">\n        ',contentClasses:["target-container","content-container","flex-main-list"]},t=this.generateWidgetElement(e);b.app.appendChild(t)}addEvents(){super.addEvents(),this.section.addEventListener("contextmenu",(e=>{b.showContextmenu({event:e,menuItems:this.contextMenuItems,sectionCode:""})})),this.container.addEventListener("click",(e=>{if(e.target.closest(".comments-button")){const t=e.target.closest(".target-achiv")?.dataset.achivId;t&&b.showComments(t,2)}else if(e.target.matches(".delete-from-target")){const t=e.target.closest(".target-achiv");b.target.deleteFromTarget(t)}}));var e,t;e=this.container,t=e=>{b.target.addAchieveToTarget(e),this.section.querySelector(".achiv-block")?.remove()},new Sortable(e,{group:{name:"cheevos",pull:!1},animation:100,chosenClass:"dragged",onAdd:function(e){const s=e.item.dataset.achivId;t&&t(s)}}),this.searchInput?.addEventListener("input",this.searchInputEvent)}searchInputEvent(e){e.stopPropagation();[...b.target.container.querySelectorAll(".target-achiv")].forEach((e=>{const t=e.dataset.achivId,s=e.querySelector(".achiv-description"),i=e.querySelector(".target__cheevo-header a");s&&(s.innerText=R.CHEEVOS[t]?.Description),i&&(i.innerText=R.CHEEVOS[t]?.Title)})),b.target.applySort();const t=e.target.value;if(t){(e=>{const t=new RegExp(`(${e})`,"gi");[...b.target.container.querySelectorAll(".target-achiv")].reverse().forEach((e=>{const s=e.querySelector(".achiv-description"),i=e.querySelector(".target__cheevo-header a");i.innerText.match(t)&&(b.target.moveToTop(s.closest(".target-achiv")),i.innerHTML=i.innerHTML.replace(t,(e=>`<span class="badge highlight-badge">${e}</span>`))),s.innerText.match(t)&&(b.target.moveToTop(s.closest(".target-achiv")),s.innerHTML=s.innerHTML.replace(t,(e=>`<span class="badge highlight-badge">${e}</span>`)))}))})(t);const e=document.querySelector(".badge.highlight-badge");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}}setValues(){ui_UI.applyPosition({widget:this}),this.section.classList.toggle("show-events",this.SHOW_EVENTS),this.section.classList.toggle("compact",!this.SHOW_HEADER),this.section.classList.toggle("hide-bg",this.HIDE_BG),this.section.classList.toggle("hide-passed",this.HIDE_PASSED_LEVELS),this.section.classList.toggle("highlight-passed",this.HIGHLIGHT_PASSED_LEVELS),this.section.classList.toggle("fixed-size",this.IS_FIXED_SIZE),this.container.style.setProperty("--max-count",this.FIXED_COUNT),this.startAutoScroll()}gameChangeEvent(){this.genreFilter="",this.AUTOCLEAR&&this.clearEarned(),this.AUTOFILL&&this.fillItems()}updateEarnedAchieves({earnedAchievementIDs:e}){e.forEach((e=>{const t=this.container.querySelector(`.target-achiv[data-achiv-id='${e}']`);R.CHEEVOS[e].isHardcoreEarned&&t?(t.classList.add("earned","hardcore","show-hard-anim"),t.dataset.DateEarnedHardcore=R.CHEEVOS[e].DateEarnedHardcore):t?.classList.add("earned","show-hard-anim"),setTimeout((()=>t?.classList.remove("show-hard-anim")),5e3)})),this.applyFilter(),this.applySort(),this.genreFilter&&this.filterByGenre(this.genreFilter,!0)}autoscrollInterval;startAutoScroll(e=!0){this.stopAutoScroll();let t=this.container,s=1;this.AUTOSCROLL&&(this.autoscrollInterval=setInterval((()=>{t.scrollHeight-t.clientHeight<=10&&this.stopAutoScroll(),e?(t.scrollTop+=s,t.scrollTop+t.clientHeight>=t.scrollHeight&&(this.stopAutoScroll(),setTimeout((()=>this.startAutoScroll(!1)),2e3))):(t.scrollTop-=s,0===t.scrollTop&&(this.stopAutoScroll(),setTimeout((()=>this.startAutoScroll(!0)),2e3)))}),50),t.addEventListener("mouseenter",(()=>{s=0})),t.addEventListener("mouseleave",(()=>{s=1})))}stopAutoScroll(){clearInterval(this.autoscrollInterval)}isAchievementInTargetSection({ID:e,targetContainer:t=this.container}){return[...t.querySelectorAll(".target-achiv")].filter((t=>t.dataset.achivId==e)).length>0}addAchieveToTarget(e){if(this.isAchievementInTargetSection({ID:e}))return;const t=R.CHEEVOS[e],s=document.createElement("li");(()=>{s.classList.add("target-achiv","main-column-item","right-bg-icon"),s.classList.toggle("border",this.SHOW_PREV_BORDER),s.classList.toggle("overlay",this.SHOW_PREV_OVERLAY),s.classList.toggle("show-difficult",this.SHOW_DIFFICULT),s.classList.toggle("show-level",this.SHOW_LEVEL),s.classList.toggle("show-genre",this.SHOW_GENRE),s.classList.toggle("earned",t.isEarned),s.classList.toggle("hardcore",t.isHardcoreEarned)})(),s.dataset.type=t.type,s.dataset.Points=t.Points,s.dataset.TrueRatio=t.TrueRatio,s.dataset.DisplayOrder=t.DisplayOrder,t.DateEarnedHardcore&&(s.dataset.DateEarnedHardcore=t.DateEarnedHardcore),t.DateEarned&&(s.dataset.DateEarned=t.DateEarned),s.dataset.NumAwardedHardcore=t.NumAwardedHardcore,s.dataset.achivId=e,t.level&&(s.dataset.level=t.level),(()=>{const i=t.level?.toString()?.split(".")[1],n=t.zone?i?`${t.zone} [${i}]`:t.zone:t.level?.toString()?.replace(".","-"),a=100*t.NumAwardedHardcore/t.totalPlayers;s.innerHTML=`\n            <div class="target__buttons-container">\n                <button class="header-button header-icon  target__comments-button comments-button chat-icon" data-title="show comments">\n                <button class="header-button header-icon  delete-icon delete-from-target" data-title="remove from target">\n                </button>\n            </div>\n            </button>\n            <div class="prev">\n                <img\n                class="prev-img"\n                src="${t.prevSrc}"\n                alt="${t.Title}"\n                />\n            </div>\n            <div class="target__cheevo-details">\n                <h3 class="target__cheevo-header">\n                    ${n?`${A.cheevoLevel(n.toString().trim())}`:""}\n                    ${t.genres.length>0?t.genres?.map((e=>`<p class="target-genre-badge badge badge-bold badge_gold badge-button" data-title="achievement genre" onclick="ui.target.filterByGenre('${e}')">${e.trim()}</p>`)).join(""):""}<a target="_blanc" data-title="go to RA cheevo-page" href="https://retroachievements.org/achievement/${e}">\n                        ${t.Title}\n                    </a>\n                </h3>\n                <p class="achiv-description">${t.Description}</p>\n                <div class="target-other-descriptions icons-row-list">\n                    ${I.cheevoType(t.type)}\n                    ${T.points(t.Points)}\n                    ${T.retropoints(t.TrueRatio)}\n                    ${T.rarity(a,t.rateEarnedHardcore)}\n                    ${T.retroRatio(t.retroRatio)}\n                    ${T.difficulty(t.difficulty)}\n                </div>\n            </div>\n            `})(),this.container.appendChild(s),this.isDynamicAdding||(this.applyFilter(),this.applySort()),this.delayedRemove()}moveToTop(e){1==this.REVERSE_SORT?this.container.prepend(e):this.container.append(e),this.applyFilter()}applyFilter(){ui_UI.applyFilter({container:this.container,itemClassName:".target-achiv",filterMethod:this.FILTER_METHOD,reverse:this.REVERSE_FILTER,isHide:this.HIDE_FILTERED})}filterByGenre(e,t=!1){(()=>{this.container.querySelectorAll(".hidden").forEach((e=>e.classList.remove("hidden")))})(),!t&&this.genreFilter===e||!e?(this.genreFilter="",this.applyFilter()):(this.genreFilter=e,ui_UI.applyFilter({container:this.container,itemClassName:".target-achiv",filterMethod:t=>R.CHEEVOS[t.achivId].genres.includes(e),reverse:!1,isHide:this.HIDE_FILTERED}))}applySort(){ui_UI.applySort({container:this.container,itemClassName:".target-achiv",sortMethod:this.SORT_METHOD,reverse:this.REVERSE_SORT})}highlightCurrentLevel(e){[...this.container.querySelectorAll(".target-achiv")].forEach((t=>{t.classList.remove("highlight"),t.classList.remove("passed");const s=t.dataset.level;if(s==e&&t.classList.add("highlight"),!Number.isInteger(e)){const s=parseInt(e);t.dataset.level==s&&t.classList.add("highlight")}Number.isInteger(+s)?s<parseInt(e)&&t.classList.add("passed"):s<e&&t.classList.add("passed")}))}deleteFromTarget(e){const t=e.closest(".target-achiv");t?.classList.add("removing"),setTimeout((()=>t?.remove()),0)}clearEarned(){this.container.querySelectorAll(".target-achiv").forEach((e=>{e.classList.contains("hardcore")&&e.remove()}))}clearAllAchivements(){this.container.innerHTML=""}delayedRemove(){this.AUTOCLEAR&&this.container.querySelectorAll(".earned").forEach((e=>{setTimeout((()=>e.remove()),1e3*this.AUTOCLEAR_DELAY)}))}fillItems(){this.isDynamicAdding=!0,this.clearAllAchivements(),Object.keys(R.CHEEVOS).forEach((e=>{this.addAchieveToTarget(e)})),this.applyFilter(),this.applySort(),this.isDynamicAdding=!1,w.aotw&&this.container.querySelector(`.target-achiv[data-achiv-id='${w.aotw?.ID}']`)?.classList.add("target__aotw")}showAotwEvent({cheevo:e}){if(!e||e.wasShown)return;const t=100*e.UnlocksHardcoreCount/e.TotalPlayers;this.section.querySelector(".target__aotw-container")?.remove(),this.container.querySelector(`.target-achiv[data-achiv-id='${e.ID}']`)?.classList.add("target__aotw");const s=document.createElement("div");s.classList.add("target__aotw-container","target__aotw","show-difficult","show-level"),s.innerHTML=`\n        <button class="description-icon close-icon target__hide-aotw" \n          onclick="ui.target.hideAotw()"></button>\n        <div class="prev">\n          <img class="prev-img" src="https://media.retroachievements.org${e.BadgeURL}" alt=" ">\n        </div>\n        <div class="target__cheevo-details">\n          <h3 class="target__cheevo-header">\n            <a target="_blanc" href="https://retroachievements.org/achievement/${e.ID}">\n              ${e.Title}\n            </a>\n            in\n            <a target="_blanc" href="https://retroachievements.org/game/${e.GameID}">\n              ${e.GameTitle}\n            </a>\n          </h3>\n          <div class="achiv-description">\n          ${A.black("AotW Event")}\n            ${e.Description}\n          </div>\n          <div class="target-other-descriptions  icons-row-list">\n            ${I.cheevoType(e?.type)}\n            ${T.points(e.Points)}\n            ${T.retropoints(e.TrueRatio)}\n            ${T.rarity(t,t.toFixed(2)+"%")}\n            ${T.retroRatio((e.TrueRatio/e.Points).toFixed(2))}\n           \n          </div>\n        </div>\n      `,this.section.querySelector(".target__aotw-container")?.remove(),this.section.insertBefore(s,this.container)}hideAotw(){this.section.querySelector(".target__aotw-container")?.remove(),w.aotw={...w?.aotw,wasShown:!0}}}class StatusPanel extends Widget{widgetIcon={description:"status widget",iconID:"side-panel__status",onChangeEvent:"ui.statusPanel.VISIBLE = this.checked",badgeLabel:"v1",iconClass:"status-icon"};get contextMenuItems(){return[{label:b.lang.gameTime,elements:[{type:"checkbox",name:"context_show-time",id:"context_show-time",label:"**Show timeBar**",checked:this.SHOW_TIME_BAR,event:'onchange="ui.statusPanel.SHOW_TIME_BAR = this.checked;"'},{type:"radio",name:"context_game-time",id:"context_show-playTime",label:b.lang.gameTime,checked:"playTime"==this.SHOW_TIME,event:"onclick=\"ui.statusPanel.SHOW_TIME = 'playTime';\""},{type:"radio",name:"context_game-time",id:"context_show-sessionTime",label:b.lang.sessionGameTime,checked:"sessionTime"==this.SHOW_TIME,event:"onclick=\"ui.statusPanel.SHOW_TIME = 'sessionTime';\""},{type:"radio",name:"context_game-time",id:"context_show-full-time",label:"**Session time**",checked:"totalSessionTime"==this.SHOW_TIME,event:"onclick=\"ui.statusPanel.SHOW_TIME = 'totalSessionTime';\""},{type:"radio",name:"context_game-time",id:"context_show-timer",label:b.lang.timer,checked:"timer"==this.SHOW_TIME,event:"onclick=\"ui.statusPanel.SHOW_TIME = 'timer';\""},{prefix:b.lang.timer,postfix:b.lang.min,type:"input-number",id:"context-menu_stats-timer-duration",label:b.lang.timer,value:~~(this.TIMER_TIME/60*100)/100,event:'onchange="ui.statusPanel.TIMER_TIME = this.value;"',onChange:"ui.statusPanel.TIMER_TIME = this.value;"}]},{label:b.lang.elements,elements:[{type:"checkbox",name:"context_show-target-preview",id:"context_show-target-preview",label:"**Focus preview**",checked:this.SHOW_TARGET_PREVIEW,event:'onchange="ui.statusPanel.SHOW_TARGET_PREVIEW = this.checked;"'},{type:"radio",name:"context_description-variant-radio",id:"context_show-progression-description",label:"Progression",checked:"progression"===this.STATUS_DESCRIPTION_VARIANT,event:"onchange=\"ui.statusPanel.STATUS_DESCRIPTION_VARIANT = 'progression';\""},{type:"radio",name:"context_description-variant-radio",id:"context_show-game-info-description",label:"Rich presence",checked:"gameInfo"===this.STATUS_DESCRIPTION_VARIANT,event:"onchange=\"ui.statusPanel.STATUS_DESCRIPTION_VARIANT = 'gameInfo';\""},{type:"checkbox",name:"context_show-mastery-rate",id:"context_show-mastery-rate",label:b.lang.showMasteryRate,checked:this.SHOW_MASTERY_RATE,event:'onclick="ui.statusPanel.SHOW_MASTERY_RATE = this.checked;"'}]},{label:"**Progression variants**",elements:[{type:"radio",name:"context_progression-variant",id:"context_progression-variant-dots",label:"**Dots**",checked:"dots"===this.PROGRESSION_VARIANT,event:"onchange=\"ui.statusPanel.PROGRESSION_VARIANT = 'dots';\""},{type:"radio",name:"context_progression-variant",id:"context_progression-variant-rects",label:"**Rects**",checked:"rects"===this.PROGRESSION_VARIANT,event:"onchange=\"ui.statusPanel.PROGRESSION_VARIANT = 'rects';\""}]},{label:b.lang.alerts,elements:[{type:"checkbox",name:"context_show-new-cheevos",id:"context_show-new-cheevos",label:b.lang.showAlerts,checked:this.SHOW_NEW_ACHIV,event:'onchange="ui.statusPanel.SHOW_NEW_ACHIV = this.checked;"'},{prefix:b.lang.duration,postfix:b.lang.sec,type:"input-number",id:"context-menu_stats-earned-duration",label:b.lang.duration,value:this.NEW_ACHIV_DURATION,event:'onchange="ui.statusPanel.NEW_ACHIV_DURATION = this.value;"',onChange:"ui.statusPanel.NEW_ACHIV_DURATION = this.value;"},{type:"checkbox",name:"context_show-stats-alert",id:"context_show-stats-alert",label:"**Stats alert**",checked:this.SHOW_STATISTICS_ALERT,event:'onchange="ui.statusPanel.SHOW_STATISTICS_ALERT = this.checked;"'}]},{type:"checkbox",name:"context_show-update-blink",id:"context_show-update-blink",label:b.lang.showUpdateBlink,checked:this.BLINK_ON_UPDATE,event:'onchange="ui.statusPanel.BLINK_ON_UPDATE = this.checked;"'},{type:"checkbox",name:"context_hard-mode",id:"context_hard-mode",label:b.lang.hardcoreMode,checked:this.IS_HARD_MODE,event:'onchange="ui.statusPanel.IS_HARD_MODE = this.checked; ui.statusPanel.generateProgressionBlock()"'},{type:"checkbox",name:"context_game-bg",id:"context_game-bg",label:"**Show game bg**",checked:this.SHOW_GAME_BG,event:'onchange="ui.statusPanel.SHOW_GAME_BG = this.checked;"'}]}get SHOW_TIME_BAR(){return w.getUIProperty({sectionID:this.section.id,property:"showTimeBar"})??!0}set SHOW_TIME_BAR(e){w.saveUIProperty({sectionID:this.section.id,property:"showTimeBar",value:e}),this.setElementsValues()}get IS_HARD_MODE(){return w.getUIProperty({sectionID:this.section.id,property:"hardMode"})??!0}set IS_HARD_MODE(e){w.saveUIProperty({sectionID:this.section.id,property:"hardMode",value:e})}get BLINK_ON_UPDATE(){return w.ui.update_section?.showUpdateBlink??!0}set BLINK_ON_UPDATE(e){w.ui.update_section.showUpdateBlink=e,w.writeConfiguration()}get SHOW_TICKER(){return!1}set SHOW_TICKER(e){w.ui.update_section.showTicker=e,w.writeConfiguration(),this.setElementsValues(),this.SHOW_TICKER?this.infiniteLine.startScrolling():this.infiniteLine.stopScrolling()}get SHOW_RP(){return!1}set SHOW_RP(e){w.ui.update_section.showRP=e,w.writeConfiguration(),this.startStatsAnimation()}get SHOW_HP(){return!1}set SHOW_HP(e){w.ui.update_section.showHP=e,w.writeConfiguration(),this.startStatsAnimation()}get SHOW_SP(){return!1}set SHOW_SP(e){w.ui.update_section.showSP=e,w.writeConfiguration(),this.startStatsAnimation()}get SHOW_STATISTICS_ALERT(){return w.ui.update_section?.showStatisticsAlert??!0}set SHOW_STATISTICS_ALERT(e){w.ui.update_section.showStatisticsAlert=e,w.writeConfiguration()}get SHOW_CHEEVOS(){return!1}set SHOW_CHEEVOS(e){w.ui.update_section.showCheevos=e,w.writeConfiguration(),this.startStatsAnimation()}get SHOW_PROGRESSION(){return!1}set SHOW_PROGRESSION(e){w.ui.update_section.showProgression=e,w.writeConfiguration(),this.startStatsAnimation()}get SHOW_PLATFORM(){return!0}set SHOW_PLATFORM(e){w.ui.update_section.showPlatform=e,w.writeConfiguration(),this.setElementsValues()}get SHOW_RICH_PRESENCE(){return!0}set SHOW_RICH_PRESENCE(e){w.ui.update_section.showRichPresence=e,w.writeConfiguration(),this.setElementsValues()}get STATS_DURATION(){const e=w.ui.update_section?.statsDuration??30;return e<5?5:e}set STATS_DURATION(e){w.ui.update_section.statsDuration=e,w.writeConfiguration(),this.startStatsAnimation()}get SHOW_NEW_ACHIV(){return w.ui.update_section?.showNewAchiv??!0}set SHOW_NEW_ACHIV(e){w.ui.update_section.showNewAchiv=e,w.writeConfiguration()}get CHANGE_PROGRESS_AUTO(){return"auto"==w.ui.update_section?.progressBarPropertyName}get PROGRESSBAR_PROPERTY_NAME(){return w.ui.update_section?.progressBarPropertyName??"auto"}set PROGRESSBAR_PROPERTY_NAME(e){w.ui.update_section.progressBarPropertyName=e,w.writeConfiguration(),this.setProgressBarValue()}get NEW_ACHIV_DURATION(){const e=w.ui.update_section?.newAchivDuration??15;return e<5?5:e}set NEW_ACHIV_DURATION(e){w.ui.update_section.newAchivDuration=e,w.writeConfiguration()}get AUTOSCROLL_RICHPRESENCE(){return!0}get SHOW_GAME_PREV_BORDER(){return!1}set SHOW_GAME_PREV_BORDER(e){w.ui.update_section.showGamePrevBorder=e,w.writeConfiguration(),this.container.classList.toggle("game-border",e)}get SHOW_GAME_RATIO(){return!1}set SHOW_GAME_RATIO(e){this.SHOW_GAME_RATIO&&e?(e=!1,document.getElementById("context_show-game-ratio").checked=!1):w.ui.update_section.showMasteryRate=!e,w.ui.update_section.showGameRatio=e,w.writeConfiguration(),this.setElementsValues()}get SHOW_MASTERY_RATE(){return w?.ui?.update_section?.showMasteryRate??!1}set SHOW_MASTERY_RATE(e){this.SHOW_MASTERY_RATE&&e?(e=!1,document.getElementById("context_show-mastery-rate").checked=!1):w.ui.update_section.showGameRatio=!e,w.ui.update_section.showMasteryRate=e,w.writeConfiguration(),this.setElementsValues()}get SHOW_TIME(){return w.ui.update_section?.time??"playTime"}set SHOW_TIME(e){e===w.ui.update_section.time&&(document.querySelector(`#context_show-${e}`).checked=!1,e=!1),w.ui.update_section.time=e,w.writeConfiguration(),this.startStatsAnimation()}get TIMER_TIME(){return w.ui.update_section?.timerTime??2}set TIMER_TIME(e){e<1&&(e=1),e>1440&&(e=1440),w.ui.update_section.timerTime=60*e,w.writeConfiguration(),this.timerTime=this.TIMER_TIME,this.startStatsAnimation()}get STATUS_DESCRIPTION_VARIANT(){return w?.ui?.update_section?.statusDescriptionVariant??"gameInfo"}set STATUS_DESCRIPTION_VARIANT(e){const t={gameInfo:"show-game-info",progression:"show-game-progress"};w.ui.update_section.statusDescriptionVariant=e,w.writeConfiguration(),Object.values(t).forEach((e=>this.section.classList.remove(e))),this.section.classList.add(t[e])}get SHOW_TARGET_PREVIEW(){return w.ui.update_section?.showTargetPreview??!1}set SHOW_TARGET_PREVIEW(e){w.ui.update_section.showTargetPreview=e,w.writeConfiguration(),this.generateProgressionBlock()}get SHOW_GAME_BG(){return w.ui.update_section?.showGameBg??!0}set SHOW_GAME_BG(e){w.ui.update_section.showGameBg=e,w.writeConfiguration(),this.container.classList.toggle("game-bg",this.SHOW_GAME_BG)}get PROGRESSION_VARIANT(){return w.ui.update_section?.progressionVariant??"dots"}set PROGRESSION_VARIANT(e){w.ui.update_section.progressionVariant=e,w.writeConfiguration(),this.generateProgressionBlock()}stats={userName:w.targetUser,gameTitle:R.GAME_DATA?.Title??"Title",gamePlatform:R.GAME_DATA?.ConsoleName??"Platform",richPresence:"Waiting...",imageSrc:`https://media.retroachievements.org${R.GAME_DATA?.ImageIcon}`,totalPoints:R.GAME_DATA?.totalPoints??0,totalAchievesCount:R.GAME_DATA?.NumAchievements??0,totalSoftpoints:0,earnedPoints:0,earnedAchievesCount:0,totalRetropoints:R.GAME_DATA?.TotalRetropoints,earnedRetropoints:0,earnedSoftpoints:0};awards={award:"",progressionAward:""};timerTime=this.TIMER_TIME;gameTimeInterval;getActiveTime=()=>{let e=0;switch(this.SHOW_TIME){case"playTime":e=R.playTime.totalGameTime;break;case"sessionTime":e=R.playTime.gameTime;break;case"totalSessionTime":e=R.playTime.sessionTime,e=e<0?0:e;break;case"timer":e=R.playTime.timer,e=e<0?0:e}return E(e,!0)};get statusTextValues(){const e={};return this.SHOW_HP&&(e.progressionInPointsStats=`${this.stats.earnedPoints}/${this.stats.totalPoints} HP`),this.SHOW_CHEEVOS&&(e.cheevosStats=`${this.stats.earnedAchievesCount}/${this.stats.totalAchievesCount} CHEEVOS`),this.SHOW_PROGRESSION&&(e.cheevosStats=`${this.stats.earnedProgressionCount}/${this.stats.totalProgressionCount} STEPS`),this.SHOW_RP&&(e.retroPointsStats=`${this.stats.earnedRetropoints}/${this.stats.totalRetropoints} RP`),this.SHOW_SP&&(e.softPointsStats=`${this.stats.earnedSoftpoints}/${this.stats.totalPoints-this.stats.earnedPoints} SP`),this.SHOW_TIME&&(e.gameTime=this.getActiveTime()),e}constructor(){super(),this.addWidgetIcon(),!w.ui.update_section&&(w.ui.update_section={}),this.initializeElements(),this.addEvents(),ui_UI.applyPosition({widget:this}),this.infiniteLine=a({container:this.section.querySelector("#magic-line"),textGenerator:n}),setTimeout((()=>{this.fitFontSize()}),1e3)}initializeElements(){this.section=document.querySelector("#update-section"),this.container=this.section.querySelector(".status__container"),this.guideLink=this.section.querySelector("#status-game-guide"),this.progresBar=this.section.querySelector("#status-progress-bar"),this.progresBarDelta=this.section.querySelector("#status_progress-bar-delta"),this.progressStatusText=this.section.querySelector("#status-progress-text"),this.resizer=this.section.querySelector("#status-resizer"),this.frontSide={container:this.section.querySelector(".status__front-side"),gamePreview:this.section.querySelector("#game-preview"),retroRatioElement:this.section.querySelector(".status__retro-ratio"),gameTitle:this.section.querySelector("#game-title"),gamePlatform:this.section.querySelector("#game-platform"),richPresence:this.section.querySelector("#rich-presence"),watchButton:this.section.querySelector("#watching-button"),sideBlock:this.section.querySelector(".status__sideblock-container"),iconsContainer:this.section.querySelector("#status__sideblock-icons")},this.backSide={container:this.section.querySelector(".status__back-side"),imgElement:this.section.querySelector("#update_achiv-preview"),titleElement:this.section.querySelector("#update_achiv-title"),descriptionElement:this.section.querySelector("#update_achiv-description"),badgesElement:this.section.querySelector("#update_achiv-earned-points")}}setElementsValues(){this.STATUS_DESCRIPTION_VARIANT=this.STATUS_DESCRIPTION_VARIANT,this.progressStatusText.innerText="";const e=R.GAME_DATA.ImageIngame;this.container.style.setProperty("--bg-image",`url(https://media.retroachievements.org${e})`),(()=>{this.container.classList.toggle("game-border",this.SHOW_GAME_PREV_BORDER),this.container.classList.toggle("show-game-ratio",this.SHOW_GAME_RATIO||this.SHOW_MASTERY_RATE),this.container.classList.toggle("game-bg",this.SHOW_GAME_BG),this.container.classList.toggle("show-ticker",this.SHOW_TICKER),this.container.classList.toggle("show-time-bar",this.SHOW_TIME_BAR),this.frontSide.gamePlatform.classList.toggle("hidden",!this.SHOW_PLATFORM),this.frontSide.richPresence.classList.toggle("hidden",!this.SHOW_RICH_PRESENCE)})(),(()=>{const e=R.GAME_DATA.retroRatio,t=R.GAME_DATA.masteryRate;this.frontSide.retroRatioElement.innerText=this.SHOW_MASTERY_RATE?t:e,this.frontSide.retroRatioElement.className=`status__retro-ratio difficult-badge__${R.GAME_DATA.gameDifficulty}`})(),(()=>{const{ImageIcon:e,FixedTitle:t,ConsoleName:s,ConsoleID:i,badges:n,ID:a,GuideURL:o}=R.GAME_DATA,{gamePreview:r,gameTitle:c,gamePlatform:l,richPresence:d}=this.frontSide;r.setAttribute("src",`https://media.retroachievements.org${e}`),c.innerHTML=`\n                <a target="_blank" class="status__game-title" href="https://retroachievements.org/game/${a}">${t}</a>\n                ${g(n)} \n                ${g([m[i||1]])}\n\n            `,setTimeout((()=>{this.startAutoScrollElement(c,!0,6e4),this.startAutoScrollElement(d,!0,6e4)}),1e4),this.guideLink.setAttribute("href",o),this.guideLink.classList.toggle("hidden",!o),l.innerText=s||"",this.generateProgressionBlock()})(),this.fillSidebarIcons(),this.setProgressBarValue(),this.startStatsAnimation(),this.SHOW_TICKER&&this.infiniteLine.startScrolling()}addEvents(){this.section.addEventListener("mousedown",(e=>{e.target.matches(".resizer")?(e.stopPropagation(),this.section.classList.add("resized"),ui_UI.resizeEvent({event:e,section:this.section,callback:()=>this.fitFontSize(!0)})):e.target.matches(".status__watch-button")?(e.stopPropagation(),R.isActive?R.stop():R.start()):e.target.matches(".comments-button")?(e.stopPropagation(),b.showComments(R.GAME_DATA?.ID,1)):e.target.matches(".close-icon")?(e.stopPropagation(),this.close()):ui_UI.moveEvent(this.section,e)})),this.section.addEventListener("contextmenu",(e=>{b.showContextmenu({event:e,menuItems:this.contextMenuItems})}))}fillSidebarIcons(){const e=this.IS_HARD_MODE?{...R.GAME_DATA.earnedStats.hard}:{...R.GAME_DATA.earnedStats.soft};this.frontSide.iconsContainer.innerHTML=`\n            <p class="signed-icon auto-font-size" data-title="cheevos count"><i\n                class="description-icon achievements-icon  auto-font-size"></i>\n                ${e.count}/${R.GAME_DATA.NumAchievements}\n            </p>\n\n            <p class="signed-icon auto-font-size" data-title="total points"><i\n                class="description-icon points-icon  auto-font-size"></i>\n                ${e.points}/${R.GAME_DATA.totalPoints}\n            </p>\n            <p class="signed-icon auto-font-size" data-title="true ratio">\n            <i class="description-icon rarity-icon  auto-font-size"></i>\n            ${R.GAME_DATA.retroRatio}\n            </p>\n            <p class="signed-icon auto-font-size" data-title="total retropoints"><i\n                class="description-icon retropoints-icon  auto-font-size"></i>\n                ${e.retropoints}/${R.GAME_DATA.TotalRetropoints}\n            </p>\n        `}updateGameData(e=!1){this.stats={userName:w.targetUser,gameTitle:R.GAME_DATA?.FixedTitle??"Title",gamePlatform:R.GAME_DATA?.ConsoleName??"Platform",richPresence:"Waiting...",imageSrc:`https://media.retroachievements.org${R.GAME_DATA?.ImageIcon}`,totalPoints:R.GAME_DATA?.totalPoints??0,totalSoftPoints:R.GAME_DATA.totalPoints-R.GAME_DATA.earnedStats.soft.points,totalAchievesCount:R.GAME_DATA?.NumAchievements??0,totalProgressionCount:R.GAME_DATA?.progressionSteps,earnedPoints:R.GAME_DATA.earnedStats.hard.points,earnedAchievesCount:R.GAME_DATA.earnedStats.hard.count,earnedProgressionCount:R.GAME_DATA.earnedStats.soft.progressionCount,totalRetropoints:R.GAME_DATA?.TotalRetropoints,earnedRetropoints:R.GAME_DATA.earnedStats.hard.retropoints,earnedSoftpoints:R.GAME_DATA.earnedStats.soft.points-R.GAME_DATA.earnedStats.hard.points},e&&(this.awards.award=R.GAME_DATA.award,this.awards.progressionAward=R.GAME_DATA.progressionAward)}gameChangeEvent(e=!1){e&&R.IS_WATCHING&&this.addAlertsToQuery([{type:"new-game",value:R.GAME_DATA}]),this.updateGameData(!0),this.setElementsValues()}timeWatcher(){this.frontSide.watchButton.classList.toggle("active",R.isActive),this.section.classList.toggle("watching",R.IS_ONLINE&&R.isActive);return{start:()=>{b.statusPanel.timeWatcher().stop(),this.gameTimeInterval=setInterval((()=>{"timer"===this.SHOW_TIME&&R.playTime.timer<0&&this.section.classList.add("timer-timeout");const e=this.getActiveTime(),t=this.section.querySelector(".status__game-time");t&&t.innerHTML!==e&&(t.innerHTML=e)}),1e3)},stop:()=>{this.gameTimeInterval&&clearInterval(this.gameTimeInterval)}}}setProgressBarValue(){let e=0;switch(this.PROGRESSBAR_PROPERTY_NAME){case"points":e=this.stats.earnedPoints/R.GAME_DATA?.totalPoints;break;case"retropoints":e=this.stats.earnedRetropoints/R.GAME_DATA?.TotalRetropoints;break;case"achives":e=this.stats.earnedAchievesCount/R.GAME_DATA?.NumAchievements;break;case"progression":e=this.stats.earnedProgressionCount/R.GAME_DATA?.progressionSteps;break;case"softpoints":e=this.stats.earnedSoftpoints/this.stats.totalSoftPoints}this.section.style.setProperty("--progress-points",100*(e||0)+"%")}generateProgressionBlock(){const e=this.section.querySelector(".status__progression-container"),t=this.section.querySelector(".status__description-text"),s=e=>this.IS_HARD_MODE?e.isHardcoreEarned?"earned":"":e.isEarned?"earned":"",i={dots:()=>{const e=Object.values(R.CHEEVOS).filter((e=>"progression"==e.type)).sort(((e,t)=>ui_UI.sortBy.default(e,t))),t=Object.values(R.CHEEVOS).filter((e=>"win_condition"==e.type));return e.reduce(((e,t)=>e+=`\n                            <div class="progression-point progression-point__dot  ${s(t)}" data-achiv-id=${t.ID}></div>\n                        `),"")+(t?.length>0?`\n                        <div class="win-points win-points__dots">\n                            ${t.reduce(((e,t)=>e+=`\n                                <div class="progression-point progression-point__dot-win ${s(t)}" data-achiv-id=${t.ID}></div>\n                            `),"")}\n                         </div>\n                        `:"")},rects:()=>{const e=Object.values(R.CHEEVOS).filter((e=>"progression"==e.type)).sort(((e,t)=>ui_UI.sortBy.default(e,t))),t=Object.values(R.CHEEVOS).filter((e=>"win_condition"==e.type));return e.reduce(((e,t)=>e+=`\n                        <div class="rp__progression-point ${s(t)}" data-achiv-id=${t.ID}></div>\n                    `),"")+(t?.length>0?`\n                    <div class="rp__win-points">\n                        ${t.reduce(((e,t)=>e+=`\n                                <div class="rp__progression-point win ${s(t)}" data-achiv-id=${t.ID}></div>\n                            `),"")}\n                     </div>\n                    `:"")}},n=Object.values(R.CHEEVOS).filter((e=>ui_UI.filterBy.progression(e))).sort(((e,t)=>ui_UI.sortBy.default(e,t))).find((e=>!s(e)));e.classList.remove("progression-points__dots","progression-points__rects"),e.classList.add(`progression-points__${this.PROGRESSION_VARIANT}`),e.innerHTML=i[this.PROGRESSION_VARIANT](),t.innerHTML=n?n.Description:R.GAME_DATA?.progressionAward?"You have beaten the game "+(R.GAME_DATA.winVariantCount>1?"for all possible endings":""):"Progression is not available";const a=e.querySelector(`[data-achiv-id="${n?.ID}"`);a?.scrollIntoView({behavior:"smooth",block:"end",inline:"center"}),a?.classList.add("focus"),this.frontSide.gamePreview.src=this.SHOW_TARGET_PREVIEW&&n?`https://media.retroachievements.org/Badge/${n?.BadgeName}.png`:`https://media.retroachievements.org${R.GAME_DATA.ImageIcon}`}updateProgress({earnedAchievementIDs:e}){e.length>0&&(this.IS_HARD_MODE=!!R.CHEEVOS[e[0]].isHardcoreEarned),this.updateGameData(),this.generateProgressionBlock(),this.fillSidebarIcons(),this.progresBarDelta?.classList.remove("hidden"),setTimeout((()=>this.progresBarDelta?.classList.add("hidden")),50),this.initialStats&&(this.initialStats.cheevosCount+=e.length)}initialStats;currentStats;deltaStats;updateStatistics({userSummary:e}){function t(e){return 0==e?"":(e>0?"+":"")+e}if(this.initialStats){this.currentStats={points:e.TotalPoints,retroPoints:e.TotalTruePoints,softPoints:e.TotalSoftcorePoints,rank:e.Rank,totalRanked:e.TotalRanked,percentile:100*e.Rank/e.TotalRanked};const s=this.currentStats.rank-this.initialStats.rank,i=(this.currentStats.percentile-this.initialStats.percentile).toFixed(3),n={deltaPoints:t(this.currentStats.points-this.initialStats.points),deltaRetroPoints:t(this.currentStats.retroPoints-this.initialStats.retroPoints),deltaSoftPoints:t(this.currentStats.softPoints-this.initialStats.softPoints),deltaRank:t(s),deltaPercentile:t(i)};this.deltaStats=n;const a={type:"stats",value:{...this.currentStats,...n,cheevosCount:this.initialStats.cheevosCount}};!this.alertsQuery.find((e=>"stats"===e.type))&&this.addAlertsToQuery([a]),b.status.addAlertsToQuery([a]),this.SHOW_TICKER&&this.infiniteLine.startScrolling(),this.infiniteLine.startScrolling()}else this.initialStats={points:e.TotalPoints,retroPoints:e.TotalTruePoints,softPoints:e.TotalSoftcorePoints,rank:e.Rank,totalRanked:e.TotalRanked,percentile:100*e.Rank/e.TotalRanked,cheevosCount:0},this.currentStats=this.initialStats}alertsQuery=[];addAlertsToQuery(e){this.SHOW_NEW_ACHIV&&(this.alertsQuery.length>0?this.alertsQuery=[...this.alertsQuery,...e]:(this.alertsQuery=[...e],this.startAlerts()))}async startAlerts(){const e=()=>{this.container.classList.remove("new-game-info","new-achiv","new-award","stats","beaten","mastered"),this.backSide.container.classList.remove("hardcore","beaten","mastered","beaten-softcore","completed")},t=()=>{const e=this.section.querySelector(".status_glass-effect");e.classList.remove("update"),setTimeout((()=>e.classList.add("update")),20)},s=e=>{const{FixedTitle:t,badges:s,ImageIcon:i,totalPoints:n,ConsoleName:a,TotalRetropoints:o,NumAchievements:r,masteryRate:c,beatenRate:l}=e;this.backSide.imgElement.src=`https://media.retroachievements.org${i}`,this.backSide.titleElement.innerHTML=`${t} ${g(s)}\n            <i class="badge">${a}</i>\n            `;let d=`\n                ${v(I.cheevos+r)}\n                ${v(I.points+n)}\n                ${v(I.retropoints+o)}\n                ${v(c+"% MASTERED")}\n                ${v(l+"% BEATEN")}\n            `;this.backSide.descriptionElement.innerText="",this.backSide.badgesElement.innerHTML=d,this.container.classList.add("new-game-info")},i=e=>{const{isHardcoreEarned:t,Title:s,prevSrc:i,Points:n,TrueRatio:a,rateEarned:o,rateEarnedHardcore:r,difficulty:c}=e;this.backSide.imgElement.src=i,this.backSide.titleElement.innerHTML=s,this.backSide.descriptionElement.innerText=e.Description;let l=t?`\n                    ${v(I.points+" +"+n)}\n                    ${v(I.retropoints+" +"+a)}\n                    ${v("TOP"+r)}\n                    <p class="badge difficult-badge__${c}">${c}</p>\n                `:`\n                    ${v(I.points+" +"+n)}\n                    ${v("TOP"+o)}\n                    <p class="badge difficult-badge__${c}">${c}</p>\n                `,d=e.genres?.map((e=>v(e))).join("\n")??"";this.backSide.badgesElement.innerHTML=d+l,this.backSide.container.classList.toggle("hardcore",e.isHardcoreEarned),setTimeout((()=>this.container.classList.add("new-achiv")),2e3)},n=(e,t)=>{const{FixedTitle:s,badges:i,ImageIcon:n,totalPoints:a,earnedStats:o,TotalRetropoints:r,masteryRate:c,beatenRate:l,completedRate:d,beatenSoftRate:h,ID:u,NumAchievements:p}=e,m="mastered"==t?c:"beaten"==t?l:"completed"==t?d:h,_=(e=>{const t=~~(e/3600),s=~~((e-3600*t)/60);return`\n          ${t>0?1==t?"1 hour ":t+" hours ":""}\n          ${t>0&&s>0?"and ":""}\n          ${s>0?1==s?"1 minute":s+" minutes":""}\n            `})(w._cfg.playTime[u]);this.backSide.imgElement.src=`https://media.retroachievements.org${n}`,this.backSide.titleElement.innerHTML=`${s} ${g(i)}\n                <i class="badge badge_gold">GAINED AWARD</i>\n            `;let E=`\n                ${v(`${t} IN ${_}`)}\n                ${v(`TOP${m}%`)}\n                ${v(`${I.cheevos}${o.hard.count}/${p}`)}\n                ${v(`${I.points}${o.hard.points}/${a}`)}\n                ${v(`${I.retropoints}${o.hard.retropoints}/${r}`)}\n            `;this.backSide.badgesElement.innerHTML=E,this.backSide.descriptionElement.innerText="",this.backSide.container.classList.add(t),setTimeout((()=>this.container.classList.add("new-award")),1e3)},a=e=>{this.backSide.imgElement.src=w.userImageSrc,this.backSide.titleElement.innerHTML=`\n                ${w.USER_NAME.toUpperCase()} statistics:\n            `;let t=`\n                ${v(`Rank: ${e.rank} ${e.deltaRank}`)}\n                ${v(`TOP ${e.percentile.toFixed(2)}% ${e.deltaPercentile}`)}\n                ${v(`${I.cheevos} +${e.cheevosCount}`)}\n                ${v(`${I.points}${e.points} ${e.deltaPoints}`)}\n                ${v(`${I.retropoints}${e.retroPoints} ${e.deltaRetroPoints}`)}\n                ${v(`${I.points}${e.softPoints}SP ${e.deltaSoftPoints}`)}\n            `;this.backSide.badgesElement.innerHTML=t,this.backSide.descriptionElement.innerText="",this.container.classList.add("stats")},o=t=>{switch(e(),t.type){case"new-game":s(t.value);break;case"new-achiv":i(t.value);break;case"new-award":n(t.value,t.award);break;case"stats":a(t.value)}};for(;this.alertsQuery.length>0;){const e=this.alertsQuery[0];if(!e.value)return void this.alertsQuery.shift();const s=()=>{o(e),this.container.classList.add("show-back"),t(),setTimeout((()=>{this.startAutoScrollElement(this.backSide.titleElement),this.startAutoScrollElement(this.backSide.badgesElement)}),2e3)},i=()=>{this.container.classList.remove("show-back"),this.alertsQuery.shift(),this.stopAutoScrollElement(this.backSide.badgesElement,!0),this.stopAutoScrollElement(this.backSide.titleElement,!0)};await h(1e3),s(),await h(1e3*this.NEW_ACHIV_DURATION),i()}}statsAnimationInterval;startStatsAnimation(){this.stopStatsAnimation(),this.section.classList.remove("timer-timeout");const e=this.getActiveTime(),t=this.section.querySelector(".status__game-time");t&&t.innerHTML!==e&&(t.innerHTML=e,this.frontSide.sideBlock.classList.toggle("long-time",e.length>6))}stopStatsAnimation(){clearInterval(this.statsAnimationInterval),this.currentStatusTextIndex=0}changeStatsElementValues({className:e,text:t}){this.progressStatusText.innerText=t,this.progressStatusText.className=`status__big-text ${e}`,this.CHANGE_PROGRESS_AUTO&&"gameTime"!=e&&this.section.style.setProperty("--progress-points",this.convertToPercentage(t)||"0%")}autoscrollAlertInterval={};startAutoScrollElement(e,t=!0,s=1e3){const i=e.className;this.autoscrollAlertInterval[i]?this.stopAutoScrollElement(e):this.autoscrollAlertInterval[i]={};this.autoscrollAlertInterval[i].interval=setInterval((()=>{e.clientWidth==e.scrollWidth?(this.stopAutoScrollElement(e,!0),this.autoscrollAlertInterval[i].timeout=setTimeout((()=>this.startAutoScrollElement(e,!0,s)),1e4)):t?(e.scrollLeft++,e.scrollWidth-e.scrollLeft<=e.clientWidth&&(this.stopAutoScrollElement(e),this.autoscrollAlertInterval[i].timeout=setTimeout((()=>this.startAutoScrollElement(e,!1,s)),5e3))):(e.scrollLeft--,e.scrollLeft<=0&&(this.stopAutoScrollElement(e),this.autoscrollAlertInterval[i].timeout=setTimeout((()=>this.startAutoScrollElement(e,!0,s)),s)))}),50)}stopAutoScrollElement(e,t=!1){t&&(e.scrollLeft=0),clearInterval(this.autoscrollAlertInterval[e.className].interval),clearTimeout(this.autoscrollAlertInterval[e.className].timeout)}convertToPercentage(e){const t=e.split("/");return(parseInt(t[0],10)/parseInt(t[1],10)*100).toFixed(2)+"%"}fitFontSize(e=!1){const t=this.section.querySelector(".status__container");let s=w.ui["update-section"]?.height??this.section.getBoundingClientRect().height;e&&(s=this.section.getBoundingClientRect().height);const i=(parseInt(s)-10)/5.5+"px";t.style.fontSize=i}blinkUpdate(){this.section.classList.remove("offline","blink"),this.BLINK_ON_UPDATE&&R.IS_ONLINE?(this.section.classList.add("blink"),setTimeout((()=>this.section.classList.remove("blink","offline")),1e3)):R.IS_ONLINE||this.section.classList.add("offline")}}function n(){const e={...R.GAME_DATA?.earnedStats,user:w?.targetUser,game:R.GAME_DATA?.FixedTitle,console:R.GAME_DATA?.ConsoleName,totalCheevos:R.GAME_DATA?.NumAchievements,totalPoints:R.GAME_DATA?.totalPoints,totalRetropoints:R.GAME_DATA?.TotalRetropoints},t="&nbsp;&nbsp;&middot;&nbsp;&nbsp;\n    ",s=`retrocheevos.vercel.app${t}`,i=`\n        ${e.user} is playing ${e.game} for ${e.console}${t}`,n=`\n        Game statistics: \n        ${e.hard.count>0?e.hard.count+"/":""}${e.soft.count>0?e.soft.count+"/":""}${e.totalCheevos} achievements, \n        ${e.hard.points>0?e.hard.points+"/":""}${e.soft.points>0?e.soft.points+"/":""}${e.totalPoints} points, \n        ${e.hard.retropoints?e.hard.retropoints+"/":""}${e.totalRetropoints} retropoints${t}`,a=!!b.statusPanel?.deltaStats?.deltaPoints,o=!!b.statusPanel?.deltaStats,r=a?`${b.statusPanel.deltaStats.deltaPoints} hardpoints and ${b.statusPanel.deltaStats.deltaRetroPoints} retropoints`:`and ${b.statusPanel?.deltaStats?.deltaSoftPoints} softpoints`,c=o?`Session statistics: +${b.statusPanel.initialStats.cheevosCount} achievements, ${r}${t}`:"",l=b.statusPanel?.currentStats||b.statusPanel?.initialStats;return i+n+c+(l?`User statistics: position ${l?.rank} in RA rank system (TOP${l?.percentile.toFixed(2)}%), \n        ${l?.points} total hardpoints, \n        ${l?.retroPoints} total retropoints and\n        ${l?.softPoints} total softpoints\n        ${t}`:"")+s}function a({container:e,textGenerator:t}){const s=e=>`<p class="infinite-line">${e}</p>`;let i;const n=()=>{i&&clearInterval(i),e.innerHTML=""};return{startScrolling:()=>{n(),(()=>{for(;e.scrollWidth/e.offsetWidth<2||e.querySelectorAll("p").length<3;)e.innerHTML+=s(t())})(),i=setInterval((()=>{e.scrollLeft++,(e=>e.scrollLeft)(e)+e.offsetWidth>=e.scrollWidth&&(e.querySelector(".infinite-line").remove(),e.scrollTo(e.scrollWidth,0),e.innerHTML+=s(t()))}),40)},stopScrolling:n}}class SidePanel{get VISIBLE(){return!this.section.classList.contains("hidden")}constructor(){this.initializeElements(),this.addEvents(),this.setValues()}initializeElements(){this.section=document.querySelector("#side_panel"),this.header=this.section.querySelector("#buttons-header_container"),this.settings=this.section.querySelector("#open-settings-button"),this.achievements=this.section.querySelector("#open-achivs-button"),this.gameCard=this.section.querySelector("#open-game-card-button"),this.target=this.section.querySelector("#open-target-button"),this.status=this.section.querySelector("#open-status-button"),this.awards=this.section.querySelector("#open-awards-button"),this.games=this.section.querySelector("#open-games-button"),this.progression=this.section.querySelector("#open-progression-button"),this.userImage=this.section.querySelector("#side-panel-user-image"),this.note=this.section.querySelector("#open-note-button"),this.notifications=this.section.querySelector("#open-notifications-button"),this.user=this.section.querySelector("#open-user-button"),this.stats=this.section.querySelector("#open-stats-button")}addEvents(){this.sidePanel=document.querySelector("#side_panel"),setTimeout((()=>b.buttons.section.classList.remove("expanded")),2e3),document.addEventListener("touchstart",(e=>this.touchVisibilityHandler(e))),document.addEventListener("mousemove",(e=>this.positionVisibilityHandler(e))),this.settings.addEventListener("click",(e=>{const t=document.querySelector("#settings_section");t?t.remove():b.settings.openSettings()}))}setValues(){this.userImage.src=w.userImageSrc}touchVisibilityHandler(e){e.touches[0].clientX<50&&(this.section.classList.add("expanded"),this.section.addEventListener("blur",(e=>{setTimeout((()=>b.buttons.section.classList.remove("expanded")),0)})))}positionVisibilityHandler(e){e.clientX<10&&(this.section.classList.add("expanded"),this.section.addEventListener("mouseleave",(e=>{setTimeout((()=>b.buttons.section.classList.remove("expanded")),200)})))}generatePanel(){const e=document.createElement("section");e.id="side_panel",e.classList.add("buttons-block","expanded")}}class Settings{get settingsItems(){return[{label:b.lang.style,elements:[{type:"select",label:b.lang.selectColors,id:"settings_colors-selector",selectValues:[...Object.keys(s).map((e=>({type:"radio",name:"settings_color-scheme",id:`settings_color-scheme-${e}`,label:e,checked:b.settings.COLOR_SCHEME===e,event:`onchange="ui.settings.COLOR_SCHEME = '${e}'"`}))),{type:"radio",name:"settings_color-scheme",id:"settings_color-scheme-custom",label:"custom",checked:"custom"===b.settings.COLOR_SCHEME,event:"onchange=\"ui.settings.COLOR_SCHEME = 'custom'\""}]},{type:"checkbox",label:b.lang.showBgAnimation,id:"settings_show-bg",onChange:"ui.settings.BG_ANIMATION = this.checked;",checked:this.BG_ANIMATION},{type:"checkbox",label:"Sticky Windows",id:"settings_sticky-windows",onChange:"ui.settings.IS_WINDOWS_STICKY = this.checked;",checked:this.IS_WINDOWS_STICKY}]},{label:b.lang.customColors,elements:[{type:"color",id:"main-color-input",label:"main color",value:w.mainColor,onChange:"console.log(this); config.mainColor = this.value; ui.settings.COLOR_SCHEME = ui.settings.COLOR_SCHEME"},{type:"color",id:"secondary-color-input",label:"secondary color",value:w.secondaryColor,onChange:"config.secondaryColor = this.value; ui.settings.COLOR_SCHEME = ui.settings.COLOR_SCHEME"},{type:"color",id:"accent-color-input",label:"accent color",value:w.accentColor,onChange:"config.accentColor = this.value; ui.settings.COLOR_SCHEME = ui.settings.COLOR_SCHEME"},{type:"color",id:"selection-color-input",label:"selection color",value:w.selectionColor,onChange:"config.selectionColor = this.value; ui.settings.COLOR_SCHEME = ui.settings.COLOR_SCHEME"},{type:"color",id:"font-color-input",label:"font color",value:w.fontColor,onChange:"config.fontColor = this.value; ui.settings.COLOR_SCHEME = ui.settings.COLOR_SCHEME"}]},{label:b.lang.fontFamily,elements:[{type:"select",label:b.lang.selectFont,id:"settings_font-family",selectValues:[{type:"radio",name:"settings_font-family",id:"settings_font-family-default",label:"default",checked:"default"===b.settings.FONT_NAME,event:"onchange=\"ui.settings.selectFont('default');\""},{type:"radio",name:"settings_font-family",id:"settings_font-family-Oxygen",label:"Oxygen",checked:"Oxygen"===b.settings.FONT_NAME,event:"onchange=\"ui.settings.selectFont('oxygen');\""},{type:"radio",name:"settings_font-family",id:"settings_font-family-Shadows",label:"Shadows",checked:"Shadows"===b.settings.FONT_NAME,event:"onchange=\"ui.settings.selectFont('shadows');\""},{type:"radio",name:"settings_font-family",id:"settings_font-family-Pixelify",label:"Pixelify",checked:"Pixelify Sans"===b.settings.FONT_NAME,event:"onchange=\"ui.settings.selectFont('pixelifySans');\""},{type:"radio",name:"settings_font-family",id:"settings_font-family-Jaro",label:"Jaro",checked:"Jaro"===b.settings.FONT_NAME,event:"onchange=\"ui.settings.selectFont('jaro');\""},{type:"radio",name:"settings_font-family",id:"settings_font-family-Jacquard",label:"Jacquard",checked:"Jacquard"===b.settings.FONT_NAME,event:"onchange=\"ui.settings.selectFont('jacquard');\""},{type:"radio",name:"settings_font-family",id:"settings_font-family-Custom",label:"Custom",checked:"custom"===b.settings.FONT_NAME,event:"onchange=\"ui.settings.selectFont('custom');\""}]},{type:"search",label:b.lang.pasteHere,id:"settings_font-input",value:"",onChange:"ui.settings.FONT_FAMILY = this.value; this.value = '';"},{type:"button",label:"-",id:"settings_font-size-decrease",onClick:"ui.settings.FONT_SIZE = parseFloat(ui.settings.FONT_SIZE) - 0.5;"},{type:"button",label:"+",id:"settings_font-size-increase",onClick:"ui.settings.FONT_SIZE = parseFloat(ui.settings.FONT_SIZE) + 0.5;"}]},{label:b.lang.targetUser,elements:[{type:"search",label:w.targetUser,id:"settings_target-user-input",value:w.targetUser,onChange:"config.targetUser = this.value"}]},{label:b.lang.gameID,elements:[{type:"button",label:b.lang.checkGameID,id:"settings_check-game-id",onClick:"watcher.updateGameData(config.gameID)"},{type:"button",label:b.lang.getLastID,id:"settings_get-last-id",onClick:"ui.settings.getLastGameID()"},{type:"number",label:b.lang.gameID,id:"settings_game-id-input",value:w.gameID,onChange:"config.gameID = this.value;"}]},{label:b.lang.autoupdate,elements:[{type:"checkbox",label:b.lang.startOnLoad,id:"settings_start-on-load",onChange:"ui.settings.START_ON_LOAD = this.checked;",checked:this.START_ON_LOAD},{type:"checkbox",label:"**Pause if offline**",id:"settings_autopause",onChange:"ui.settings.PAUSE_ON_OFFLINE = this.checked;",checked:this.PAUSE_ON_OFFLINE},{type:"number",label:"sec",id:"settings_update-delay-input",value:w.updateDelay,onChange:"config.updateDelay = this.value",title:"autoupdate interval in secs"}]},{label:"Discord Alerts",elements:[{type:"text-input",label:b.lang.pasteWebhook,id:"settings_discord-hook-input",value:this.DISCORD_WEBHOOK??"",onChange:"ui.settings.DISCORD_WEBHOOK = value;"},{type:"checkbox",label:b.lang.startGameAlert,id:"settings_discord-start-game",onChange:"ui.settings.DISCORD_NEW_GAME = this.checked;",checked:this.DISCORD_NEW_GAME},{type:"checkbox",label:b.lang.startSession,id:"settings_discord-start-session",onChange:"ui.settings.DISCORD_START_SESSION = this.checked;",checked:this.DISCORD_START_SESSION},{type:"checkbox",label:b.lang.earnCheevoAlert,id:"settings_discord-new-cheevo",onChange:"ui.settings.DISCORD_NEW_CHEEVO = this.checked;",checked:this.DISCORD_NEW_CHEEVO},{type:"number",label:b.lang.points,id:"settings_min-points-alert",title:"Min points for Alert",value:this.DISCORD_MIN_POINTS_ALERT,onChange:"ui.settings.DISCORD_MIN_POINTS_ALERT = this.value;"},{type:"number",label:b.lang.retropoints,title:"Min retroPoints for Alert",id:"settings_min-retropoints-alert",value:this.DISCORD_MIN_RETROPOINTS_ALERT,onChange:"ui.settings.DISCORD_MIN_RETROPOINTS_ALERT = this.value;"},{type:"checkbox",label:"Hardcore Only",id:"settings_discord-hard-award",onChange:"ui.settings.DISCORD_HARD_ONLY_ALERT = this.checked;",checked:this.DISCORD_HARD_ONLY_ALERT},{type:"checkbox",label:b.lang.earnAwardAlert,id:"settings_discord-new-award",onChange:"ui.settings.DISCORD_NEW_AWARD = this.checked;",checked:this.DISCORD_NEW_AWARD}]},{label:"Language",elements:[{type:"radio",label:"English",id:"settings_lang-en",onChange:"ui.settings.LANG = 'en';",checked:"en"===this.LANG},{type:"radio",label:"",id:"settings_lang-ua",onChange:"ui.settings.LANG = 'ua';",checked:"ua"===this.LANG},{type:"radio",label:"Japanese",id:"settings_lang-jp",onChange:"ui.settings.LANG = 'jp';",checked:"jp"===this.LANG}]},{label:b.lang.data,elements:[{label:b.lang.exportCompletion,type:"button",name:"context_export-completion",id:"context_export-completion",event:'onclick="ui.exportCompletionDataToXlsx()"'},{label:b.lang.exportWantToPlay,type:"button",name:"context_export-wtp-list",id:"context_export-wtp-list",event:'onclick="ui.exportWantToPlayToCSV()"'},{label:b.lang.exportSettings,type:"button",name:"context_export-settings",id:"context_export-settings",event:'onclick="ui.exportSettingsToJson()"'},{label:b.lang.importSettings,type:"button",name:"context_import-settings",id:"context_import-settings",event:'onclick="ui.importSettingsFromJson()"'}]}]}set DISCORD_MIN_POINTS_ALERT(e){w._cfg.settings.minPointsDiscordAlert=e>0?e:0,w.writeConfiguration()}get DISCORD_MIN_POINTS_ALERT(){return w._cfg.settings?.minPointsDiscordAlert??0}set DISCORD_HARD_ONLY_ALERT(e){w._cfg.settings.hardOnlyDiscordAlert=e,w.writeConfiguration()}get DISCORD_HARD_ONLY_ALERT(){return w._cfg.settings?.hardOnlyDiscordAlert??!1}set DISCORD_MIN_RETROPOINTS_ALERT(e){w._cfg.settings.minRetroPointsDiscordAlert=e>0?e:0,w.writeConfiguration()}get DISCORD_MIN_RETROPOINTS_ALERT(){return w._cfg.settings?.minRetroPointsDiscordAlert??0}get LANG(){return w.ui?.local??"en"}set LANG(e){w.ui.local=e,w.writeConfiguration(),setTimeout((()=>location.reload()),1e3)}get PAUSE_ON_OFFLINE(){return!0}set PAUSE_ON_OFFLINE(e){w.ui.pauseOffline=e,w.writeConfiguration()}get IS_WINDOWS_STICKY(){return w.ui.isWindowsSticky??!0}set IS_WINDOWS_STICKY(e){w.ui.isWindowsSticky=e,w.writeConfiguration()}get DISCORD_WEBHOOK(){return w.DISCORD_WEBHOOK??""}set DISCORD_WEBHOOK(e){w.DISCORD_WEBHOOK=e,w.writeConfiguration()}get DISCORD_NEW_GAME(){return w._cfg?.discordNewGame??!0}set DISCORD_NEW_GAME(e){w._cfg.discordNewGame=e,w.writeConfiguration()}get DISCORD_NEW_CHEEVO(){return w._cfg?.discordNewCheevo??!0}set DISCORD_NEW_CHEEVO(e){w._cfg.discordNewCheevo=e,w.writeConfiguration()}get DISCORD_NEW_AWARD(){return w._cfg?.discordNewAward??!0}set DISCORD_NEW_AWARD(e){w._cfg.discordNewAward=e,w.writeConfiguration()}get DISCORD_START_SESSION(){return w._cfg?.discordStartSession??!0}set DISCORD_START_SESSION(e){w._cfg.discordStartSession=e,w.writeConfiguration()}get VISIBLE(){return!this.section.classList.contains("hidden")}get contextMenuItems(){return[{label:b.lang.selectColors,elements:Object.keys(s).map((e=>({type:"radio",name:"context_color-scheme",id:`context_color- scheme - ${e}`,label:e,checked:b.settings.COLOR_SCHEME===e,event:`onchange ="ui.settings.COLOR_SCHEME = '${e}'"`})))},{label:b.lang.showBgAnimation,type:"checkbox",name:"context_show-bg-animation",id:"context_show-bg-animation",checked:b.settings.BG_ANIMATION,event:'onchange="ui.settings.BG_ANIMATION = this.checked;"'},{label:b.lang.startOnLoad,type:"checkbox",name:"context_show-start-on-load",id:"context_show-start-on-load",checked:b.settings.START_ON_LOAD,event:'onchange="ui.settings.START_ON_LOAD = this.checked;"'}]}get FONT_SIZE(){return w?._cfg.settings?.fontSize??14}set FONT_SIZE(e){w._cfg.settings.fontSize=e,w.writeConfiguration(),document.documentElement.style.setProperty("font-size",`${this.FONT_SIZE}px`)}get FONT_FAMILY(){return this.fonts[w._cfg?.fontSelectorName??"default"]}get FONT_NAME(){let e=new RegExp(/(?<=family=)([A-Za-z0-9+);])*/gim),t="default";return e.test(this.FONT_FAMILY)&&(t=this.FONT_FAMILY.match(e)[0].replaceAll("+"," ")),t}set FONT_FAMILY(e){let t=new RegExp(/https:\/\/[^'");]*/gim),s=new RegExp(/(?<=family=)([A-Za-z0-9+);])*/gim);if(t.test(e)){let i=e.match(t)[0],n=e.match(s)[0].replaceAll("+"," ");const a=document.createElement("link");a.rel="stylesheet",a.href=i,document.head.appendChild(a),document.documentElement.style.setProperty("--font-family",`"${n}", system-ui, sans-serif`)}"def"==e&&document.documentElement.style.setProperty("--font-family"," system-ui, sans-serif")}loadCustomFont(e){const t=this.parseFontUrl(e);t&&(w._cfg.settings.customFontFamily=t.fontFamily,this.fontColorInput.value=t.fontName,this.FONT_FAMILY=t.fontFamily,this.fontSelector.value="custom",w._cfg.fontSelectorName="custom",w.writeConfiguration()),"def"==e&&(w._cfg.settings.fontFamily="",w.writeConfiguration(),document.documentElement.style.setProperty("--font-family"," system-ui, sans-serif"))}parseFontUrl(e){let t=new RegExp(/https:\/\/[^'");]*/gim),s=new RegExp(/(?<=family=)([A-Za-z0-9+);])*/gim);if(t.test(e)){return{fontFamily:e.match(t)[0],fontName:e.match(s)[0].replaceAll("+"," ")}}}get COLOR_SCHEME(){return w._cfg.settings.preset||"default"}set COLOR_SCHEME(e){console.log("set color"),w._cfg.settings.preset=e,w.writeConfiguration(),ui_UI.updateColors(e)}get BG_ANIMATION(){return w._cfg.settings.bgVisibility??!0}set BG_ANIMATION(e){w._cfg.settings.bgVisibility=e,w.writeConfiguration(),document.querySelector("#background-animation").style.display=w.bgVisibility?"block":"none"}get START_ON_LOAD(){return w._cfg.settings.startOnLoad??!1}set START_ON_LOAD(e){w._cfg.settings.startOnLoad=e,w.writeConfiguration()}fonts={default:"def",pixelifySans:"https://fonts.googleapis.com/css2?family=Pixelify+Sans",jaro:"https://fonts.googleapis.com/css2?family=Jaro",oxygen:"https://fonts.googleapis.com/css2?family=Oxygen:wght@300;400;700",jacquard:"https://fonts.googleapis.com/css2?family=Jacquard+24",shadows:"https://fonts.googleapis.com/css2?family=Shadows+Into+Light&display=swap",custom:w._cfg?.settings?.customFontFamily??"def"};constructor(){this.setValues()}setValues(){this.FONT_SIZE=this.FONT_SIZE,this.FONT_FAMILY=this.fonts[w._cfg?.fontSelectorName??"default"]}getLastGameID(){apiWorker.getProfileInfo({}).then((e=>{document.getElementById("settings_game-id-input").value=e.LastGameID,w.gameID=e.LastGameID,watcher.updateGameData()}))}selectFont(e){const t=e;this.FONT_FAMILY=this.fonts[t],w._cfg.fontSelectorName=t,w.writeConfiguration()}close(){b.buttons.settings.checked=!1,this.section&&this.section.remove()}openSettings(e=this.settingsItems){this.close(),this.section=this.generateSettingsContainer(e),w.ui.settings_section&&(w.ui.settings_section.x&&(this.section.style.left=w.ui.settings_section.x),w.ui.settings_section.y&&(this.section.style.top=w.ui.settings_section.y)),this.section.querySelector(".header-container").addEventListener("mousedown",(e=>{ui_UI.moveEvent(this.section,e)})),this.section.addEventListener("click",(e=>{this.section.querySelectorAll(".extended").forEach((e=>e.classList.remove("extended")))})),b.app.appendChild(this.section),b.buttons.settings.checked=!0}generateSettingsContainer(e){const t=document.createElement("section");t.classList.add("prefs_section","section"),t.id="settings_section",t.innerHTML='\n        <div class="header-container prefs-header-container">\n          <div class="header-icon settings-icon"></div>\n          <h2 class="widget-header-text prefs-header">Settings</h2>\n          <button class="header-button header-icon close-icon" onclick="ui.settings.close()">\n          </button>\n        </div>\n        <div class="settings_container "></div>\n      ';const s=document.createElement("ul");s.classList.add("settings_container","content-container");const i=e=>{switch(e.type){case"button":return`\n              <button class="button-input" ${e.event??""} onclick="${e.onClick??""}">${e.label}</button>\n            `;case"checkbox":return`\n              <div class="checkbox-input_container">\n                <input ${e.event??"--"}  onchange="${e.onChange??""}" type="checkbox" id="${e.id}" ${e.checked&&"checked"}>\n                <label class="checkbox-input" for="${e.id}">${e.label}</label>\n              </div>\n            `;case"radio":return`\n              <div class="radio-input_container">\n                <input ${e.event??"--"} name="${e.name}"  onchange="${e.onChange??""}" type="radio" id="${e.id}" ${e.checked&&"checked"}>\n                <label class="checkbox-input" for="${e.id}">${e.label}</label>\n              </div>\n            `;case"select":return`\n              <button class="select-button" id="${e.id}" onclick="this.classList.toggle('extended'); event.stopPropagation();">\n                <div class="select-label"> ${e.label}</div>\n                <div class="select-menu">\n               ${ui_UI.generateContextMenu({menuItems:e.selectValues}).innerHTML}\n             \n                </div>\n              </button>\n            `;case"number":case"input-number":return`\n            <input type="number" data-title="${e.title?e.title:e.prefix??""}" class="text-input" id="${e.id}" value="${e.value}"\n                 placeholder="${e.label}" onchange="${e.onChange}"/>\n              `;case"text-input":return`\n                <input type="text" class="text-input" id="${e.id}" data-title="${e.title?e.title:""}" value="${e.value}"\n                 placeholder="${e.label}" onchange="${e.onChange}"/>\n              `;case"search":return`\n                <input type="search" class="text-input" data-title="${e.title?e.title:""}" id="${e.id}" value="${e.value}"\n                 placeholder="${e.label}" onchange="${e.onChange}"/>\n              `;case"color":return`\n            <input type="color" class="color-input" onchange="${e.onChange}" value="${e.value}" id="${e.id}" data-title="${e.label}" />\n            `;default:return"default"}};return e.forEach((e=>{const t=document.createElement("li");t.classList.add("settings_setting-line"),t.innerHTML=`\n          <h3 class="settings_setting-header">${e?.label}</h3>\n        `,e.elements?e.elements.forEach((e=>{t.innerHTML+=i(e)})):t.innerHTML+=i(e),s.appendChild(t)})),t.appendChild(s),t}}class Note extends Widget{widgetIcon={description:"notes widget",iconID:"side-panel__note",onChangeEvent:"ui.note.VISIBLE = this.checked",iconClass:"note-icon"};AUTOSAVE_INTERVAL_MILISECS=2e3;get notesTabs(){return[{type:"radio",name:"note__tabs",id:"notes__main-tab",label:b.lang.mainNote,checked:"main"===this.CURRENT_TAB,onChange:"ui.note.CURRENT_TAB = 'main'"},{type:"radio",name:"note__tabs",id:"notes__game-tab",label:b.lang.gameNote,checked:"game"===this.CURRENT_TAB,onChange:"ui.note.CURRENT_TAB = 'game'"}]}get NOTES_VALUE(){return w._cfg.ui?.note_section?.notes??""}set NOTES_VALUE(e){w._cfg.ui.note_section.notes=e,w.writeConfiguration()}get GAME_NOTES_VALUE(){return w._cfg.ui.note_section.game_notes||(w._cfg.ui.note_section.game_notes={}),w._cfg.ui?.note_section?.game_notes[w.gameID]??""}set GAME_NOTES_VALUE(e){w._cfg.ui.note_section.game_notes[w.gameID]=e,w.writeConfiguration()}get CURRENT_TAB(){return w._cfg.ui?.note_section?.currentTab??"main"}set CURRENT_TAB(e){w._cfg.ui.note_section.currentTab=e,w.writeConfiguration(),this.switchActiveTab()}constructor(){super(),this.addWidgetIcon(),w._cfg.ui.note_section||(w._cfg.ui.note_section={}),this.initializeElements(),this.generateTabs(),this.addEvents(),this.setValues(),ui_UI.applyPosition({widget:this})}initializeElements(){this.section=document.querySelector("#note_section"),this.header=this.section.querySelector(".header-container"),this.resizer=this.section.querySelector("#note-resizer"),this.textarea=this.section.querySelector(".note-textaria")}generateTabs(){const e=this.notesTabs.reduce(((e,t)=>e+=`\n          <div class="checkbox-input_container" onmousedown="event.stopPropagation()">\n            <input  onchange="${t.onChange}" type="radio" id="${t.id}" ${t.checked?"checked":""} name="${t.name}">\n            <label class="radio-tab" for="${t.id}">${t.label}</label>\n          </div>\n        `),"");document.querySelector(".note__tabs-container").innerHTML=e}addEvents(){this.delayedSave={},this.textarea.addEventListener("input",this.textInputHandler),this.resizer.addEventListener("mousedown",(e=>{e.stopPropagation(),this.section.classList.add("resized"),ui_UI.resizeEvent({event:e,section:this.section})})),this.header.addEventListener("mousedown",(e=>{e.target.matches(".close-icon")?this.close():ui_UI.moveEvent(this.section,e)}))}textInputHandler(e){const t="main"==b.note.CURRENT_TAB?"main":w.gameID,s=b.note.textarea.value;clearTimeout(b.note.delayedSave[t]),b.note.delayedSave[t]=setTimeout((()=>{b.note.saveNoteValue({id:t,value:s})}),b.note.AUTOSAVE_INTERVAL_MILISECS)}saveNoteValue({id:e,value:t}){if("main"===e)this.NOTES_VALUE=t;else w._cfg.ui.note_section.game_notes[e]=t,w.writeConfiguration()}setValues(){this.switchActiveTab()}switchActiveTab(){switch(this.CURRENT_TAB){case"main":this.textarea.value=this.NOTES_VALUE;break;case"game":this.textarea.value=this.GAME_NOTES_VALUE}}updateGame(){"game"===this.CURRENT_TAB&&(this.textarea.value=this.GAME_NOTES_VALUE)}async copyNoteText(){const e=this.textarea.value.substring(this.textarea.selectionStart,this.textarea.selectionEnd),t=e||this.textarea.value;try{await navigator.clipboard.writeText(t),this.textInputHandler()}catch(e){console.error(e)}}async pasteTextToNote(){try{const e=await navigator.clipboard.readText();this.textarea.value+=e,this.textInputHandler()}catch(e){console.error(e)}}clearTextNote(){this.textarea.value="",this.textInputHandler()}}class Awards extends Widget{widgetIcon={description:"awards widget",iconID:"side-panel__awards",onChangeEvent:"ui.awards.VISIBLE = this.checked",iconClass:"awards-icon"};awardTypes={mastery:"mastery",completion:"completion",beatenSoftcore:"beatenSoftcore",beatenHardcore:"beatenHardcore"};constructor(){super(),this.generateWidget(),this.addWidgetIcon(),this.initializeElements(),this.addEvents(),ui_UI.applyPosition({widget:this})}generateWidget(){const e={classes:["awards_section","section"],id:"awards_section",title:"Awards",headerElementsHtml:'\n            <div class="get-awards_button header-button header-icon update-icon" title="force reload"></div>\n        ',contentClasses:["awards-content_container","content-container"]},t=this.generateWidgetElement(e);b.app.appendChild(t)}initializeElements(){this.section=document.querySelector(".awards_section"),this.container=this.section.querySelector(".awards-content_container")}addEvents(){super.addEvents(),this.section.querySelector(".update-icon")?.addEventListener("click",(()=>this.updateAwards()))}async updateAwards(){const e=await C.getUserAwards({});this.parseAwards(e)}parseAwards(e){if(!e?.TotalAwardsCount)return;this.container.innerHTML="";const{dataset:t}=this.container;t.total=e.TotalAwardsCount,t.beatenSoftcore=e.BeatenSoftcoreAwardsCount,t.beatenHard=e.BeatenHardcoreAwardsCount,t.completion=e.CompletionAwardsCount,t.mastery=e.MasteryAwardsCount;let s=[...e.VisibleUserAwards];s=this.fixGamesProperties(s);const i=this.generateAwardsGroupsArray(s);this.generateConsolesAwards(i)}fixGamesProperties(e){return e.map((e=>(e.awardedDate=new Date(e.AwardedAt),e.awardeTypeFixed="Game Beaten"===e.AwardType?1===e.AwardDataExtra?this.awardTypes.beatenHardcore:this.awardTypes.beatenSoftcore:1===e.AwardDataExtra?this.awardTypes.mastery:this.awardTypes.completion,e))).sort(((e,t)=>t.awardedDate-e.awardedDate))}generateAwardsGroupsArray(e){return e.reduce(((e,t)=>(e.hasOwnProperty(t.ConsoleName)||(e[t.ConsoleName]=[]),e[t.ConsoleName].push(t),e.Total.push(t),e)),{Total:[]})}generateConsolesAwards(e){Object.getOwnPropertyNames(e).forEach((t=>{let s=document.createElement("li");s.classList.add("console-awards"),"Total"!==t&&s.classList.add("collapsed"),s.dataset.consoleName=t;let i=e[t].length;const n=({awardType:e,gamesArray:t})=>t.filter((t=>t.awardeTypeFixed===e)).length;let a=n({awardType:this.awardTypes.beatenSoftcore,gamesArray:e[t]}),o=n({awardType:this.awardTypes.beatenHardcore,gamesArray:e[t]}),r=n({awardType:this.awardTypes.completion,gamesArray:e[t]}),c=n({awardType:this.awardTypes.mastery,gamesArray:e[t]});s.innerHTML=`\n          <h3 class="awards-console_header" onclick="ui.awards.expandAwards(this)">${t}</h3>\n          <ul class="console-awards-values">      \n            <li class="awarded-games total" title="total awards" onclick="ui.awards.filterAwards('all')">${i}</li>\n            <li class="awarded-games beaten-softcore" title="beaten softcore" onclick="ui.awards.filterAwards('${this.awardTypes.beatenSoftcore}')">${a}</li>\n            <li class="awarded-games beaten"  title="beaten"  onclick="ui.awards.filterAwards('${this.awardTypes.beatenHardcore}')">${o}</li>\n            <li class="awarded-games completed"  title="completed" onclick="ui.awards.filterAwards('${this.awardTypes.completion}')">${r}</li>\n            <li class="awarded-games mastered"  title="mastered" onclick="ui.awards.filterAwards('${this.awardTypes.mastery}')">${c}</li>\n          </ul>\n          <button class="expand-awards_button" onclick="ui.awards.expandAwards(this)"> </button>\n          <ul class="flex-main-list awarded-games_list ${"Total"==t?"":"hidden"} total">\n          </ul>\n          `,this.container.appendChild(s);let l=s.querySelector(".flex-main-list");e[t].forEach((e=>{l.appendChild(this.generateAwardElement(e))}))}))}generateAwardElement(e){let t=document.createElement("li");return t.classList.add("awarded-game","awards__game-item","main-column-item","right-bg-icon",e.awardeTypeFixed),t.dataset.title=`Award type: ${e.awardeTypeFixed}`,t.innerHTML=`\n            <img class="awards__game-preview" src="https://media.retroachievements.org${e.ImageIcon}" alt=" ">\n            <h3 class="game-title">${e.Title}</h3>\n            <p class="awards__game-description">${e.ConsoleName}</p>\n            <p class="awards__game-description">${e.timeString}</p>\n        `,t}expandAwards(e){const t=e.parentNode,s=t.querySelector(".awarded-games_list");s.classList.contains("hidden")?(t.classList.remove("collapsed"),s.classList.remove("hidden")):(t.classList.add("collapsed"),s.classList.add("hidden"))}filterAwards(e){this.container.querySelectorAll(".awarded-game").forEach((t=>{t.classList.remove("hidden"),t.classList.contains(e)||"all"===e||t.classList.add("hidden")}))}}class GameCard extends Widget{widgetIcon={description:"game info widget",iconID:"side-panel__gamecard",onChangeEvent:"ui.gameCard.VISIBLE = this.checked",iconClass:"game-info-icon"};get SHOW_BADGES(){return w.ui?.game_section?.showBadges??!0}set SHOW_BADGES(e){w.ui.game_section.showBadges=e,w.writeConfiguration(),this.updateGameCardInfo()}get SHOW_COMPLETION(){return w.getUIProperty({sectionID:this.section.id,property:"showCompletion"})??!0}set SHOW_COMPLETION(e){w.saveUIProperty({sectionID:this.section.id,property:"showCompletion",value:e}),this.updateGameCardInfo()}get SHOW_DEVELOPER(){return w.getUIProperty({sectionID:this.section.id,property:"showDeveloper"})??!0}set SHOW_DEVELOPER(e){w.saveUIProperty({sectionID:this.section.id,property:"showDeveloper",value:e}),this.updateGameCardInfo()}get SHOW_GENRE(){return w.getUIProperty({sectionID:this.section.id,property:"showGenre"})??!0}set SHOW_GENRE(e){w.saveUIProperty({sectionID:this.section.id,property:"showGenre",value:e}),this.updateGameCardInfo()}get SHOW_PLAYERS(){return w.getUIProperty({sectionID:this.section.id,property:"showPlayers"})??!0}set SHOW_PLAYERS(e){w.saveUIProperty({sectionID:this.section.id,property:"showPlayers",value:e}),this.updateGameCardInfo()}get SHOW_POINTS(){return w.getUIProperty({sectionID:this.section.id,property:"showPoints"})??!0}set SHOW_POINTS(e){w.saveUIProperty({sectionID:this.section.id,property:"showPoints",value:e}),this.updateGameCardInfo()}get SHOW_PUBLISHER(){return w.getUIProperty({sectionID:this.section.id,property:"showPublisher"})??!0}set SHOW_PUBLISHER(e){w.saveUIProperty({sectionID:this.section.id,property:"showPublisher",value:e}),this.updateGameCardInfo()}get SHOW_RELEASED(){return w.getUIProperty({sectionID:this.section.id,property:"showReleased"})??!0}set SHOW_RELEASED(e){w.saveUIProperty({sectionID:this.section.id,property:"showReleased",value:e}),this.updateGameCardInfo()}get SHOW_CHEEVOS(){return w.getUIProperty({sectionID:this.section.id,property:"showAchievements"})??!0}set SHOW_CHEEVOS(e){w.saveUIProperty({sectionID:this.section.id,property:"showAchievements",value:e}),this.updateGameCardInfo()}get SHOW_PLATFORM(){return w.getUIProperty({sectionID:this.section.id,property:"showPlatform"})??!0}set SHOW_PLATFORM(e){w.saveUIProperty({sectionID:this.section.id,property:"showPlatform",value:e}),this.updateGameCardInfo()}get contextMenuItems(){return[{label:b.lang.showTitleBadges,type:"checkbox",name:"game-card_show-badges",id:"game-card_show-badges",event:"onchange=\"ui.gameCard.SHOW_BADGES = this.parentNode.querySelector('input').checked\"",checked:this.SHOW_BADGES},{label:b.lang.platform,type:"checkbox",name:"context_show-platform",id:"context_show-platform",event:"onchange=\"ui.gameCard.SHOW_PLATFORM = this.parentNode.querySelector('input').checked\"",checked:this.SHOW_PLATFORM},{label:b.lang.developer,type:"checkbox",name:"context_show-developer",id:"context_show-developer",event:"onchange=\"ui.gameCard.SHOW_DEVELOPER = this.parentNode.querySelector('input').checked\"",checked:this.SHOW_DEVELOPER},{label:b.lang.publisher,type:"checkbox",name:"context_show-publisher",id:"context_show-publisher",event:"onchange=\"ui.gameCard.SHOW_PUBLISHER = this.parentNode.querySelector('input').checked\"",checked:this.SHOW_PUBLISHER},{label:b.lang.genre,type:"checkbox",name:"context_show-genre",id:"context_show-genre",event:"onchange=\"ui.gameCard.SHOW_GENRE = this.parentNode.querySelector('input').checked\"",checked:this.SHOW_GENRE},{label:b.lang.released,type:"checkbox",name:"context_show-released",id:"context_show-released",event:"onchange=\"ui.gameCard.SHOW_RELEASED = this.parentNode.querySelector('input').checked\"",checked:this.SHOW_RELEASED},{label:b.lang.points,type:"checkbox",name:"context_show-points",id:"context_show-points",event:"onchange=\"ui.gameCard.SHOW_POINTS = this.parentNode.querySelector('input').checked\"",checked:this.SHOW_POINTS},{label:b.lang.players,type:"checkbox",name:"context_show-players",id:"context_show-players",event:"onchange=\"ui.gameCard.SHOW_PLAYERS = this.parentNode.querySelector('input').checked\"",checked:this.SHOW_PLAYERS},{label:b.lang.completion,type:"checkbox",name:"context_show-completion",id:"context_show-completion",event:"onchange=\"ui.gameCard.SHOW_COMPLETION = this.parentNode.querySelector('input').checked\"",checked:this.SHOW_COMPLETION},{label:b.lang.cheevos,type:"checkbox",name:"context_show-achievements",id:"context_show-achievements",event:"onchange=\"ui.gameCard.SHOW_CHEEVOS = this.parentNode.querySelector('input').checked\"",checked:this.SHOW_CHEEVOS}]}gameInfoElements=()=>({Platform:{title:b.lang.platform,id:"game-card-platform",visible:this.SHOW_PLATFORM,value:()=>R.GAME_DATA?.ConsoleName??""},Developer:{title:b.lang.developer,id:"game-card-developer",visible:this.SHOW_DEVELOPER,value:()=>R.GAME_DATA?.Developer??""},Publisher:{title:b.lang.publisher,id:"game-card-publisher",visible:this.SHOW_PUBLISHER,value:()=>R.GAME_DATA?.Publisher??""},Genre:{title:b.lang.genre,id:"game-card-genre",visible:this.SHOW_GENRE,value:()=>R.GAME_DATA?.Genre??""},Released:{title:b.lang.released,id:"game-card-released",visible:this.SHOW_RELEASED,value:()=>{const{Released:e}=R?.GAME_DATA??!1;return e?new Date(e).toLocaleDateString():""}},Completion:{title:b.lang.completion,id:"game-card-completion",value:"",visible:this.SHOW_COMPLETION,value:()=>{const e=R.GAME_DATA?.earnedStats?.hard.count,t=R.GAME_DATA?.NumAchievements;return t?`${e} / ${t} cheevos`:"n/a"}},Points:{title:b.lang.points,id:"game-card-points-total",visible:this.SHOW_POINTS,value:()=>R.GAME_DATA?.totalPoints??""},Players:{title:b.lang.players,id:"#game-card-players-total",visible:this.SHOW_PLAYERS,value:()=>R.GAME_DATA?.NumDistinctPlayers??""},Achievements:{title:b.lang.cheevos,id:"game-card-achivs-count",visible:this.SHOW_CHEEVOS,value:()=>R.GAME_DATA?.NumAchievements??""}});constructor(){super(),this.addWidgetIcon(),this.initializeElements(),this.generateInfo(),this.addEvents(),ui_UI.applyPosition({widget:this})}initializeElements(){this.section=document.querySelector(".game-card_section"),this.header=document.querySelector("#game-card-header"),this.descriptions=document.querySelector(".game-card-description"),this.preview=document.querySelector("#game-card-image"),this.iconsContainer=this.section.querySelector(".game-card__icons-container"),this.resizer=document.querySelector("#game-card-resizer")}addEvents(){this.section.addEventListener("mousedown",(e=>{if(e.target.matches(".close-icon"))this.close();else if(e.target.closest(".comments-button")){const e=R.GAME_DATA?.ID;e&&b.showComments(e,1)}else ui_UI.moveEvent(this.section,e)})),this.section.addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation(),document.querySelector(".context-menu")?.remove(),this.contextMenu=ui_UI.generateContextMenu({menuItems:this.contextMenuItems,sectionCode:""}),this.section.appendChild(this.contextMenu),e.x+this.contextMenu.offsetWidth>window.innerWidth?this.contextMenu.style.left=e.x-this.contextMenu.offsetWidth+"px":this.contextMenu.style.left=e.x+"px",e.y+this.contextMenu.offsetHeight>window.innerHeight?this.contextMenu.style.top=e.y-this.contextMenu.offsetHeight+"px":this.contextMenu.style.top=e.y+"px",this.contextMenu.classList.remove("hidden")})),this.resizer.addEventListener("mousedown",(e=>{e.stopPropagation(),this.section.classList.add("resized"),ui_UI.resizeEvent({event:e,section:this.section})}))}generateInfo(){this.descriptions.innerHTML="";const e=this.gameInfoElements(),t=Object.keys(e).map((t=>{const s=e[t];return`\n                <div class="game-card-info ${s.visible?"":"hidden"}">\n                    <h3 class="game-info-header">${s.title}</h3>\n                    <p class="game-card-text" id="${s.id}">${s.value()}</p>\n                </div>\n            `})).join("\n");this.descriptions.innerHTML=t}async updateGameCardInfo(e=R.GAME_DATA){const{FixedTitle:t,ID:s,ImageBoxArt:i,Genre:n,TotalRetropoints:a,NumAchievements:r,totalPoints:c,badges:l,retroRatio:d}=e;this.generateInfo(),(async()=>{this.section.dataset.award=R.GAME_DATA?.award??"-",this.section.dataset.progressionAward=R.GAME_DATA?.progressionAward??"-",this.header.innerHTML=`${t.replaceAll(/\,\s*the$/gi,"")}`,this.header.href=`https://retroachievements.org/game/${s}`,this.preview.src=`https://media.retroachievements.org${i}`,this.preview.alt=`${t} boxart`;const e=await o(s),a=e?.Genres,r=this.section.querySelector(".game-card__genres-container");r.innerHTML="",this.SHOW_BADGES&&(r.innerHTML=`\n                ${l?g(l):""} ${a?u(a):n?g(n.split(",")):""}`)})(),(()=>{this.iconsContainer.innerHTML=`\n            ${A.black(T.cheevos(r))}\n            ${A.black(T.points(c))}\n            ${A.black(T.retropoints(a))}\n            ${A.black(T.retroRatio(d))}\n            `})()}}const o=async e=>{if(!b.gamesExtInfo){const e=await fetch("./json/games/all_ext.json");b.gamesExtInfo=await e.json()}return e?b.gamesExtInfo.find((t=>t.ID==e)):void 0};class Progression extends Widget{widgetIcon={description:"progression widget",iconID:"side-panel__progression",onChangeEvent:"ui.progression.VISIBLE = this.checked",iconClass:"progression"};get contextMenuItems(){return[{label:b.lang.elements,elements:[{type:"checkbox",name:"context_show-header",id:"context_show-header",label:b.lang.showHeader,checked:this.SHOW_HEADER,event:'onchange="ui.progression.SHOW_HEADER = this.checked;"'},{type:"checkbox",name:"context_show-bg",id:"context_show-bg",label:b.lang.showBackground,checked:this.SHOW_BG,event:'onchange="ui.progression.SHOW_BG = this.checked;"'}]},{label:b.lang.style,elements:[{type:"checkbox",name:"context_progression-description",id:"context_show-all-descr",label:"**Show all descriptions**",checked:this.SHOW_DESCRIPTIONS,event:'onchange="ui.progression.SHOW_DESCRIPTIONS = this.checked;"'},{type:"checkbox",name:"context_show-sublevels",id:"context_show-sublevels",label:"**Show Sublevels**",checked:this.SHOW_SUBLEVELS,event:'onchange="ui.progression.SHOW_SUBLEVELS = this.checked;"'}]}]}get SHOW_BG(){return w.getUIProperty({sectionID:this.section.id,property:"showBG"})??!0}set SHOW_BG(e){w.saveUIProperty({sectionID:this.section.id,property:"showBG",value:e}),this.setElementsVisibility()}get SHOW_HEADER(){return w.getUIProperty({sectionID:this.section.id,property:"showHeader"})??!0}set SHOW_HEADER(e){w.saveUIProperty({sectionID:this.section.id,property:"showHeader",value:e}),this.setElementsVisibility()}get IS_HARD_MODE(){return w.getUIProperty({sectionID:this.section.id,property:"hardMode"})??!0}set IS_HARD_MODE(e){w.saveUIProperty({sectionID:this.section.id,property:"hardMode",value:e})}get SHOW_SUBLEVELS(){return w.getUIProperty({sectionID:this.section.id,property:"showSublevels"})??!0}set SHOW_SUBLEVELS(e){w.saveUIProperty({sectionID:this.section.id,property:"showSublevels",value:e}),this.setElementsVisibility()}get SHOW_DESCRIPTIONS(){return w.getUIProperty({sectionID:this.section.id,property:"showAllDescriptions"})??!1}set SHOW_DESCRIPTIONS(e){w.saveUIProperty({sectionID:this.section.id,property:"showAllDescriptions",value:e}),this.setElementsVisibility()}constructor(){super(),this.generateWidget(),this.addWidgetIcon(),this.initializeElements(),this.setElementsVisibility(),this.addEvents(),ui_UI.applyPosition({widget:this}),this.generateProgression()}initializeElements(){this.section=document.querySelector("#progression_section"),this.header=this.section.querySelector(".header-container"),this.resizer=this.section.querySelector("#progression-resizer")}setElementsVisibility(){this.section.classList.toggle("compact",!this.SHOW_HEADER),this.section.classList.toggle("hide-bg",!this.SHOW_BG),this.section.classList.toggle("show-all-descriptions",this.SHOW_DESCRIPTIONS),this.section.classList.toggle("show-sublevels",this.SHOW_SUBLEVELS)}addEvents(){super.addEvents(),this.section.addEventListener("contextmenu",(e=>{b.showContextmenu({event:e,menuItems:this.contextMenuItems,sectionCode:""})}))}IS_HARD_MODE=!0;update({earnedAchievementIDs:e}){e[0]&&(this.IS_HARD_MODE=R.CHEEVOS[e[0]].isHardcoreEarned),this.generateProgression()}generateWidget(){const e=this.generateWidgetElement({classes:["progression_section","section"],id:"progression_section",title:"Progression",contentClasses:["progression__list","content-container"]});b.app.appendChild(e)}generateProgression(){const e=this.section.querySelector(".progression__list");const t=Object.values(R.CHEEVOS)?.filter((e=>"progression"==e.type||"win_condition"==e.type)).sort(((e,t)=>0===e.DisplayOrder?e.ID-t.ID:e.DisplayOrder-t.DisplayOrder)),s=t.find((e=>this.IS_HARD_MODE?!e.isHardcoreEarned:!e.isEarned))?.ID;e.innerHTML=t?.reduce(((e,i)=>(e+=function(e,t){const i=e.level,n=t?.find((e=>e.level>i))?.level??i+1,a=null!=i?Object.values(R.CHEEVOS).filter((e=>e.level&&!["progression","win_condition"].includes(e.type)&&e.level>=i&&e.level<n)):[],o=`\n                <li class="progression__item ${s===e.ID?"focus":""} ${e.type}-cheevo">\n                    <p class="cheevo-date">${function(e){if(!e)return"";const[t,s]=e.split(", ");let[i,n,a]=t.split(".");return a=a.slice(2),`${i}.${n}.${a} ${s}`}(e.DateEarnedHardcore||e.DateEarned)}</p>\n                    <div class="mark ${e.isEarned?"earned":""} ${e.isHardcoreEarned?"hardcore":""}"></div>\n                    <div class="cheevo-container">\n                        <h3 class="cheevo-title" data-achiv-id="${e.ID}">${e.Title}</h3>\n                        <p class="cheevo-description">\n                            ${e.Description}</p>\n                        <div class="subcheevos-container">\n                            ${a?.reduce(((e,t)=>e+`<h3 class="progression__subcheevo ${t.isEarned?"earned":""} ${t.isHardcoreEarned?"hardcore":""}" data-achiv-id="${t.ID}">${t.Title}</h3>`),"")}\n                        </div>\n                    </div>\n                </li>\n            `;return o}(i,t),e)),"")??"",function(){const e=b.progression?.listContainer?.querySelector(".focus")||b.progression?.listContainer?.querySelector(".win_condition-cheevo");e?.scrollIntoView({behavior:"auto",block:"center"})}()}}class UserStatistic extends Widget{widgetIcon={description:"user statistics widget",iconID:"side-panel__stats",onChangeEvent:"ui.stats.VISIBLE = this.checked",iconClass:"stats-icon"};get contextMenuItems(){return[{label:b.lang.showStats,elements:[{type:"checkbox",name:"context_show-points",id:"context_show-points",label:b.lang.points,checked:this.SHOW_HP,event:'onchange="ui.stats.SHOW_HP = this.checked;"'},{type:"checkbox",name:"context_show-retropoints",id:"context_show-retropoints",label:b.lang.retropoints,checked:this.SHOW_RP,event:'onchange="ui.stats.SHOW_RP = this.checked;"'},{type:"checkbox",name:"context_show-softpoints",id:"context_show-softpoints",label:b.lang.softpoints,checked:this.SHOW_SP,event:'onchange="ui.stats.SHOW_SP = this.checked;"'},{type:"checkbox",name:"context_show-rank",id:"context_show-rank",label:b.lang.rank,checked:this.SHOW_RANK,event:'onchange="ui.stats.SHOW_RANK = this.checked;"'},{type:"checkbox",name:"context_show-percentile",id:"context_show-percentile",label:b.lang.percentile,checked:this.SHOW_PERCENTILE,event:'onchange="ui.stats.SHOW_PERCENTILE = this.checked;"'},{type:"checkbox",name:"context_show-true-ratio",id:"context_show-true-ratio",label:b.lang.trueRatio,checked:this.SHOW_TR,event:'onchange="ui.stats.SHOW_TR = this.checked;"'},{type:"checkbox",name:"context_show-completion-chart",id:"context_show-completion-chart",label:b.lang.completionChart,checked:this.SHOW_COMPLETION_CHART,event:'onchange="ui.stats.SHOW_COMPLETION_CHART = this.checked;"'}]},{label:b.lang.style,elements:[{type:"checkbox",name:"context_show-header",id:"context_show-header",label:b.lang.showHeader,checked:this.SHOW_HEADER,event:'onchange="ui.stats.SHOW_HEADER = this.checked;"'},{type:"checkbox",name:"context_show-bg",id:"context_show-bg",label:b.lang.showBackground,checked:this.SHOW_BG,event:'onchange="ui.stats.SHOW_BG = this.checked;"'}]},{type:"checkbox",name:"context_show-session-progress",id:"context_show-session-progress",label:b.lang.showSessionProgress,checked:this.SHOW_SESSION_PROGRESS,event:'onchange="ui.stats.SHOW_SESSION_PROGRESS = this.checked;"'}]}get SHOW_BG(){return w.ui?.stats_section?.showBG??!0}set SHOW_BG(e){this.saveProppertySetting("showBG",e),this.setElementsVisibility()}get SHOW_HEADER(){return w.ui?.stats_section?.showHeader??!0}set SHOW_HEADER(e){this.saveProppertySetting("showHeader",e),this.setElementsVisibility()}get SHOW_HP(){return w.ui?.stats_section?.showHP??!0}set SHOW_HP(e){this.saveProppertySetting("showHP",e),this.setElementsVisibility()}get SHOW_RP(){return w.ui?.stats_section?.showRP??!0}set SHOW_RP(e){this.saveProppertySetting("showRP",e),this.setElementsVisibility()}get SHOW_SP(){return w.ui?.stats_section?.showSP??!0}set SHOW_SP(e){this.saveProppertySetting("showSP",e),this.setElementsVisibility()}get SHOW_RANK(){return w.ui?.stats_section?.showRank??!0}set SHOW_RANK(e){this.saveProppertySetting("showRank",e),this.setElementsVisibility()}get SHOW_PERCENTILE(){return w.ui?.stats_section?.showPercentile??!0}set SHOW_PERCENTILE(e){this.saveProppertySetting("showPercentile",e),this.setElementsVisibility()}get SHOW_TR(){return w.ui?.stats_section?.showTrueRatio??!0}set SHOW_TR(e){this.saveProppertySetting("showTrueRatio",e),this.setElementsVisibility()}get SHOW_SESSION_PROGRESS(){return w.ui?.stats_section?.showSessionProgress??!0}set SHOW_SESSION_PROGRESS(e){this.saveProppertySetting("showSessionProgress",e),this.setElementsVisibility()}get SHOW_COMPLETION_CHART(){return w.ui?.stats_section?.completionChart??!1}set SHOW_COMPLETION_CHART(e){this.saveProppertySetting("completionChart",e),this.setElementsVisibility(),this.updateChart()}saveProppertySetting(e,t){w.ui.stats_section||(w.ui.stats_section={}),w.ui.stats_section[e]=t,w.writeConfiguration()}initialUserSummary;userSummary;constructor(){super(),this.addWidgetIcon(),this.initializeElements(),this.setElementsVisibility(),this.addEvents(),ui_UI.applyPosition({widget:this})}initializeElements(){this.section=document.querySelector("#stats_section"),this.header=this.section.querySelector(".header-container"),this.container=this.section.querySelector(".stats-container"),this.generateStatsElements(),this.rankRateElement=this.section.querySelector("#stats_rank-rate"),this.rankElement=this.section.querySelector("#stats_rank"),this.pointsElement=this.section.querySelector("#stats_points"),this.retropointsElement=this.section.querySelector("#stats_retropoints"),this.softpointsElement=this.section.querySelector("#stats_softpoints"),this.trueRatioElement=this.section.querySelector("#stats_true-ratio"),this.completionElement=this.section.querySelector(".stats__chart-container"),this.masteredCountElement=this.section.querySelector("#stats_mastered-count"),this.beatenCountElement=this.section.querySelector("#stats_beaten-count"),this.playedCountElement=this.section.querySelector("#stats_played-count"),this.resizer=this.section.querySelector(".resizer")}setElementsVisibility(){this.pointsElement.closest("li").classList.toggle("hidden",!this.SHOW_HP),this.retropointsElement.closest("li").classList.toggle("hidden",!this.SHOW_RP),this.softpointsElement.closest("li").classList.toggle("hidden",!this.SHOW_SP),this.rankElement.closest("li").classList.toggle("hidden",!this.SHOW_RANK),this.rankRateElement.closest("li").classList.toggle("hidden",!this.SHOW_PERCENTILE),this.trueRatioElement.closest("li").classList.toggle("hidden",!this.SHOW_TR),this.completionElement.classList.toggle("hidden",!this.SHOW_COMPLETION_CHART),this.section.classList.toggle("compact",!this.SHOW_HEADER),this.section.classList.toggle("hide-bg",!this.SHOW_BG),this.container.classList.toggle("show-session-progress",this.SHOW_SESSION_PROGRESS)}addEvents(){this.section.addEventListener("mousedown",(e=>{e.target.matches(".close-icon")?this.close():ui_UI.moveEvent(this.section,e)})),this.section.addEventListener("contextmenu",(e=>{b.showContextmenu({event:e,menuItems:this.contextMenuItems,sectionCode:""})})),this.resizer.addEventListener("mousedown",(e=>{e.stopPropagation(),this.section.classList.add("resized"),ui_UI.resizeEvent({event:e,section:this.section})}))}initialSetStats({userSummary:e,completionProgress:t}){this.initialData={Rank:e.Rank,rankRate:+(100*e.Rank/e.TotalRanked).toFixed(2),TotalPoints:e.TotalPoints,TotalSoftcorePoints:e.TotalSoftcorePoints,TotalTruePoints:e.TotalTruePoints,trueRatio:+(e.TotalTruePoints/e.TotalPoints).toFixed(2)},e&&(this.userSummary=e,this.initialUserSummary=e,this.rankElement.innerText=e.Rank,this.rankRateElement.innerText=(100*e.Rank/e.TotalRanked).toFixed(2)+"%",this.pointsElement.innerText=e.TotalPoints,this.softpointsElement.innerText=e.TotalSoftcorePoints,this.retropointsElement.innerText=e.TotalTruePoints,this.trueRatioElement.innerText=(e.TotalTruePoints/e.TotalPoints).toFixed(2)),setTimeout((()=>this.updateChart()),1e3)}async updateStats({currentUserSummary:e}){e||(e=await C.getUserSummary({gamesCount:"0",achievesCount:0}));const t=(t,s)=>{let i=0,n=0,a=0,o=0;switch(s){case"rankRate":a=(100*e.Rank/e.TotalRanked).toFixed(2),o=(100*this.userSummary.Rank/this.userSummary.TotalRanked).toFixed(2),i=+(a-o).toFixed(2),n=+(a-this.initialData.rankRate).toFixed(2),a+="%";break;case"trueRatio":a=(e.TotalTruePoints/e.TotalPoints).toFixed(2),o=(this.userSummary.TotalTruePoints/this.userSummary.TotalPoints).toFixed(2),i=+(a-o).toFixed(2),n=+(a-this.initialData.trueRatio).toFixed(2);break;default:i=e[s]-this.userSummary[s],n=e[s]-this.initialData[s],a=e[s]}if(0===i)return;const r=i<0,c=n<0;t.classList.add("delta"),t.classList.toggle("negative",r),t.dataset.delta=`${r?"":"+"}${i}`;setTimeout((()=>{t.innerHTML=a+` <span class="session-progress ${c?"negative":""}">\n            ${c?"":"+"}${n}</span>`,t.classList.remove("delta")}),5e3)};t(this.rankRateElement,"rankRate"),t(this.rankElement,"Rank"),t(this.pointsElement,"TotalPoints"),t(this.softpointsElement,"TotalSoftcorePoints"),t(this.retropointsElement,"TotalTruePoints"),t(this.trueRatioElement,"trueRatio"),this.userSummary=e}async updateChart(){if(!this.SHOW_COMPLETION_CHART)return;const e=this.section.querySelector(".stats__chart-container"),t=await C.SAVED_COMPLETION_PROGRESS,s=t?.Results??[],i=s.length,n=s.filter((e=>"mastered"===e.HighestAwardKind)).length/i*100,a=s.filter((e=>"completed"===e.HighestAwardKind)).length/i*100,o=s.filter((e=>"beaten-hardcore"===e.HighestAwardKind)).length/i*100,r=s.filter((e=>"beaten-softcore"===e.HighestAwardKind)).length/i*100;e.style.setProperty("--m",n+"%"),e.style.setProperty("--c",a+"%"),e.style.setProperty("--b",o+"%"),e.style.setProperty("--b-s",r+"%"),this.section.querySelector(".legend__value-mastered").innerText=n.toFixed(2)+"%",this.section.querySelector(".legend__value-completed").innerText=a.toFixed(2)+"%",this.section.querySelector(".legend__value-beaten").innerText=o.toFixed(2)+"%",this.section.querySelector(".legend__value-beaten-soft").innerText=r.toFixed(2)+"%",this.section.querySelector(".legend__value-progress").innerText=(100-n-a-o-r).toFixed(2)+"%"}statusProperties={percentile:{label:b.lang.percentile,id:"stats_rank-rate",class:"stats__rank-value"},rank:{label:b.lang.rank,id:"stats_rank",class:"stats__rank-value"},points:{label:b.lang.points,id:"stats_points"},retropoints:{label:b.lang.retropoints,id:"stats_retropoints"},trueRatio:{label:b.lang.trueRatio,id:"stats_true-ratio"},softpoints:{label:b.lang.softpoints,id:"stats_softpoints"}};generateStatsElements(){const e=Object.values(this.statusProperties).reduce(((e,t)=>e+=`\n          <li class="stats__stat-container">\n              <h2 class="stats__title">${t.label}</h2>\n              <p id="${t.id}" class="stats__value ${t.class}"></p>\n          </li>\n          `),""),t=`\n      <li class="stats__stat-container stats__chart-container">\n      <h2 class="stats__title">${b.lang.completionChart}</h2>\n      <div class="round-stat__container ">\n        <div class="circle">\n          <div class="round-stat__total" id="sector"></div>\n        </div>\n          <div class="round-stat__legend">\n              <div class="legend__award legend__mastered">mastered: <span class="legend__value-mastered">0%</span></div>\n              <div class="legend__award legend__completed">completed: <span class="legend__value-completed">0%</div>\n              <div class="legend__award legend__beaten">beaten: <span class="legend__value-beaten">0%</div>\n              <div class="legend__award legend__beaten-soft">beaten soft: <span class="legend__value-beaten-soft">0%</div>\n              <div class="legend__award legend__started">in progress: <span class="legend__value-progress">0%</div>\n          </div>\n      </div>\n      </li>\n      `;this.container.innerHTML=e+t}}class Notifications extends Widget{widgetIcon={description:"notifications widget",iconID:"side-panel__notifications",onChangeEvent:"ui.notifications.VISIBLE = this.checked",iconClass:"notification-icon"};get contextMenuItems(){return[{label:"Show header",type:"checkbox",name:"context_hide-notification-header",id:"context_hide-notification-header",checked:this.SHOW_HEADER,event:'onchange="ui.notifications.SHOW_HEADER = this.checked;"'},{label:"Hide background",type:"checkbox",name:"context_hide-notification-bg",id:"context_hide-notification-bg",checked:this.HIDE_BG,event:'onchange="ui.notifications.HIDE_BG = this.checked;"'},{label:"Show timestamp",type:"checkbox",name:"context_show-notification-time",id:"context_show-notification-time",checked:this.SHOW_TIMESTAMP,event:'onchange="ui.notifications.SHOW_TIMESTAMP = this.checked;"'}]}types={newGame:"newGame",earnedAchivs:"earnedAchivs"};get SHOW_TIMESTAMP(){return w?.ui.notification_section?.showTimestamp??!0}set SHOW_TIMESTAMP(e){w.ui.notification_section||(w.ui.notification_section={}),this.section.querySelectorAll(".notification_timestamp").forEach((e=>e.classList.toggle("hidden",this.SHOW_TIMESTAMP))),w.ui.notification_section.showTimestamp=e,w.writeConfiguration(),this.section.classList.toggle("compact",!this.SHOW_HEADER)}get SHOW_HEADER(){return w?.ui.notification_section?.showHeader??!0}set SHOW_HEADER(e){w.ui.notification_section||(w.ui.notification_section={}),w.ui.notification_section.showHeader=e,w.writeConfiguration(),this.section.classList.toggle("compact",!this.SHOW_HEADER)}get HIDE_BG(){return w?.ui.notification_section?.hideBg??!1}set HIDE_BG(e){w.ui.notification_section||(w.ui.notification_section={}),w.ui.notification_section.hideBg=e,w.writeConfiguration(),this.section.classList.toggle("hide-bg",this.HIDE_BG)}get NOTIFICATIONS(){return this._notifications??{time:"",notifications:[]}}constructor(){super(),this.addWidgetIcon(),this.initializeElements(),this.addEvents(),this.HIDE_BG=this.HIDE_BG,this.SHOW_HEADER=this.SHOW_HEADER,this.updateInterval=setInterval((()=>{this.container.querySelectorAll(".notification_timestamp").forEach((e=>{e.innerText=this.getDeltaTime(e.dataset.time)}))}),6e4),ui_UI.applyPosition({widget:this})}initializeElements(){this.section=document.querySelector("#notification_section"),this.container=this.section.querySelector(".notification-container"),this.resizer=this.section.querySelector(".resizer")}addEvents(){this.section.addEventListener("mousedown",(e=>{e.target.matches(".close-icon")?this.close():ui_UI.moveEvent(this.section,e)})),this.section.addEventListener("contextmenu",(e=>{b.showContextmenu({event:e,menuItems:this.contextMenuItems,sectionCode:""})})),this.resizer.addEventListener("mousedown",(e=>{e.stopPropagation(),this.section.classList.add("resized"),ui_UI.resizeEvent({event:e,section:this.section})}))}parseUserSummary(e){e.lastGames.map((e=>(e.DateEarnedHardcore=e.LastPlayed,e.type=this.types.newGame,e))),e.lastAchivs.map((e=>(e.DateEarnedHardcore=e.DateAwarded,e.type=this.types.earnedAchivs,e.BadgeURL=`Badge/${e.BadgeName}.png`,e))),[...e.lastAchivs,...e.lastGames].sort(((e,t)=>-1*ui_UI.sortBy.latest(e,t))).forEach((e=>this.pushNotification({type:e.type,elements:e,time:e.DateEarnedHardcore})))}pushNotification({type:e,elements:t,time:s}){e===this.types.earnedAchivs&&(t=t?.map((e=>R.CHEEVOS[e])));const i=this.generatePopupTime(s);let n=[];switch(e){case this.types.newGame:n.push(this.generateNewgameElement(t));break;case this.types.earnedAchivs:n=this.generateNewachivsElements([...t]);break;default:return void console.log("notification type doesn't exist")}const a=this.generateTimeBlock(i,n);n.length>0&&this.container.prepend(a);const o=a.getBoundingClientRect().height;this.container.style.setProperty("--offset-height",`${o}px`),a.classList.add("notification_popup")}generateTimeBlock(e,t){const s=document.createElement("ul");return s.classList.add("notification_timeblock-list"),s.appendChild(e),t.forEach((e=>{s.appendChild(e)})),s}generatePopupTime(e){const t=document.createElement("li"),s=(e?(e=>{const[t,s]=e.split(", "),[i,n,a]=t.split(".").map(Number),[o,r]=s.split(":").map(Number);return new Date(a,n-1,i,o,r)})(e):new Date).getTime();return t.dataset.time=s,t.classList.add("notification_timestamp"),!this.SHOW_TIMESTAMP&&t.classList.add("hidden"),t.innerHTML=`\n       ${this.getDeltaTime(s)}\n      `,t}generateNewgameElement(e){const t=document.createElement("li");return t.classList.add("notification-game","new-game"),t.innerHTML=`\n        <div class="prev">\n          <img class="prev-img" src="https://media.retroachievements.org${e.ImageIcon}" alt=" ">\n        </div>\n        <div class="notification_details">\n          <h3 class="achiv-name">\n            <a target="_blanc" href="https://retroachievements.org/game/${e.ID??e.GameID}">\n              ${e.Title}\n            </a>\n          </h3>\n          <p class="achiv-description">${e.Genre?e.Genre+",\n":""}${e.ConsoleName}</p>\n          <div class="notification_description-icons">\n            <p class="notification_description-text" title="points">\n              <i class="notification_description-icon  points-icon"></i>\n              ${e.totalPoints??""}\n            </p>\n            <p class="notification_description-text" title="retropoints">\n              <i class="notification_description-icon  achievements-icon"></i>\n              ${e.NumAchievements??e.AchievementsTotal}\n            </p>\n            <p class="notification_description-text" title="earned by">\n              <i class="notification_description-icon  players-icon"></i>\n              ${e.NumDistinctPlayersHardcore??""}\n            </p>\n          </div>\n        </div>\n      `,t}generateNewachivsElements(e){let t=[];return e.forEach((e=>{const{AchievementID:s,prevSrc:i,Description:n,Title:a,Points:o,TrueRatio:r,ID:c,rateEarnedHardcore:l}=e,d=document.createElement("li");d.classList.add("notification-achiv","new-achiv"),d.innerHTML=`\n                <div class="prev">\n                    <img class="prev-img" src="${i}" alt=" ">\n                </div>\n                <div class="notification_details">\n                    <h3 class="achiv-name"><a target="_blanc" href="https://retroachievements.org/achievement/${s??c}">${a}</a></h3>\n                    <p class="achiv-description">${n}</p>\n                    <div class="notification_description-icons">\n                        <p class="notification_description-text" title="points">\n                        <i class="notification_description-icon  points-icon"></i>\n                        ${o}\n                        </p>\n                        \n                        <p class="notification_description-text" title="retropoints">\n                        <i class="notification_description-icon  retropoints-icon"></i>\n                        ${r??""}\n                        </p>\n                        <p class="notification_description-text" title="earned by">\n                        <i class="notification_description-icon  trending-icon"></i>\n                        ${l||""}\n                        </p>\n                    </div>\n                </div>\n            `,t.push(d)})),t}getDeltaTime(e){let t=+e,s=~~(((new Date).getTime()-t)/1e3);return s<120?"moment ago":s<600?"few minutes ago":s<3600?~~(s/60)+" minutes ago":s<43200?new Date(t).toLocaleTimeString().replace(/:[^:]*$/gi,""):new Date(t).toLocaleString().replace(/:[^:]*$/gi,"")}}class Games extends Widget{widgetIcon={description:"games widget",iconID:"side-panel__games",onChangeEvent:"ui.games.VISIBLE = this.checked",iconClass:"games-icon"};get platformFilterItems(){return Object.keys(r).reduce(((e,t)=>{const s={label:t,type:"group"},i=Object.keys(r[t]).reduce(((e,s)=>{const i={label:s,type:"checkbox",name:"filter-by-platform",checked:this.PLATFORMS_FILTER.includes(r[t][s]),onChange:`ui.games.platformCheckboxChangeEvent(this,${r[t][s]})`,id:`filter-by-platform-${r[t][s]}`};return e.push(i),e}),[]);return e=[...e,s,...i]}),[])}get awardsFilterItems(){return Object.keys(this.awardTypes).reduce(((e,t)=>{const s={label:this.awardTypes[t],name:"filter-by-award",checked:this.AWARD_FILTER.includes(t),onChange:`ui.games.awardCheckboxChangeEvent(this,"${t}")`,id:`filter-by-platform-${t}`};return e.push(s),e}),[])}get genresFilterItems(){return Object.keys(_).reduce(((e,t)=>{const s={label:_[t],name:"filter-by-genre",checked:this.GENRE_FILTER.includes(t),onChange:`ui.games.genreCheckboxChangeEvent(this,"${t}")`,id:`filter-by-genre-${t}`};return e.push(s),e}),[])}set FAVOURITES(e){this._favs=e,w.ui.favouritesGames=e,w.writeConfiguration()}get FAVOURITES(){return this._favs??[]}set COOP_FILTER(e){w.ui.games_section.coopOnly=e,w.writeConfiguration(),this.updateGamesList()}get COOP_FILTER(){return w.ui.games_section?.coopOnly??!1}awardCheckboxChangeEvent(e,t){let s=this.AWARD_FILTER;e.checked?s.push(t):s=s.filter((e=>e!=t)),this.AWARD_FILTER=s}platformCheckboxChangeEvent(e,t){let s=this.PLATFORMS_FILTER;e.checked?s.push(t+""):s=s.filter((e=>e!=t)),this.PLATFORMS_FILTER=s}genreCheckboxChangeEvent(e,t){let s=this.GENRE_FILTER;e.checked?s.push(t):s=s.filter((e=>e!=t)),this.GENRE_FILTER=s}set PLATFORMS_FILTER(e){let t=e.filter((e=>Object.keys(m).includes(e)));w.ui.games_section.platformsFilter=t,w.writeConfiguration(),this.updateGamesList()}get PLATFORMS_FILTER(){return w.ui?.games_section?.platformsFilter??["7"]}set GENRE_FILTER(e){let t=e.filter((e=>Object.keys(_).includes(e)));w.ui.games_section.genreFilter=t,w.writeConfiguration(),this.updateGamesList()}get GENRE_FILTER(){return w.ui?.games_section?.genreFilter??[]}set AWARD_FILTER(e){w.ui.games_section.awardFilter=e,w.writeConfiguration(),this.updateGamesList()}get AWARD_FILTER(){return w.ui?.games_section?.awardFilter??[]}set FAVOURITES_FILTER(e){w.ui.games_section.favouritesFilter=e,w.writeConfiguration(),this.updateGamesList()}get FAVOURITES_FILTER(){return w.ui?.games_section?.favouritesFilter??!1}get TYPES_FILTER(){return w.ui?.games_section?.typesFilter??["original"]}set TYPES_FILTER(e){const t=e.dataset.type??"",s=this.TYPES_FILTER;if(e.checked)s.push(t);else{const e=s.indexOf(t);-1!==e&&s.splice(e,1)}w.ui.games_section.typesFilter=s,w.writeConfiguration(),this.applyFilter()}set REVERSE_SORT(e){w._cfg.ui.games_section.reverse_sort=e?-1:1,w.writeConfiguration(),this.updateGamesList()}get REVERSE_SORT(){return w._cfg.ui?.games_section?.reverse_sort??-1}get SORT_METHOD(){return ui_UI.sortBy[this.SORT_NAME]}get SORT_NAME(){return w._cfg.ui?.games_section?.sort_name??ui_UI.sortMethods.title}set SORT_NAME(e){e==this.SORT_NAME&&(w._cfg.ui.games_section.reverse_sort=-1*this.REVERSE_SORT),w._cfg.ui.games_section.sort_name=e,w.writeConfiguration(),this.updateGamesList()}titleFilter="";applyFilter(){const e=this.titleFilter.split(/\s/).map((e=>`(?=.*${e})`)).join(""),t=new RegExp(e,"gi");this.games=this.titleFilter?this.GAMES.filter((e=>`${e.FixedTitle} ${e.badges?.join(" ")} ${m[e.ConsoleID]}`.match(t))):this.GAMES,this.COOP_FILTER&&(this.games=this.games?.filter((e=>"true"==e.Coop))),this.PLATFORMS_FILTER.length>0&&(this.games=this.games?.filter((e=>{let t=!1;for(let s of this.PLATFORMS_FILTER)s==e.ConsoleID&&(t=!0);return t}))),this.GENRE_FILTER.length>0&&(this.games=this.games?.filter((e=>{let t=!1;for(let s of this.GENRE_FILTER)e?.Genres?.includes(+s)&&(t=!0);return t}))),this.FAVOURITES_FILTER&&(this.games=this.games.filter((e=>this.FAVOURITES.includes(e.ID)))),this.AWARD_FILTER.length>0&&(this.games=this.games.filter((e=>{let t=!1;for(let s of this.AWARD_FILTER)s==e.Award&&(t=!0);return t})))}applySort(){this.games=this.games.sort(((e,t)=>this.REVERSE_SORT*this.SORT_METHOD(e,t)))}platformCodes={};awardTypes={mastered:"mastered","beaten-hardcore":"beaten",completed:"completed","beaten-softcore":"beaten softcore",started:"started"};games={};gamesInfo={};constructor(){super(),this.addWidgetIcon(),this._favs=w.ui.favouritesGames??[],this.initializeElements(),this.setValues(),this.addEvents(),this.gamesList.innerHTML='\n      <button class="games__load-button" onclick="ui.games.loadGames()"></button>\n      ',ui_UI.applyPosition({widget:this})}initializeElements(){this.section=document.querySelector("#games_section"),this.header=this.section.querySelector(".header-container"),this.container=this.section.querySelector(".games_container"),this.searchbar=this.section.querySelector("#games__searchbar"),this.platformFiltersList=this.section.querySelector("#games_filter-platform-list"),this.gamesList=this.section.querySelector("#games-list"),this.resizer=this.section.querySelector(".resizer")}setValues(){this.section.querySelector("#games__favourites-filter").checked=this.FAVOURITES_FILTER,this.section.querySelector("#games__coop-filter").checked=this.COOP_FILTER}addEvents(){this.searchbar.addEventListener("input",(e=>{const t=this.searchbar.value;this.titleFilter=t,this.searchbar.classList.toggle("empty",""==t),this.updateGamesList()})),this.resizer.addEventListener("mousedown",(e=>{e.stopPropagation(),this.section.classList.add("resized"),ui_UI.resizeEvent({event:e,section:this.section})})),this.header.addEventListener("mousedown",(e=>{e.target.matches(".close-icon")?this.close():ui_UI.moveEvent(this.section,e)}))}async loadWantToPlay(){const e=await C.getWantToPlayGames({});this._favs=Array.from(new Set([...this._favs,...e]))}updateGamesList(){this.applyFilter(),this.applySort(),this.gamesList.innerHTML=this.gamesListHeaderHtml(),function({list:e,items:t,callback:s}){const i=document.createElement("div");i.classList.add("lazy-load_trigger"),e.appendChild(i);let n=0;const a=20,o=i=>{for(let a=0;a<i&&n<t.length;a++)e.appendChild(s(t[n++]))};o(a);const r=(s,r)=>{s.forEach((s=>{s.isIntersecting&&(o(a),r.unobserve(i),e.appendChild(i),n<t.length&&r.observe(i))}))};new IntersectionObserver(r,{root:null,rootMargin:"0px",threshold:1}).observe(i)}({list:this.gamesList,items:this.games,callback:this.GameElement})}loadGames(){this.loadWantToPlay().then(this.getAllGames().then((()=>{this.updateGamesList()}))),this.loadGameInfo()}async loadGameInfo(){const e=await fetch("./json/games/all_info.json");this.gamesInfo=await e.json()}async getAllGames(){this.GAMES={};try{const e=await fetch("./json/games/all_ext.json"),t=await e.json(),s=await C.SAVED_COMPLETION_PROGRESS;for(let e of s.Results){let s=t.find((t=>e.ID===t.ID));s?(e.NumAwardedHardcore&&(s.NumAwardedHardcore=e.NumAwardedHardcore),e.HighestAwardKind?s.Award=e.HighestAwardKind:s.Award="started",e.MostRecentAwardedDate&&(s.MostRecentAwardedDate=e.MostRecentAwardedDate)):(s=e,s.ImageIcon=s.ImageIcon.match(/\d+/gi)[0],e.NumAwardedHardcore&&(s.NumAwardedHardcore=e.NumAwardedHardcore),e.HighestAwardKind?s.Award=e.HighestAwardKind:s.Award="started",s.Points="",t.push(s))}this.GAMES=t}catch(e){return[]}}GameElement(e){const t=document.createElement("li");var s;return t.classList.add("platform_game-item"),t.dataset.id=e.ID,t.innerHTML=`\n        <h3 class="game-description_title">\n          <button data-title="show game information" class="game-description_button"\n                onclick="ui.games.showGameInfoPopup(${e.ID})">\n                ${e.FixedTitle} \n                ${e.badges?.length?g(e.badges):""} \n                ${s=e.Coop,"true"===s?A.default("coop"):""} \n                ${e.Genres?u(e.Genres,"gameGenre"):""}\n          </button>\n        </h3>      \n        <p data-title="${e.Award||""}" class="game-description  award-type">\n          ${I.award(e.Award)}\n        </p>\n        <button class="favourites-button favourite_icon description-icon game-description icon-button games__icon-button ${b.games.FAVOURITES.includes(e.ID)?"checked":""}" onclick="ui.games.addToFavourite(event,${e.ID})">\n        </button>\n        <p data-title="Rating" class="game-description  game-rating">\n          ${e.Rating||"n/a"}\n        </p>\n              <p data-title="Date" class="game-description  game-date">\n          ${e.Date||"n/a"}\n        </p>\n        <p data-title="platform" class="game-description  achievements-count">\n          ${m[e.ConsoleID].match(/[^\/]*/gi)[0]}\n        </p>\n        <p data-title="achievements count" class="game-description  achievements-count">\n            ${e.NumAwardedHardcore?e.NumAwardedHardcore+"/":""}${e.NumAchievements}\n        </p>\n        <p data-title="points count" class="game-description  points-count">\n            ${e.Points}\n        </p>\n  \n        <p class="game-description game-description__links">\n          <button data-title="load game" class=" game-description_link" onclick="watcher.updateGameData(${e.ID})"> \n                ${I.apply}\n          </button>\n            <a data-title="google search" target="_blanc" \n              href="https://google.com/search?q='${e?.FixedTitle}' '${m[e?.ConsoleID]}' ${c}"\n              class="game-description game-description_link">\n              ${I.search}\n            </a> \n            <a data-title="go to RA" target="_blanc" href="https://retroachievements.org/game/${e.ID}"\n                class="game-description game-description_link">\n                ${I.link}\n            </a>\n        </p>   \n        `,t}gamesListHeaderHtml=()=>`\n      <div class="platform_game-item header">\n        \x3c!--<div class="game-preview_container">\n        </div>--\x3e\n        <h3 class="header__game-description game-description_title ${"title"==this.SORT_NAME?-1==this.REVERSE_SORT?"active reverse":"active":""}"\n          onclick="ui.games.SORT_NAME = 'title'">Title\n        </h3>\n        <p data-title="award type" class="header__game-description ${"award"==this.SORT_NAME?-1==this.REVERSE_SORT?"active reverse":"active":""}" onclick="ui.games.SORT_NAME = 'award'">\n          <i class="description-icon award_icon"></i>\n        </p>\n        <div class="header__game-description"><i class="description-icon favourite_icon checked"></i></div>\n        <p data-title="Rating" class="game-description header__game-description  game-rating ${"rating"==this.SORT_NAME?-1==this.REVERSE_SORT?"active reverse":"active":""}"\n          onclick="ui.games.SORT_NAME = 'rating'">\n            Rating\n        </p>\n        <p data-title="Date" class="game-description header__game-description  game-date ${"date"==this.SORT_NAME?-1==this.REVERSE_SORT?"active reverse":"active":""}"\n          onclick="ui.games.SORT_NAME = 'date'">\n            Date\n        </p>\n        <p data-title="achievements count" class=" game-description  achievements-count"\n          >\n            Platform\n        </p>\n        <p data-title="achievements count" class="header__game-description game-description  achievements-count ${"achievementsCount"==this.SORT_NAME?-1==this.REVERSE_SORT?"active reverse":"active":""}"\n            onclick="ui.games.SORT_NAME ='achievementsCount'">\n              Cheevos\n          </p>\n        <p data-title="points count" class="header__game-description game-description  points-count ${"points"==this.SORT_NAME?-1==this.REVERSE_SORT?"active reverse":"active":""}"\n            onclick="ui.games.SORT_NAME = 'points'">\n              Points\n          </p>\n  \n          <p data-title="" class="game-description">Links</p>\n        </div>\n    `;addToFavourite(e,t){const s=this.FAVOURITES.includes(t);this.FAVOURITES=s?this.FAVOURITES.filter((e=>e!=t)):[t,...this.FAVOURITES],e.target.closest("button").classList.toggle("checked",!s)}toggleFilterList(e,t){const s=()=>{this.section.querySelector(".games__filters-list")?.remove(),this.section.querySelectorAll(".games__filter-header .extended").forEach((e=>e.classList.remove("extended")))},i=e.target.closest("button");if(i.classList.contains("extended"))s();else{let e;switch(s(),i.classList.add("extended"),t){case"platform":e=this.generateFiltersList(this.platformFilterItems);break;case"award":e=this.generateFiltersList(this.awardsFilterItems);break;case"genre":e=this.generateFiltersList(this.genresFilterItems)}this.section.append(e),this.section.querySelector(".games__filter-container").appendChild(e)}}generateFiltersList(e){const t=Object.values(e).reduce(((e,t)=>{if("group"==t.type){const s=document.createElement("li");s.classList.add("filter-list__platform-header"),s.innerText=t.label+": ",e.appendChild(s)}else{const s=t.checked,i=document.createElement("li");i.classList.add("checkbox-input_container"),i.innerHTML=`\n            <input ${s?"checked":""} onchange='${t.onChange}' type="checkbox"   name="${t.name}" id="${t.id}" ></input>\n            <label class=" checkbox-input" for="${t.id}">${t.label}</label>\n          `,e.appendChild(i)}return e}),document.createElement("ul"));return t.classList.add("games__filters-list"),t}async showGameInfoPopup(e=1){document.querySelectorAll(".game-popup__section").forEach((e=>e.remove()));const t=document.createElement("section"),s=await C.getGameProgress({gameID:e});t.innerHTML=`\n            <section class="section game-popup__section">\n                <div class="game-popup__header-container header-container">\n                    <h2 class="widget-header-text"><a href="https://retroachievements.org/game/${s.ID}" target="_blank">${s.FixedTitle} ${g(s.badges)}</a></h2>\n                    <button class="header-button header-icon close-icon" onclick="this.closest('section').remove();">\n                        \n                    </button>\n                </div>\n                <div class="game-info__container">\n                    <div class="game-info__images-container">\n                        <img src="https://media.retroachievements.org${s.ImageBoxArt}" alt="" class="game__image">\n                        <img src="https://media.retroachievements.org${s.ImageIngame}" alt="" class="game__image">\n                        <img src="https://media.retroachievements.org${s.ImageTitle}" alt="" class="game__image">\n        \n                    </div>\n                    <div class="game-info__descriptions-container">\n                        <div class="game-description__property">Platform: <span>${s?.ConsoleName}</span></div>\n                        <div class="game-description__property">Developer: <span>${s?.Developer} Soft</span></div>\n                        <div class="game-description__property">Genre: <span>${s?.Genre}</span></div>\n                        <div class="game-description__property">Publisher: <span>${s?.Publisher} Soft</span></div>\n                        <div class="game-description__property">Released: <span>${s?.Released}</span></div>\n                        <div class="game-description__property">Achievements total : <span>${s?.NumAwardedToUserHardcore} / ${s?.NumAwardedToUser} / ${s?.NumAchievements}</span>\n                        </div>\n                        <div class="game-description__property">Total retropoints : <span>\n                        ${s?.earnedStats.hard.retropoints} / ${s?.TotalRetropoints}</span></div>\n                        <div class="game-description__property">Total points : <span>\n                            ${s?.earnedStats.hard.points} / ${s?.earnedStats.soft.points} / ${s?.totalPoints}</span></div>\n                        <div class="game-description__property">Total players : <span>${s?.masteredCount} / ${s?.beatenCount} / ${s?.players_total}</span></div>\n                        <div class="game-description__property">Completion : <span>${s?.masteryRate}% / ${s?.beatenRate}%</span></div>\n                        <div class="game-description__property">RetroRatio : <span>${s?.retroRatio}</span></div>\n                        \n                    </div>\n                    <div class="game-info__cheevos-container">\n        \n                    </div>\n                </div>\n            </section>\n        `,b.app.appendChild(t)}toggleFullscreen(){this.section.classList.toggle("fullscreen")}}const r={SEGA:{"SG-1000":"33","Master System":"11","Genesis/Mega Drive":"1","Game Gear":"15","Sega CD":"9","32X":"10",Saturn:"39",Dreamcast:"40"},Nintendo:{"NES/Famicom":"7","Game Boy":"4","SNES/Super Famicom":"3","Game Boy Color":"6","Nintendo 64":"2","Game Cube":"16","Game Boy Advance":"5","Virtual Boy":"28","Nintendo DS":"18","Nintendo DSi":"78","Pokemon Mini":"24"},NEC:{"PC Engine/TurboGrafx-16":"8","PC Engine CD/TurboGrafx-CD":"76","PC-8000/8800":"47","PC-FX":"49"},SONY:{PlayStation:"12","PlayStation 2":"21","PlayStation Portable":"41"},SNK:{"Neo Geo Pocket":"14","Neo Geo CD":"56"},Atari:{"Atari 2600":"25","Atari 7800":"51","Atari Lynx":"13","Atari Jaguar":"17","Atari Jaguar CD":"77"},Other:{"Magnavox Odyssey 2":"23",Arcade:"27","Apple II":"38","Amstrad CPC":"37",MSX:"29","3DO Interactive Multiplayer":"43",ColecoVision:"44",Intellivision:"45",Vectrex:"46",WonderSwan:"53","Fairchild Channel F":"57","Watara Supervision":"63","Mega Duck":"69",Arduboy:"71","WASM-4":"72","Arcadia 2001":"73","Interton VC 4000":"74","Elektor TV Games Computer":"75",Uzebox:"80"},Special:{Events:"101",Standalone:"102"}},c="site:www.romhacking.net OR site:wowroms.com/en/roms OR site:cdromance.org OR site:coolrom.com.au/roms OR site:planetemu.net OR site:emulatorgames.net OR site:romsfun.com/roms OR site:emu-land.net/en";class Aotw{get VISIBLE(){return!this.section.classList.contains("hidden")}set VISIBLE(e){ui_UI.switchSectionVisibility({section:this.section,visible:e}),this.widgetIcon&&(this.widgetIcon.checked=e)}aotwObj;autoremove;constructor(){this.generateAotwElement().then((()=>{this.initializeElements(),this.addEvents(),b.target.showAotwEvent({cheevo:this.aotwObj})}))}initializeElements(){this.section=document.querySelector(".aotw_section")}addEvents(){this.section.addEventListener("mouseover",(()=>this.stopAutoRemove()))}setValues(){ui_UI.switchSectionVisibility({section:this.section,visible:!0})}stopAutoRemove(){this.autoremove&&clearTimeout(this.autoremove)}doAnim(){this.section.classList.remove("show-aotw","hide-aotw","disposed"),setTimeout((()=>this.section.classList.add("show-aotw")),100),this.autoremove=setTimeout((()=>this.section.classList.add("hide-aotw")),1e4)}addGlowEffectToCard(e){var t=e.querySelector(".marker");let s;function i(s){var i=s.offsetX,n=s.offsetY,a=e.offsetHeight,o=e.offsetWidth,r=Math.abs(Math.floor(100/o*i)-100),c=Math.abs(Math.floor(100/a*n)-100);t.style.backgroundPosition=`${r}% ${c}%`}e.addEventListener("mouseenter",(e=>{s=t.getBoundingClientRect(),t.classList.remove("hidden"),t.addEventListener("mousemove",(e=>{i(e)}))})),e.addEventListener("mouseleave",(s=>{e.style.transform="",e.style.background="",t.classList.add("hidden"),e.removeEventListener("mousemove",(e=>i(e)))}))}checkCheevo({earnedAchievementIDs:e}){e?.forEach((e=>{e==this.aotwObj.ID&&(R.CHEEVOS[e].isEarned&&(this.section.classList.add("earned"),this.aotwObj.isEarned=!0,this.doAnim()),R.CHEEVOS[e].isHardcoreEarned&&(this.section.classList.add("earned","hardcore"),this.aotwObj.isEarnedHardcore=!0),w.aotw=this.aotwObj)}))}async getAotwObject(){if(!w.aotw){const e=await C.getAotW();w.aotw=e}return this.aotwObj=w.aotw,this.aotwObj}showGameInfo(){b.games.showGameInfoPopup(this.aotwObj.GameID)}async generateAotwElement(){const e=await this.getAotwObject(),t=document.createElement("section");t.classList.add("section","aotw_section","disposed","compact"),t.classList.toggle("earned",e.isEarned),t.classList.toggle("hardcore",e.isEarnedHardcore),t.id="aotw_section",t.innerHTML=`\n        <div class="header-container">\n            <div class="header-icon q-icon icon">\n            </div>\n  \n            <h2 class="widget-header-text">\n            <a class="" target="_blanc"\n                        href="https://retroachievements.org/achievement/${e.ID}">\n            AotW</a></h2>\n            <button class="header-button info-icon header-icon" onclick="ui.aotw.showGameInfo()">\n            </button>\n            <div class="header-button close-icon header-icon" onclick="event.target.closest('.section')?.classList.add('hide-aotw')">\n            </div>\n        </div>\n        <div class="aotw-card" data-id="4800">\n            <div class="aotw-backside aotw-side"></div>\n            <div class="aotw__container aotw-side">\n                <div class="progression_descriptions aotw_descriptions">\n                    <p class="signed-icon" title="points">\n                      <i class="progression_description-icon description-icon points-icon"></i>\n                      ${e.Points}\n                    </p>\n                    <p class="signed-icon" title="points">\n                      <i class="progression_description-icon description-icon retropoints-icon"></i>\n                      ${e.TrueRatio}\n                    </p>\n                    <p class="signed-icon" title="earned by">\n                      <i class="progression_description-icon description-icon trending-icon"></i>\n                      ${(100*e.UnlocksHardcoreCount/e.TotalPlayers).toFixed(2)}%\n                    </p>\n                    <p class="signed-icon" title="earned by"> \n                      <i class="progression_description-icon description-icon rarity-icon"></i>\n                      ${(e.TrueRatio/e.Points).toFixed(2)}\n                    </p>\n                    ${e.Type?`\n                      <div class="progression_description-icon condition ${e.Type}" title="achievement type">\n                      </div>`:""}\n                </div>\n                <div class="progression-achiv_prev-container">\n                    <img class="progression-achiv_prev-img" src="https://media.retroachievements.org/${e.BadgeURL}"\n                        alt=" ">\n                </div>\n                <h3 class="progression_achiv-name">\n                    <a class="progression_achiv-link" target="_blanc"\n                        href="https://retroachievements.org/achievement/${e.ID}">${e.Title}</a>\n                </h3>\n                <div class="progression-details">\n                ${e.Description}\n                </div>\n  \n                <div class="marker hidden"></div>\n            </div>\n          \n        </div>\n      `,b.app.appendChild(t)}}class Status extends Widget{widgetIcon={description:"status widget (v2)",iconID:"side-panel__status-v2",onChangeEvent:"ui.status.VISIBLE = this.checked",badgeLabel:"v2",iconClass:"status-icon"};get contextMenuItems(){return[{label:b.lang.elements,elements:[{type:"checkbox",name:"context-show-rp",id:"context-show-rp",label:"**Rich presence**",checked:this.SHOW_RP,event:'onchange="ui.status.SHOW_RP = this.checked"'},{type:"checkbox",name:"context-show-ticker",id:"context-show-ticker",label:"**Ticker**",checked:this.SHOW_TICKER,event:'onchange="ui.status.SHOW_TICKER = this.checked"'},{type:"checkbox",name:"context-show-progression",id:"context-show-progression",label:"**Progression**",checked:this.SHOW_PROGRESSION,event:'onchange="ui.status.SHOW_PROGRESSION = this.checked"'},{type:"checkbox",name:"context-show-progressbar",id:"context-show-progressbar",label:"**Progressbar**",checked:this.SHOW_PROGRESSBAR,event:'onchange="ui.status.SHOW_PROGRESSBAR = this.checked"'},{type:"checkbox",name:"context-show-cheevos-list",id:"context-show-cheevos-list",label:"**Cheevos List**",checked:this.SHOW_CHEEVOS_LIST,event:'onchange="ui.status.SHOW_CHEEVOS_LIST = this.checked"'}]},{label:"Time",elements:[{type:"radio",name:"context_game-time",id:"context_show-playTime",label:b.lang.gameTime,checked:"playTime"==this.SHOW_TIME,event:"onclick=\"ui.status.SHOW_TIME = 'playTime';\""},{type:"radio",name:"context_game-time",id:"context_show-sessionTime",label:b.lang.sessionGameTime,checked:"sessionTime"==this.SHOW_TIME,event:"onclick=\"ui.status.SHOW_TIME = 'sessionTime';\""},{type:"radio",name:"context_game-time",id:"context_show-totalTime",label:"**Total time**",checked:"totalSessionTime"==this.SHOW_TIME,event:"onclick=\"ui.status.SHOW_TIME = 'totalSessionTime';\""}]}]}get SHOW_RP(){return w.getUIProperty({sectionID:this.section.id,property:"showRichPresence"})??!0}set SHOW_RP(e){w.saveUIProperty({sectionID:this.section.id,property:"showRichPresence",value:e}),this.setElementsProperties()}get SHOW_CHEEVOS_LIST(){return w.getUIProperty({sectionID:this.section.id,property:"showcheevosList"})??!0}set SHOW_CHEEVOS_LIST(e){w.saveUIProperty({sectionID:this.section.id,property:"showcheevosList",value:e}),this.setElementsProperties()}get SHOW_PROGRESSBAR(){return w.getUIProperty({sectionID:this.section.id,property:"showProgressbar"})??!0}set SHOW_PROGRESSBAR(e){w.saveUIProperty({sectionID:this.section.id,property:"showProgressbar",value:e}),this.setElementsProperties()}get SHOW_TICKER(){return w.getUIProperty({sectionID:this.section.id,property:"showTicker"})??!0}set SHOW_TICKER(e){w.saveUIProperty({sectionID:this.section.id,property:"showTicker",value:e}),this.setElementsProperties()}get SHOW_PROGRESSION(){return w.getUIProperty({sectionID:this.section.id,property:"showProgression"})??!0}set SHOW_PROGRESSION(e){w.saveUIProperty({sectionID:this.section.id,property:"showProgression",value:e}),this.setElementsProperties()}get SHOW_TIME(){return w.getUIProperty({sectionID:this.section.id,property:"time"})??"playTime"}set SHOW_TIME(e){w.saveUIProperty({sectionID:this.section.id,property:"time",value:e}),this.gameElements.time.innerText=this.getActiveTime()}get LIST_TYPE(){return w.getUIProperty({sectionID:this.section.id,property:"listType"})??"list"}set LIST_TYPE(e){w.saveUIProperty({sectionID:this.section.id,property:"listType",value:e}),this.cheevosList.classList.toggle("grid-list","grid"==e)}set SORT_NAME(e){w.saveUIProperty({sectionID:this.section.id,property:"sortBy",value:e}),this.applySort(),console.log(this.SORT_NAME,this.SORT_METHOD,e)}get SORT_NAME(){return w.getUIProperty({sectionID:this.section.id,property:"sortBy"})??ui_UI.sortMethods.default}get SORT_METHOD(){return ui_UI.sortBy[this.SORT_NAME]}get REVERSE_SORT(){return w.getUIProperty({sectionID:this.section.id,property:"reverseSort"})??1}set REVERSE_SORT(e){w.saveUIProperty({sectionID:this.section.id,property:"reverseSort",value:e?-1:1}),this.applySort()}get FILTER_NAME(){return w.getUIProperty({sectionID:this.section.id,property:"filterBy"})??ui_UI.filterMethods.all}set FILTER_NAME(e){w.saveUIProperty({sectionID:this.section.id,property:"filterBy",value:e}),this.applyFilter()}get FILTER_METHOD(){return ui_UI.filterBy[this.FILTER_NAME]}get REVERSE_FILTER(){return w.getUIProperty({sectionID:this.section.id,property:"reverseFilter"})??!1}set REVERSE_FILTER(e){w.saveUIProperty({sectionID:this.section.id,property:"reverseFilter",value:e}),this.applyFilter()}get HIDE_FILTERED(){return w.getUIProperty({sectionID:this.section.id,property:"hideFiltered"})??!1}set HIDE_FILTERED(e){w.saveUIProperty({sectionID:this.section.id,property:"hideFiltered",value:e}),this.applyFilter()}ACHIV_DURATION=15e3;IS_HARD_MODE=!0;getActiveTime=()=>{let e=0;switch(this.SHOW_TIME){case"totalSessionTime":e=R.playTime.sessionTime;break;case"playTime":e=R.playTime.totalGameTime;break;case"sessionTime":e=R.playTime.gameTime;break;case"timer":e=R.playTime.timer,e=e<0?0:e}return E(e,!0)};constructor(){super(),this.addWidgetIcon(),this.initializeElements(),ui_UI.applyPosition({widget:this}),this.setElementsProperties(),this.addEvents()}initializeElements(){this.section=document.querySelector(".rp__section"),this.watchButton=this.section.querySelector("#rp__watch-button"),this.indicatorElement=this.section.querySelector(".rp__indicator"),this.gameElements={icon:this.section.querySelector(".rp__game-image"),title:this.section.querySelector(".rp__game-title"),platform:this.section.querySelector(".rp__game-platform"),gameIcons:this.section.querySelector(".rp__game-icons"),time:this.section.querySelector(".rp__game-time")},this.alertElements={container:this.section.querySelector(".rp__alert-container"),preview:this.section.querySelector(".rp__alert-preview"),title:this.section.querySelector(".rp__alert-title"),description:this.section.querySelector(".rp__alert-description"),badges:this.section.querySelector(".rp__alert-badges")},this.richPresenceElement=this.section.querySelector(".rp__rich-presence"),this.progressionElements={header:this.section.querySelector(".rp__progression-target"),pointsContainer:this.section.querySelector(".rp__progression-points")},this.progressbarElements={container:this.section.querySelector(".rp__progressbar-container"),title:this.section.querySelector(".rp__progressbar-title"),lastCheevos:this.section.querySelector(".rp__last-cheevos")},this.tickerElement=this.section.querySelector(".rp__ticker"),this.ticker=a({container:this.tickerElement,textGenerator:n}),this.cheevosList=this.section.querySelector(".rp__target-cheevos")}addEvents(){this.section.addEventListener("mousedown",(e=>{e.stopPropagation(),e.target.matches(".resizer")?(this.section.classList.add("resized"),ui_UI.resizeEvent({event:e,section:this.section,callback:()=>this.fitCheevosSize(this.cheevosList)})):e.target.matches(".comments-button")?(e.stopPropagation(),b.showComments(R.GAME_DATA?.ID,1)):e.target.matches(".close-icon")?(e.stopPropagation(),this.close()):ui_UI.moveEvent(this.section,e)})),this.section.addEventListener("contextmenu",(e=>{b.showContextmenu({event:e,menuItems:this.contextMenuItems})})),this.watchButton.addEventListener("click",(e=>{e.stopPropagation(),R.isActive?R.stop():R.start()}))}setElementsProperties(){this.cheevosList.classList.toggle("grid-list","grid"==this.LIST_TYPE),this.section.classList.toggle("show-ticker",this.SHOW_TICKER),this.section.classList.toggle("show-cheevos-list",this.SHOW_CHEEVOS_LIST),this.section.classList.toggle("show-progression",this.SHOW_PROGRESSION),this.section.classList.toggle("show-progressbar",this.SHOW_PROGRESSBAR),this.richPresenceElement.classList.toggle("hidden",!this.SHOW_RP),this.SHOW_TICKER&&R.GAME_DATA&&this.ticker.startScrolling()}gameChangeEvent(e=!1){e&&R.IS_WATCHING&&this.addAlertsToQuery([{type:"new-game",value:R.GAME_DATA}]),this.fillGameData(),this.SHOW_TICKER&&this.ticker.startScrolling()}fillGameData(){(()=>{const{ImageIcon:e,FixedTitle:t,badges:s,ConsoleName:i,ID:n}=R.GAME_DATA;this.gameElements.icon.setAttribute("src",`https://media.retroachievements.org${e}`),this.gameElements.title.innerHTML=`\n            ${t||"Some game name"}\n            ${g(s)}\n            `,this.gameElements.title.setAttribute("href",`https://retroachievements.org/game/${n}`),setTimeout((()=>this.startAutoScrollElement(this.gameElements.title,!0,1e4)),1e4),this.gameElements.platform.innerHTML=i,this.richPresenceElement.innerText="Rich presence",this.gameElements.gameIcons.innerHTML=`\n                <p class="signed-icon" data-title="cheevos count"><i class="description-icon achievements-icon"></i>\n                    ${R.GAME_DATA.NumAchievements}\n                </p>\n\n                <p class="signed-icon" data-title="total points"><i class="description-icon points-icon"></i>\n                     ${R.GAME_DATA.totalPoints}\n                </p>\n\n                <p class="signed-icon" data-title="true ratio">\n                    <i class="description-icon rarity-icon"></i>\n                     ${R.GAME_DATA.retroRatio}\n                </p>\n            `;const a=this.getActiveTime();this.gameElements.time.innerHTML=a})(),(()=>{const e=e=>this.IS_HARD_MODE?e.isHardcoreEarned?"earned":"":e.isEarned?"earned":"",t=Object.values(R.CHEEVOS).filter((e=>"progression"==e.type)).sort(((e,t)=>ui_UI.sortBy.default(e,t))),s=Object.values(R.CHEEVOS).filter((e=>"win_condition"==e.type)),i=t.reduce(((t,s)=>t+=`\n                    <div class="rp__progression-point ${e(s)}" data-achiv-id=${s.ID}></div>\n                `),""),n=s?.length>0?`\n                <div class="rp__win-points">\n                    ${s.reduce(((t,s)=>t+=`\n                            <div class="rp__progression-point win ${e(s)}" data-achiv-id=${s.ID}></div>\n                        `),"")}\n                 </div>\n                `:"";this.progressionElements.pointsContainer.innerHTML=i+n;const a=Object.values(R.CHEEVOS).filter((e=>ui_UI.filterBy.progression(e))).sort(((e,t)=>ui_UI.sortBy.default(e,t))).find((t=>!e(t)));this.progressionElements.header.innerHTML=a?a.Description:R.GAME_DATA?.progressionAward?"You have beaten the game":"Progression is not available";const o=this.progressionElements.pointsContainer.querySelector(`[data-achiv-id="${a?.ID}"`);o?.classList.add("focus")})(),(()=>{const e=this.IS_HARD_MODE?R.GAME_DATA?.earnedStats?.hard?.count??0:R.GAME_DATA?.earnedStats?.soft?.count??0,t=R.GAME_DATA?.NumAchievements??"";this.progressbarElements.title.innerHTML=e==t?`You have ${R.GAME_DATA.award} the game`:`Earned ${e}/${t} cheevos`,this.progressbarElements.container.style.setProperty("--earnedRate",100*e/t+"%");const s=Object.values(R.CHEEVOS).filter((e=>ui_UI.filterBy.earned(e))).sort(((e,t)=>ui_UI.sortBy.latest(e,t))).slice(0,6).reverse();this.progressbarElements.lastCheevos.innerHTML=s.reduce(((e,t)=>e+=`\n                <li class="last-cheevo cheevo-popup" data-achiv-id="${t.ID}"><img class="last-cheevo__img"\n                            src="https://media.retroachievements.org/Badge/${t.BadgeName}.png" alt=""></li>\n            `),"")})(),this.startAutoScrollElement(this.richPresenceElement,!0,1e4)}updateProgress({earnedAchievementIDs:e}){const t=()=>{const e=this.progressionElements.pointsContainer.querySelector(".rp__progression-point:not(.earned)")?.dataset?.achivId,t=R.CHEEVOS[e];this.progressionElements.header.innerHTML=t?t.Description:R.GAME_DATA?.progressionAward?"You have beaten the game":"Progression is not available"},s=()=>{const e=this.IS_HARD_MODE?R.GAME_DATA?.earnedStats?.hard?.count??0:R.GAME_DATA?.earnedStats?.soft?.count??0,t=R.GAME_DATA?.NumAchievements??"";this.progressbarElements.title.innerHTML=e==t?`You have ${R.GAME_DATA.award} the game`:`Earned ${e}/${t} cheevos`,this.progressbarElements.container.style.setProperty("--earnedRate",100*e/t+"%");const s=Object.values(R.CHEEVOS).filter((e=>ui_UI.filterBy.earned(e))).sort(((e,t)=>ui_UI.sortBy.latest(e,t))).slice(0,6).reverse();this.progressbarElements.lastCheevos.innerHTML=s.reduce(((e,t)=>e+=`\n                <li class="last-cheevo cheevo-popup" data-achiv-id="${t.ID}"><img class="last-cheevo__img"\n                            src="https://media.retroachievements.org/Badge/${t.BadgeName}.png" alt=""></li>\n            `),"")};e?.length>0&&(this.IS_HARD_MODE=!!R.CHEEVOS[e[0]].isHardcoreEarned),e.forEach((e=>{const i=R.CHEEVOS[e]?.isHardcoreEarned?"hardcore":"-";this.section.querySelectorAll(`[data-achiv-id="${e}"]`).forEach((e=>e.classList.add("earned",i))),t(),s()}))}alertsQuery=[];addAlertsToQuery(e){this.alertsQuery.length>0?this.alertsQuery=[...this.alertsQuery,...e]:(this.alertsQuery=[...e],this.startAlerts())}async startAlerts(){const e=()=>{this.alertElements.container.classList.remove("hide-alert","show-alert","new-game","new-achiv","new-award","stats","beaten","mastered","hardcore","mastered","beaten-softcore","completed")},t=e=>{const{FixedTitle:t,badges:s,ImageIcon:i,totalPoints:n,ConsoleName:a,TotalRetropoints:o,NumAchievements:r,masteryRate:c,beatenRate:l}=e;this.alertElements.preview.src=`https://media.retroachievements.org${i}`,this.alertElements.title.innerHTML=`${t} ${g(s)}\n            <i class="badge">${a}</i>\n            `;let d=`\n                ${v(I.cheevos+r)}\n                ${v(I.points+n)}\n                ${v(I.retropoints+o)}\n                ${v(c+"% MASTERED")}\n                ${v(l+"% BEATEN")}\n            `;this.alertElements.description.innerText="",this.alertElements.badges.innerHTML=d,this.alertElements.container.classList.add("new-game")},s=e=>{const{isHardcoreEarned:t,Title:s,prevSrc:i,Points:n,TrueRatio:a,rateEarned:o,rateEarnedHardcore:r,difficulty:c}=e;this.alertElements.preview.src=i,this.alertElements.title.innerHTML=`\n                ${s} \n                <p class="badge difficult-badge__${c}">\n                    ${c}\n                </p>`,this.alertElements.description.innerText=e.Description;let l=t?`\n                    ${v(I.points+" +"+n)}\n                    ${v(I.retropoints+" +"+a)}\n                    ${v("TOP"+r)}\n                    <p class="badge difficult-badge__${c}">${c}</p>\n                `:`\n                    ${v(I.points+" +"+n)}\n                    ${v("TOP"+o)}\n                    <p class="badge difficult-badge__${c}">${c}</p>\n                `,d=`${e.genres?.map((e=>`\n                <p class="badge badge_gold" >${e}</p> `)).join("\n")}`??0;this.alertElements.badges.innerHTML=d+l,this.alertElements.container.classList.toggle("hardcore",e.isHardcoreEarned),this.alertElements.container.classList.add("new-achiv")},i=(e,t)=>{const{FixedTitle:s,badges:i,ImageIcon:n,totalPoints:a,earnedStats:o,TotalRetropoints:r,masteryRate:c,beatenRate:l,completedRate:d,beatenSoftRate:h,ID:u,NumAchievements:p}=e,m="mastered"==t?c:"beaten"==t?l:"completed"==t?d:h,_=(e=>{const t=~~(e/3600),s=~~((e-3600*t)/60);return`\n          ${t>0?1==t?"1 hour ":t+" hours ":""}\n          ${t>0&&s>0?"and ":""}\n          ${s>0?1==s?"1 minute":s+" minutes":""}\n            `})(w._cfg.playTime[u]);this.alertElements.preview.src=`https://media.retroachievements.org${n}`,this.alertElements.title.innerHTML=`${s} ${g(i)}\n                <i class="badge badge_gold">GAINED AWARD</i>\n            `;let E=`\n                ${v(`${t} IN ${_}`)}\n                ${v(`TOP${m}%`)}\n                ${v(`${I.cheevos}${o.hard.count}/${p}`)}\n                ${v(`${I.points}${o.hard.points}/${a}`)}\n                ${v(`${I.retropoints}${o.hard.retropoints}/${r}`)}\n            `;this.alertElements.badges.innerHTML=E,this.alertElements.description.innerText="",this.alertElements.container.classList.add(t),this.alertElements.container.classList.add("new-award")},n=e=>{this.alertElements.preview.src=w.userImageSrc,this.alertElements.title.innerHTML=`\n                ${w.USER_NAME.toUpperCase()} statistics:\n            `;let t=`\n                ${v(`Rank: ${e.rank} ${e.deltaRank}`)}\n                ${v(`TOP ${e.percentile.toFixed(2)}% ${e.deltaPercentile}`)}\n                ${v(`${I.cheevos} +${e.cheevosCount}`)}\n                ${v(`${I.points}${e.points} ${e.deltaPoints}`)}\n                ${v(`${I.retropoints}${e.retroPoints} ${e.deltaRetroPoints}`)}\n                ${v(`${I.points}${e.softPoints}SP ${e.deltaSoftPoints}`)}\n            `;this.alertElements.badges.innerHTML=t,this.alertElements.description.innerText="",this.alertElements.container.classList.add("stats")},a=a=>{switch(e(),a.type){case"new-game":t(a.value);break;case"new-achiv":s(a.value);break;case"new-award":i(a.value,a.award);break;case"stats":n(a.value)}};for(;this.alertsQuery.length>0;){const t=this.alertsQuery[0];if(!t.value)return void this.alertsQuery.shift();const s=()=>{a(t),this.alertElements.container.classList.add("show-alert"),setTimeout((()=>{this.startAutoScrollElement(this.alertElements.title),this.startAutoScrollElement(this.alertElements.badges),this.startAutoScrollElement(this.alertElements.description)}),2e3)},i=()=>{this.alertElements.container.classList.add("hide-alert"),setTimeout((()=>e()),500),this.alertsQuery.shift(),this.stopAutoScrollElement(this.alertElements.badges,!0),this.stopAutoScrollElement(this.alertElements.description,!0),this.stopAutoScrollElement(this.alertElements.title,!0)};await h(1e3),s(),await h(this.ACHIV_DURATION),i()}}applyFilter(){ui_UI.applyFilter({container:this.cheevosList,itemClassName:".target-achiv",filterMethod:this.FILTER_METHOD,reverse:this.REVERSE_FILTER,isHide:this.HIDE_FILTERED}),this.fitCheevosSize(this.cheevosList)}applySort(){ui_UI.applySort({container:this.cheevosList,itemClassName:".target-achiv",sortMethod:this.SORT_METHOD,reverse:this.REVERSE_SORT})}timeWatcher(){this.watchButton.classList.toggle("active",R.isActive),this.section.classList.toggle("watching",R.IS_ONLINE&&R.isActive);return{start:()=>{this.timeWatcher().stop(),this.gameTimeInterval=setInterval((()=>{"timer"===this.SHOW_TIME&&R.playTime.timer<0&&this.section.classList.add("timer-timeout");const e=this.getActiveTime();e&&e!==this.gameElements.time.innerHTML&&(this.gameElements.time.innerHTML=e)}),1e3)},stop:()=>{this.gameTimeInterval&&clearInterval(this.gameTimeInterval)}}}BLINK_ON_UPDATE=!0;blinkUpdate(){this.indicatorElement.classList.remove("offline","blink"),this.section.classList.toggle("offline",!R.IS_ONLINE),this.BLINK_ON_UPDATE&&R.IS_ONLINE?(this.indicatorElement.classList.add("blink"),setTimeout((()=>this.indicatorElement.classList.remove("blink","offline")),1e3)):R.IS_ONLINE||this.indicatorElement.classList.add("offline")}autoscrollAlertInterval={};startAutoScrollElement(e,t=!0,s=1e3){const i=e.id||e.className;this.autoscrollAlertInterval[i]?this.stopAutoScrollElement(e):this.autoscrollAlertInterval[i]={};const n=e;this.autoscrollAlertInterval[i].interval=setInterval((()=>{n.clientWidth==n.scrollWidth?(this.stopAutoScrollElement(e),this.autoscrollAlertInterval[i].timeout=setTimeout((()=>this.startAutoScrollElement(e,!0,s)),1e4)):t?(n.scrollLeft++,n.scrollLeft+n.clientWidth>=n.scrollWidth&&(this.stopAutoScrollElement(e),this.autoscrollAlertInterval[i].timeout=setTimeout((()=>this.startAutoScrollElement(e,!1,s)),s))):(n.scrollLeft--,0==n.scrollLeft&&(this.stopAutoScrollElement(e),this.autoscrollAlertInterval[i].timeout=setTimeout((()=>this.startAutoScrollElement(e,!0,s)),s)))}),50)}stopAutoScrollElement(e,t=!1){t&&(e.scrollLeft=0);const s=e.id||e.className;clearInterval(this.autoscrollAlertInterval[s].interval),clearTimeout(this.autoscrollAlertInterval[s].timeout)}fitCheevosSize(e){let t,s;e.style.flex="1",t=e.clientHeight-2,s=e.clientWidth-10,e.style.flex="";const i=e.querySelectorAll(".target-achiv:not(.removed)").length;if(0===i)return;let n,a,o=Math.floor(Math.sqrt(s*t/i));do{o--,n=Math.floor(t/(o+2)),a=Math.floor(s/(o+2))}while(n*a<i&&o>36);o=o<36?36:o>128?128:o,e.style.setProperty("--achiv-height",o+"px")}}class TwitchIntegration{}class GameList extends Widget{widgetIcon={description:"game series",iconID:"side-panel__game-list",onChangeEvent:"ui.gameList.VISIBLE = this.checked",iconClass:"playlist-icon"};set VISIBLE(e){super.VISIBLE=e,R.GAME_DATA?.ID!==this.gameSetID&&this.generateGamesSet()}get VISIBLE(){return super.VISIBLE}constructor(){super(),this.generateWidget(),this.initializeElements(),!w.ui[this.section?.id]&&(this.widgetIcon.badgeLabel="new"),this.addWidgetIcon(),this.setElementsVisibility(),this.addEvents(),ui_UI.applyPosition({widget:this})}initializeElements(){this.section=document.getElementById("game-list"),this.content=this.section.querySelector(".widget-content__container")}gameChangeEvent(){this.VISIBLE&&this.generateGamesSet()}setElementsVisibility(){}addEvents(){super.addEvents(),this.section.querySelector(".update-icon")?.addEventListener("click",(()=>this.generateGamesSet()))}generateWidget(){const e={classes:["game-list__section","section"],id:"game-list",title:"Game List",headerElementsHtml:'\n            <div class="header-button header-icon update-icon" title="force reload"></div>\n        '},t=this.generateWidgetElement(e);b.app.appendChild(t)}generateWidgetContent(){this.content.innerHTML=""}async generateGamesSet(){const e=this.gameSetID=R.GAME_DATA?.ID,t=await l(e),s=(await C.SAVED_COMPLETION_PROGRESS)?.Results,i=this.section.querySelector(".widget-header-text"),n=this.section.querySelector(".widget-content__container");t.value=(await Promise.all(t?.value?.map((async e=>{const t=await d(e.ID);return e.Date=t?.Date,e.Award=s.find((t=>e.ID===t.GameID))?.HighestAwardKind??"",e}))))?.sort(((e,t)=>ui_UI.sortBy.date(e,t)));const a=t?.value.reduce(((t,s)=>t+=`\n                <li class="game-info__set-item main-column-item right-bg-icon award-type ${s.Award} ${e==s.ID?"focus":""}">\n                    <img class="awards__game-preview" src="https://media.retroachievements.org/Images/${s.ImageIcon}.png" alt=" ">\n                    <h3 class="game-title">\n                        <a target="_blank" data-title="go to RA game-page" href="https://retroachievements.org/game/${s.ID}">\n                    ${s.Title} ${g(s?.badges)}</a></h3>\n                    <p class="awards__game-description">${s.Console}</p>\n                    <p class="awards__game-description">${s.Date??"Date unavailable"}</p>\n                </li>\n            `),"");i.innerHTML=`${t.name} Series`,n.innerHTML=`<ul class="flex-main-list">${a}<ul>`,n.querySelector(".focus")?.scrollIntoView()}}const l=async(e=1)=>{if(!R.gamesSets){const e=await fetch("./json/games/gamesSets.json");R.gamesSets=await e.json()}const t=Object.keys(R.gamesSets);for(let s=0;s<t.length;s++){const i=t[s];if(R.gamesSets[i].find((t=>t.ID===e)))return{name:i,value:R.gamesSets[i]}}},d=async e=>{if(!b.gamesExtInfo){const e=await fetch("./json/games/all_ext.json");b.gamesExtInfo=await e.json()}return e?b.gamesExtInfo.find((t=>t.ID==e)):void 0};class ui_UI{VERSION="0.72";CURRENT_LEVEL;AUTOCLOSE_CONTEXTMENU=!1;STICK_MARGIN=1;STICK_TOLERANCE=7;twitchClient=new TwitchIntegration;constructor(){this.initUI()}async initUI(){await async function(){if("/test.html"===window.location.pathname)try{for(const e in i){const t=i[e],s=await fetch(t);if(!s.ok)throw new Error(`Failed to fetch section: ${t}`);const n=await s.text(),a=document.createElement("div");a.innerHTML=n,document.querySelector(".wrapper").appendChild(a)}}catch(e){console.error("Error loading sections:",e)}}();const e=w.ui?.local??"en",t=await fetch(`./json/lang/${e}.json`);this.lang=await t.json(),w.ui.update_section?.playTime&&(w._cfg.playTime={...w._cfg.playTime,...w.ui.update_section?.playTime},delete w.ui.update_section?.playTime,w.writeConfiguration()),w.ui.game_section?.contextMenuPropertiesItems&&(w.ui.game_section.contextMenuPropertiesItems.forEach((e=>{let t=e.id.replace(/context_show-/gi,"");t="show"+t.charAt(0).toUpperCase()+t.slice(1);const s=!!e.checked;w.saveUIProperty({sectionID:"game_section",property:t,value:s})})),delete w.ui.game_section.contextMenuPropertiesItems,delete w.ui.game_section.contextMenuItems,delete w.ui.game_section.gameInfoElements,w.writeConfiguration()),this.initializeElements(),this.addEvents(),ui_UI.updateColors(),document.querySelector("#background-animation").style.display=w.bgVisibility?"block":"none",w.identConfirmed&&!this.isTest&&(w.startOnLoad?R.start():R.updateGameData(),setTimeout((()=>{C.getUserSummary({}).then((e=>{this.userInfo?.update({userSummary:e}),this.stats?.initialSetStats({userSummary:e}),this.statusPanel?.updateStatistics({userSummary:e})}))}),3e3)),setTimeout((()=>document.querySelector(".loading-section").classList.add("hidden")),1e3)}initializeElements(){this.app=document.querySelector(".wrapper"),this.statusPanel=new StatusPanel,this.status=new Status,this.achievementsBlock=[new AchievementsBlock],this.createAchievementsTemplate(),this.target=new Target,this.gameCard=new GameCard,this.stats=new UserStatistic,this.gameList=new GameList,this.progression=new Progression,this.note=new Note,this.awards=new Awards,this.notifications=new Notifications,this.games=new Games,this.settings=new Settings,this.buttons=new SidePanel,this.aotw=new Aotw}static applyPosition({widget:e}){if(!e)return;const t=e.section.id,s=()=>{e.section.classList.add("hidden","disposed")};if(w.ui[t]){const{x:i,y:n,width:a,height:o,hidden:r}=w.ui[t];i&&(e.section.style.left=i<0?0:i),n&&(e.section.style.top=n<0?0:n),a&&(e.section.style.width=a),o&&(e.section.style.height=o);(r??!0)&&s()}else!e.VISIBLE&&s();e.widgetIcon?.element&&(e.widgetIcon.element.checked=!1===w.ui?.[e.section?.id]?.hidden??!e.VISIBLE)}addEvents(){this.app.addEventListener("mousemove",(e=>{const t=e.target.closest("[data-title]")?.dataset.title,s=e.target.closest("[data-achiv-id]")?.dataset?.achivId,i=R.CHEEVOS[s];if(async function(){document.querySelectorAll(".popup").forEach((e=>e.remove()))}(),t){const s=ui_UI.generateHint(t);this.app.appendChild(s),ui_UI.setPopupPosition(s,e),setTimeout((()=>s.classList.add("visible")),333)}else if(i){const t=ui_UI.generateAchievementPopup(i);this.app.appendChild(t),ui_UI.setPopupPosition(t,e),setTimeout((()=>t.classList.add("visible")),333)}})),this.app.addEventListener("mouseleave",(()=>document.querySelectorAll(".popup").forEach((e=>e.remove())))),this.app.addEventListener("click",(()=>{document.querySelectorAll(".context-menu").forEach((e=>e.remove()))})),this.app.addEventListener("contextmenu",(e=>{this.showContextmenu({event:e,menuItems:this.settings.contextMenuItems})}))}updateWidgets({earnedAchievementsIDs:e}){try{this.aotw?.checkCheevo({earnedAchievementIDs:e})}catch(e){console.log(e)}this.notifications.pushNotification({type:this.notifications.types.earnedAchivs,elements:e}),this.achievementsBlock.forEach((t=>t.updateEarnedAchieves({earnedAchievementIDs:e}))),this.target.updateEarnedAchieves({earnedAchievementIDs:e}),this.target.delayedRemove(),this.awards.VISIBLE&&this.awards.updateAwards(),this.statusPanel.updateProgress({earnedAchievementIDs:e}),this.status.updateProgress({earnedAchievementIDs:e}),this.progression.update({earnedAchievementIDs:e}),this.userInfoTimeout&&clearTimeout(this.userInfoTimeout),(this.stats?.VISIBLE||this.statusPanel?.SHOW_STATISTICS_ALERT)&&(this.userInfoTimeout=setTimeout((async()=>{const e=await C.getUserSummary({gamesCount:0,achievesCount:0});b.stats.updateStats({currentUserSummary:e}),b.statusPanel?.updateStatistics({userSummary:e})}),16e3*e.length))}showAwardsAlerts(e=[]){e.forEach((e=>{"mastered"===e.award&&this.showFSAlert().masteryAlert(e.value),this.settings.DISCORD_NEW_AWARD&&this.sendDiscordMessage({message:alert.award,type:"award",id:w.gameID})})),this.statusPanel.addAlertsToQuery(e),this.status.addAlertsToQuery(e),this.gameCard.section.dataset.award=R.GAME_DATA?.award??"-",this.gameCard.section.dataset.progressionAward=R.GAME_DATA?.progressionAward??"-",e.length&&setTimeout((()=>b.stats.updateChart()),4e3)}showCheevoAlerts(e=[]){let t=e.map((e=>({type:"new-achiv",value:R.CHEEVOS[e]})));e.forEach((e=>{this.settings.DISCORD_NEW_CHEEVO&&this.sendDiscordMessage({type:"earned-cheevo",id:e})})),this.statusPanel.addAlertsToQuery(t),this.status.addAlertsToQuery(t)}updateWidgetsRichPresence(e="Rich presence"){this.statusPanel.frontSide.richPresence.innerText=e,this.status.richPresenceElement.innerText=e;const t=p(e);this.CURRENT_LEVEL=t,t&&(this.target.highlightCurrentLevel(t),this.achievementsBlock.forEach((e=>e.highlightCurrentLevel(t))))}showContextmenu({event:e,menuItems:t,sectionCode:s=""}){e.preventDefault(),e.stopPropagation(),document.querySelector(".context-menu")?.remove(),this.contextMenu=ui_UI.generateContextMenu({menuItems:t,sectionCode:s}),this.app.appendChild(this.contextMenu),(()=>{this.contextMenu.style.left=e.x+"px",this.contextMenu.style.top=e.y+"px",window.innerWidth-e.x<3*this.contextMenu.offsetWidth&&this.contextMenu.classList.add("to-left"),window.innerHeight-e.y<2*this.contextMenu.offsetHeight&&this.contextMenu.classList.add("to-top")})(),this.contextMenu.classList.remove("hidden")}createAchievementsTemplate(){2===this.achievementsBlock.length?ui_UI.switchSectionVisibility(this.achievementsBlock[1]):(this.achievementsBlock.push(new AchievementsBlock(!0)),R.GAME_DATA&&this.achievementsBlock.at(-1).parseGameAchievements(R.GAME_DATA))}async showComments(e,t=2){const s=await(C?.getComments({id:e,type:t}))||[];let i="";i=s.length>0?`\n            <ul class="comments-list scrollable">\n                ${s.map((e=>`\n                    <li class="comment">\n                        <div class="comment__header">\n                            <h3 class="comment__user-name">${e.User}</h3>\n                            <div class="comment__date">${new Date(e.Submitted).toLocaleString()}</div>\n                        </div>\n                \n                        <div class="comment__comment">\n                          <button data-title="copy to clipboard" class="icon-button description-icon copy-icon comment__copy-button"></button>\n                          <button data-title="copy to note" class="icon-button description-icon note-icon comment__note-button"></button>\n                          ${e.CommentText?.replace(/\bhttp(?:s)*:\/\/[^\s]*\b/g,(e=>`<a href='${e}' target='_blank'>${e}</a>`))}\n                        </div>\n                    </li>\n                `)).join("\n")}\n            </ul>`:'<h2 style="width: 100%;padding: 1rem; font-size: 2rem; text-align:center">No comments yet</h2>';new PopupWindow({title:(1===t?"Game":2===t?"Cheevo":"User")+" comments",content:i,id:`comments_type-${t}`})}async sendDiscordMessage({message:e="",type:t,id:s}){const i={},n=w.DISCORD_WEBHOOK;if(!n)return;switch(t){case"new-game":i.header=`${w.targetUser} has launched the game: \n${R.GAME_DATA.Title}`,i.description=`          \n          Platform: ${R.GAME_DATA.ConsoleName}\n          Realeased: ${R.GAME_DATA.Released}\n          Achievements: ${R.GAME_DATA.NumAwardedToUserHardcore} / ${R.GAME_DATA.NumAchievements}\n          Retropoints:  ${R.GAME_DATA.earnedStats.hard.retropoints} / ${R.GAME_DATA.TotalRetropoints}\n        `,i.color=65280,i.url=`https://retroachievements.org/game/${w.gameID}`,i.image="https://media.retroachievements.org"+R.GAME_DATA.ImageIcon;break;case"award":await h(2e3),i.header=`${w.targetUser} has ${e.toUpperCase()} the game: \n${R.GAME_DATA.Title}`,i.description=`\n          Earned in: ${E(w._cfg.playTime[R.GAME_DATA.ID])}\n          Platform: ${R.GAME_DATA.ConsoleName}\n          Realeased: ${R.GAME_DATA.Released}\n          Achievements: ${R.GAME_DATA?.earnedStats?.hard.count} / ${R.GAME_DATA?.earnedStats?.soft.count} / ${R.GAME_DATA.NumAchievements}\n          Points: ${R.GAME_DATA.earnedStats.hard.points} / ${R.GAME_DATA.earnedStats.soft.points} / ${R.GAME_DATA.TotalRetropoints}\n          Retropoints: ${R.GAME_DATA.earnedStats.hard.retropoints} / ${R.GAME_DATA.TotalRetropoints}\n        `,i.color="beaten"==e||"mastered"==e?16766720:12632256,i.url=`https://retroachievements.org/game/${w.gameID}`,i.image="https://media.retroachievements.org"+R.GAME_DATA.ImageIcon;break;case"earned-cheevo":const t=w.aotw?.ID==s,n=R.CHEEVOS[s];if(n.Points<+b.settings.DISCORD_MIN_POINTS_ALERT||n.TrueRatio<+b.settings.DISCORD_MIN_RETROPOINTS_ALERT||!n.isHardcoreEarned&&b.settings.DISCORD_HARD_ONLY_ALERT)return;i.header=`${w.targetUser}  earned ${n.isHardcoreEarned?"hardcore":"softcore"} ${t?"Achievement of the Week":"cheevo"}: \n${n.Title}`,i.description=`\n          Game: [${R.GAME_DATA.Title}](https://retroachievements.org/game/${R.GAME_DATA.ID})\n          Description: ${n.Description}\n          Points: ${n.Points}\n          Retropoints:  ${n.TrueRatio}\n        `,i.color=n.isHardcoreEarned?16766720:12632256,i.url=`https://retroachievements.org/achievement/${s}`,i.image=n.prevSrc}const a={username:"RETROCHEEVOS",avatar_url:"https://taras240.github.io/retro-api/assets/img/overlay_sets/mario_q/q.png",embeds:[{thumbnail:{url:i.image},title:i.header,url:i.url,color:i.color,description:i.description.replace(/\n[ \t]*/g,"\n"),footer:{text:"retrocheevos.vercel.app"},timestamp:(new Date).toISOString()}]};fetch(n,{body:JSON.stringify(a),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(e){})).catch((function(e){console.log(e)}))}stopWatching(){b.IS_WATCHING=!1,this.statusPanel.frontSide.watchButton.classList.remove("active"),clearInterval(b.apiTrackerInterval)}static applySort({container:e,itemClassName:t,sortMethod:s,reverse:i}){const n=[...e.querySelectorAll(t)];e.innerHTML="",n.sort(((e,t)=>s(e.dataset,t.dataset)*i)).forEach((t=>{e.appendChild(t)}))}static applyFilter({container:e,itemClassName:t,filterMethod:s,reverse:i,isHide:n}){[...e.querySelectorAll(t)].forEach((e=>{e.classList.remove("removed","hidden"),e.classList.toggle(n?"removed":"hidden",!s(e.dataset)^i)}))}static generateContextMenu({menuItems:e,sectionCode:t="",isSubmenu:s=!1}){const i=document.createElement("ul");return s?i.classList.add("context-menu_item-menu","context-submenu"):i.classList.add("achievement_context-menu","context-menu","hidden"),e.forEach((e=>{const s=e.hasOwnProperty("elements");let n=document.createElement("li");if(n.classList.add("context-menu_item",s?"expandable":"f"),s)n.innerHTML+=e.label,n.appendChild(ui_UI.generateContextMenu({menuItems:e.elements,isSubmenu:!0,sectionCode:t}));else switch(e.type){case"checkbox":case"radio":n.innerHTML+=`\n            <input type="${e.type}" name="${e.name}${t}" id="${e.id}${t}" \n             ${1==e.checked?"checked":""} ${e.event??""}></input>\n            <label class="context-menu_${e.type}" for="${e.id}${t}">${e.label}</label>\n            `;break;case"input-number":n.innerHTML+=`\n            ${e.prefix}\n            <input class="context-menu_${e.type}" id="${e.id}-${t}" type="number" title="${e.title}" value="${e.value??""}" ${e.event??""} onclick="event.stopPropagation()">${e.postfix??""} </input>\n            `;break;case"text-input":n.innerHTML+=`\n              ${e.prefix}\n              <input class="context-menu_${e.type}" id="${e.id}-${t}"  ${e.event??""} title="${e.title}" type="text" placeholder="${e.placeholder??""}"  onclick="event.stopPropagation()">${e.postfix??""}</input>\n              `;break;case"range":n.innerHTML+=`\n              ${e.prefix}\n              <input type="range"  ${e.event??""} min="${e.minRange}" max="${e.maxRange}" value="${e.value}" class="slider" id="${e.id}-${t}">\n            `;break;case"button":n.innerHTML+=`\n              <button class="context-menu_${e.type}" id="${e.id}-${t}" ${e.event??""} type="button">${e.label??""}</button>\n              `}i.appendChild(n)})),i.addEventListener("contextmenu",(e=>e.stopPropagation())),i.addEventListener("mousedown",(e=>e.stopPropagation())),b.AUTOCLOSE_CONTEXTMENU||i.addEventListener("click",(e=>e.stopPropagation())),i}static updateColors(e){const{style:t}=document.body,{mainColor:s,secondaryColor:i,accentColor:n,fontColor:a,selectionColor:o}=w.getColors(e||w.colorsPreset);t.setProperty("--main-color",s),t.setProperty("--secondary-color",i),t.setProperty("--accent-color",n),t.setProperty("--font-color",a),t.setProperty("--selection-color",o)}static resizeEvent({event:e,section:t,callback:s}){let i={startWidth:t.clientWidth,startHeight:t.clientHeight,startX:e.clientX,startY:e.clientY};const n=e=>{ui_UI.setSize(e,i,t),s&&s()};document.addEventListener("mousemove",n),document.addEventListener("mouseup",(()=>{document.removeEventListener("mousemove",n),t.classList.remove("resized"),w.setNewPosition({id:t.id,width:t.clientWidth,height:t.clientHeight})}))}static setSize(e,t,s){const{startWidth:i,startHeight:n,startX:a,startY:o}=t;let r=i+(e.clientX-a),c=n+(e.clientY-o),{newHeight:l,newWidth:d}=ui_UI.stickResizingSection({width:r,height:c,stickySection:s});s.style.width=`${d}px`,s.style.height=`${l}px`}static stickResizingSection({width:e,height:t,stickySection:s}){const{offsetTop:i,offsetLeft:n}=s;let a=e,o=t;if(!1===w.ui.isWindowsSticky)return{newWidth:a,newHeight:o};const r=b.STICK_TOLERANCE,c=b.STICK_MARGIN,l=[{check:e=>Math.abs(i+t-e.offsetTop-e.clientHeight)<r,action:e=>o=e.offsetTop+e.clientHeight-i},{check:e=>Math.abs(i+t-e.offsetTop)<r,action:e=>o=e.offsetTop-i-c},{check:t=>Math.abs(n+e-t.offsetLeft-t.clientWidth)<r,action:e=>a=e.offsetLeft+e.clientWidth-n},{check:t=>Math.abs(n+e-t.offsetLeft)<r,action:e=>a=e.offsetLeft-n-c}];return document.querySelectorAll(".section").forEach((e=>{s!=e&&l.forEach((({check:t,action:s})=>t(e)&&s(e)))})),a=Math.abs(window.innerWidth-n-a)<r?window.innerWidth-n:a,o=Math.abs(window.innerHeight-i-o)<r?window.innerHeight-i:o,{newWidth:a,newHeight:o}}static moveEvent(e,t){if(0!==t.button)return;e.classList.add("dragable");const s=e.getBoundingClientRect(),i=t.clientX-s.left,n=t.clientY-s.top,a=t=>ui_UI.setPosition(t,i,n,e),o=t=>{e.classList.remove("dragable"),b.app.removeEventListener("mousemove",a),b.app.removeEventListener("mouseup",o),e.removeEventListener("mouseleave",o),w.setNewPosition({id:e.id,xPos:e.style.left,yPos:e.style.top}),t.preventDefault()};b.app.addEventListener("mousemove",a),b.app.addEventListener("mouseup",o)}static stickMovingSection({x:e,y:t,stickySection:s}){const{clientHeight:i,clientWidth:n}=s;let a=t,o=e;if(!1===w.ui.isWindowsSticky)return{newXPos:o,newYPos:a};const r=b.STICK_TOLERANCE,c=b.STICK_MARGIN,l=[{check:e=>Math.abs(t+i-e.offsetTop-e.clientHeight)<r,action:e=>a=e.offsetTop+e.clientHeight-i},{check:e=>Math.abs(t-e.offsetTop)<r,action:e=>a=e.offsetTop},{check:e=>Math.abs(t-e.offsetTop-e.clientHeight)<r,action:e=>a=e.offsetTop+e.clientHeight+c},{check:e=>Math.abs(t+i-e.offsetTop)<r,action:e=>a=e.offsetTop-i-c},{check:t=>Math.abs(e+n-t.offsetLeft-t.clientWidth)<r,action:e=>o=e.offsetLeft+e.clientWidth-n},{check:t=>Math.abs(e-t.offsetLeft)<r,action:e=>o=e.offsetLeft},{check:t=>Math.abs(e+n-t.offsetLeft)<r,action:e=>o=e.offsetLeft-n-c},{check:t=>Math.abs(e-t.offsetLeft-t.clientWidth)<r,action:e=>o=e.offsetLeft+e.clientWidth+c}];return document.querySelectorAll(".section").forEach((e=>{s!=e&&l.forEach((({check:t,action:s})=>t(e)&&s(e)))})),o=Math.abs(window.innerWidth-o-n)<r?window.innerWidth-n:o,o=Math.abs(o)<r?0:o,a=Math.abs(window.innerHeight-a-i)<r?window.innerHeight-i:a,a=Math.abs(a)<r?0:a,{newXPos:o,newYPos:a}}static setPosition(e,t,s,i){e.preventDefault();let n=e.clientX-t,a=e.clientY-s,{newXPos:o,newYPos:r}=ui_UI.stickMovingSection({x:n,y:a,stickySection:i});i.style.left=o+"px",i.style.top=r+"px"}static addDraggingEventForElements(e,t){}static generateHint(e){let t=document.createElement("div");return t.classList.add("popup","hint"),t.innerHTML=`\n      <p>${e}</p>\n      `,t}static generateAchievementPopup(e){let t=document.createElement("div");return t.classList.add("achiv-details-block","popup"),t.innerHTML=`\n      <h3 class="achievement__header">${e.Title} <p class="badge difficult-badge__${e.difficulty}">${e.difficulty}</p>\n      </h3>\n      <p>${e.Description}</p>\n      <div class="points">\n        ${T.points(e.Points)}\n        ${T.retropoints(e.TrueRatio)}\n        ${T.retroRatio(e.retroRatio)}\n        ${I.cheevoType(e.type)}\n      </div>\n      ${e.DateEarnedHardcore?"<p>Earned hardcore: "+e.DateEarnedHardcore+"</p>":e.DateEarned?"<p>Earned softcore: "+e.DateEarned+"</p>":""}\n      <p>Earned by ${e.NumAwardedHardcore} (${e.NumAwarded}) of ${e.totalPlayers} players</p>\n      <p>Earned rate: ${e.rateEarnedHardcore} (${e.rateEarned})</p>\n      <p>Created: ${new Date(e.DateCreated).toLocaleDateString()} (${new Date(e.DateModified).toLocaleDateString()})</p>\n      <p>Created by: ${e.Author}</p>\n    `,t}static setPopupPosition(e,t){const s=t.x,i=t.y;e.style.left=s+50+"px",e.style.top=i+"px";let{left:n,right:a,top:o,bottom:r}=e.getBoundingClientRect();n<0&&e.classList.remove("left-side"),a>window.innerWidth&&e.classList.add("left-side"),o<0?e.classList.remove("top-side"):r>window.innerHeight&&e.classList.add("top-side")}static switchSectionVisibility({section:e,visible:t=!1}){e.classList.contains("hidden")||t?(e.classList.remove("disposed"),setTimeout((()=>e.classList.remove("hidden")),100),w.setNewPosition({id:e.id,hidden:!1})):(e.classList.add("hidden"),setTimeout((()=>e.classList.add("disposed")),300),w.setNewPosition({id:e.id,hidden:!0}))}static sortBy={latest:(e,t)=>{const s=e=>{const[t,s]=e.split(", "),[i,n,a]=t.split(".").map(Number),[o,r]=s.split(":").map(Number);return new Date(a,n-1,i,o,r)},i=e.DateEarnedHardcore?s(e.DateEarnedHardcore):e.DateEarned?s(e.DateEarned):-1/0;return(t.DateEarnedHardcore?s(t.DateEarnedHardcore):t.DateEarned?s(t.DateEarned):-1/0)-i},date:(e,t)=>(e.Date?new Date(e.Date):-1/0)-(t.Date?new Date(t.Date):-1/0),earnedCount:(e,t)=>t.NumAwardedHardcore-e.NumAwardedHardcore,points:(e,t)=>parseInt(e.Points)-parseInt(t.Points),truepoints:(e,t)=>e.TrueRatio-t.TrueRatio,default:(e,t)=>0!=e.DisplayOrder?e.DisplayOrder-t.DisplayOrder:e.achivId-t.achivId,id:(e,t)=>e.ID-t.ID,disable:(e,t)=>0,rating:(e,t)=>t.Rating-e.Rating,achievementsCount:(e,t)=>parseInt(e.NumAchievements)-parseInt(t.NumAchievements),title:(e,t)=>{let s=e.FixedTitle.toUpperCase(),i=t.FixedTitle.toUpperCase();return s<i?-1:s>i?1:0},award:(e,t)=>{const s={mastered:5,completed:4,"beaten-hardcore":3,"beaten-softcore":2,started:1},i=s[t.Award]??0,n=s[e.Award]??0,a=new Date(t.MostRecentAwardedDate),o=new Date(e.MostRecentAwardedDate);return i-n!=0?i-n:a-o},level:(e,t)=>e.level||t.level?e.level?t.level?e.level-t.level:-1:1:ui_UI.sortBy.default(e,t)};static filterBy={earned:e=>e.DateEarnedHardcore||e.DateEarned,notEarned:e=>!e.DateEarnedHardcore,missable:e=>"missable"===e.type,progression:e=>"progression"===e.type||"win_condition"===e.type,all:()=>!0};static filterMethods={all:"all",earned:"earned",notEarned:"notEarned",missable:"missable",progression:"progression"};static sortMethods={latest:"latest",earnedCount:"earnedCount",points:"points",truepoints:"truepoints",disable:"disable",id:"id",default:"default",achievementsCount:"achievementsCount",title:"title",award:"award",rating:"rating",date:"date",level:"level"};async exportCompletionDataToXlsx(){const e=await C.SAVED_COMPLETION_PROGRESS,t=e?.Results.map((e=>({Title:e.Title,ID:e.GameID,Platform:m[e.ConsoleID],Award:e.HighestAwardKind,AwardDate:e.HighestAwardDate&&new Date(e.HighestAwardDate).toLocaleString(),LastEarnedDate:e.MostRecentAwardedDate&&new Date(e.MostRecentAwardedDate).toLocaleString(),TotalAchievements:e.NumAchievements,EarnedAchievements:e.NumAwardedHardcore,EarnedAchievementsSoftcore:e.NumAwarded,PlayedTime:S(w._cfg.playTime[e.GameID]),Notes:w.ui.note_section?.game_notes&&w.ui.note_section.game_notes[e.GameID]?.replace(/;|\n/g," ")})));if(!t||0==t.length)return;const s=[...Object.keys(t[0])],i=t.map((e=>[e.Title,e.ID,e.Platform,e.Award,e.AwardDate,e.LastEarnedDate,e.TotalAchievements,e.EarnedAchievements,e.EarnedAchievementsSoftcore,e.PlayedTime,e.Notes])),n=[s.join(";"),...i.map((e=>e.join(";")))].join("\n"),a=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(a),r=document.createElement("a");r.href=o,r.download="data.csv",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}async exportWantToPlayToCSV(){const e=await C.getWantToPlayGamesList({count:500});console.log(e);const t=e?.map((e=>({Title:e.Title,ID:e.ID,ConsoleName:m[e.ConsoleID],AchievementsPublished:e.AchievementsPublished}))),s=[...Object.keys(t[0])],i=t.map((e=>[e.Title,e.ID,e.ConsoleName,e.AchievementsPublished])),n=[s.join(";"),...i.map((e=>e.join(";")))].join("\n"),a=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(a),r=document.createElement("a");r.href=o,r.download="data.csv",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}exportSettingsToJson(){const e=localStorage.getItem("retroApiConfig"),t=JSON.parse(e);t.apiWorker&&delete t.apiWorker.completionProgress,t.version=b.VERSION;const s=new Blob([JSON.stringify(t)],{type:"text/json;charset=utf-8;"}),i=URL.createObjectURL(s),n=document.createElement("a");n.href=i,n.download="settings.json",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}importSettingsFromJson(){const e=document.createElement("input");e.type="file",e.accept=".json",e.addEventListener("change",(function(e){const t=e.target.files[0];if(t){const e=new FileReader;e.onload=function(e){try{const t=JSON.parse(e.target.result);console.log("Imported Settings:",t),b.applySettings(t)}catch(e){console.error("Error parsing JSON:",e)}},e.onerror=function(){console.error("Error reading file:",e.error)},e.readAsText(t)}else console.log("No file selected")})),e.click()}applySettings(e){e.version>=.65?(w._cfg=e,w.writeConfiguration(),setTimeout((()=>location.reload()),1e3)):console.log("Unsupported file")}showFSAlert(){return{masteryAlert:({ImageIcon:e,FixedTitle:t}=R.GAME_DATA)=>{document.querySelectorAll(".fs-alert__container").forEach((e=>e.remove()));const s=document.createElement("div");s.className="fs-alert__container",s.innerHTML=`\n          <div class="fs-alert__main-content">\n              <div class="fs-alert__border fs-alert__border-top"></div>\n              <div class="fs-alert__header">mastery unlocked</div>\n              <div class="fs-alert__sub-border "></div>\n              <div class="fs-alert__image-container">\n                  <div class="fs-alert__light"></div>\n                  <img src="https://media.retroachievements.org${e}" alt="" class="fs-alert__image">\n                  <div class="fs-alert__blick"></div>\n              </div>\n              <div class="fs-alert__description">\n                  ${t}\n              </div>\n              <div class="fs-alert__border fs-alert__border-botton"></div>\n          </div>\n      `,b.app.appendChild(s),setTimeout((()=>s?.remove()),15e3)}}}}const h=e=>new Promise((t=>setTimeout(t,e)));function g(e,t="gameTitle"){return e?.reduce(((e,s)=>{const i=A[t](s);return e.push(i),e}),[]).join(" ")}function u(e,t="gameTitle"){return g(e.map((e=>_[e])),t)}const p=e=>{let t;const s=["level","levels","stage","area","world","mission","chapter","section","part","zone","phase","realm","domain","episode","act","sequence","tier","floor","dimension","region","floor","scene","","in"].join("|");return t=((e,t)=>{const i=new RegExp(`(${s})(\\s|-\\s*|:\\s*)((\\d+-\\d+)|(\\d+))`,"gi"),n=new RegExp(`\\b${t?.join("\\b|\\b")}\\b`,"gi"),a=e.match(n),o=a?R.GAME_DATA.zones?.indexOf(a[0]):void 0,r=e.matchAll(i);let c;for(const e of r)c=e[3]?.replace("-",".");return o>=0&&(c=`${o+1}${c?.includes(".")?"."+c:""}`),Number(c)})((e=>{const t={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10,"1st":1,"2nd":2,"3rd":3,"4th":4,"5th":5,"6th":6,"7th":7,"8th":8,"9th":9,"10th":10},s=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(s,(e=>t[e.toLowerCase()]))})(e),R.GAME_DATA.zones),!!Number.isFinite(t)&&t},m={1:"Mega Drive",2:"Nintendo 64",3:"SNES",4:"Game Boy",5:"GBA",6:"GBC",7:"NES",8:"PC Engine",9:"Sega CD",10:"32X",11:"Master System",12:"PlayStation",13:"Atari Lynx",14:"Neo Geo Pocket",15:"Game Gear",16:"Game Cube",17:"Atari Jaguar",18:"Nintendo DS",21:"PS2",23:"Magnavox Odyssey 2",24:"Pokemon Mini",25:"Atari 2600",27:"Arcade",28:"Virtual Boy",29:"MSX",33:"SG-1000",37:"Amstrad CPC",38:"Apple II",39:"Saturn",40:"Dreamcast",41:"PSP",43:"3DO",44:"ColecoVision",45:"Intellivision",46:"Vectrex",47:"PC-8000/8800",49:"PC-FX",51:"Atari 7800",53:"WonderSwan",56:"Neo Geo CD",57:"Fairchild Channel F",63:"Watara Supervision",69:"Mega Duck",71:"Arduboy",72:"WASM-4",73:"Arcadia 2001",74:"Interton VC 4000",75:"Elektor TV Games Computer",76:"PC Engine CD/TurboGrafx-CD",77:"Atari Jaguar CD",78:"Nintendo DSi",80:"Uzebox",101:"Events",102:"Standalone"},_={0:" ",1:"Compilation",2:"Strategy",3:"Casino",4:"Music",5:"Action",6:"Platformer",7:"Puzzle",8:"Quiz",9:"Shooter",10:"Vehicle Simulation",11:"Construction and Management Simulation",12:"Fighting",13:"Sports",14:"Role-Playing",15:"Racing",16:"Beat 'em Up",17:"Adventure",18:"Education",19:"Life Simulation",20:"Board Game",21:"Stealth",22:"Pinball",23:"Flight Simulator",24:"Visual Novel",25:"Horror",26:"Sandbox",27:"Party",28:"MMO"};function E(e,t=!1){const s=e<0;s&&(e*=-1);let i=Math.floor(e/3600),n=Math.floor(e%3600/60),a=e%60;i=i<10?"0"+i:i,n=n<10?"0"+n:n,a=a<10?"0"+a:a;const o=`${s?"-":""}${"00"!=i?i+":":""}${n}:${a}`;return t?"00"==i?o:`${s?"-":""}${i}<i class="time__blinked-dots">:</i>${n}`:o}function S(e){if(!e)return"";(e=parseInt(e)??0)<0&&(e*=-1);let t=Math.floor(e/3600),s=Math.floor(e%3600/60),i=e%60;t=t<10?"0"+t:t,s=s<10?"0"+s:s,i=i<10?"0"+i:i;return`${t}:${s}:${i}`}const v=e=>`<p class="badge badge-centered badge_gold">${e}</p>`,A={default:e=>`<i class="badge">${e.trim()}</i>`,black:e=>`<div class="badge badge_black">${e.trim()}</div>`,gold:e=>`<div class="badge badge-centered badge_gold">${e.trim()}</div>`,gameTitle:e=>`<i class="badge game-title_${e.toLowerCase().replace(/[\s\'\"\`]/g,"-")}">${e.trim()}</i>`,gameGenre:e=>`<i class="badge game-title_genre">${e.trim()}</i>`,cheevoLevel:e=>`<div class="target-level-badge badge badge-bold badge_gold" data-title="game level">\n    ${I.flag}${e}\n  </div>`},I={flag:'<i class="description-icon map-icon"></i>',points:'<i class="description-icon points-icon  auto-font-size"></i>',retropoints:'<i class="description-icon retropoints-icon auto-font-size"></i>',cheevos:'<i class="description-icon achievements-icon auto-font-size"></i>',trueratio:'<i class="description-icon rarity-icon  auto-font-size"></i>',rarity:e=>` <i class="description-icon  ps-rarity-icon ${e<5?"ultra-rare":e<10?"very-rare":e<25?"rare":""}"></i>`,retroRatio:e=>`<i class="description-icon  ${e>13?"difficult-badge__hell":""}  rarity-icon"></i>`,cheevoType:e=>`<i class=" description-icon ${e??"none"}" data-title="achievement type [${e??"none"}]"></i> `,chat:'<i class="description-icon link_icon chat-icon"></i>',award:e=>e?`<i class="description-icon award-type__icon ${e}_icon"></i>`:"",favourite:'<i class="description-icon favourite_icon"></i>',apply:'<i class="description-icon link_icon apply-icon"></i>',search:'<i class="description-icon link_icon search-icon google_link"></i>',link:'<i class="description-icon link_icon ra-link_icon"></i>'},T={cheevos:e=>`<p class="signed-icon" data-title="cheevos count">${I.cheevos}${e}</p>`,points:e=>`<p class="signed-icon" data-title="points">${I.points}${e}</p>`,retropoints:e=>`<p class="signed-icon" data-title="retropoints">${I.retropoints}${e}</p>`,rarity:(e,t)=>`<p class="signed-icon" data-title="earned by">${I.rarity(e)}${t}</p>`,retroRatio:e=>`<p class="signed-icon" data-title="true ratio">${I.retroRatio(e)}${e}</p>`,difficulty:e=>`<p class="description-icon difficult-icon difficult-badge__${e}" data-title="cheevo difficult [${e}]"></p>`};class APIWorker{get _savedCompletionProgress(){return w._cfg?.apiWorker?.completionProgress??{}}get SAVED_COMPLETION_PROGRESS(){let e=this._savedCompletionProgress;if(e?.Total&&w._cfg.apiWorker.targetUser===w.targetUser){return new Date-this._savedCompletionProgress.Date<6e4?this._savedCompletionProgress:this.updateCompletionProgress({batchSize:10,savedArray:e.Results}).then((()=>this._savedCompletionProgress))}return this.updateCompletionProgress({batchSize:500}).then((()=>this._savedCompletionProgress))}set SAVED_COMPLETION_PROGRESS(e){e.Results=e.Results.map((e=>(delete e.ConsoleName,delete e.NumLeaderboards,e))),w._cfg.apiWorker||(w._cfg.apiWorker={}),w._cfg.apiWorker.targetUser=w.targetUser,w._cfg.apiWorker.completionProgress=e,w.writeConfiguration()}baseUrl="https://retroachievements.org/API/";endpoints={userProfile:"API_GetUserProfile.php",gameProgress:"API_GetGameInfoAndUserProgress.php",recentAchieves:"API_GetUserRecentAchievements.php",gameInfo:"API_GetGame.php",extendedGameInfo:"API_GetGameExtended.php",recentlyPlayedGames:"API_GetUserRecentlyPlayedGames.php",userAwards:"API_GetUserAwards.php",userGameRankAndScore:"API_GetUserGameRankAndScore.php",completionProgress:"API_GetUserCompletionProgress.php",gameList:"API_GetGameList.php",userSummary:"API_GetUserSummary.php",achievementOfTheWeek:"API_GetAchievementOfTheWeek.php",comments:"API_GetComments.php",wantToPlay:"API_GetUserWantToPlayList.php"};getUrl({endpoint:e,targetUser:t,gameID:s,minutes:i,apiKey:n,userName:a,achievesCount:o,count:r,offset:c,type:l}){let d=new URL(e,this.baseUrl),h={y:n||w.API_KEY,z:a||w.USER_NAME,u:t||w.targetUser,g:s||w.gameID,m:i||2e3,i:s||w.gameID,f:1,h:1,a:o||5,c:r||20,o:c||0,t:l};return e===this.endpoints.userProfile&&delete h.i,d.search=new URLSearchParams(h),d}getAotW(){let e=this.getUrl({endpoint:this.endpoints.achievementOfTheWeek});return fetch(e).then((e=>e.json())).then((e=>{const t=e.Unlocks.find((e=>e.User.toLowerCase()===w.targetUser?.toLowerCase()?.trim()));return{...e.Achievement,ConsoleName:e.Console.Title,ForumTopic:e.ForumTopic.ID,GameID:e.Game.ID,GameTitle:e.Game.Title,StartAt:e.StartAt,TotalPlayers:e.TotalPlayers,UnlocksHardcoreCount:e.UnlocksHardcoreCount,isEarned:!!t,isEarnedHardcore:!!t&&!!t.HardcoreMode}}))}getUserGameRank({targetUser:e,gameID:t}){let s=this.getUrl({endpoint:this.endpoints.userRankAndScore});return fetch(s).then((e=>e.json()))}getProfileInfo({targetUser:e}){let t=this.getUrl({targetUser:e,endpoint:this.endpoints.userProfile});return fetch(t).then((e=>e.json()))}getUserCompelitionProgress({targetUser:e,count:t,offset:s}){let i=this.getUrl({targetUser:e||w.targetUser,count:t||100,offset:s||0,endpoint:this.endpoints.completionProgress});return fetch(i).then((e=>e.json())).then((e=>(e.Results=e.Results.map((e=>(e.ID=e.GameID,e.NumAchievements=e.MaxPossible,delete e.MaxPossible,delete e.NumLeaderboards,e))),e)))}getUserAwards({targetUser:e}){let t=this.getUrl({targetUser:e||w.targetUser,endpoint:this.endpoints.userAwards});return fetch(t).then((e=>e.json())).then((e=>(e.VisibleUserAwards=e.VisibleUserAwards.map((e=>({...e,DateEarnedHardcore:e.AwardedAt,timeString:this.toLocalTimeString(e.AwardedAt),award:"Events"==e.ConsoleName?"event":"Game Beaten"==e.AwardType?"1"==e.AwardDataExtra?"beaten":"beaten_softcore":"1"==e.AwardDataExtra?"mastered":"completed"}))),e)))}getGameProgress({targetUser:e,gameID:t}){let s=this.getUrl({endpoint:this.endpoints.gameProgress,targetUser:e||w.targetUser,gameID:t||w.gameID});return fetch(s).then((e=>e.json())).then((e=>{e={...e,...this.parseBadges(e),TotalRealPlayers:0,TotalRetropoints:0,totalPoints:0,progressionRetroRatio:0,beatenCount:1/0,masteredCount:1/0,beatenSoftCount:1/0,completedCount:1/0,earnedStats:{soft:{count:0,points:0,retropoints:0,progressionCount:0},hard:{count:0,points:0,retropoints:0,progressionCount:0}}};const t={Count:0,WinCount:0,WinAwardedCount:0,WinAwardedSoftCount:0,WinEarnedCount:0},s={isBeaten:!0,isBeatenSoftcore:!0,isWinEarned:!1,isWinEarnedSoftcore:!1};for(let i of Object.values(e.Achievements))e.TotalRetropoints+=i.TrueRatio,e.totalPoints+=i.Points,e.TotalRealPlayers<i.NumAwarded&&(e.TotalRealPlayers=i.NumAwarded),i.DateEarned&&(e.earnedStats.soft.count+=1,e.earnedStats.soft.points+=i.Points,e.earnedStats.soft.retropoints+=i.TrueRatio,"progression"!==i.type&&"win_condition"!==i.type||e.earnedStats.soft.progressionCount++),i.DateEarnedHardcore&&(e.earnedStats.hard.count+=1,e.earnedStats.hard.points+=i.Points,e.earnedStats.hard.retropoints+=i.TrueRatio,"progression"!==i.type&&"win_condition"!==i.type||e.earnedStats.hard.progressionCount++),"progression"===i.type?(t.Count++,!i.DateEarned&&(s.isBeatenSoftcore=!1),!i.DateEarnedHardcore&&(s.isBeaten=!1),e.beatenCount=Math.min(i.NumAwardedHardcore,e.beatenCount),e.beatenSoftCount=Math.min(i.NumAwarded,e.beatenSoftCount)):"win_condition"===i.type&&(t.WinCount++,t.WinAwardedCount=Math.max(i.NumAwardedHardcore,t.WinAwardedCount),t.WinAwardedSoftCount=Math.max(i.NumAwarded,t.WinAwardedSoftCount),i.DateEarnedHardcore&&t.WinEarnedCount++,s.isWinEarned=!!i.DateEarnedHardcore,s.isWinEarnedSoftcore=!!i.DateEarned),e.masteredCount=Math.min(i.NumAwardedHardcore,e.masteredCount),e.completedCount=Math.min(i.NumAwarded,e.completedCount);(e={...e,winVariantCount:t.WinCount,winEarnedCount:t.WinEarnedCount,progressionSteps:t.WinCount>0?t.Count+1:t.Count}).award=e.NumAchievements===e.NumAwardedToUserHardcore?"mastered":e.NumAchievements===e.NumAwardedToUser?"completed":e.award,e.progressionSteps&&(e.progressionAward=s.isBeaten&&e.earnedStats.hard.progressionCount>=e.progressionSteps?"beaten":s.isBeatenSoftcore&&e.earnedStats.soft.progressionCount>=e.progressionSteps?"beaten-softcore":e.progressionAward),t.WinCount>0&&(e.beatenCount=t.WinAwardedCount,e.beatenSoftCount=t.WinAwardedSoftCount),e.beatenCount!=1/0&&(e.beatenRate=~~(1e4*e.beatenCount/e.TotalRealPlayers)/100),e.beatenSoftCount!=1/0&&(e.beatenSoftRate=~~(1e4*e.beatenSoftCount/e.TotalRealPlayers)/100),e.masteredCount!=1/0&&(e.masteryRate=~~(1e4*e.masteredCount/e.TotalRealPlayers)/100),e.completedCount!=1/0&&(e.completedRate=~~(1e4*e.completedCount/e.TotalRealPlayers)/100);const i=~~(e.TotalRetropoints/e.totalPoints*100)/100;return e.retroRatio=i,e.gameDifficulty=i>9?"insane":i>7?"expert":i>5?"pro":i>3?"standard":"easy",Object.values(e.Achievements).map((t=>this.fixAchievement(t,e))),this.parseCheevoLevels(e),this.parseCheevosGenres(e),e}))}getRecentAchieves({targetUser:e,minutes:t}){let s=this.getUrl({endpoint:this.endpoints.recentAchieves,targetUser:e,minutes:t});return fetch(s).then((e=>e.json())).then((e=>e.map((e=>(e.Date=this.toLocalTimeString(e.Date),e)))))}getGameInfo({gameID:e,extended:t}){let s=this.getUrl({endpoint:this.endpoints[t?"extendedGameInfo":"gameInfo"],gameID:e});return fetch(s).then((e=>e.json()))}getWantToPlayGamesList({targetUser:e,count:t,offset:s}){let i=this.getUrl({endpoint:this.endpoints.wantToPlay,targetUser:e,count:t||50,offset:s||0});return fetch(i).then((e=>e.json())).then((e=>e.Results||[]))}getWantToPlayGames({targetUser:e,count:t,offset:s}){let i=this.getUrl({endpoint:this.endpoints.wantToPlay,targetUser:e,count:t||50,offset:s||0});return fetch(i).then((e=>e.json())).then((e=>(e.Results||[]).map((e=>e.ID))))}getRecentlyPlayedGames({targetUser:e,count:t}){let s=this.getUrl({endpoint:this.endpoints.recentlyPlayedGames,targetUser:e,count:t||50});return fetch(s).then((e=>e.json())).then((e=>e.map(((e,t)=>({...e,...this.parseBadges(e),ID:e.GameID,Points:e.ScoreAchievedHardcore+"/"+e.PossibleScore,NumAchievements:e.NumAchievedHardcore+"/"+e.AchievementsTotal,DateEarnedHardcore:e.LastPlayed})))))}getUserProfile({userName:e}){let t=this.getUrl({targetUser:e,userName:e,endpoint:this.endpoints.userProfile});return fetch(t).then((e=>e.json()))}getUserSummary({targetUser:e,gamesCount:t=3,achievesCount:s}){let i=this.getUrl({targetUser:e,gameID:t,achievesCount:s,endpoint:this.endpoints.userSummary});return fetch(i).then((e=>e.json())).then((e=>(e.RecentlyPlayed=e.RecentlyPlayed.map((t=>(t.LastPlayed=this.toLocalTimeString(t.LastPlayed),e.Awarded[t.GameID]&&(t={...t,...e.Awarded[t.GameID]}),t))),e.RecentAchievements=Object.values(e.RecentAchievements).flatMap((e=>Object.values(e))).map((e=>(e.DateAwarded=this.toLocalTimeString(e.DateAwarded),e))),e.RecentlyPlayed.length&&(e.isInGame=new Date-new Date(e.RecentlyPlayed[0].LastPlayed)<3e5),e)))}getComments({targetUser:e,id:t,offset:s=0,count:i=200,type:n=2}){let a=this.getUrl({targetUser:e,gameID:t,type:n,offset:s,count:i,endpoint:this.endpoints.comments});return fetch(a).then((e=>e.json())).then((e=>e.Results?.filter((e=>"Server"!==e.User)).reverse()||[]))}verifyUserIdent({userName:e,apiKey:t}){let s=this.getUrl({targetUser:e,userName:e,apiKey:t,endpoint:this.endpoints.userProfile});return fetch(s).then((e=>e.json()))}getGameList({userName:e,apiKey:t,systemID:s}){let i=this.getUrl({userName:e,apiKey:t,gameID:s,endpoint:this.endpoints.gameList});return fetch(i).then((e=>e.json()))}doTestEndpoint({endpoint:e}){let t=this.getUrl({endpoint:e});return fetch(t).then((e=>e.json())).then((e=>console.log(e)))}async updateCompletionProgress({savedArray:e=[],completionProgress:t=[],batchSize:s=500}){let i=await this.getUserCompelitionProgress({count:s,offset:t.length}),n=(t=[...t,...i.Results]).at(-1);if(e.findIndex((e=>e.hasOwnProperty("GameID")&&e.GameID===n.GameID&&e.MostRecentAwardedDate===n.MostRecentAwardedDate))>=0||t.length===i.Total){const s=t.map((e=>e.GameID));e=e.filter((e=>!s.includes(e.GameID))),e=[...t,...e],this.SAVED_COMPLETION_PROGRESS={Date:new Date,Total:e.length,Results:e}}else setTimeout((()=>this.updateCompletionProgress({savedArray:e,completionProgress:t,batchSize:s})),100)}fixAchievement(e,t){const{BadgeName:s,DateEarned:i,DateEarnedHardcore:n,NumAwardedHardcore:a,NumAwarded:o,TrueRatio:r,ID:c,Points:l}=e,{NumDistinctPlayers:d,NumAwardedToUserHardcore:h,TotalRealPlayers:g}=t,u=100*(a-.5*h)/(.5*(d+g)-.5*h),p=100*a/d;t.Achievements[c]={...e,totalPlayers:d,isEarned:!!i,isHardcoreEarned:!!n,DateEarned:i&&this.toLocalTimeString(i),DateEarnedHardcore:n&&this.toLocalTimeString(n),prevSrc:`https://media.retroachievements.org/Badge/${s}.png`,rateEarned:~~(100*o/d)+"%",rateEarnedHardcore:a<20?a:p<10?`${p.toFixed(1)}%`:`${p.toFixed(0)}%`,trend:u,retroRatio:(r/l).toFixed(2),difficulty:u<1.5&&r>300||r>=500?"hell":u<=3&&r>100||r>=300?"insane":u<8&&r>24?"expert":u<13&&r>10?"pro":u<20&&r>5||r>10?"standard":"easy"}}parseBadges(e){let t=e.Title;const s=[/\[SUBSET[^\[]*\]/gi,/~[^~]*~/g,".HACK//"].reduce(((s,i)=>{const n=new RegExp(i,"gi"),a=e.Title.match(n);return a&&a.forEach((e=>{t=t.replace(e,"");let i=e;s.push(i.replace(/[~\.\[\]]|subset -|\/\//gi,""))})),s}),[]);return e.badges=s,e.FixedTitle=t.trim(),{badges:s,FixedTitle:t.trim()}}toLocalTimeString(e){!/(\+00\:00$)|(z$)/gi.test(e)&&(e+="+00:00");return new Date(e).toLocaleDateString("uk-UA",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})}parseCheevoLevels(e){const t=Object.values(e.Achievements).sort(((e,t)=>0!=e.DisplayOrder?e.DisplayOrder-t.DisplayOrder:e.ID-t.ID)),s=t.reduce(((e,t)=>{const s=(e=>{const t=["Stage","Area","World","Mission","Chapter","Section","Zone","Scene"],s=["Win","Perfect","Clear","Complete","Finish","Beat","Start","Enter","Reach","Select","Bonus","No","Any","Mario","The"],i=function(e){const i="\\b"+[...t,...t.map((e=>e.toLowerCase()))].join("\\b|\\b")+"\\b",n="\\b"+s.join("\\b|\\b")+"\\b",a="\\b[A-Z]\\w*\\b",o=new RegExp(`((?:${i})\\s(?!${n})((${a}\\s*){1,2}))|((?!${n}\\s*)((${a}\\s*){1,2})(?:${i}(?!\\s*\\d)))`,"gm").exec(e),r=o&&(o[2]||o[5]);return r?.trim()}(e.Description);return i})(t);s&&(e.zoneCount++,!e.zoneNames.includes(s)&&e.zoneNames.push(s));const i=(e=>{const t=["level","levels","stage\\b","stages","area","world","mission","chapter","section","zone","phase","realm","domain","episode","act","acts","tier","floor","floors","dimension","region","scene","screen","round\\b","course","board"],s={one:"1",first:"1",two:"2",second:"2",three:"3",third:"3",four:"4",fourth:"4",five:"5",fifth:"5",six:"6",sixth:"6",seven:"7",seventh:"7",eight:"8",eighth:"8",nine:"9",ninth:"9",ten:"10",tenth:"10",eleven:"11",eleventh:"11",twelve:"12",twelfth:"12",thirteen:"13",thirteenth:"13",fourteen:"14",fourteenth:"14",fifteen:"15",fifteenth:"15",sixteen:"16",sixteenth:"16",seventeen:"17",seventeenth:"17",eighteen:"18",eighteenth:"18",nineteen:"19",nineteenth:"19",twenty:"20",twentieth:"20"},i=function(e){const s=t.join("|"),i="(?!\\d{4,}|\\d+%)(\\d{1,3}(?:-\\d{1,3}\\b){0,1})",n=new RegExp(`(?:(${s})\\s(?<level1>${i}))|(?<level2>${i})\\s(?:(${s}))|(?<level3>\\b\\d{1,3}-\\d{1,2}\\b)`,"gi").exec(e);if(n){const e=n.groups.level1||n.groups.level2||n.groups.level3;return parseFloat(e?.replace("-","."))}return null}(function(e){e=e.replaceAll(/(\d)(st|nd|rd|th)/gi,((e,t)=>t));const t=new RegExp(Object.keys(s).map((e=>`\\b${e}\\b`)).join("|"),"gi");return e.replace(t,(e=>s[e.toLowerCase().trim()]))}(e.Description));return i})(t);return i&&(e.levelCount++,e.levelNums.add(i)),e.data.push({ID:t.ID,zone:s,level:i}),e}),{zoneCount:0,levelCount:0,levelNums:new Set,data:[],zoneNames:[]});s?.zoneNames?.forEach(((t,i)=>{Object.values(e.Achievements).forEach((e=>{const i=new RegExp(`\\b${t}\\b`,"gi");(i.test(e.Description)||i.test(e.Title))&&(s.zoneCount++,s.data.push({ID:e.ID,zone:t}))}))})),s.zoneNames.length>3&&s.zoneCount>4&&s.zoneNames.length>=s.levelNums.size?(s.zoneNames=((e,t)=>e.reduce(((e,s)=>(t.forEach((t=>{const i=new RegExp(`\\b${t}\\b`,"g");!e.includes(t)&&(i.test(s.Title)||i.test(s.Description))&&e.push(t)})),e)),[]))(t,s.zoneNames),e.zones=s.zoneNames,s.data.forEach((t=>{t.zone&&(e.Achievements[t.ID].zone=t.zone,e.Achievements[t.ID].level=+`${e.zones.indexOf(t.zone)+1}${t.level?"."+t.level:""}`)}))):(s.levelCount,s.levelNums.size>3?s.data.forEach((t=>{delete e.Achievements[t.ID].zone,e.Achievements[t.ID].level=t.level})):s.data.forEach((t=>{delete e.Achievements[t.ID].zone,delete e.Achievements[t.ID].level})))}parseCheevosGenres(e){Object.values(e.Achievements).forEach((e=>{e.genres=[],(e=>{["first","second","third","fourth","fifth","sixth","seventh","eighth"].join("\\b|\\b");const t="\\b"+["Defeat","defeat","(K|k)ill"].join("\\b|\\b")+"\\b",s="\\b"+["(?:T|t)he\\b","(?:M|m)rs{0,1}\\b[.]*","(?:D|d)r\\b[.]*"].join("|\\b"),i="\\b"+["All"].join("\\b|\\b")+"\\b";return new RegExp(`((${t})\\s*(${s})*\\s*(?!${i})(?:(['"]*[A-Z]\\w*\\b)|((all)*[\\s\\w]*boss(es)*)))`,"g").exec(e.Description)})(e)&&e.genres.push("bossfight"),(e=>{const t="\\b"+["(?:C|c)ollect","by collecting","(?:O|o)btain","(?:S|s)till","(?:P|p)ick\\sup"].join("\\b|\\b")+"\\b",s=["(?:P|p)oints","(?:S|s)core"].join("|");return new RegExp(`(?:${t})(?![^.]*(?:${s}))[^.]+(?:.|w$)`,"g").exec(e.Description)})(e)&&e.genres.push("collector"),(e=>new RegExp("(((W|w)ithout|no)\\b[\\s\\w]*((D|d)amage|(H|h)armed)|(\\b(with)|at)\\b\\sfull\\s(\\b(health)|(life)))","gi").exec(e.Description))(e)&&e.genres.push("no-damage"),(e=>{const t=["without\\sdying","(without|\\bno(t)*)\\slosing\\s(a)*\\slife","\\bno(t)*\\s(dying|death)"].join("|");return new RegExp(`${t},"gi"`).exec(e.Description)})(e)&&e.genres.push("no-death"),(e=>{const t=["\\b(?:M|m)inute","\\b(?:S|s)econds","\\b(?:H|h)our"].join("|");return new RegExp(`((?:\\bin\\b|\\bless|\\bunder|\\bfor|\\within)[\\s\\w\\d:]*(?:${t}))|(.*\\d{0,2}:\\d{2})`,"g").exec(e.Description)})(e)&&e.genres.push("timetrial"),(e=>{const t="\\b"+["(?:S|s)core(?:d|s){0,1}","(?:(P|p)oints{0,1})","(?:PTS|pts|Pts)","(?:E|e)arn"].join("\\b|\\b")+"\\b",s="\\d{1,3}[.,]{0,1}(?:\\d{3,}[.,]{0,1})+";return new RegExp(`(?:(?:${t})[^.]+)${s}|(?:${s}[^.]+(?:${t}))`,"g").exec([e.Title,e.Description].join(". "))})(e)&&e.genres.push("score")}))}async rawgSearchGame({gameTitle:e,platformID:t}){e=e.split("|")[0];const s=f[t];if(!s)return!1;let i=new URL("games","https://api.rawg.io/api/"),n={search:e,platforms:s,key:"179353905bcb491d975b1fc03b3c8bd6"};i.search=new URLSearchParams(n);try{const s=await fetch(i);if(!s.ok)return console.log(`HTTP error! status: ${s.status}`),!1;const n=await s.json(),a=n.results?n.results[0]:null,o=e.replace(/[^a-z0-9]/gi," ").trim(),r=a?.name.replace(/[^a-z0-9]/gi," ").trim()??"";if(!a||o!==r)return console.log(`Game not found for title: ${e} on platform: ${t}`),!1;const c=["name","playtime","released","background_image","rating","ratings","added","metacritic","score","community_rating","genres"];return Object.fromEntries(Object.entries(a).filter((([e])=>c.includes(e))))}catch(e){return console.log(`Fetch error: ${e.message}`),!1}}}const f={1:167,2:83,3:79,4:26,5:24,6:43,7:49,8:null,9:119,10:117,11:74,12:27,13:46,14:null,15:77,17:112,18:9,21:15,23:null,24:null,25:23,27:12,28:null,29:null,33:null,37:null,38:41,39:107,40:106,41:17,43:111,44:null,45:null,46:null,47:null,49:null,51:28,53:null,56:null,57:null,63:null,69:null,71:null,72:null,73:null,74:null,75:null,76:null,77:null,78:13,80:null,101:null,102:null};class Watcher{RP_DATA={text:"",lastChange:""};IS_ONLINE=!0;IS_HARD_MODE=!0;IS_WATCHING=!1;RECENT_ACHIVES_RANGE_MINUTES=Math.max(5*w.updateDelay/60,5);CHECK_FOR_ONLINE_DELAY_MS=6e4;CHECK_FOR_ONLINE_AFTER_SILENCE_MS=18e4;watcherInterval;playTime={totalGameTime:0,gameTime:0,sessionTime:0,timer:60};points={hard:0,soft:0};get CHEEVOS(){return this.GAME_DATA?.Achievements??{}}get GAME_DATA(){return this._gameData}set GAME_DATA(e){const t=this.GAME_DATA&&e.ID!=this.GAME_DATA?.ID;this._gameData=e,(()=>{this.savePlayTime(),this.initPlayTime()})(),(t=>{b.statusPanel.gameChangeEvent(t),b.status?.gameChangeEvent(t),b.gameList?.gameChangeEvent(),b.achievementsBlock.forEach((e=>e?.parseGameAchievements(this.GAME_DATA))),b.gameCard?.updateGameCardInfo(this.GAME_DATA),b.target.gameChangeEvent(),b.note?.updateGame(),t&&b.notifications?.pushNotification({type:b.notifications.types.newGame,elements:e}),b.progression?.generateProgression()})(t)}constructor(){w._cfg.playTime||(w._cfg.playTime={}),this.isActive=!1}initPlayTime=()=>{const e=this.GAME_DATA?.ID??0,t=w._cfg.playTime[e]??0;this.playTime={...this.playTime,gameID:e,totalGameTime:t,gameTime:0,timer:60}};gameChangeEvent(){this.savePlayTime(),this.initPlayTime()}async checkForOnline(){console.log("Checking for online...");const e=(e=>{!/(\+00\:00$)|(z$)/gi.test(e)&&(e+="+00:00");return new Date(e)})((await C.getRecentlyPlayedGames({count:1}))[0].LastPlayed);if(!b.settings.PAUSE_ON_OFFLINE||new Date-e<18e4)this.RP_DATA.lastChange=new Date,!this.IS_ONLINE&&(this.IS_ONLINE=!0,this.checkApiUpdates()),this.IS_ONLINE=!0;else{if(this.IS_ONLINE=!1,!this.IS_WATCHING)return;setTimeout((()=>this.checkForOnline()),this.CHECK_FOR_ONLINE_DELAY_MS)}}apiTrackerInterval;async checkApiUpdates(e=!1){const t=e=>{this.points.hard=e.TotalPoints,this.points.soft=e.TotalSoftcorePoints};if(!(e||b.settings.PAUSE_ON_OFFLINE&&this.IS_ONLINE))return;const s=await C.getProfileInfo({});(s.LastGameID!=this.GAME_DATA?.ID||e)&&(w.gameID=s.LastGameID,e&&t(s),await this.updateGameData(s.LastGameID),(b.settings.DISCORD_NEW_GAME||e&&b.settings.DISCORD_START_SESSION)&&b.sendDiscordMessage({type:y.game})),(e=>e.TotalPoints!=this.points.hard||e.TotalSoftcorePoints!=this.points.soft)(s)&&(t(s),this.updateCheevos(),this.RP_DATA.lastChange=new Date);const i=s.RichPresenceMsg;b.updateWidgetsRichPresence(i),i!==this.RP_DATA.text?(this.RP_DATA.lastChange=new Date,this.RP_DATA.text=s.RichPresenceMsg,this.IS_ONLINE=!0):!e&&this.RP_DATA.lastChange&&new Date-this.RP_DATA.lastChange>this.CHECK_FOR_ONLINE_AFTER_SILENCE_MS&&await this.checkForOnline()}async updateGameData(e){e||(e=await(async()=>{const e=Object.values(await C.getRecentlyPlayedGames({count:1}))[0]?.ID;return w.gameID=e,e})());try{const t=await C.getGameProgress({gameID:e});this.GAME_DATA=t}catch(e){this.stop,console.error(e)}}async updateCheevos(){const e=e=>{let t=[];e.forEach((e=>{const s=this.CHEEVOS[e.AchievementID];if(s){const i=1===e.HardcoreMode&&!s?.isHardcoreEarned;(!s.isEarned||i)&&t.push(e)}})),(e=>{e.forEach((e=>{const{HardcoreMode:t,Date:s}=e,i=this.CHEEVOS[e.AchievementID],n=1==t;this.IS_HARD_MODE=n,n&&(i.isHardcoreEarned=!0,i.DateEarnedHardcore=s,this.GAME_DATA.earnedStats.hard.count++,this.GAME_DATA.earnedStats.hard.points+=i.Points,this.GAME_DATA.earnedStats.hard.retropoints+=i.TrueRatio,"progression"!=i.type&&"win_condition"!=i.type||this.GAME_DATA.earnedStats.hard.progressionCount++),this.GAME_DATA.earnedStats.soft.count++,this.GAME_DATA.earnedStats.soft.points+=i.Points,"progression"!=i.type&&"win_condition"!=i.type||this.GAME_DATA.earnedStats.soft.progressionCount++,i.isEarned=!0,i.DateEarned=i.DateEarned??s,this.CHEEVOS[e.AchievementID]=i}))})(t);const s=t?.map((e=>e.AchievementID));return s},t=()=>{let e=[];return"mastered"!==this.GAME_DATA.award&&this.GAME_DATA.earnedStats.hard.count===this.GAME_DATA.NumAchievements?(this.GAME_DATA.award="mastered",e.push({type:"new-award",award:"mastered",value:this.GAME_DATA})):this.GAME_DATA.award||this.GAME_DATA.earnedStats.soft.count!==this.GAME_DATA.NumAchievements||(this.GAME_DATA.award="completed",e.push({type:"new-award",award:"completed",value:this.GAME_DATA})),this.GAME_DATA.progressionSteps>0&&"beaten"!==this.GAME_DATA.progressionAward&&this.GAME_DATA.earnedStats.hard.progressionCount>=this.GAME_DATA.progressionSteps?(this.GAME_DATA.progressionAward="beaten",e.push({type:"new-award",award:"beaten",value:this.GAME_DATA})):this.GAME_DATA.progressionSteps>0&&!this.GAME_DATA.progressionAward&&this.GAME_DATA.earnedStats.soft.progressionCount>=this.GAME_DATA.progressionSteps&&(this.GAME_DATA.progressionAward="beaten-softcore",e.push({type:"new-award",award:"beaten-softcore",value:this.GAME_DATA})),e};try{const s=e(await C.getRecentAchieves({minutes:this.RECENT_ACHIVES_RANGE_MINUTES}));b.showCheevoAlerts(s),b.updateWidgets({earnedAchievementsIDs:s});const i=t();b.showAwardsAlerts(i)}catch(e){console.error(e)}}checkForAwards({earnedAchievementIDs:e=[]}){if(e.length){const t=()=>{};let s=e.map((e=>({type:"new-achiv",value:watcher.CHEEVOS[e]})));const i=t();if(this.settings.DISCORD_NEW_CHEEVO)for(let t of e)this.sendDiscordMessage({type:"earned-cheevo",id:t});i.length>0&&this.settings.DISCORD_NEW_AWARD&&i.forEach((e=>this.sendDiscordMessage({message:e.award,type:"award",id:w.gameID}))),i.length>0&&(s=[...s,...i],setTimeout((()=>b.stats.updateChart()),4e3)),this.statusPanel.addAlertsToQuery(s),this.status.addAlertsToQuery(s)}}start(){const e=()=>{this.IS_ONLINE&&(this.playTime.totalGameTime++,this.playTime.gameTime++,this.playTime.sessionTime++,this.playTime.timer--)},t=()=>{b.statusPanel.blinkUpdate(),b.status.blinkUpdate()};this.stop(),(()=>{this.checkApiUpdates(!0),this.IS_WATCHING=!0,this.apiTrackerInterval=setInterval((()=>{t(),this.checkApiUpdates()}),w.updateDelayInMiliSecs)})(),(()=>{this.isActive=!0,this.initPlayTime()})(),b.statusPanel.timeWatcher().start(),b.status.timeWatcher().start(),this.watcherInterval=setInterval((()=>{e(),this.playTime.gameTime%60==0&&this.savePlayTime()}),1e3)}stop(){clearInterval(this.apiTrackerInterval),this.IS_WATCHING=!1,this.isActive=!1,this.playTime.totalGameTime&&this.savePlayTime(),this.watcherInterval&&clearInterval(this.watcherInterval),this.playTime.sessionTime=0,b.statusPanel.timeWatcher().stop(),b.status.timeWatcher().stop()}savePlayTime(){w._cfg.playTime[this.playTime.gameID]=this.playTime.totalGameTime,w.writeConfiguration()}}const y={game:"new-game"};let w,b,C,R;const O=navigator.userAgent||navigator.vendor||window.opera;/android/i.test(O)||/iPhone/.test(O)&&!window.MSStream?window.location.href="./mobile/index.html":(w=new Config,b=new ui_UI,C=new APIWorker,R=new Watcher,window.ui=b,window.config=w,window.apiWorker=C,window.watcher=R),w.identConfirmed||(console.log("redirect to login"),window.location.href="./login"),document.addEventListener("keydown",(function(e){const t=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","KeyB","KeyA"],s=e.code;s===t[L.length]?(L.push(s),L.length===t.length&&(D=1===D?2:1,function(){P&&clearTimeout(P),document.querySelector("#secret")?.remove();let e=document.createElement("audio");10!==L.length&&(e=null),L=[],e.id="secret",e.innerHTML=`\n    <source src="./assets/s/ss-${D}.m4a" type="audio/mpeg">\n  `,b.app.appendChild(e),e.play();const t=document.querySelector("#background-animation");t.style.opacity=0,setTimeout((()=>{t.style.opacity=1,t.classList.add("secret"),document.querySelector("#background-animation").style.display="block"}),2e3);P=setTimeout((()=>{t.classList.remove("secret"),document.querySelector("#background-animation").style.display=w.bgVisibility?"block":"none"}),1e3*(2===D?240:66))}())):L=[]}));let L=[],D=0,P=0})();